[{"id":"0199eae0-e721-72eb-b29c-d4284d96e53c","type":"userMessage","contents":[{"type":"text","text":"I want to create a Reddit-like community platform.\r\n\r\nSince I'm not familiar with programming, please write a requirements analysis report as you see fit.\r\n\r\nHere are the key features I want:\r\n- User registration and login\r\n- Create communities (subreddits)\r\n- Post text, links, or images in communities\r\n- Upvote/downvote posts and comments\r\n- Comment on posts with nested replies\r\n- User karma system\r\n- Sort posts by hot, new, top, controversial\r\n- Subscribe to communities\r\n- User profiles showing their posts and comments\r\n- Report inappropriate content"}],"created_at":"2025-10-16T02:37:11.841Z"},{"id":"0199eae0-ec68-706b-b12b-e66d83b12cf3","type":"assistantMessage","text":"I'll help you create a Reddit-like community platform. Let me gather some more details to ensure we build exactly what you need.\n\nTo confirm your requirements, you want a platform where:\n- Users can register and login to accounts\n- Create communities (like subreddits)\n- Post different types of content (text, links, images)\n- Upvote/downvote posts and comments\n- Have nested comment replies\n- Track user karma\n- Sort posts by different criteria (hot, new, top, controversial)\n- Subscribe to communities\n- View user profiles with their activity\n- Report inappropriate content\n\nBefore I create the requirements analysis report, I'd like to ask a few clarifying questions:\n\n1. **User Roles**: Should there be different types of users (like regular users, moderators, admins)? What special permissions or capabilities should each role have?\n\n2. **Content Types**: For posts, you mentioned text, links, and images. Are there any other types of content you'd like to support, like videos or polls?\n\n3. **Voting System**: Should users be able to change their vote after initially upvoting or downvoting? Should there be any restrictions on who can vote (new accounts, karma requirements, etc.)?\n\n4. **Community Management**: Should community creators automatically become moderators? What moderation tools do you envision (delete posts, ban users, etc.)?\n\n5. **Karma System**: How should karma be calculated? Is it based only on upvotes to posts and comments, or other factors as well?\n\n6. **Sorting Algorithm**: For \"hot\" and \"controversial\" sorting, do you have specific algorithms in mind, or should we implement standard approaches?\n\n7. **Reporting System**: What happens after content is reported? Should there be a review process? Who handles these reviews?\n\nOnce I have your answers to these questions, I can proceed with creating a comprehensive requirements analysis report.","created_at":"2025-10-16T02:37:13.192Z","completed_at":"2025-10-16T02:37:13.735Z"},{"id":"0199eae0-ee9c-72a8-8dd8-e6ab178c8e6e","type":"userMessage","contents":[{"type":"text","text":"I'm not familiar with the analyze feature. Please determine everything by yourself, and just show me the analysis report."}],"created_at":"2025-10-16T02:37:13.756Z"},{"type":"analyze","id":"0199eae1-eef7-73ff-aa4f-6a81910a7335","instruction":"Focus on creating a Reddit-like community platform with core features including user registration and login, community creation (subreddits), posting capabilities (text, links, images), upvote/downvote functionality for posts and comments, nested comment replies, user karma system, post sorting (hot, new, top, controversial), community subscription, user profiles showing posts and comments, and content reporting system. Prioritize user-friendly design with clear community structure and engagement features.","prefix":"redditClone","roles":[{"name":"guest","kind":"guest","description":"Unauthenticated users who can browse public content, register, and login"},{"name":"member","kind":"member","description":"Authenticated users who can create posts, comment, vote, subscribe to communities, and manage their profiles"},{"name":"moderator","kind":"member","description":"Community moderators with additional permissions to manage community content, remove posts/comments, and ban users"},{"name":"admin","kind":"admin","description":"System administrators with full access to manage users, communities, and handle reported content"}],"files":[{"filename":"00-toc.md","reason":"Table of contents for the entire requirements analysis report","documentType":"requirement","outline":["Table of Contents","Document Overview","Developer Autonomy Note"],"audience":"backend developers","keyQuestions":[],"detailLevel":"comprehensive","relatedDocuments":[],"constraints":[],"content":"# Reddit-like Community Platform Requirements Analysis Report\n\n## Table of Contents\n\n1. [Service Overview Document](./01-service-overview.md)\n   - Service Vision\n   - Business Justification\n   - Core Value Proposition\n   - Success Metrics\n\n2. [User Roles Document](./02-user-roles.md)\n   - User Role Structure\n   - Authentication Requirements\n   - Permission Matrix\n   - JWT Specifications\n\n3. [Registration and Login Document](./03-registration-login.md)\n   - User Registration Flow\n   - Login Process\n   - Password Management\n   - Session Handling\n\n4. [Community Management Document](./04-community-management.md)\n   - Community Creation\n   - Community Settings\n   - Moderation Tools\n   - Community Discovery\n\n5. [Posting System Document](./05-posting-system.md)\n   - Post Types\n   - Content Validation\n   - Post Creation Flow\n   - Post Editing\n\n6. [Voting System Document](./06-voting-system.md)\n   - Voting Mechanics\n   - Vote Tracking\n   - Karma Calculation\n   - Vote Restrictions\n\n7. [Commenting System Document](./07-commenting-system.md)\n   - Comment Creation\n   - Nested Replies\n   - Comment Management\n   - Comment Display\n\n8. [Content Sorting Document](./08-content-sorting.md)\n   - Sorting Algorithms\n   - Hot Posts Calculation\n   - Top Posts Periods\n   - Controversial Posts\n\n9. [Subscription System Document](./09-subscription-system.md)\n   - Subscription Mechanics\n   - Subscription Tracking\n   - Community Feed\n   - Notification Settings\n\n10. [User Profiles Document](./10-user-profiles.md)\n    - Profile Information\n    - Activity Display\n    - Post History\n    - Comment History\n\n11. [Content Reporting Document](./11-content-reporting.md)\n    - Reporting Mechanism\n    - Report Categories\n    - Moderation Workflow\n    - Admin Actions\n\n## Document Overview\n\nThis requirements analysis report provides a comprehensive specification for building a Reddit-like community platform. The platform will enable users to create accounts, form communities, share content, and engage through voting and commenting mechanisms.\n\nThe documentation is structured into specialized sections that focus on distinct functional areas of the system. Each document defines WHAT the system should do rather than HOW it should be implemented, allowing backend developers complete autonomy over technical decisions including architecture, database design, and API specifications.\n\nThe user roles defined for this system include:\n- Guest: Unauthenticated users who can browse public content, register, and login\n- Member: Authenticated users who can create posts, comment, vote, subscribe to communities, and manage their profiles\n- Moderator: Community moderators with additional permissions to manage community content, remove posts/comments, and ban users\n- Admin: System administrators with full access to manage users, communities, and handle reported content\n\nAll requirements in these documents follow the EARS (Easy Approach to Requirements Syntax) format to ensure clarity and testability. The templates include:\n- WHEN <trigger>, THE <system> SHALL <function>\n- WHILE <state>, THE <system> SHALL <function>\n- IF <condition>, THEN THE <system> SHALL <function>\n- WHERE <feature/condition>, THE <system> SHALL <function>\n- THE <system> SHALL <function>\n\n> *Developer Note: This document defines **business requirements only**. All technical implementations (architecture, APIs, database design, etc.) are at the discretion of the development team.*"},{"filename":"01-service-overview.md","reason":"Provide an overview of the Reddit-like community platform, its purpose, and vision","documentType":"service-overview","outline":["Service Vision","Business Justification","Core Value Proposition","Success Metrics"],"audience":"backend developers","keyQuestions":["What is this service and why does it exist?","What problems does it solve for users?","What are the key benefits?"],"detailLevel":"comprehensive","relatedDocuments":[],"constraints":[],"content":"# Reddit-like Community Platform Requirements Analysis Report\n\n## Executive Summary\n\nThis document outlines the complete requirements for a Reddit-like community platform that allows users to create accounts, form communities, share content, and interact through voting and commenting systems. The platform will support multiple content types, user reputation through karma, content sorting algorithms, community subscriptions, user profiles, and a content reporting/moderation system.\n\n## Service Overview\n\nTHE redditClone service SHALL provide a platform for users to create communities, share content, and engage with each other through voting and commenting mechanisms.\n\n### Core Features\n\n- User registration and authentication system\n- Community (subreddit-like) creation and management\n- Multi-format posting (text, links, images)\n- Upvote/downvote functionality for posts and comments\n- Nested commenting system\n- User karma and reputation tracking\n- Multiple content sorting algorithms\n- Community subscription functionality\n- User profile pages with activity history\n- Content reporting and moderation workflow\n\n## User Roles and Authentication\n\nThe system SHALL support four distinct user roles with varying permissions:\n\n### Guest Users\n- Can browse public communities and content\n- Can view posts and comments\n- Cannot create content, vote, or subscribe to communities\n- SHALL be redirected to login for restricted actions\n\n### Member Users\n- Authenticated users with full posting capabilities\n- Can create posts in communities\n- Can comment and reply to comments\n- Can upvote/downvotes posts and comments\n- Can subscribe to communities\n- Have karma scores based on community engagement\n- Can report inappropriate content\n- Have customizable user profiles\n\n### Moderator Users\n- Members with additional community management capabilities\n- Can remove posts and comments from their communities\n- Can ban users from their communities\n- Can edit community settings and descriptions\n- Have all member privileges plus moderation tools\n\n### Admin Users\n- System administrators with full platform control\n- Can manage all users, communities, and content\n- Handle reported content and take enforcement actions\n- Can create, modify, or delete any community\n- Have access to system analytics and user data (within legal boundaries)\n\n## Functional Requirements\n\n### User Registration and Login System\n\nWHEN a guest accesses the platform, THE system SHALL present registration and login options.\n\nWHEN a guest chooses to register, THE system SHALL collect username, email address, and password.\n\nWHEN a user submits registration information, THE system SHALL validate:\n- Username SHALL be unique and between 3-20 characters\n- Email SHALL be in valid format and unique\n- Password SHALL be at least 8 characters long\n\nWHEN registration information is valid, THE system SHALL create a member account with default permissions.\n\nWHEN a user provides valid credentials for login, THE system SHALL authenticate the user and create a session.\n\nWHEN a user requests logout, THE system SHALL terminate the current session immediately.\n\n### Community Management System\n\nWHEN an authenticated member chooses to create a community, THE system SHALL require:\n- Unique community name (3-21 characters, alphanumeric and underscores)\n- Community description (max 500 characters)\n- Privacy settings (public, restricted, or private)\n\nTHE system SHALL allow community creators to automatically become moderators.\n\nWHEN a moderator accesses community settings, THE system SHALL permit modification of:\n- Community description\n- Privacy settings\n- Banner and icon images\n- Rules and guidelines\n- Moderator list (add/remove moderators)\n\nWHEN a moderator removes a post or comment, THE system SHALL:\n- Archive the removed content\n- Display a notice to users that content was removed by moderator\n- Log the moderation action for audit purposes\n\n### Content Posting System\n\nWHEN a member chooses to create a post, THE system SHALL offer three content types:\n- Text posts (max 40,000 characters)\n- Link posts (valid URL validation)\n- Image posts (JPG, PNG, GIF formats with max 10MB size)\n\nTHE system SHALL require each post to include:\n- Title (max 300 characters)\n- Community selection from user's subscribed communities\n- Content appropriate to selected post type\n\nWHEN a user submits a post, THE system SHALL validate:\n- Title contains between 1-300 characters\n- URL is valid for link posts\n- Image meets size/type requirements for image posts\n- Community selection is valid and accessible to user\n\nTHE system SHALL store all posts with metadata including:\n- Creation timestamp\n- Author identification\n- Community association\n- Vote counts (upvotes, downvotes, net score)\n- Comment count\n\n### Voting System\n\nWHEN a member interacts with a post or comment, THE system SHALL provide upvote and downvote options.\n\nWHEN a member upvotes content, THE system SHALL:\n- Increment the content's upvote count\n- Add +1 to the author's karma score\n- Track the user's vote to prevent multiple votes\n\nWHEN a member downvotes content, THE system SHALL:\n- Increment the content's downvote count\n- Subtract -1 from the author's karma score\n- Track the user's vote to prevent multiple votes\n\nTHE system SHALL allow users to change votes:\n- IF a user has previously upvoted content and clicks downvote, THEN the system SHALL decrement upvote and increment downvote\n- IF a user has previously downvoted content and clicks upvote, THEN the system SHALL decrement downvote and increment upvote\n- IF a user clicks the same vote option twice, THEN the system SHALL remove that vote\n\nTHE system SHALL update displayed scores in real-time upon user voting actions.\n\n### Commenting System\n\nWHEN a member chooses to comment on a post, THE system SHALL provide a text input (max 10,000 characters).\n\nWHEN a member replies to a comment, THE system SHALL create a nested reply structure with:\n- Parent-child relationships between comments\n- Indentation visual hierarchy\n- Up to 10 levels of nesting\n\nWHEN a user submits a comment, THE system SHALL:\n- Validate that the comment contains text (1-10,000 characters)\n- Store the comment with parent relationship if replying\n- Update the post's comment count\n- Notify relevant users based on subscription settings\n\nTHE system SHALL allow users to edit their comments within 15 minutes of posting.\n\nTHE system SHALL allow users to delete their comments if they have no replies.\n\nWHEN a comment has replies, THE system SHALL NOT permit deletion, BUT SHALL allow editing to indicate \"[deleted]\".\n\n### Content Sorting Algorithms\n\nTHE system SHALL provide four content sorting mechanisms:\n\n1. Hot posts algorithm:\n   - WHILE calculating hot scores, THE system SHALL use the formula: \n     Score = (Upvotes - Downvotes) / (Time since posting in hours + 2)^1.8\n   - Posts SHALL be sorted by this calculated score in descending order\n\n2. New posts algorithm:\n   - THE system SHALL display posts in chronological order with newest first\n\n3. Top posts algorithm:\n   - THE system SHALL rank posts by net vote score (upvotes - downvotes)\n   - WHEN displaying top posts, THE system SHALL provide time filtering:\n     - Today (posts from last 24 hours)\n     - This week (posts from last 7 days)\n     - This month (posts from last 30 days)\n     - This year (posts from last 365 days)\n     - All time (all posts)\n\n4. Controversial posts algorithm:\n   - WHILE calculating controversial scores, THE system SHALL use a formula that favors posts with:\n     - High absolute vote counts (upvotes + downvotes)\n     - Balanced upvote/downvote ratios (close to 1:1)\n   - Posts SHALL be sorted based on this controversy metric\n\n### Subscription System\n\nWHEN a member visits a community page, THE system SHALL display a \"subscribe/unsubscribe\" toggle.\n\nWHEN a user subscribes to a community, THE system SHALL:\n- Add the community to the user's subscription list\n- Include posts from this community in the user's home feed\n- Notify the user of new posts based on notification settings\n\nWHEN a user unsubscribes from a community, THE system SHALL:\n- Remove the community from the user's subscription list\n- Remove posts from this community from the user's home feed\n\nTHE system SHALL display subscribed communities on the user's profile page.\n\nTHE system SHALL limit users to 10,000 community subscriptions.\n\n### User Profile System\n\nTHE system SHALL display user profile pages showing:\n- Username and registration date\n- Karma score\n- List of recent posts\n- List of recent comments\n- Subscribed communities\n\nWHEN a user visits their own profile page, THE system SHALL provide:\n- Account settings modification options\n- Notification preference controls\n- Privacy settings management\n\nWHEN a user visits another user's profile page, THE system SHALL:\n- Display public information only\n- Show content history based on community privacy settings\n- Hide private information and settings\n\n### Content Reporting and Moderation System\n\nWHEN a member encounters inappropriate content, THE system SHALL provide a reporting mechanism with these categories:\n- Spam or misleading content\n- Harassment or bullying\n- Hate speech or discrimination\n- Violence or threats\n- Personal information sharing\n- Sexual content\n- Illegal activities\n- Other (custom reason field)\n\nWHEN a user submits a content report, THE system SHALL:\n- Store the report with metadata (timestamp, reporter ID, content ID, reason)\n- Add the report to a moderation queue\n- Prevent duplicate reports from the same user for the same content\n\nTHE system SHALL implement a moderation workflow with these steps:\n1. Report submission creates a moderation ticket\n2. Moderators can view and filter tickets by community\n3. Moderators can mark tickets as reviewed\n4. Moderators can take actions (remove content, warn user, ban user)\n5. Reporters receive status updates on their submissions\n\nWHEN a moderator removes reported content, THE system SHALL:\n- Archive the removed content\n- Display a notice that content was removed for violating community guidelines\n- Update the reporter's ticket with resolution status\n\nWHEN an admin bans a user, THE system SHALL:\n- Immediately terminate all user sessions\n- Prevent further login attempts\n- Display a notice that the account has been suspended\n- Log the ban reason and administrator responsible\n\n## Business Rules\n\nTHE system SHALL enforce these core business rules:\n\n1. User Account Rules:\n   - Users must verify email before posting content\n   - Usernames must be unique across the platform\n   - Deleted user accounts SHALL retain content for historical purposes\n\n2. Content Rules:\n   - Posts SHALL be associated with exactly one community\n   - Posts cannot be moved between communities after creation\n   - Comments must be associated with exactly one post\n   - Links in posts SHALL be validated as accessible URLs\n\n3. Karma Rules:\n   - Users SHALL receive +1 karma for each upvote on their content\n   - Users SHALL receive -1 karma for each downvote on their content\n   - Users SHALL receive 0 karma for self-votes (system prevents self-voting)\n   - Deleted content SHALL not affect karma scores\n\n4. Community Rules:\n   - Community names SHALL be unique and URL-safe\n   - Community creators SHALL automatically become moderators\n   - Only moderators can modify community settings\n   - Each community SHALL have at least one moderator\n\n5. Moderation Rules:\n   - Users SHALL only report content once per item\n   - Moderators SHALL only moderate communities they belong to\n   - Admins SHALL have access to all moderation actions\n   - Removal actions SHALL provide reasons visible to content creators\n\n## Error Handling Requirements\n\nIF a user attempts to access restricted functionality without authentication, THEN THE system SHALL redirect to the login page.\n\nIF a user submits invalid registration information, THEN THE system SHALL display appropriate error messages:\n- \"Username must be between 3 and 20 characters\"\n- \"Email address is invalid\"\n- \"Password must be at least 8 characters\"\n\nIF a user attempts to post invalid content, THEN THE system SHALL display appropriate error messages:\n- \"Title is required and must be between 1-300 characters\"\n- \"URL is invalid for link posts\"\n- \"Image exceeds 10MB size limit\"\n- \"Image format not supported\"\n\nIF a user tries to subscribe to more than 10,000 communities, THEN THE system SHALL display error: \"Maximum subscription limit reached\"\n\nIF a user attempts to access a non-existent community, THEN THE system SHALL display error: \"Community not found\"\n\nIF a user attempts to create a community with an existing name, THEN THE system SHALL display error: \"Community name already taken\"\n\nIF a user attempts to vote on content multiple times, THEN THE system SHALL reject additional votes and maintain the existing vote.\n\n## Performance Requirements\n\nWHEN a user loads the homepage, THE system SHALL display content within 2 seconds.\n\nWHEN a user submits a post, THE system SHALL process and display the post within 1 second.\n\nWHEN a user votes on content, THE system SHALL update vote counts immediately.\n\nWHEN a user submits a comment, THE system SHALL display the comment within 500 milliseconds.\n\nWHEN searching for communities, THE system SHALL return results within 1 second.\n\nTHE system SHALL support up to 10,000 concurrent users.\n\nTHE system SHALL maintain 99.5% uptime.\n\nWHEN retrieving user profile information, THE system SHALL respond within 1.5 seconds.\n\nTHE system SHALL cache hot posts for 5 minutes to improve performance during high traffic.\n\n## Success Metrics\n\nTHE system SHALL track these key performance indicators:\n\n1. User Engagement:\n   - Daily Active Users (DAU)\n   - Monthly Active Users (MAU)\n   - Average session duration\n   - Posts created per day\n   - Comments created per day\n\n2. Community Growth:\n   - Number of communities created\n   - Subscription rates per community\n   - Community activity levels (posts/comments per day)\n\n3. Content Quality:\n   - Report resolution time\n   - User satisfaction with content relevance\n   - High karma content ratio\n\n4. Technical Performance:\n   - Average page load times\n   - Uptime percentage\n   - Concurrent user capacity utilization\n\nThese requirements SHALL serve as the foundation for backend developers to implement the Reddit-like community platform. Each requirement follows EARS format to ensure clarity, testability and prevent ambiguity in the implementation process."},{"filename":"02-user-roles.md","reason":"Define the different user roles and their permissions in the system","documentType":"requirement","outline":["User Role Structure","Authentication Requirements","Permission Matrix","JWT Specifications"],"audience":"backend developers","keyQuestions":["What types of users will use the system?","What permissions does each role have?","How does authentication work?"],"detailLevel":"detailed","relatedDocuments":[],"constraints":[],"content":"# Reddit-like Community Platform Requirements Analysis\n\n## Service Overview\n\nTHE redditClone service SHALL provide users with a platform for community-driven content sharing and discussion similar to Reddit.\n\nWHEN users access the platform, THE system SHALL present a familiar interface with communities (subreddits), user-generated posts, and threaded discussions.\n\nWHERE users seek information, share content, or engage in discussions, THE redditClone service SHALL facilitate these activities through a structured community organization system.\n\nTHE system SHALL enable registered users to create and participate in topic-specific communities, fostering engagement around shared interests.\n\nWHILE maintaining content quality and community standards, THE system SHALL allow for user-driven moderation through upvotes, downvotes, and reporting mechanisms.\n\n### Business Justification\n\n#### Why This Service Exists\n\nTHE redditClone service SHALL address the need for decentralized discussion platforms where users can share and discover content on specific topics organized in communities.\n\nWHEN users desire focused discussions without platform restrictions, THE service SHALL provide independent community spaces for any legitimate topic area.\n\nTHE platform SHALL differentiate itself from existing social media by organizing content primarily through user-submitted posts and community-driven quality control.\n\nWHERE users want to participate in knowledge-sharing communities, THE redditClone service SHALL provide an accessible platform with familiar Reddit-style interactions.\n\n#### Market Opportunity\n\nTHE service SHALL target users who value community-based content curation and threaded discussions over traditional social media feeds.\n\nWHEN existing platforms implement restrictive content policies, THE redditClone service SHALL offer alternative community spaces for discourse.\n\nTHE system SHALL attract community moderators seeking tools to manage their own discussion spaces independently.\n\nWHERE users engage with Reddit but seek alternatives, THE platform SHALL offer a similar experience with potentially different moderation philosophies.\n\n#### Community Growth Strategy\n\nTHE platform SHALL encourage organic growth through user-created communities and content sharing.\n\nWHEN users find value in specific communities, THE system SHALL facilitate easy sharing of those communities to attract new members.\n\nTHE service SHALL implement a karma system to incentivize quality contributions and community participation.\n\nWHERE users demonstrate expertise in certain topics, THE platform SHALL highlight their contributions to establish credibility within communities.\n\n### Core Value Proposition\n\n#### Community-Centric Organization\n\nTHE redditClone service SHALL organize all content around user-created communities (subreddits), with each community focused on a specific topic or interest.\n\nWHEN users want to engage with content about a particular subject, THE system SHALL allow them to subscribe to relevant communities for a curated experience.\n\nTHE platform SHALL differentiate content by community, ensuring users can easily navigate to topics of interest.\n\nWhere users create new communities, THE system SHALL provide standard templates and tools for community setup.\n\n#### Content Democratization\n\nTHE system SHALL allow all registered users to create posts containing text, links, or images within appropriate communities.\n\nWHEN users submit content, THE platform SHALL enable community voting (upvotes/downvotes) to determine content visibility and quality.\n\nWhile maintaining content standards, THE service SHALL minimize editorial oversight to allow community-driven content curation.\n\nTHE platform SHALL support nested commenting to enable detailed discussions and responses to specific points.\n\n#### User Recognition System\n\nTHE redditClone service SHALL track user contributions through a karma system that reflects community approval of posts and comments.\n\nWHEN users receive upvotes on their contributions, THE system SHALL increment their karma score to recognize valuable participation.\n\nTHE platform SHALL display user karma on public profiles to establish reputation within the community.\n\nWhere users consistently contribute quality content, THE system SHALL make their high karma status visible to enhance credibility.\n\n#### Flexible Content Discovery\n\nTHE system SHALL enable sorting of posts by multiple criteria including hot, new, top, and controversial rankings.\n\nWHEN users browse communities, THE platform SHALL provide algorithmic sorting that highlights engaging content based on community interaction.\n\nTHE service SHALL allow users to customize their experience through community subscriptions that create personalized content feeds.\n\nWHERE users seek trending discussions, THE platform SHALL calculate \"hot\" post rankings based on recent engagement levels.\n\n### Success Metrics\n\n#### User Engagement Metrics\n\nTHE platform SHALL measure daily active users (DAU) as the primary indicator of service health.\n\nWHEN users access the service, THE system SHALL track posts created, comments submitted, and votes cast to calculate engagement levels.\n\nTHE service SHALL define highly engaged users as those who create posts, comment, and vote regularly across multiple communities.\n\nWHERE communities maintain active discussions, THE platform SHALL measure comment thread depth and response rates.\n\n#### Community Growth Metrics\n\nTHE system SHALL track total number of communities created as a measure of platform adoption across diverse interests.\n\nWHEN users subscribe to communities, THE platform SHALL monitor subscription growth rates to identify popular topics.\n\nTHE service SHALL measure average posts per community per day to determine community vitality.\n\nWhere communities attract new members, THE system SHALL track subscriber growth trends for each community.\n\n#### Content Quality Metrics\n\nTHE platform SHALL evaluate content quality through karma distributions and voting patterns.\n\nWHEN users flag inappropriate content, THE system SHALL track report resolution times and community satisfaction with moderation.\n\nTHE service SHALL measure user retention by tracking how often contributors return to engage with their content.\n\nWhile posts age, THE system SHALL monitor how voting patterns change to inform \"top\" content algorithms.\n\n#### Platform Health Metrics\n\nTHE redditClone service SHALL monitor average session duration to assess user engagement depth.\n\nWHEN users browse content, THE platform SHALL track page load satisfaction through user interaction timing.\n\nTHE system SHALL measure bounce rates and return visits as indicators of content relevance and platform usability.\n\nWhere technical issues occur, THE service SHALL track user abandonment rates during critical workflows like registration or posting.\n\n## User Roles\n\nTHE Reddit-like community platform SHALL support four distinct user roles, each with clearly defined capabilities and permissions to ensure proper access control and user experience.\n\n### Guest Users\nGuest users represent unauthenticated visitors to the platform who have limited access to system features.\n\nTHE guest role SHALL allow users to:\n- Browse public communities and their content\n- View posts and comments without interacting\n- Search for communities by name or description\n- Register for a new account\n- Access the login interface\n\nWHEN a guest attempts to perform restricted actions, THE system SHALL redirect them to the login page with an appropriate error message.\n\n### Member Users\nMember users are authenticated participants who form the core community of the platform.\n\nTHE member role SHALL allow users to:\n- Create text, link, and image posts in communities they have access to\n- Upvote and downvote posts and comments\n- Create comments on posts\n- Reply to comments with nested replies\n- Subscribe and unsubscribe from communities\n- View and edit their own user profile\n- Report inappropriate content\n- Access all public communities and their content\n\nWHEN a member attempts to access a restricted community, THE system SHALL verify their subscription status or show an appropriate access denied message.\n\n### Moderator Users\nModerators are trusted community members with additional management capabilities for specific communities.\n\nTHE moderator role SHALL inherit all member permissions and additionally allow users to:\n- Remove posts and comments from communities they moderate\n- Ban and unban users from communities they moderate\n- Edit community settings and descriptions\n- Review reported content within communities they moderate\n- Approve or reject posts in communities with moderation requirements\n\nWHEN a moderator performs a moderation action, THE system SHALL log the action with timestamp and user identifier for audit purposes.\n\n### Admin Users\nAdministrators have system-wide management capabilities and oversight responsibilities.\n\nTHE admin role SHALL inherit all member permissions and additionally allow users to:\n- Manage all communities regardless of membership\n- Access and review all reported content\n- Ban and unban users from the entire system\n- Remove any post or comment across all communities\n- Configure system settings and policies\n- Access administrative dashboards and reports\n\nWHEN an admin performs a system-level action, THE system SHALL log the action with timestamp, user identifier, and affected entities for audit purposes.\n\n## Authentication Requirements\n\n### User Registration Flow\n\nWHEN a guest attempts to register, THE system SHALL collect the following information:\n- Email address (required, unique)\n- Username (required, unique, 3-20 characters, alphanumeric with underscores allowed)\n- Password (required, minimum 8 characters with at least one uppercase, lowercase, and number)\n\nWHEN a guest submits registration information, THE system SHALL validate inputs and provide appropriate error messages for:\n- Duplicate email address\n- Duplicate username\n- Password not meeting complexity requirements\n- Malformed email address\n\nTHE system SHALL send a verification email to new registrants containing a one-time verification link.\n\nWHEN a user clicks the verification link within 24 hours, THE system SHALL activate their account and redirect them to the login page.\n\nIF a user does not verify their email within 24 hours, THE system SHALL require them to request a new verification email through the login process.\n\n### Login Process\n\nWHEN a guest attempts to login with valid credentials, THE system SHALL validate the email/password combination and create an authenticated session.\n\nWHEN a guest attempts to login with invalid credentials, THE system SHALL display an appropriate error message and increment failed login attempt counter.\n\nIF failed login attempts exceed 5 within a 15-minute window, THE system SHALL temporarily lock the account for 30 minutes.\n\nTHE system SHALL provide a \"forgot password\" function that sends a password reset link to the user's verified email address.\n\nWHEN a user successfully logs in, THE system SHALL redirect them to their personalized community feed or the homepage.\n\n### Password Management\n\nWHEN a user requests a password reset, THE system SHALL send a one-time password reset link valid for 2 hours.\n\nTHE system SHALL enforce password complexity requirements during reset:\n- Minimum 8 characters\n- At least one uppercase letter\n- At least one lowercase letter\n- At least one number\n\nWHEN a user successfully changes their password, THE system SHALL invalidate all existing sessions except the current one.\n\nTHE system SHALL NOT allow reusing the previous 5 passwords when changing passwords.\n\n### Session Handling\n\nTHE system SHALL maintain user sessions using JWT tokens.\n\nWHEN a user logs in, logs out, or registers, THE system SHALL create or destroy sessions appropriately.\n\nTHE system SHALL automatically log out users after 30 days of inactivity.\n\nTHE system SHALL provide a \"logout from all devices\" option in user security settings.\n\n## Permission Matrix\n\nTHE system SHALL implement role-based access control using the following permission matrix:\n\n| Action | Guest | Member | Moderator | Admin |\n|--------|-------|--------|-----------|-------|\n| Browse public communities | ✅ | ✅ | ✅ | ✅ |\n| Create posts | ❌ | ✅ | ✅ | ✅ |\n| Comment on posts | ❌ | ✅ | ✅ | ✅ |\n| Vote on content | ❌ | ✅ | ✅ | ✅ |\n| Subscribe to communities | ❌ | ✅ | ✅ | ✅ |\n| Edit own profile | ❌ | ✅ | ✅ | ✅ |\n| Report content | ❌ | ✅ | ✅ | ✅ |\n| Remove own posts/comments | ❌ | ✅ | ✅ | ✅ |\n| Moderate community content | ❌ | ❌ | ✅ | ✅ |\n| Ban community users | ❌ | ❌ | ✅ | ✅ |\n| Edit community settings | ❌ | ❌ | ✅ | ✅ |\n| Review community reports | ❌ | ❌ | ✅ | ✅ |\n| Remove any post/comment | ❌ | ❌ | ❌ | ✅ |\n| Ban/unban any user | ❌ | ❌ | ❌ | ✅ |\n| Access system reports | ❌ | ❌ | ❌ | ✅ |\n| Manage all communities | ❌ | ❌ | ❌ | ✅ |\n\nWHEN a user attempts an action not permitted by their role, THE system SHALL deny access and display an appropriate permission error message.\n\n## JWT Specifications\n\nTHE system SHALL implement authentication using JSON Web Tokens (JWT).\n\n### Token Structure\n\nTHE access token SHALL have a payload containing:\n- User identifier (unique)\n- Role identifier (matching defined roles)\n- Permissions array (based on role)\n- Issued at timestamp\n- Expiration timestamp\n\nTHE refresh token SHALL contain:\n- User identifier (unique)\n- Issued at timestamp\n- Expiration timestamp\n\n### Expiration Policies\n\nTHE access token SHALL expire after 30 minutes of issuance.\n\nTHE refresh token SHALL expire after 30 days of issuance.\n\nWHEN a user's access token expires, THE system SHALL use the refresh token to automatically generate a new access token without requiring re-authentication.\n\n### Storage Recommendations\n\nTHE system SHALL store JWT tokens in httpOnly cookies for enhanced security.\n\nTHE system SHALL set cookie security flags appropriately (Secure, SameSite) based on deployment environment.\n\nWHEN a user logs out, THE system SHALL destroy both access and refresh tokens in client storage.\n\n## User Registration and Login\n\n### User Registration Flow\n\n#### Registration Overview\nUsers must be able to create accounts on the platform to access features such as posting, commenting, voting, and subscribing to communities. Registration shall be straightforward but secure.\n\n#### Registration Process Requirements\n\nWHEN a guest accesses the registration page, THE system SHALL display a form requesting username, email address, and password.\n\nWHEN a guest submits registration information, THE system SHALL validate all input fields according to the following rules:\n- Username SHALL contain 3-20 characters including letters, numbers, underscores, and hyphens only\n- Email SHALL be in valid email format (user@domain.extension)\n- Password SHALL be at least 8 characters long and include at least one uppercase letter, one lowercase letter, and one number\n\nIF submitted username already exists in the system, THEN THE system SHALL display error message \"Username already taken. Please choose another.\"\n\nIF submitted email is already registered, THEN THE system SHALL display error message \"Email address already registered. Please use a different email or try logging in.\"\n\nWHEN registration data passes validation, THE system SHALL create a new user account in \"pending\" state and send a verification email.\n\nWHEN a user clicks the verification link in email, THE system SHALL activate their account and redirect to login page with success message.\n\n```mermaid\ngraph LR\n  A[\"Guest Visit Registration Page\"] --> B[\"Display Registration Form\"]\n  B --> C[\"User Submit Credentials\"]\n  C --> D{\"Validate Input Fields\"}\n  D -->|\"Invalid\"| E[\"Show Validation Errors\"]\n  D -->|\"Valid\"| F[\"Check Username Availability\"]\n  F -->|\"Taken\"| G[\"Show Username Error\"]\n  F -->|\"Available\"| H[\"Check Email Availability\"]\n  H -->|\"Registered\"| I[\"Show Email Error\"]\n  H -->|\"Available\"| J[\"Create Pending Account\"]\n  J --> K[\"Send Verification Email\"]\n  K --> L[\"User Click Verification Link\"]\n  L --> M[\"Activate Account\"]\n  M --> N[\"Redirect to Login with Success Message\"]\n```\n\n#### Guest Access Restrictions\n\nWHILE in unauthenticated state, THE system SHALL allow guests to browse public communities and posts.\n\nWHEN a guest attempts to create a post, THE system SHALL redirect to registration/login page with message \"You need to be logged in to create posts.\"\n\nWHEN a guest attempts to vote on content, THE system SHALL redirect to registration/login page with message \"You need to be logged in to vote.\"\n\nWHEN a guest attempts to comment on posts, THE system SHALL redirect to registration/login page with message \"You need to be logged in to comment.\"\n\n### Login Process\n\n#### Authentication Mechanics\n\nWHEN a user accesses the login page, THE system SHALL display a form requesting email and password.\n\nWHEN valid credentials are submitted, THE system SHALL authenticate the user and create a session.\n\nIF email is not registered in the system, THEN THE system SHALL display error message \"No account found with this email address.\"\n\nIF password does not match the stored hash for the email, THEN THE system SHALL display error message \"Incorrect password. Please try again.\"\n\nWHEN authentication succeeds, THE system SHALL redirect the user to their home feed.\n\n#### Session Creation Requirements\n\nTHE system SHALL create a new session with JWT token upon successful authentication.\n\nEach session SHALL include user identifier, role information, and permissions in the token payload.\n\nTHE system SHALL set session expiration to 30 days for \"Remember Me\" selections and 24 hours otherwise.\n\n#### Account Status Validation\n\nIF a user attempts to log in to an account that has not been verified, THEN THE system SHALL display message \"Please verify your email address before logging in.\"\n\nIF a user attempts to log in to an account that has been banned, THEN THE system SHALL display message \"This account has been suspended. Please contact support for assistance.\"\n\n### Password Management\n\n#### Password Reset Process\n\nWHEN a user selects \"Forgot Password\" on login page, THE system SHALL display a form requesting email address.\n\nWHEN a valid registered email is submitted, THE system SHALL send a password reset link to that address with 1-hour expiration.\n\nIF the requested email is not registered, THEN THE system SHALL still display success message to prevent email discovery attacks.\n\nWHEN a user clicks a valid password reset link, THE system SHALL display a form to enter new password with validation requirements.\n\nWHEN new password is submitted successfully, THE system SHALL update the user's password and invalidate all existing sessions.\n\n```mermaid\ngraph LR\n  A[\"User Click Forgot Password\"] --> B[\"Display Reset Request Form\"]\n  B --> C[\"User Submit Email\"]\n  C --> D{\"Email Registered?\"}\n  D -->|\"Yes\"| E[\"Send Reset Link (1-hr expiry)\"]\n  D -->|\"No\"| F[\"Show Generic Success Message\"]\n  F --> G[\"Redirect to Login\"]\n  E --> H[\"User Click Reset Link\"]\n  H --> I[\"Verify Link Validity\"]\n  I -->|\"Expired\"| J[\"Show Expiry Message\"]\n  I -->|\"Valid\"| K[\"Display New Password Form\"]\n  K --> L[\"User Submit New Password\"]\n  L --> M{\"Password Meets Requirements?\"}\n  M -->|\"No\"| N[\"Show Password Requirements\"]\n  M -->|\"Yes\"| O[\"Update Password\"]\n  O --> P[\"Invalidate All Sessions\"]\n  P --> Q[\"Redirect to Login with Success\"]\n```\n\n#### Password Change Requirements\n\nWHEN an authenticated user accesses account settings, THE system SHALL provide option to change password.\n\nIF a user requests password change, THEN THE system SHALL require current password verification before allowing update.\n\nWHEN a user provides current password and valid new password, THE system SHALL update their password and maintain session.\n\nIF current password verification fails, THEN THE system SHALL display error message \"Current password is incorrect.\"\n\n#### Password Security Rules\n\nTHE system SHALL enforce the following password requirements:\n- Minimum 8 characters in length\n- At least one uppercase letter (A-Z)\n- At least one lowercase letter (a-z)\n- At least one numerical digit (0-9)\n- Optional special characters (!@#$%^&* etc.)\n\nTHE system SHALL NOT impose requirements such as:\n- Mandatory special characters\n- Password expiration dates\n- Password history restrictions\n\n### Session Handling\n\n#### Session Management Requirements\n\nWHEN a user successfully authenticates, THE system SHALL create a new session with JWT token stored client-side.\n\nWHEN a user accesses any protected resource, THE system SHALL validate their session token before granting access.\n\nIF a session token has expired, THEN THE system SHALL redirect to login page with message \"Please log in again.\"\n\nWHEN a user selects \"Logout\", THE system SHALL invalidate the current session and delete all session cookies.\n\n#### Cross-Device Session Handling\n\nTHE system SHALL allow users to maintain multiple concurrent sessions (e.g., desktop and mobile).\n\nWHEN a user changes password, THE system SHALL invalidate all sessions except the one used for password change.\n\nWHERE a user requests to \"Logout from all devices\", THE system SHALL invalidate all sessions for that user.\n\n#### Session Security\n\nTHE system SHALL use httpOnly and secure flags for all session cookies where cookies are utilized.\n\nTHE system SHALL set JWT tokens to expire after 24 hours for standard sessions or 30 days with \"Remember Me\".\n\nIF a user account is banned or suspended, THE system SHALL immediately invalidate all active sessions.\n\nIF a session is inactive for more than 30 days, THEN THE system SHALL automatically invalidate that session.\n\n#### Account Recovery Limitations\n\nTHE system SHALL limit password reset requests to 5 per hour per email address to prevent abuse.\n\nTHE system SHALL limit account registration attempts to 10 per IP address per day to prevent spam.\n\n## Community Management\n\n### Community Creation\n\n#### Core Community Creation Functions\n\nWHEN a member navigates to the \"Create Community\" page, THE system SHALL display a form requesting community name, description, and type.\n\nWHEN a member submits valid community creation information, THE system SHALL create a new community with the member automatically assigned as the first moderator.\n\nTHE system SHALL validate that community names contain only alphanumeric characters, hyphens, and underscores.\n\nTHE system SHALL restrict community names to between 3 and 21 characters in length.\n\nWHEN a user attempts to create a community with an already-existing name, THE system SHALL reject the request and display an error message indicating the name is taken.\n\nWHEN a member successfully creates a community, THE system SHALL redirect them to the new community's main page.\n\nWHEN a guest attempts to create a community, THE system SHALL redirect them to the login page with a notice that community creation requires authentication.\n\n#### Community Properties\n\nTHE system SHALL store the following properties for each community:\n- Unique identifier (UUID format)\n- Name (unique across the platform)\n- Description (up to 500 characters)\n- Creation timestamp\n- Community type (public, private, or restricted)\n- Subscriber count\n- Rules text (up to 10000 characters)\n- Sidebar content (up to 10000 characters)\n- Banner image (URL reference)\n- Icon image (URL reference)\n\n### Community Settings\n\n#### Community Configuration Options\n\nWHERE a community exists, THE system SHALL allow moderators to configure the following settings:\n- Community description (text up to 500 characters)\n- Community rules (text up to 10000 characters)\n- Sidebar content (text up to 10000 characters)\n- Community type (public, private, or restricted)\n- Banner image upload\n- Icon image upload\n\nWHERE a community moderator updates settings, THE system SHALL save the changes immediately and reflect them on the community page within 2 seconds.\n\nTHE system SHALL validate that any uploaded images are in JPEG, PNG, or GIF format and do not exceed 5MB in size.\n\nIF a community moderator attempts to upload an image exceeding 5MB, THEN THE system SHALL reject the upload and display an error message.\n\nIF a community moderator attempts to save settings with invalid data formats, THEN THE system SHALL reject the changes and highlight the problematic fields.\n\n#### Community Types\n\nTHE system SHALL support three community types with distinct access rules:\n- Public: Anyone can view, join, and participate\n- Private: Users must be approved by moderators to join and participate\n- Restricted: Anyone can view, but only approved members can participate in posting or commenting\n\nWHEN a community is set to private, THE system SHALL require users to request membership before they can view content.\n\nWHEN a community is set to restricted, THE system SHALL allow guests to view posts but require membership to post or comment.\n\n### Moderation Tools\n\n#### Moderator Permissions\n\nWHERE a user is a community moderator, THE system SHALL grant them these permissions:\n- Approve or reject membership requests (for private/restricted communities)\n- Remove any post or comment from their community\n- Ban or unban users from the community\n- Edit community settings including description, rules, type, and images\n- Appoint other moderators from community members\n- Create and manage community flair for users and posts\n\nWHERE a user is not a moderator, THE system SHALL deny access to moderation tools and display appropriate error messages.\n\nWHEN a moderator removes a post or comment, THE system SHALL log the action with the moderator's identifier and timestamp.\n\nWHEN a moderator bans a user, THE system SHALL immediately prevent that user from posting or commenting in the community.\n\nWHEN a moderator unbans a user, THE system SHALL restore their ability to post and comment within 5 seconds.\n\n#### Administrative Override\n\nWHERE a user is an admin, THE system SHALL grant them full moderation capabilities across ALL communities regardless of community-specific permissions.\n\nWHEN an admin performs moderation actions, THE system SHALL log these actions with appropriate administrator identification.\n\n### Community Discovery\n\n#### Community Listing\n\nTHE system SHALL display communities in lists organized by categories including \"most popular\", \"newest\", and \"trending\".\n\nTHE system SHALL define popular communities as those with the highest subscriber count.\n\nTHE system SHALL define trending communities as those with the highest recent activity (posts and comments in last 24 hours).\n\nWHEN a user browses community listings, THE system SHALL present 20 communities per page.\n\nTHE system SHALL allow users to search for communities by name or description keywords.\n\nWHEN a user searches for communities, THE system SHALL return results sorted by relevance within 3 seconds.\n\n#### Community Rules Display\n\nTHE system SHALL prominently display community rules on the community's main page.\n\nTHE system SHALL limit community rules text to 10000 characters maximum.\n\nWHEN community rules are updated, THE system SHALL display the changes immediately to all users viewing the community.\n\n### Business Rules and Validation\n\n#### Community Naming Rules\n\nTHE system SHALL enforce that community names:\n- Begin with an alphabetic character\n- Contain only alphanumeric characters, hyphens, and underscores\n- Range between 3 and 21 characters in length\n- Are unique across the entire platform\n\nWHEN a user attempts to create a community with invalid naming characters, THE system SHALL reject the request and display an error message listing valid character types.\n\nWHEN a user attempts to create a community with a name shorter than 3 characters or longer than 21 characters, THE system SHALL reject the request and specify the valid length range.\n\n#### Content Validation\n\nTHE system SHALL validate that community descriptions are not longer than 500 characters.\n\nTHE system SHALL validate that sidebar content is not longer than 10000 characters.\n\nTHE system SHALL validate that community rules text is not longer than 10000 characters.\n\n### Error Handling Scenarios\n\n#### Creation Failures\n\nIF a user submits a community creation request with a name that already exists, THEN THE system SHALL display an error message stating \"A community with this name already exists. Please choose another name.\"\n\nIF a user submits a community creation request with invalid characters in the name, THEN THE system SHALL display an error message stating \"Community names can only contain letters, numbers, hyphens, and underscores.\"\n\nIF a user submits a community creation request with a name outside the valid length range, THEN THE system SHALL display an error message stating \"Community names must be between 3 and 21 characters long.\"\n\nIF a guest attempts to access community creation tools, THEN THE system SHALL redirect them to the login page with a message stating \"You must be logged in to create a community.\"\n\n#### Settings Validation Errors\n\nIF a moderator attempts to save a community description exceeding 500 characters, THEN THE system SHALL reject the changes and highlight the description field with an error message.\n\nIF a moderator attempts to save community rules exceeding 10000 characters, THEN THE system SHALL reject the changes and display an error message indicating the character limit.\n\nIF a moderator attempts to save sidebar content exceeding 10000 characters, THEN THE system SHALL reject the changes and display an error message indicating the character limit.\n\n#### Image Upload Errors\n\nIF a user attempts to upload an image in an unsupported format, THEN THE system SHALL reject the upload and display an error message listing accepted formats (JPEG, PNG, GIF).\n\nIF a user attempts to upload an image exceeding 5MB in size, THEN THE system SHALL reject the upload and display an error message stating \"Image files must be under 5MB in size.\"\n\nIF a user attempts to upload an image that fails server-side validation, THEN THE system SHALL reject the upload and display a generic error message about upload problems.\n\n#### Permission Errors\n\nIF a non-moderator attempts to access moderation tools, THEN THE system SHALL deny access with an error message stating \"You must be a community moderator to access these tools.\"\n\nIF a moderator attempts to ban themselves from their own community, THEN THE system SHALL prevent the action and display an error message.\n\nIF a moderator attempts to appoint another moderator who is not a community member, THEN THE system SHALL reject the request and display an error message.\n\n## Content Posting System\n\n### Post Types Overview\n\nTHE redditClone platform SHALL support three distinct types of posts that users can submit to communities: text posts, link posts, and image posts.\n\n#### Text Posts\nText posts SHALL allow users to submit written content with a title and body text. The body text SHALL support plain text formatting only (no HTML or markdown).\n\n#### Link Posts\nLink posts SHALL require a URL and MAY include an optional title. The system SHALL validate that the URL follows a proper web address format (http:// or https:// protocol).\n\n#### Image Posts\nImage posts SHALL accept image uploads and SHALL require a title. Images SHALL be validated for format (JPEG, PNG, GIF) and size limitations.\n\n### Content Validation Requirements\n\nWHEN a user submits any type of post, THE system SHALL validate all required fields before allowing publication.\n\n#### Universal Post Validation\nALL posts SHALL require:\n- A community selection from existing communities\n- A title with minimum 1 character and maximum 300 characters\n- Proper user authentication (guests SHALL NOT be allowed to post)\n\n#### Text Post Validation\nWHEN a user creates a text post, THE system SHALL:\n- Validate that the title contains 1-300 characters\n- Validate that the body text contains 1-40,000 characters\n- Prevent submission if either field is empty or exceeds limits\n\n#### Link Post Validation\nWHEN a user creates a link post, THE system SHALL:\n- Validate that the URL is properly formatted with http:// or https:// protocol\n- Validate that the URL does not exceed 2,000 characters\n- Allow optional title (1-300 characters) \n- Prevent submission if URL is empty or malformed\n\n#### Image Post Validation\nWHEN a user creates an image post, THE system SHALL:\n- Validate that the uploaded file is in JPEG, PNG, or GIF format\n- Validate that the image file size does NOT exceed 10MB\n- Validate that the title contains 1-300 characters\n- Prevent submission if title is empty or image fails format/size validation\n\n### Post Creation Flow\n\n#### General Post Creation Process\nWHEN a member creates a post, THE system SHALL follow this sequence:\n\n1. User navigates to \"Create Post\" interface\n2. User selects target community from subscribed communities\n3. User selects post type (text, link, or image)\n4. User fills required fields for selected post type\n5. System validates all inputs\n6. IF validation passes, THEN post is created with default values:\n   - Initial upvotes/downvotes set to zero\n   - Created timestamp set to current time\n   - User karma unchanged until first vote\n   - Post status set to \"published\"\n7. IF validation fails, THEN appropriate error messages SHALL be displayed\n\n#### Community Selection\nTHE system SHALL display a dropdown list of communities the user has subscribed to. Users SHALL be able to search through this list if they have subscribed to many communities.\n\n#### Content Input\nTHE system SHALL provide appropriate input fields based on post type:\n- Text posts: Title field + large text area for body content\n- Link posts: Title field (optional) + URL input field\n- Image posts: Title field + file upload component\n\n```mermaid\ngraph LR\n  A[\"User Starts Post Creation\"] --> B[\"Select Community\"]\n  B --> C{\"Choose Post Type\"}\n  C -->|\"Text\"| D[\"Title + Text Body Fields\"]\n  C -->|\"Link\"| E[\"Optional Title + URL Field\"]\n  C -->|\"Image\"| F[\"Title + File Upload\"]\n  D --> G[\"Validate Content\"]\n  E --> G\n  F --> G\n  G --> H{\"Validation Success?\"}\n  H -->|\"Yes\"| I[\"Post Created with Zero Votes\"]\n  H -->|\"No\"| J[\"Show Error Messages\"]\n  I --> K[\"Post Appears in Community Feed\"]\n  J --> L[\"User Corrects Errors and Resubmits\"]\n```\n\n### Post Editing Capabilities\n\n#### Editing Permissions\nTHE system SHALL allow members to edit their own posts within 24 hours of creation. After 24 hours, posts SHALL become locked for editing.\n\n#### Editable Fields by Post Type\nWHEN a user edits their post, THE system SHALL allow modification of:\n\n##### Text Posts\n- Title (1-300 characters)\n- Body text (1-40,000 characters)\n\n##### Link Posts\n- Title only (1-300 characters)\n- URL SHALL NOT be editable after post creation\n\n##### Image Posts\n- Title only (1-300 characters)\n- Image SHALL NOT be editable after post creation\n\n#### Edit Validation\nTHE system SHALL re-validate all editable fields when a user submits changes to a post, following the same validation rules as post creation.\n\n#### Edit History\nTHE system SHALL maintain a record that a post has been edited but SHALL NOT show detailed edit history to users. Edited posts SHALL display a simple \"Edited\" indicator.\n\n### Business Rules and Constraints\n\n#### Rate Limiting\nTHE system SHALL limit users to posting no more than 10 posts per hour to prevent spam behavior.\n\n#### Content Moderation\nWHERE a community has moderation enabled, THE system SHALL place new posts in a \"pending review\" state until approved by a moderator.\n\n#### Duplicate Prevention\nTHE system SHALL prevent users from submitting identical content (same URL or same text body) to the same community within 24 hours.\n\n#### Flair and Tags\nTHE system SHALL support optional post flairs/tags that communities can define. Users SHALL be able to select from community-defined flairs during post creation.\n\n#### NSFW Content\nTHE system SHALL allow communities to be marked as NSFW. Posts in NSFW communities SHALL be tagged accordingly and hidden by default from non-subscribers.\n\n### Error Handling Scenarios\n\n#### Validation Errors\nIF a user submits a post with invalid content, THEN the system SHALL:\n- Display specific error messages for each failed validation\n- Preserve user input so they can correct errors without re-entering everything\n- Highlight the problematic fields visually\n\n#### Authentication Errors\nIF an unauthenticated user attempts to create a post, THEN the system SHALL redirect them to the login page with a message indicating authentication is required.\n\n#### Community Access Errors\nIF a user attempts to post in a community they are not subscribed to, THEN the system SHALL display an error message: \"You must subscribe to this community before posting.\"\n\n#### Upload Errors\nIF a user attempts to upload an image that exceeds size limits or has unsupported format, THEN the system SHALL display message: \"Image must be in JPEG, PNG, or GIF format and under 10MB.\"\n\n#### Rate Limit Errors\nIF a user exceeds posting rate limits, THEN the system SHALL display message: \"You have reached the hourly posting limit. Please wait before creating more posts.\"\n\n#### Edit Timeout Errors\nIF a user attempts to edit a post more than 24 hours after creation, THEN the system SHALL display message: \"Posts can only be edited within 24 hours of creation.\"\n\n## Voting System\n\n### Core Voting Functions\nThe voting system enables users to express their approval or disapproval of posts and comments through upvotes and downvotes, which directly affect content visibility and user reputation scores.\n\n### Post Voting Behavior\nWHEN a member clicks the upvote button on a post, THE system SHALL increase the post's vote score by 1\nWHEN a member clicks the downvote button on a post, THE system SHALL decrease the post's vote score by 1\nWHEN a member clicks an already selected vote button on a post, THE system SHALL remove that vote and reset the button to neutral state\nWHEN a member changes a previous vote on a post, THE system SHALL update the post's vote score accordingly (from +1 to -1 or vice versa)\n\n### Comment Voting Behavior\nWHEN a member clicks the upvote button on a comment, THE system SHALL increase the comment's vote score by 1\nWHEN a member clicks the downvote button on a comment, THE system SHALL decrease the comment's vote score by 1\nWHEN a member clicks an already selected vote button on a comment, THE system SHALL remove that vote and reset the button to neutral state\nWHEN a member changes a previous vote on a comment, THE system SHALL update the comment's vote score accordingly (from +1 to -1 or vice versa)\n\n### User Interface States\nTHE system SHALL display three distinct visual states for voting buttons:\n- Neutral state (default appearance)\n- Upvoted state (visually distinct to show user has upvoted)\n- Downvoted state (visually distinct to show user has downvoted)\n\n### Vote Visibility\nTHE system SHALL display the current vote score for each post and comment publicly\nTHE system SHALL NOT display which specific users have voted on content\nTHE system SHALL show the user their own voting choices on content they have interacted with\n\n### Vote Recording\nWHEN a member votes on a post or comment, THE system SHALL record:\n- The voter's user ID\n- The content ID (post or comment)\n- The vote type (upvote or downvote)\n- The timestamp of the vote action\n- The previous vote state (if any)\n\n### Vote Data Association\nTHE system SHALL associate each vote with exactly one piece of content (either a post or comment)\nTHE system SHALL associate each vote with exactly one user\nTHE system SHALL track both the current vote score and individual user voting actions\n\n### Vote Modification Tracking\nWHEN a member changes their vote on content, THE system SHALL update their previous vote record rather than creating a new one\nWHEN a member removes their vote on content, THE system SHALL mark the vote record as nullified with a timestamp\n\n### Vote Consistency\nTHE system SHALL prevent users from casting multiple votes on the same content\nTHE system SHALL maintain atomic operations for vote changes to prevent race conditions\nTHE system SHALL ensure vote counts accurately reflect the difference between upvotes and downvotes\n\n### Post Karma Calculation\nWHEN a member's post receives an upvote, THE system SHALL increase that member's post karma score by 1\nWHEN a member's post receives a downvote, THE system SHALL decrease that member's post karma score by 1\nWHEN a member's post has a vote removed, THE system SHALL adjust the member's post karma score accordingly\n\n### Comment Karma Calculation\nWHEN a member's comment receives an upvote, THE system SHALL increase that member's comment karma score by 1\nWHEN a member's comment receives a downvote, THE system SHALL decrease that member's comment karma score by 1\nWHEN a member's comment has a vote removed, THE system SHALL adjust the member's comment karma score accordingly\n\n### Total Karma Calculation\nTHE system SHALL calculate a member's total karma as the sum of their post karma and comment karma scores\nTHE system SHALL update total karma in real-time as individual post and comment votes are modified\n\n### Karma Visibility\nTHE system SHALL display a member's total karma score on their public profile\nTHE system SHALL display a member's post karma score on their public profile\nTHE system SHALL display a member's comment karma score on their public profile\nTHE system SHALL update karma scores instantly in the user interface when votes occur\n\n### Self-Voting Restriction\nTHE system SHALL NOT award karma points to users who vote on their own posts or comments\nTHE system SHALL prevent users from voting on their own content\n\n### Authentication Requirements\nWHEN a guest attempts to vote on a post, THE system SHALL redirect them to the login page\nWHEN a guest attempts to vote on a comment, THE system SHALL redirect them to the login page\n\n### Rate Limiting\nTHE system SHALL limit individual members to 100 voting actions per hour to prevent abuse\nWHEN a member exceeds the hourly voting limit, THE system SHALL prevent further votes and display an appropriate error message\n\n### Vote Reversal Restrictions\nTHE system SHALL allow members to change or remove their votes at any time while the content exists\nTHE system SHALL NOT allow vote changes on deleted or removed content\n\n### Moderator and Admin Voting\nWHERE a moderator role is applied, THE system SHALL allow voting on all community content following the same rules as members\nWHERE an admin role is applied, THE system SHALL allow voting on all community content following the same rules as members\nTHE system SHALL NOT give moderators or admins special voting privileges beyond standard users\n\n### Community Restrictions\nWHEN a community is set to \"private\" mode, THE system SHALL continue allowing voting for subscribed members\nWHEN content is removed by moderators, THE system SHALL disable voting on that content\nWHEN content is deleted by the author, THE system SHALL disable voting on that content\n\n### Invalid Content Handling\nWHEN a user attempts to vote on non-existent content, THE system SHALL return an error message \"Content not found\"\nWHEN a user attempts to vote on content in a non-existent community, THE system SHALL return an error message \"Community not found\"\n\n### Concurrent Vote Handling\nWHEN multiple vote actions occur simultaneously on the same content, THE system SHALL process them sequentially to ensure data integrity\n\n### System Failure Handling\nIF a vote action fails to record due to system issues, THEN THE system SHALL display an error message \"Unable to process vote. Please try again.\"\nIF a vote action fails due to network issues, THEN THE system SHALL display an error message \"Network connection failed. Please check your connection and try again.\"\n\n### Vote Processing\nTHE system SHALL process individual vote actions and update displayed scores within 1 second\nTHE system SHALL update karma scores in user profiles within 1 second of vote actions\n\n### Vote History Retrieval\nTHE system SHALL retrieve a user's voting history for their profile display within 3 seconds\nTHE system SHALL calculate content vote scores for sorting algorithms within 100 milliseconds\n\n```mermaid\ngraph LR\n    A[\"User Vote Interaction\"] --> B{\"Is User Authenticated?\"}\n    B -->|\"No\"| C[\"Redirect to Login\"]\n    B -->|\"Yes\"| D[\"Process Vote Action\"]\n    D --> E{\"Is Content Valid?\"}\n    E -->|\"No\"| F[\"Show Error: Content Not Found\"]\n    E -->|\"Yes\"| G[\"Record Vote\"]\n    G --> H{\"Is Self-Vote?\"}\n    H -->|\"Yes\"| I[\"Block Karma Award\"]\n    H -->|\"No\"| J[\"Update User Karma\"]\n    J --> K[\"Update UI Instantly\"]\n    I --> K\n```\n\n## Nested Commenting System\n\n### Comment Creation\n\n#### Core Commenting Functionality\nTHE commenting system SHALL allow authenticated members to create comments on posts in communities\n\nWHEN a member submits a comment, THE system SHALL validate that:\n- The comment contains text content between 1 and 10,000 characters\n- The comment is associated with a valid post\n- The member has permission to comment in the community where the post exists\n- The comment adheres to community rules and content guidelines\n\nWHEN a guest attempts to create a comment, THE system SHALL redirect them to the login page with a message indicating authentication is required\n\nTHE system SHALL record the following information for each comment:\n- Unique comment identifier\n- Content text\n- Author identifier\n- Parent post identifier\n- Creation timestamp\n- Last modification timestamp\n- Vote score (initially 0)\n- Comment status (active, deleted, removed by moderator)\n\n#### Comment Input Validation\nTHE commenting system SHALL validate all comment submissions according to these rules:\n\nWHEN a user creates a comment, THE system SHALL:\n- Verify the comment text length is between 1 and 10,000 characters\n- Confirm the parent post exists and is not deleted\n- Check that the user is not banned from the community\n- Ensure the user has not been restricted from commenting\n\nIF a comment exceeds 10,000 characters, THEN THE system SHALL reject the submission and display an error message stating \"Comment too long. Maximum 10,000 characters allowed.\"\n\nIF a comment contains no text, THEN THE system SHALL reject the submission and display an error message stating \"Comment cannot be empty.\"\n\nWHEN a member submits a comment successfully, THE system SHALL:\n- Add the comment to the post's comment thread\n- Update the post's comment count\n- Award +1 karma point to the commenter\n- Notify subscribed users according to their notification preferences\n\n### Nested Replies\n\n#### Reply Structure\nTHE system SHALL support nested replies up to 10 levels deep to enable discussion threads\n\nWHEN a member replies to an existing comment, THE system SHALL:\n- Create the reply as a child comment of the target comment\n- Preserve the chronological order of comments within each nesting level\n- Update the parent comment's reply count\n- Maintain the community and post association of the reply\n\nWHERE comments exceed 10 levels of nesting, THE system SHALL prevent further nesting and require users to reply to a higher-level comment\n\n#### Comment Threading Behavior\nTHE system SHALL organize comments in a hierarchical structure with these characteristics:\n\nWHILE displaying a post with comments, THE system SHALL:\n- Show first-level comments directly under the post\n- Indent replies to visually indicate nesting level\n- Collapse reply threads beyond 3 levels by default\n- Provide expand/collapse controls for nested threads\n\nWHEN a user navigates to a deeply nested comment, THE system SHALL:\n- Display the comment context including parent comments\n- Highlight the target comment for easy identification\n- Show the full nesting path to the root comment\n\nWHEN a parent comment is deleted, THE system SHALL:\n- Preserve child comments which become orphaned but remain visible\n- Display a \"[deleted]\" placeholder for the parent comment\n- Continue to show indentation for child comments\n\n#### Reply Limitations and Restrictions\nTHE system SHALL enforce these restrictions on comment replies:\n\nWHERE a user has been banned from a community, THE system SHALL prevent them from creating replies to any comments in that community\n\nIF a comment is removed by a moderator, THEN THE system SHALL hide all nested replies to that comment\n\nWHEN a post is deleted, THE system SHALL remove all associated comments and nested replies from public view\n\n### Comment Management\n\n#### Comment Editing\nTHE system SHALL allow members to edit their own comments within 30 minutes of creation\n\nWHEN a member edits a comment, THE system SHALL:\n- Preserve the original creation timestamp\n- Update the last modification timestamp\n- Maintain the comment's position in the thread\n- Keep all existing votes intact\n- Award no additional karma for edits\n\nIF more than 30 minutes have passed since comment creation, THEN THE system SHALL prevent the member from editing their comment\n\nWHEN a moderator edits a comment for rule violations, THE system SHALL:\n- Update the comment content with moderator-provided text\n- Add a \"Moderator Edit\" flag to the comment\n- Preserve all timestamps but add edit explanation\n\n#### Comment Deletion\nTHE system SHALL allow members to delete their own comments if no replies exist\n\nWHEN a member deletes their comment, THE system SHALL:\n- Mark the comment as deleted but preserve it in the database\n- Replace comment content with \"[deleted]\" placeholder\n- Reduce the member's karma by 1 point\n- Update the post's comment count\n- Remove the comment from user profile history\n\nIF a comment has replies, THEN THE system SHALL prevent the member from deleting it\n\nWHEN a moderator removes a comment for rule violations, THE system SHALL:\n- Mark the comment with \"removed by moderator\" status\n- Hide the comment from regular users\n- Allow moderators and admins to view removed comments\n- Preserve the comment for audit purposes\n\nWHEN an admin deletes a comment, THE system SHALL completely remove it from the database including all nested replies\n\n#### Comment Moderation Actions\nTHE system SHALL provide these moderation capabilities:\n\nModerators SHALL be able to:\n- Remove comments that violate community rules\n- Ban users from commenting in their communities\n- Distinguish official moderator comments\n- Lock comment threads to prevent further replies\n\nWHEN a moderator removes a comment, THE system SHALL:\n- Send a notification to the comment author explaining the removal\n- Log the moderation action with timestamp and reason\n- Award no karma penalty to the moderator for removing comments\n\nAdmins SHALL be able to:\n- Delete comments completely from the system\n- View all removed comments across all communities\n- Override moderator decisions when necessary\n\n### Comment Display\n\n#### Comment List Organization\nTHE system SHALL display comments in threads with these ordering options:\n\nWHEN showing comments on a post, THE system SHALL provide sorting by:\n- Best (algorithmically determined quality comments)\n- Top (highest voted comments)\n- New (chronologically newest first)\n- Controversial (high vote variance)\n\nWHEN sorting by \"Best\", THE system SHALL use an algorithm that prioritizes:\n- Comments with high vote scores\n- Comments with recent activity\n- Comments with good engagement ratios\n- Comments flagged by moderators as high-quality\n\nWHEN sorting by \"Top\", THE system SHALL order comments by net vote score (upvotes minus downvotes) in descending order\n\nWHEN sorting by \"New\", THE system SHALL order comments by creation timestamp with newest first\n\nWHEN sorting by \"Controversial\", THE system SHALL use an algorithm that prioritizes:\n- Comments with high absolute vote counts\n- Comments with similar upvote and downvote counts\n- Comments with high engagement but mixed sentiment\n\n#### Pagination and Loading\nTHE system SHALL paginate comment lists with 50 comments per page for optimal performance\n\nWHEN a post has more than 50 comments, THE system SHALL:\n- Display the first 50 comments on initial load\n- Provide pagination controls for additional comments\n- Show total comment count including nested replies\n\nWHEN loading nested comments, THE system SHALL:\n- Load the first 3 levels of nesting immediately\n- Provide \"Load more replies\" buttons for deeper nesting\n- Expand all comments in a thread when requested\n\n#### Comment Voting Integration\nTHE system SHALL integrate voting functionality with comments:\n\nWHEN a user votes on a comment, THE system SHALL:\n- Update the comment's vote score in real-time\n- Award +1 karma to the comment author for upvotes\n- Award no karma penalty for downvotes\n- Prevent users from voting on their own comments\n\nWHEN a user's vote changes the net score by more than 10 points, THE system SHALL notify the comment author\n\nTHE system SHALL calculate comment scores using this formula:\n- Comment Score = Upvotes - Downvotes\n- This score SHALL be used for sorting and karma calculations\n\n#### Performance Requirements\nTHE system SHALL display comment threads with these performance characteristics:\n\nWHEN loading a post with comments, THE system SHALL:\n- Render the initial comment view within 2 seconds\n- Load nested comments within 1 second of expansion\n- Update vote counts immediately without page refresh\n\nWHEN a user submits a comment, THE system SHALL:\n- Display the new comment within 1 second\n- Update all relevant counters and profiles instantly\n- Show any validation errors within 500 milliseconds\n\n#### Error Handling Scenarios\nTHE system SHALL handle comment-related errors gracefully with user-appropriate messages:\n\nIF a user attempts to comment on a deleted post, THEN THE system SHALL display \"This post has been deleted and can no longer receive comments.\"\n\nIF a user attempts to reply to a removed comment, THEN THE system SHALL display \"You cannot reply to a comment that has been removed.\"\n\nIF the system experiences a technical error during comment submission, THEN THE system SHALL display \"Unable to post your comment. Please try again later.\" and preserve the comment text in the input field.\n\nIF a user exceeds rate limits for commenting, THEN THE system SHALL display \"You are posting comments too quickly. Please wait a moment before posting again.\"\n\nWHEN a user navigates to a non-existent comment URL, THE system SHALL redirect them to the associated post with a message indicating the comment is not available.\n\n#### Mobile Responsiveness\nTHE commenting system SHALL adapt to mobile viewing with these characteristics:\n\nWHILE displaying on mobile devices, THE system SHALL:\n- Stack comment indentation vertically instead of horizontal indentation\n- Provide touch-friendly expand/collapse controls\n- Optimize comment input forms for mobile typing\n- Collapse long comment threads by default with expand options\n\n#### User Experience Guidelines\nTHE commenting system SHALL provide these user experience features:\n\nWHERE users hover over or focus on a comment, THE system SHALL:\n- Highlight the comment and its direct replies\n- Show action buttons (reply, edit, delete, report)\n- Display the comment author's username and karma\n\nWHEN a user clicks the \"reply\" button on a comment, THE system SHALL:\n- Open a comment input form directly below that comment\n- Prefill the reply with the author's username for mention tracking\n- Focus the cursor in the reply text area\n\nTHE system SHALL indicate comment nesting through:\n- Visual indentation (20px per level on desktop)\n- Color-coded left borders that darken with nesting level\n- Collapsible sections for better readability\n\nNote: This document outlines the business requirements for the commenting system functionality. All implementation decisions, including but not limited to database design, API architecture, and technical implementation details, are at the discretion of the backend development team.\n\n## Content Sorting Mechanisms\n\n### Sorting Algorithms Overview\n\nTHE system SHALL implement four primary post sorting algorithms:\n- Hot: Posts sorted by popularity and recent activity\n- New: Posts sorted by creation time, newest first\n- Top: Posts sorted by total upvotes, with time-based filters\n- Controversial: Posts with high engagement but divided opinions\n\nEach community (subreddit) SHALL have a default sorting mechanism set to \"Hot\".\nUsers SHALL be able to override the default sorting for individual browsing sessions.\n\n### Hot Posts Calculation Requirements\n\nWHEN displaying posts sorted by \"Hot\", THE system SHALL calculate a hotness score using the following algorithm:\n- Score = Log10(Max(|upvotes - downvotes|, 1)) + Sign × TimeFactor\n- Where Sign = 1 if (upvotes > downvotes), 0 if (upvotes = downvotes), -1 if (upvotes < downvotes)\n- TimeFactor = (Post creation time - Epoch reference time) / 45000\n- Epoch reference time SHALL be set to January 1, 2025 00:00:00 UTC\n\nTHE system SHALL order posts by this hotness score in descending order.\nPosts created within the last 24 hours SHALL receive a 10% boost to their hotness score.\nPosts with deleted or banned status SHALL be excluded from hot sorting.\n\nWHEN a post receives a new vote, THE system SHALL recalculate its hotness score immediately.\nTHE system SHALL update hot post rankings every 5 minutes for optimal performance.\n\n### Top Posts Period Specifications\n\nTHE system SHALL provide multiple time period filters for top posts:\n- All time: All posts since platform inception\n- Year: Posts from the past 365 days\n- Month: Posts from the past 30 days\n- Week: Posts from the past 7 days\n- Day: Posts from the past 24 hours\n\nTHE system SHALL calculate top post scores using the formula:\n- Score = upvotes - downvotes\n\nPosts SHALL be ordered by this score in descending order within each time period.\n\nWHEN a user accesses \"Top\" sorting without specifying a time period, THE system SHALL default to \"All time\" sorting.\nTHE system SHALL exclude posts with deleted or banned status from top sorting results.\n\nIF a time period contains fewer than 10 posts, THEN THE system SHALL display all available posts without pagination for that period.\n\n### Controversial Posts Algorithm\n\nTHE system SHALL identify controversial posts using the following criteria:\n- Posts with at least 5 upvotes AND 5 downvotes\n- Posts with a vote ratio between 0.25 and 0.75 (where ratio = upvotes / (upvotes + downvotes))\n\nTHE system SHALL calculate controversy scores using the formula:\n- Score = Max(upvotes, downvotes) / |upvotes - downvotes|\n\nPosts SHALL be ordered by this controversy score in descending order.\n\nWHEN a post receives new votes that change its controversy status, THE system SHALL update its position in controversial sorting within 1 minute.\n\nPosts with deleted or banned status SHALL be excluded from controversial sorting.\n\n### New Posts Sorting\n\nTHE system SHALL order new posts by creation time in descending order (newest first).\n\nWHEN a user accesses a community with \"New\" sorting, THE system SHALL display all new posts in chronological order.\nEach page of new posts SHALL contain exactly 25 posts.\n\nPosts with deleted or banned status SHALL be excluded from new sorting results.\n\n### User Interface Sorting Options\n\nTHE system SHALL provide a dropdown menu on all community pages with the following sorting options:\n- Hot (default)\n- New\n- Top (with submenu for time periods)\n- Controversial\n\nWHERE a user has set a preferred sorting method in their profile settings, THE system SHALL use that preference as default for all community browsing.\n\nWHEN a user changes sorting options, THE system SHALL preserve that setting for their current browsing session.\n\n### Performance Requirements\n\nTHE system SHALL load sorted post listings within 2 seconds for communities with fewer than 10,000 posts.\n\nTHE system SHALL implement pagination for sorted post listings with 25 posts per page.\n\nWHEN retrieving sorted posts from the database, THE system SHALL utilize indexed queries for optimal performance.\n\nTHE system SHALL cache hot post rankings for 5 minutes to reduce computational overhead.\n\n### Error Handling\n\nIF a sorting algorithm calculation fails due to data inconsistencies, THEN THE system SHALL log the error and default to sorting by creation time (New).\n\nIF a user attempts to access a non-existent sorting method, THEN THE system SHALL return HTTP 400 with error code SORT_INVALID_METHOD.\n\nIF database queries for sorted posts exceed timeout limits, THEN THE system SHALL return an empty result set with error code SORT_QUERY_TIMEOUT.\n\nWHEN a community has no posts available for sorting, THE system SHALL display an appropriate message informing the user that no content is available.\n\n## Subscription System\n\n### Subscription Mechanics\n\nThis section defines how users interact with the subscription system to follow communities.\n\nWHEN a guest user attempts to subscribe to a community, THE system SHALL redirect them to the login page with a message indicating subscription requires authentication.\n\nWHEN an authenticated member browses a community page, THE system SHALL display a \"Subscribe\" button if they are not currently subscribed to that community.\n\nWHEN an authenticated member clicks the \"Subscribe\" button, THE system SHALL add that community to their subscriptions and change the button to \"Unsubscribe\".\n\nWHEN an authenticated member clicks the \"Unsubscribe\" button, THE system SHALL display a confirmation dialog asking if they want to unsubscribe from the community.\n\nWHEN an authenticated member confirms unsubscribing from a community, THE system SHALL remove that community from their subscriptions and change the button to \"Subscribe\".\n\nWHEN a moderator or admin subscribes to a community they moderate, THE system SHALL maintain their moderator status separately from their subscription status.\n\nTHE system SHALL allow members to subscribe to any public community without approval.\n\nTHE system SHALL allow members to subscribe to private communities only after their membership request is approved by a moderator.\n\nIF a private community changes to public status, THEN all pending subscription requests for that community SHALL be automatically approved.\n\nIF a public community changes to private status, THEN existing subscriptions SHALL remain valid but new subscriptions SHALL require approval.\n\n### Subscription Tracking\n\nThis section defines how the system maintains and tracks subscription relationships.\n\nTHE system SHALL maintain a record of each user's community subscriptions including the subscription timestamp.\n\nTHE system SHALL track the total number of subscribers for each community and display this count on the community page.\n\nTHE system SHALL update subscriber counts in real-time when users subscribe or unsubscribe from communities.\n\nWHEN a user views their profile, THE system SHALL display a list of communities they are subscribed to with subscription dates.\n\nWHILE a user is subscribed to a community, THE system SHALL include posts from that community in their personalized feed.\n\nIF a subscribed community is deleted or banned, THEN THE system SHALL automatically unsubscribe all members from that community.\n\nIF a user account is suspended or deleted, THEN THE system SHALL automatically unsubscribe that user from all communities.\n\nTHE system SHALL limit users to a maximum of 10,000 community subscriptions to prevent performance issues.\n\n### Community Feed\n\nThis section defines how subscribed content is aggregated and displayed to users.\n\nTHE system SHALL create a personalized feed for each authenticated user containing posts from all communities they are subscribed to.\n\nWHEN a user accesses their feed, THE system SHALL display posts sorted by \"new\" as the default sorting method.\n\nWHERE a user has no community subscriptions, THE system SHALL display a recommendation of popular communities to subscribe to.\n\nTHE system SHALL ensure posts from subscribed communities appear in users' feeds within 30 seconds of posting.\n\nWHEN a user unsubscribes from a community, THE system SHALL remove posts from that community from their feed within 1 minute.\n\nTHE system SHALL display a maximum of 25 posts per page in the user's feed.\n\nIF a user attempts to access their feed and has network connectivity issues, THEN THE system SHALL display a cached version of their recent feed content if available.\n\nIF a subscribed community has no posts, THEN THE system SHALL not display any content from that community in the user's feed.\n\n### Notification Settings\n\nThis section defines how the subscription system interacts with notification preferences.\n\nWHEN a user subscribes to a community, THE system SHALL enable \"new post\" notifications for that community by default.\n\nTHE system SHALL allow users to customize notification preferences for each subscribed community, including:\n- New post notifications (enabled by default)\n- Hot post notifications (disabled by default)\n- Community announcement notifications (enabled by default)\n\nWHEN a user unsubscribes from a community, THE system SHALL automatically disable all notifications for that community.\n\nTHE system SHALL deliver notifications for subscribed community content within 1 minute of creation during peak hours.\n\nTHE system SHALL deliver notifications for subscribed community content within 5 minutes of creation during non-peak hours.\n\nWHERE a user has disabled all notifications in their device settings, THE system SHALL queue notifications for 24 hours and attempt redelivery when notifications are re-enabled.\n\nIF a notification fails to deliver to a user, THEN THE system SHALL retry delivery up to 3 times with exponential backoff.\n\nTHE system SHALL allow users to configure notification frequency preferences including:\n- Real-time delivery\n- Digest delivery (hourly summaries)\n- Daily digest only\n- Notifications disabled\n\nWHEN a moderator posts in a community, THE system SHALL prioritize those notifications for all subscribers to that community.\n\n```mermaid\ngraph LR\n    A[\"User Views Community Page\"] --> B{\"Already Subscribed?\"}\n    B -->|\"Yes\"| C[\"Show Unsubscribe Button\"]\n    B -->|\"No\"| D[\"Show Subscribe Button\"]\n    D --> E[\"User Clicks Subscribe\"]\n    E --> F[\"Add to User Subscriptions\"]\n    F --> G[\"Update Subscriber Count\"]\n    F --> H[\"Enable Default Notifications\"]\n    C --> I[\"User Clicks Unsubscribe\"]\n    I --> J[\"Show Confirmation Dialog\"]\n    J --> K{\"User Confirms?\"}\n    K -->|\"Yes\"| L[\"Remove from Subscriptions\"]\n    L --> M[\"Update Subscriber Count\"]\n    L --> N[\"Disable All Notifications\"]\n    K -->|\"No\"| O[\"Return to Community Page\"]\n```\n\nTHE system SHALL store notification preferences per user per community combination.\n\nTHE system SHALL provide users with a centralized notification settings page where they can manage preferences for all subscribed communities.\n\nIF a user changes their global notification settings, THEN THE system SHALL apply those changes to all community-specific notification preferences.\n\n## User Profile System\n\n### Profile Information\n\nTHE user profile system SHALL display the following information for each member:\n- Username (unique identifier selected during registration)\n- Account creation date\n- Karma score (derived from upvotes received on posts and comments)\n- Community subscriptions count\n- Brief user bio text (optional, up to 200 characters)\n- Post count (total posts created by the user)\n- Comment count (total comments created by the user)\n\nTHE profile system SHALL allow users to view their own profile with additional information:\n- Email address (private, visible only to the profile owner)\n- Account status (active, suspended, etc.)\n- Last login timestamp\n- Connected social accounts (if any)\n\nTHE user profile system SHALL display moderator badge for users who moderate at least one community.\n\nTHE user profile system SHALL display admin badge for users with administrative privileges.\n\nWHEN a guest accesses a user profile, THE system SHALL show only public information and exclude private details.\n\nWHEN a member accesses another member's profile, THE system SHALL show only public information and exclude private details.\n\nWHEN a user accesses their own profile, THE system SHALL display both public and private information.\n\nTHE profile system SHALL display user's karma score prominently at the top of their profile.\n\nTHE profile system SHALL show subscription count as a numerical value.\n\nTHE profile system SHALL limit bio text to 200 characters maximum.\n\nIF a user's bio text exceeds 200 characters, THEN THE system SHALL truncate the text and show error message \"Bio must be 200 characters or less\".\n\nTHE profile system SHALL calculate and display total post count in real-time.\n\nTHE profile system SHALL calculate and display total comment count in real-time.\n\n### Activity Display\n\nTHE activity display system SHALL organize user content into filterable tabs:\n- \"Overview\" tab showing recent posts and comments\n- \"Posts\" tab showing user's post history\n- \"Comments\" tab showing user's comment history\n\nTHE activity display system SHALL show at most 10 items per page in the overview tab.\n\nTHE activity display system SHALL load additional content through pagination when users navigate to next pages.\n\nWHEN a user accesses a profile, THE system SHALL display the overview tab by default.\n\nWHEN a user selects the posts tab, THE system SHALL show only posts created by that user.\n\nWHEN a user selects the comments tab, THE system SHALL show only comments created by that user.\n\nTHE activity display system SHALL show relative timestamps (e.g., \"2 hours ago\", \"3 days ago\") for all activity items.\n\nTHE activity display system SHALL display community names as links to the respective community pages.\n\nTHE activity display system SHALL indicate deleted posts or comments with \"[deleted]\" text when displayed in activity feeds.\n\nTHE activity display system SHALL indicate removed posts or comments by moderators with \"[removed]\" text when displayed in activity feeds.\n\nWHILE loading profile activity, THE system SHALL display a loading indicator.\n\nIF profile activity fails to load, THEN THE system SHALL display error message \"Unable to load user activity. Please try again later.\"\n\nTHE activity display system SHALL sort items in descending chronological order (newest first) by default.\n\nWHERE a user has no activity, THE system SHALL display message \"This user has no activity yet\" in the respective tab.\n\n### Post History\n\nTHE post history system SHALL display all posts created by a user in the posts tab.\n\nTHE post history system SHALL organize posts by the following criteria:\n- Creation date (newest first by default)\n- Community where posted\n- Post type (text, link, image)\n\nTHE post history system SHALL show at most 20 posts per page.\n\nTHE post history system SHALL display the following information for each post:\n- Post title\n- Post type indicator (text/link/image)\n- Community name where posted\n- Creation timestamp\n- Upvote count\n- Downvote count\n- Comment count\n- Preview text for text posts (first 100 characters)\n- Preview image for image posts (thumbnail)\n- Domain name for link posts\n\nWHEN viewing their own post history, THE system SHALL show draft posts and scheduled posts.\n\nWHEN viewing another user's post history, THE system SHALL exclude draft posts and scheduled posts.\n\nTHE post history system SHALL indicate NSFW posts with appropriate badge.\n\nTHE post history system SHALL indicate spoiler posts with appropriate badge.\n\nTHE post history system SHALL indicate locked posts with appropriate badge.\n\nTHE post history system SHALL indicate pinned posts with appropriate badge.\n\nIF a post's community has been deleted, THEN THE system SHALL display \"[community deleted]\" instead of the community name.\n\nIF a post has been deleted by its author, THEN THE system SHALL show \"[deleted by author]\" message.\n\nIF a post has been removed by a moderator, THEN THE system SHALL show \"[removed by moderator]\" message.\n\nTHE post history system SHALL enable sorting by:\n- New (creation date, newest first)\n- Top (highest karma first)\n- Controversial (controversy score)\n\n### Comment History\n\nTHE comment history system SHALL display all comments created by a user in the comments tab.\n\nTHE comment history system SHALL organize comments by:\n- Creation date (newest first by default)\n- Thread context (post title that comment belongs to)\n- Community context (community of the post)\n\nTHE comment history system SHALL show at most 20 comments per page.\n\nTHE comment history system SHALL display the following information for each comment:\n- Post title (that the comment belongs to)\n- Community name where the post exists\n- Creation timestamp\n- Upvote count\n- Downvote count\n- Comment text preview (first 100 characters)\n- Reply count to the comment\n\nTHE comment history system SHALL enable sorting by:\n- New (creation date, newest first)\n- Top (highest karma first)\n- Controversial (controversy score)\n\nTHE comment history system SHALL include comments on posts in communities the viewing user doesn't have access to, but SHALL hide post and community information, displaying only \"[restricted]\" text.\n\nIF a comment's parent post has been deleted, THEN THE system SHALL display \"[parent post deleted]\" instead of the post title.\n\nIF a comment has been deleted by its author, THEN THE system SHALL show \"[deleted by author]\" message.\n\nIF a comment has been removed by a moderator, THEN THE system SHALL show \"[removed by moderator]\" message.\n\nIF a comment's text exceeds 100 characters, THEN THE system SHALL truncate for preview and show \"...\" indicator.\n\nTHE comment history system SHALL display nested context for replies with indentation visual cues.\n\nTHE comment history system SHALL limit displayed nesting depth to 5 levels for performance reasons.\n\nWHEN viewing their own comment history, THE system SHALL include deleted comments with appropriate indicators.\n\nWHEN viewing another user's comment history, THE system SHALL exclude comments deleted by the author or removed by moderators from display.\n\n### Privacy and Visibility Controls\n\nTHE profile visibility system SHALL allow users to set their profile as:\n- Public (visible to all users including guests)\n- Private (visible only to the user themselves)\n\nTHE profile visibility system SHALL default to Public for all new user accounts.\n\nWHEN a user sets their profile to private, THE system SHALL restrict access to their profile information for all users except the account owner.\n\nWHEN a guest attempts to access a private profile, THE system SHALL deny access and redirect to login page with message \"This user's profile is private. You need to login to view profiles.\"\n\nWHEN a member attempts to access a private profile that is not their own, THE system SHALL deny access and display message \"This user's profile is private.\"\n\nTHE bio text SHALL be visible only when the profile visibility is set to Public.\n\nTHE post history SHALL be visible only when the profile visibility is set to Public.\n\nTHE comment history SHALL be visible only when the profile visibility is set to Public.\n\nTHE subscription information SHALL be visible only when the profile visibility is set to Public.\n\nTHE karma score SHALL be visible even when profile visibility is set to Private.\n\n### Performance Requirements\n\nWHEN a user accesses any profile page, THE system SHALL load and display the page within 2 seconds under normal conditions.\n\nWHEN filtering or sorting profile content, THE system SHALL update the view within 1 second.\n\nTHE profile system SHALL cache user activity data to meet performance requirements.\n\nTHE profile system SHALL implement pagination for all history listings to maintain performance with large data sets.\n\n### Error Handling\n\nIF a requested user profile does not exist, THEN THE system SHALL return HTTP 404 with message \"User profile not found.\"\n\nIF a user account has been suspended, THEN THE profile system SHALL display message \"This user account has been suspended\" instead of normal profile information.\n\nIF the profile system experiences a temporary failure, THEN THE system SHALL display message \"Profiles are temporarily unavailable. Please try again later.\"\n\nIF a user attempts to sort by an invalid criterion, THEN THE system SHALL default to sorting by creation date (newest first) and log the error.\n\n## Content Reporting System\n\n### Reporting Mechanism\n\nWHEN a member encounters inappropriate content, THE system SHALL provide a reporting mechanism with these categories:\n- Spam or misleading content\n- Harassment or bullying\n- Hate speech or discrimination\n- Violence or threats\n- Personal information sharing\n- Sexual content\n- Illegal activities\n- Other (custom reason field)\n\nWHEN a user submits a content report, THE system SHALL:\n- Store the report with metadata (timestamp, reporter ID, content ID, reason)\n- Add the report to a moderation queue\n- Prevent duplicate reports from the same user for the same content\n\nTHE system SHALL implement a moderation workflow with these steps:\n1. Report submission creates a moderation ticket\n2. Moderators can view and filter tickets by community\n3. Moderators can mark tickets as reviewed\n4. Moderators can take actions (remove content, warn user, ban user)\n5. Reporters receive status updates on their submissions\n\nWHEN a moderator removes reported content, THE system SHALL:\n- Archive the removed content\n- Display a notice that content was removed for violating community guidelines\n- Update the reporter's ticket with resolution status\n\nWHEN an admin bans a user, THE system SHALL:\n- Immediately terminate all user sessions\n- Prevent further login attempts\n- Display a notice that the account has been suspended\n- Log the ban reason and administrator responsible\n\n### Report Categories\n\nTHE system SHALL categorize content reports into these predefined categories:\n- Spam or misleading content\n- Harassment or bullying\n- Hate speech or discrimination\n- Violence or threats\n- Personal information sharing\n- Sexual content\n- Illegal activities\n- Other (custom reason field)\n\nWHEN a user selects a report category, THE system SHALL:\n- Display appropriate category-specific instructions\n- Provide examples of what constitutes this category\n- Store the selected category in the report metadata\n\nWHEN a user selects \"Other\" category, THE system SHALL:\n- Provide a text area for custom reason explanation\n- Store the custom text as part of the report information\n- Treat it as a valid report for moderation purposes\n\n### Moderation Workflow\n\nTHE system SHALL implement a structured moderation workflow with these stages:\n\n#### Report Submission Stage\nWHEN a user encounters inappropriate content, THE system SHALL:\n- Provide a clear report button visible on all posts and comments\n- Display a modal with category selection options\n- Allow users to add descriptive explanation in text form\n- Confirm report submission and provide tracking reference\n\n#### Report Review Stage\nTHE system SHALL allocate reports in these priority orders:\n- Reports against new users are prioritized for faster response\n- Reports with multiple submissions receive higher priority\n- Reports in flagged communities receive immediate attention\n\nWHEN a moderator accesses the moderation dashboard, THE system SHALL:\n- Display reports organized by priority and community\n- Show all report metadata including timestamp, reporter, content\n- Allow filtering by category, date, community, and status\n\n#### Resolution Stage\nWHEN a moderator completes report review, THE system SHALL:\n- Record resolution actions taken with timestamps\n- Update original reporter about action outcomes\n- Maintain report history for audit and review purposes\n\nWHERE a report requires admin-level action, THE system SHALL:\n- Escalate automatically to admin moderation queue\n- Preserve all original report metadata\n- Track escalation timeline for response metrics\n\n#### Notification System\nTHE system SHALL provide status updates to reporters through:\n- Real-time notifications for urgent resolution types\n- Daily digest of resolved reports for low-priority issues\n- Ability to view current report status on the reporting page\n\nWHEN a reported content is resolved, THE system SHALL:\n- Notify the original reporter about resolution status\n- Provide brief explanation of moderator actions taken\n- Allow reporters to provide feedback on moderation response\n\n### Admin Actions\n\nTHE admin role SHALL have these system-wide moderation capabilities:\n- Complete content deletion from the system\n- Permanent user account suspension\n- Community-wide banning and unbanning\n- Moderator role assignment and revocation\n- System configuration for report handling policies\n- Access to all historical moderation data\n\nWHEN an admin performs a system-level action, THE system SHALL:\n- Log action with complete metadata including justification\n- Alert affected users about action taken and reason\n- Archive all related content appropriately\n- Update metrics and dashboard information\n\nWHERE admin actions affect community-wide settings, THE system SHALL:\n- Notify all community members about policy changes\n- Maintain detailed logs for transparency requirements\n- Provide rollback mechanisms for system stability\n\n### Business Rules and Validation\n\nTHE system SHALL enforce these core business rules for reporting:\n\n#### User Account Rules\n- Users must verify email before posting content\n- Usernames must be unique across the platform\n- Deleted user accounts SHALL retain content for historical purposes\n\n#### Content Rules\n- Posts SHALL be associated with exactly one community\n- Posts cannot be moved between communities after creation\n- Comments must be associated with exactly one post\n- Links in posts SHALL be validated as accessible URLs\n\n#### Karma Rules\n- Users SHALL receive +1 karma for each upvote on their content\n- Users SHALL receive -1 karma for each downvote on their content\n- Users SHALL receive 0 karma for self-votes (system prevents self-voting)\n- Deleted content SHALL not affect karma scores\n\n#### Community Rules\n- Community names SHALL be unique and URL-safe\n- Community creators SHALL automatically become moderators\n- Only moderators can modify community settings\n- Each community SHALL have at least one moderator\n\n#### Moderation Rules\n- Users SHALL only report content once per item\n- Moderators SHALL only moderate communities they belong to\n- Admins SHALL have access to all moderation actions\n- Removal actions SHALL provide reasons visible to content creators\n\n### Error Handling Requirements\n\nIF a user attempts to access restricted functionality without authentication, THEN THE system SHALL redirect to the login page.\n\nIF a user submits invalid registration information, THEN THE system SHALL display appropriate error messages:\n- \"Username must be between 3 and 20 characters\"\n- \"Email address is invalid\"\n- \"Password must be at least 8 characters\"\n\nIF a user attempts to post invalid content, THEN THE system SHALL display appropriate error messages:\n- \"Title is required and must be between 1-300 characters\"\n- \"URL is invalid for link posts\"\n- \"Image exceeds 10MB size limit\"\n- \"Image format not supported\"\n\nIF a user tries to subscribe to more than 10,000 communities, THEN THE system SHALL display error: \"Maximum subscription limit reached\"\n\nIF a user attempts to access a non-existent community, THEN THE system SHALL display error: \"Community not found\"\n\nIF a user attempts to create a community with an existing name, THEN THE system SHALL display error: \"Community name already taken\"\n\nIF a user attempts to vote on content multiple times, THEN THE system SHALL reject additional votes and maintain the existing vote.\n\n### Performance Requirements\n\nWHEN a user loads the homepage, THE system SHALL display content within 2 seconds.\n\nWHEN a user submits a post, THE system SHALL process and display the post within 1 second.\n\nWHEN a user votes on content, THE system SHALL update vote counts immediately.\n\nWHEN a user submits a comment, THE system SHALL display the comment within 500 milliseconds.\n\nWHEN searching for communities, THE system SHALL return results within 1 second.\n\nTHE system SHALL support up to 10,000 concurrent users.\n\nTHE system SHALL maintain 99.5% uptime.\n\nWHEN retrieving user profile information, THE system SHALL respond within 1.5 seconds.\n\nTHE system SHALL cache hot posts for 5 minutes to improve performance during high traffic."},{"filename":"03-registration-login.md","reason":"Specify the detailed requirements for user registration and login functionality","documentType":"requirement","outline":["User Registration Flow","Login Process","Password Management","Session Handling"],"audience":"backend developers","keyQuestions":["How do users create accounts?","What information is required?","How does login work?","How are sessions managed?"],"detailLevel":"comprehensive","relatedDocuments":[],"constraints":[],"content":"# Requirements Analysis Report for Reddit-like Community Platform\n\n## Executive Summary\n\nThis document outlines the complete requirements for a Reddit-like community platform that allows users to create accounts, form communities, share content, and interact through voting and commenting systems. The platform will support multiple content types, user reputation through karma, content sorting algorithms, community subscriptions, user profiles, and a content reporting/moderation system.\n\n## Service Overview\n\nTHE redditClone service SHALL provide a platform for users to create communities, share content, and engage with each other through voting and commenting mechanisms.\n\n### Core Features\n\n- User registration and authentication system\n- Community (subreddit-like) creation and management\n- Multi-format posting (text, links, images)\n- Upvote/downvote functionality for posts and comments\n- Nested commenting system\n- User karma and reputation tracking\n- Multiple content sorting algorithms\n- Community subscription functionality\n- User profile pages with activity history\n- Content reporting and moderation workflow\n\n## User Roles and Authentication\n\nThe system SHALL support four distinct user roles with varying permissions:\n\n### Guest Users\n- Can browse public communities and content\n- Can view posts and comments\n- Cannot create content, vote, or subscribe to communities\n- SHALL be redirected to login for restricted actions\n\n### Member Users\n- Authenticated users with full posting capabilities\n- Can create posts in communities\n- Can comment and reply to comments\n- Can upvote/downvotes posts and comments\n- Can subscribe to communities\n- Have karma scores based on community engagement\n- Can report inappropriate content\n- Have customizable user profiles\n\n### Moderator Users\n- Members with additional community management capabilities\n- Can remove posts and comments from their communities\n- Can ban users from their communities\n- Can edit community settings and descriptions\n- Have all member privileges plus moderation tools\n\n### Admin Users\n- System administrators with full platform control\n- Can manage all users, communities, and content\n- Handle reported content and take enforcement actions\n- Can create, modify, or delete any community\n- Have access to system analytics and user data (within legal boundaries)\n\n## Functional Requirements\n\n### User Registration and Login System\n\nWHEN a guest accesses the platform, THE system SHALL present registration and login options.\n\nWHEN a guest chooses to register, THE system SHALL collect username, email address, and password.\n\nWHEN a user submits registration information, THE system SHALL validate:\n- Username SHALL be unique and between 3-20 characters\n- Email SHALL be in valid format and unique\n- Password SHALL be at least 8 characters long\n\nWHEN registration information is valid, THE system SHALL create a member account with default permissions.\n\nWHEN a user provides valid credentials for login, THE system SHALL authenticate the user and create a session.\n\nWHEN a user requests logout, THE system SHALL terminate the current session immediately.\n\n### Community Management System\n\nWHEN an authenticated member chooses to create a community, THE system SHALL require:\n- Unique community name (3-21 characters, alphanumeric and underscores)\n- Community description (max 500 characters)\n- Privacy settings (public, restricted, or private)\n\nTHE system SHALL allow community creators to automatically become moderators.\n\nWHEN a moderator accesses community settings, THE system SHALL permit modification of:\n- Community description\n- Privacy settings\n- Banner and icon images\n- Rules and guidelines\n- Moderator list (add/remove moderators)\n\nWHEN a moderator removes a post or comment, THE system SHALL:\n- Archive the removed content\n- Display a notice to users that content was removed by moderator\n- Log the moderation action for audit purposes\n\n### Content Posting System\n\nWHEN a member chooses to create a post, THE system SHALL offer three content types:\n- Text posts (max 40,000 characters)\n- Link posts (valid URL validation)\n- Image posts (JPG, PNG, GIF formats with max 10MB size)\n\nTHE system SHALL require each post to include:\n- Title (max 300 characters)\n- Community selection from user's subscribed communities\n- Content appropriate to selected post type\n\nWHEN a user submits a post, THE system SHALL validate:\n- Title contains between 1-300 characters\n- URL is valid for link posts\n- Image meets size/type requirements for image posts\n- Community selection is valid and accessible to user\n\nTHE system SHALL store all posts with metadata including:\n- Creation timestamp\n- Author identification\n- Community association\n- Vote counts (upvotes, downvotes, net score)\n- Comment count\n\n### Voting System\n\nWHEN a member interacts with a post or comment, THE system SHALL provide upvote and downvote options.\n\nWHEN a member upvotes content, THE system SHALL:\n- Increment the content's upvote count\n- Add +1 to the author's karma score\n- Track the user's vote to prevent multiple votes\n\nWHEN a member downvotes content, THE system SHALL:\n- Increment the content's downvote count\n- Subtract -1 from the author's karma score\n- Track the user's vote to prevent multiple votes\n\nTHE system SHALL allow users to change votes:\n- IF a user has previously upvoted content and clicks downvote, THEN the system SHALL decrement upvote and increment downvote\n- IF a user has previously downvoted content and clicks upvote, THEN the system SHALL decrement downvote and increment upvote\n- IF a user clicks the same vote option twice, THEN the system SHALL remove that vote\n\nTHE system SHALL update displayed scores in real-time upon user voting actions.\n\n### Commenting System\n\nWHEN a member chooses to comment on a post, THE system SHALL provide a text input (max 10,000 characters).\n\nWHEN a member replies to a comment, THE system SHALL create a nested reply structure with:\n- Parent-child relationships between comments\n- Indentation visual hierarchy\n- Up to 10 levels of nesting\n\nWHEN a user submits a comment, THE system SHALL:\n- Validate that the comment contains text (1-10,000 characters)\n- Store the comment with parent relationship if replying\n- Update the post's comment count\n- Notify relevant users based on subscription settings\n\nTHE system SHALL allow users to edit their comments within 15 minutes of posting.\n\nTHE system SHALL allow users to delete their comments if they have no replies.\n\nWHEN a comment has replies, THE system SHALL NOT permit deletion, BUT SHALL allow editing to indicate \"[deleted]\".\n\n### Content Sorting Algorithms\n\nTHE system SHALL provide four content sorting mechanisms:\n\n1. Hot posts algorithm:\n   - WHILE calculating hot scores, THE system SHALL use the formula: \n     Score = (Upvotes - Downvotes) / (Time since posting in hours + 2)^1.8\n   - Posts SHALL be sorted by this calculated score in descending order\n\n2. New posts algorithm:\n   - THE system SHALL display posts in chronological order with newest first\n\n3. Top posts algorithm:\n   - THE system SHALL rank posts by net vote score (upvotes - downvotes)\n   - WHEN displaying top posts, THE system SHALL provide time filtering:\n     - Today (posts from last 24 hours)\n     - This week (posts from last 7 days)\n     - This month (posts from last 30 days)\n     - This year (posts from last 365 days)\n     - All time (all posts)\n\n4. Controversial posts algorithm:\n   - WHILE calculating controversial scores, THE system SHALL use a formula that favors posts with:\n     - High absolute vote counts (upvotes + downvotes)\n     - Balanced upvote/downvote ratios (close to 1:1)\n   - Posts SHALL be sorted based on this controversy metric\n\n### Subscription System\n\nWHEN a member visits a community page, THE system SHALL display a \"subscribe/unsubscribe\" toggle.\n\nWHEN a user subscribes to a community, THE system SHALL:\n- Add the community to the user's subscription list\n- Include posts from this community in the user's home feed\n- Notify the user of new posts based on notification settings\n\nWHEN a user unsubscribes from a community, THE system SHALL:\n- Remove the community from the user's subscription list\n- Remove posts from this community from the user's home feed\n\nTHE system SHALL display subscribed communities on the user's profile page.\n\nTHE system SHALL limit users to 10,000 community subscriptions.\n\n### User Profile System\n\nTHE system SHALL display user profile pages showing:\n- Username and registration date\n- Karma score\n- List of recent posts\n- List of recent comments\n- Subscribed communities\n\nWHEN a user visits their own profile page, THE system SHALL provide:\n- Account settings modification options\n- Notification preference controls\n- Privacy settings management\n\nWHEN a user visits another user's profile page, THE system SHALL:\n- Display public information only\n- Show content history based on community privacy settings\n- Hide private information and settings\n\n### Content Reporting and Moderation System\n\nWHEN a member encounters inappropriate content, THE system SHALL provide a reporting mechanism with these categories:\n- Spam or misleading content\n- Harassment or bullying\n- Hate speech or discrimination\n- Violence or threats\n- Personal information sharing\n- Sexual content\n- Illegal activities\n- Other (custom reason field)\n\nWHEN a user submits a content report, THE system SHALL:\n- Store the report with metadata (timestamp, reporter ID, content ID, reason)\n- Add the report to a moderation queue\n- Prevent duplicate reports from the same user for the same content\n\nTHE system SHALL implement a moderation workflow with these steps:\n1. Report submission creates a moderation ticket\n2. Moderators can view and filter tickets by community\n3. Moderators can mark tickets as reviewed\n4. Moderators can take actions (remove content, warn user, ban user)\n5. Reporters receive status updates on their submissions\n\nWHEN a moderator removes reported content, THE system SHALL:\n- Archive the removed content\n- Display a notice that content was removed for violating community guidelines\n- Update the reporter's ticket with resolution status\n\nWHEN an admin bans a user, THE system SHALL:\n- Immediately terminate all user sessions\n- Prevent further login attempts\n- Display a notice that the account has been suspended\n- Log the ban reason and administrator responsible\n\n## Business Rules\n\nTHE system SHALL enforce these core business rules:\n\n1. User Account Rules:\n   - Users must verify email before posting content\n   - Usernames must be unique across the platform\n   - Deleted user accounts SHALL retain content for historical purposes\n\n2. Content Rules:\n   - Posts SHALL be associated with exactly one community\n   - Posts cannot be moved between communities after creation\n   - Comments must be associated with exactly one post\n   - Links in posts SHALL be validated as accessible URLs\n\n3. Karma Rules:\n   - Users SHALL receive +1 karma for each upvote on their content\n   - Users SHALL receive -1 karma for each downvote on their content\n   - Users SHALL receive 0 karma for self-votes (system prevents self-voting)\n   - Deleted content SHALL not affect karma scores\n\n4. Community Rules:\n   - Community names SHALL be unique and URL-safe\n   - Community creators SHALL automatically become moderators\n   - Only moderators can modify community settings\n   - Each community SHALL have at least one moderator\n\n5. Moderation Rules:\n   - Users SHALL only report content once per item\n   - Moderators SHALL only moderate communities they belong to\n   - Admins SHALL have access to all moderation actions\n   - Removal actions SHALL provide reasons visible to content creators\n\n## Error Handling Requirements\n\nIF a user attempts to access restricted functionality without authentication, THEN THE system SHALL redirect to the login page.\n\nIF a user submits invalid registration information, THEN THE system SHALL display appropriate error messages:\n- \"Username must be between 3 and 20 characters\"\n- \"Email address is invalid\"\n- \"Password must be at least 8 characters\"\n\nIF a user attempts to post invalid content, THEN THE system SHALL display appropriate error messages:\n- \"Title is required and must be between 1-300 characters\"\n- \"URL is invalid for link posts\"\n- \"Image exceeds 10MB size limit\"\n- \"Image format not supported\"\n\nIF a user tries to subscribe to more than 10,000 communities, THEN THE system SHALL display error: \"Maximum subscription limit reached\"\n\nIF a user attempts to access a non-existent community, THEN THE system SHALL display error: \"Community not found\"\n\nIF a user attempts to create a community with an existing name, THEN THE system SHALL display error: \"Community name already taken\"\n\nIF a user attempts to vote on content multiple times, THEN THE system SHALL reject additional votes and maintain the existing vote.\n\n## Performance Requirements\n\nWHEN a user loads the homepage, THE system SHALL display content within 2 seconds.\n\nWHEN a user submits a post, THE system SHALL process and display the post within 1 second.\n\nWHEN a user votes on content, THE system SHALL update vote counts immediately.\n\nWHEN a user submits a comment, THE system SHALL display the comment within 500 milliseconds.\n\nWHEN searching for communities, THE system SHALL return results within 1 second.\n\nTHE system SHALL support up to 10,000 concurrent users.\n\nTHE system SHALL maintain 99.5% uptime.\n\nWHEN retrieving user profile information, THE system SHALL respond within 1.5 seconds.\n\nTHE system SHALL cache hot posts for 5 minutes to improve performance during high traffic.\n\n## Success Metrics\n\nTHE system SHALL track these key performance indicators:\n\n1. User Engagement:\n   - Daily Active Users (DAU)\n   - Monthly Active Users (MAU)\n   - Average session duration\n   - Posts created per day\n   - Comments created per day\n\n2. Community Growth:\n   - Number of communities created\n   - Subscription rates per community\n   - Community activity levels (posts/comments per day)\n\n3. Content Quality:\n   - Report resolution time\n   - User satisfaction with content relevance\n   - High karma content ratio\n\n4. Technical Performance:\n   - Average page load times\n   - Uptime percentage\n   - Concurrent user capacity utilization\n\nThese requirements SHALL serve as the foundation for backend developers to implement the Reddit-like community platform. Each requirement follows EARS format to ensure clarity, testability and prevent ambiguity in the implementation process."},{"filename":"04-community-management.md","reason":"Detail requirements for creating and managing communities (subreddits)","documentType":"requirement","outline":["Community Creation","Community Settings","Moderation Tools","Community Discovery"],"audience":"backend developers","keyQuestions":["How do users create communities?","What settings can be configured?","How are communities moderated?"],"detailLevel":"detailed","relatedDocuments":[],"constraints":[],"content":"# Community Management Requirements\n\n## Community Creation\n\n### Core Community Creation Functions\n\nWHEN a member navigates to the \"Create Community\" page, THE system SHALL display a form requesting community name, description, and type.\n\nWHEN a member submits valid community creation information, THE system SHALL create a new community with the member automatically assigned as the first moderator.\n\nTHE system SHALL validate that community names contain only alphanumeric characters, hyphens, and underscores.\n\nTHE system SHALL restrict community names to between 3 and 21 characters in length.\n\nWHEN a user attempts to create a community with an already-existing name, THE system SHALL reject the request and display an error message indicating the name is taken.\n\nWHEN a member successfully creates a community, THE system SHALL redirect them to the new community's main page.\n\nWHEN a guest attempts to create a community, THE system SHALL redirect them to the login page with a notice that community creation requires authentication.\n\n### Community Properties\n\nTHE system SHALL store the following properties for each community:\n- Unique identifier (UUID format)\n- Name (unique across the platform)\n- Description (up to 500 characters)\n- Creation timestamp\n- Community type (public, private, or restricted)\n- Subscriber count\n- Rules text (up to 10000 characters)\n- Sidebar content (up to 10000 characters)\n- Banner image (URL reference)\n- Icon image (URL reference)\n\n## Community Settings\n\n### Community Configuration Options\n\nWHERE a community exists, THE system SHALL allow moderators to configure the following settings:\n- Community description (text up to 500 characters)\n- Community rules (text up to 10000 characters)\n- Sidebar content (text up to 10000 characters)\n- Community type (public, private, or restricted)\n- Banner image upload\n- Icon image upload\n\nWHERE a community moderator updates settings, THE system SHALL save the changes immediately and reflect them on the community page within 2 seconds.\n\nTHE system SHALL validate that any uploaded images are in JPEG, PNG, or GIF format and do not exceed 5MB in size.\n\nIF a community moderator attempts to upload an image exceeding 5MB, THEN THE system SHALL reject the upload and display an error message.\n\nIF a community moderator attempts to save settings with invalid data formats, THEN THE system SHALL reject the changes and highlight the problematic fields.\n\n### Community Types\n\nTHE system SHALL support three community types with distinct access rules:\n- Public: Anyone can view, join, and participate\n- Private: Users must be approved by moderators to join and participate\n- Restricted: Anyone can view, but only approved members can participate in posting or commenting\n\nWHEN a community is set to private, THE system SHALL require users to request membership before they can view content.\n\nWHEN a community is set to restricted, THE system SHALL allow guests to view posts but require membership to post or comment.\n\n## Moderation Tools\n\n### Moderator Permissions\n\nWHERE a user is a community moderator, THE system SHALL grant them these permissions:\n- Approve or reject membership requests (for private/restricted communities)\n- Remove any post or comment from their community\n- Ban or unban users from the community\n- Edit community settings including description, rules, type, and images\n- Appoint other moderators from community members\n- Create and manage community flair for users and posts\n\nWHERE a user is not a moderator, THE system SHALL deny access to moderation tools and display appropriate error messages.\n\nWHEN a moderator removes a post or comment, THE system SHALL log the action with the moderator's identifier and timestamp.\n\nWHEN a moderator bans a user, THE system SHALL immediately prevent that user from posting or commenting in the community.\n\nWHEN a moderator unbans a user, THE system SHALL restore their ability to post and comment within 5 seconds.\n\n### Administrative Override\n\nWHERE a user is an admin, THE system SHALL grant them full moderation capabilities across ALL communities regardless of community-specific permissions.\n\nWHEN an admin performs moderation actions, THE system SHALL log these actions with appropriate administrator identification.\n\n## Community Discovery\n\n### Community Listing\n\nTHE system SHALL display communities in lists organized by categories including \"most popular\", \"newest\", and \"trending\".\n\nTHE system SHALL define popular communities as those with the highest subscriber count.\n\nTHE system SHALL define trending communities as those with the highest recent activity (posts and comments in last 24 hours).\n\nWHEN a user browses community listings, THE system SHALL present 20 communities per page.\n\nTHE system SHALL allow users to search for communities by name or description keywords.\n\nWHEN a user searches for communities, THE system SHALL return results sorted by relevance within 3 seconds.\n\n### Community Rules Display\n\nTHE system SHALL prominently display community rules on the community's main page.\n\nTHE system SHALL limit community rules text to 10000 characters maximum.\n\nWHEN community rules are updated, THE system SHALL display the changes immediately to all users viewing the community.\n\n```mermaid\ngraph LR\n  A[\"User Access Community Creation\"] --> B{\"Authenticated?\"}\n  B -->|No| C[\"Redirect to Login\"]\n  B -->|Yes| D[\"Display Creation Form\"]\n  D --> E[\"User Submit Info\"]\n  E --> F{\"Valid Format?\"}\n  F -->|No| G[\"Show Validation Errors\"]\n  F -->|Yes| H[\"Check Name Availability\"]\n  H -->|Taken| I[\"Show Name Error\"]\n  H -->|Available| J[\"Create Community\"]\n  J --> K[\"Assign Creator as Moderator\"]\n  K --> L[\"Redirect to Community Page\"]\n```\n\n## Business Rules and Validation\n\n### Community Naming Rules\n\nTHE system SHALL enforce that community names:\n- Begin with an alphabetic character\n- Contain only alphanumeric characters, hyphens, and underscores\n- Range between 3 and 21 characters in length\n- Are unique across the entire platform\n\nWHEN a user attempts to create a community with invalid naming characters, THE system SHALL reject the request and display an error message stating \"Community names can only contain letters, numbers, hyphens, and underscores.\"\n\nWHEN a user attempts to create a community with a name shorter than 3 characters or longer than 21 characters, THE system SHALL reject the request and specify the valid length range.\n\n### Content Validation\n\nTHE system SHALL validate that community descriptions are not longer than 500 characters.\n\nTHE system SHALL validate that sidebar content is not longer than 10000 characters.\n\nTHE system SHALL validate that community rules text is not longer than 10000 characters.\n\n## Error Handling Scenarios\n\n### Creation Failures\n\nIF a user submits a community creation request with a name that already exists, THEN THE system SHALL display an error message stating \"A community with this name already exists. Please choose another name.\"\n\nIF a user submits a community creation request with invalid characters in the name, THEN THE system SHALL display an error message stating \"Community names can only contain letters, numbers, hyphens, and underscores.\"\n\nIF a user submits a community creation request with a name outside the valid length range, THEN THE system SHALL display an error message stating \"Community names must be between 3 and 21 characters long.\"\n\nIF a guest attempts to access community creation tools, THEN THE system SHALL redirect them to the login page with a message stating \"You must be logged in to create a community.\"\n\n### Settings Validation Errors\n\nIF a moderator attempts to save a community description exceeding 500 characters, THEN THE system SHALL reject the changes and highlight the description field with an error message.\n\nIF a moderator attempts to save community rules exceeding 10000 characters, THEN THE system SHALL reject the changes and display an error message indicating the character limit.\n\nIF a moderator attempts to save sidebar content exceeding 10000 characters, THEN THE system SHALL reject the changes and display an error message indicating the character limit.\n\n### Image Upload Errors\n\nIF a user attempts to upload an image in an unsupported format, THEN THE system SHALL reject the upload and display an error message listing accepted formats (JPEG, PNG, GIF).\n\nIF a user attempts to upload an image exceeding 5MB in size, THEN THE system SHALL reject the upload and display an error message stating \"Image files must be under 5MB in size.\"\n\nIF a user attempts to upload an image that fails server-side validation, THEN THE system SHALL reject the upload and display a generic error message about upload problems.\n\n### Permission Errors\n\nIF a non-moderator attempts to access moderation tools, THEN THE system SHALL deny access with an error message stating \"You must be a community moderator to access these tools.\"\n\nIF a moderator attempts to ban themselves from their own community, THEN THE system SHALL prevent the action and display an error message.\n\nIF a moderator attempts to appoint another moderator who is not a community member, THEN THE system SHALL reject the request and display an error message."},{"filename":"05-posting-system.md","reason":"Define requirements for posting different content types in communities","documentType":"requirement","outline":["Post Types","Content Validation","Post Creation Flow","Post Editing"],"audience":"backend developers","keyQuestions":["What types of content can users post?","How is content validated?","Can users edit their posts?"],"detailLevel":"comprehensive","relatedDocuments":[],"constraints":[],"content":"# Reddit-like Community Platform Requirements Analysis Report\n\n## Executive Summary\n\nTHE Reddit-like community platform SHALL provide users with a decentralized forum experience where they can create accounts, join topic-specific communities, share content in multiple formats, and engage with others through voting and nested commenting systems. This platform SHALL replicate core Reddit functionality while allowing for customization of community rules and content moderation approaches.\n\n## Service Overview\n\n### Core Features\n\nTHE system SHALL implement these primary functions:\n1. User account registration and authentication with email verification\n2. Community creation with customizable settings and moderation tools\n3. Multi-format content posting (text, links, images) with validation\n4. Voting mechanism (upvote/downvote) for posts and comments affecting user karma\n5. Nested reply system for comments up to 10 levels deep\n6. Content ranking algorithms (hot, new, top, controversial)\n7. Community subscription system for personalized content feeds\n8. User profiles displaying activity history and karma scores\n9. Content reporting system with moderation workflow for inappropriate material\n\n### Business Value\n\nWHEN users seek specific communities for their interests, THE platform SHALL provide organized content discovery through topic-based grouping.\n\nWHILE maintaining content quality, THE system SHALL enable community-driven moderation through voting and reporting mechanisms.\n\nTHE platform SHALL foster engagement through a karma system that recognizes valuable contributions.\n\nWHERE users want to track discussions on topics they care about, THE subscription system SHALL create personalized feeds.\n\n## User Roles and Authentication System\n\n### Guest User Capabilities\n\nGuests SHALL have limited access to platform features:\n- Browse public communities and their content\n- View posts and comments without interaction capability\n- Access registration and login interfaces\n- Search for communities by name or description\n\nWHEN a guest attempts restricted actions like posting or voting, THE system SHALL redirect them to the login page with an explanatory message.\n\n### Member User Capabilities\n\nMembers SHALL have full participation rights:\n- Create text, link, and image posts in accessible communities\n- Comment on posts with nested replies\n- Upvote or downvote posts and comments\n- Subscribe to and unsubscribe from communities\n- Customize profile information and privacy settings\n- Report inappropriate content with categorized reasons\n\nWHEN a member performs an action, THE system SHALL update related metrics (karma scores, vote counts, subscription lists) in real-time.\n\n### Moderator Capabilities\n\nModerators SHALL have enhanced community management functions:\n- Remove posts and comments that violate community rules\n- Ban or unban users from their moderated communities\n- Configure community settings, descriptions, and rules\n- Review and resolve reported content in their communities\n- Distinguish official moderator communications\n\nWHEN a moderator performs a moderation action, THE system SHALL log the action with timestamp, user identifier, and affected content for audit purposes.\n\n### Admin Capabilities\n\nAdmins SHALL have system-wide control privileges:\n- Review and resolve all content reports regardless of community\n- Ban or suspend user accounts platform-wide\n- Delete any post or comment across all communities\n- Access administrative dashboards and system metrics\n- Configure global platform settings and policies\n\n### Authentication Workflows\n\n```mermaid\ngraph LR\n  A[\"User Access Platform\"] --> B{\"Authenticated?\"}\n  B -->|No| C[\"Show Guest View\"]\n  B -->|Yes| D[\"Show Member View\"]\n  C --> E[\"Browse Public Content\"]\n  C --> F[\"Access Login/Register\"]\n  D --> G[\"Enable Full Features\"]\n  D --> H[\"Show User-Specific Data\"]\n```\n\nWhen a user registers, THE system SHALL:\n- Verify email address availability and format\n- Check username uniqueness and character constraints\n- Validate password complexity requirements\n- Send verification email with time-limited token\n- Create account in pending status until email confirmation\n\nWhen a user logs in successfully, THE system SHALL:\n- Validate email/password combination\n- Generate JWT access token with user permissions\n- Create refresh token for session persistence\n- Set authentication status in user session\n- Redirect to personalized home feed\n\n## Functional Requirements\n\n### User Registration and Login System\n\nWHEN a guest submits registration information, THE system SHALL validate:\n- Email format compliance with RFC 5322 standards\n- Username length between 3-20 characters\n- Username composition of alphanumeric characters, underscores, and hyphens only\n- Password minimum length of 8 characters\n- Password inclusion of uppercase, lowercase, and numeric characters\n\nIF submitted credentials fail validation, THEN THE system SHALL display specific error messages for each failed criterion.\n\nWHEN a user clicks the email verification link within 24 hours, THE system SHALL activate the account and redirect to login interface.\n\nIF verification link expires or is invalid, THEN THE system SHALL display error and offer to resend verification email.\n\n### Community Management System\n\n```mermaid\ngraph LR\n  I[\"User Request Community\"] --> J{\"Validate Name\"}\n  J -->|Invalid| K[\"Show Naming Errors\"]\n  J -->|Valid| L{\"Check Availability\"}\n  L -->|Taken| M[\"Show Uniqueness Error\"]\n  L -->|Available| N[\"Create Community\"]\n  N --> O[\"Assign Creator as Moderator\"]\n  N --> P[\"Set Default Settings\"]\n```\n\nWHEN a member requests to create a community, THE system SHALL validate:\n- Community name contains 3-21 characters\n- Community name uses only alphanumeric characters, underscores, and hyphens\n- Community name is unique across the platform\n- Description contains fewer than 500 characters\n\nWHEN a community is created successfully, THE system SHALL:\n- Generate unique community identifier (UUID)\n- Assign requesting user as initial moderator\n- Initialize community settings with default values\n- Create empty post listings for the community\n\n### Content Posting System\n\nTHE system SHALL support three post types with specific requirements:\n\n1. Text Posts:\n   - Maximum title length: 300 characters\n   - Maximum body length: 40,000 characters\n   - Plain text formatting only (no HTML/markdown)\n\n2. Link Posts:\n   - URL validation for http/https protocols\n   - Optional title field (max 300 characters)\n   - URL length maximum: 2,000 characters\n\n3. Image Posts:\n   - File format restrictions: JPEG, PNG, GIF only\n   - File size maximum: 10MB\n   - Required title field (max 300 characters)\n\nWHEN a member submits any post type, THE system SHALL validate all inputs against these criteria before allowing publication.\n\n### Voting System\n\n```mermaid\ngraph LR\n  Q[\"User Vote Action\"] --> R{\"Check Authentication\"}\n  R -->|Guest| S[\"Redirect to Login\"]\n  R -->|Member| T{\"Validate Content\"}\n  T -->|Invalid| U[\"Show Content Error\"]\n  T -->|Valid| V[\"Record Vote\"]\n  V --> W{\"Update Karma?\"}\n  W -->|Yes| X[\"Modify User Karma\"]\n  W -->|No| Y[\"Skip Karma Update\"]\n  V --> Z[\"Update Content Score\"]\n```\n\nWHEN a member votes on content, THE system SHALL:\n- Verify user authentication status\n- Validate content identifier exists and is accessible\n- Prevent self-voting on user's own content\n- Record vote with timestamp and content association\n- Update content score immediately in UI\n\nIF content receives an upvote, THEN author's karma SHALL increase by 1 point.\nIF content receives a downvote, THEN author's karma SHALL decrease by 1 point.\n\n### Commenting System\n\nWHEN a member posts a comment, THE system SHALL:\n- Verify parent post exists and is not deleted\n- Validate comment text length between 1-10,000 characters\n- Confirm user has commenting privileges in the community\n- Create nested structure preserving parent-child relationships\n\nTHE system SHALL support up to 10 levels of comment nesting.\nTHE system SHALL display comments with visual indentation cues.\nTHE system SHALL maintain chronological ordering within nesting levels.\n\nWHEN a user edits a comment within 15 minutes of posting, THE system SHALL update the content while preserving creation timestamp.\nIF a comment has existing replies, THE system SHALL prevent deletion but allow editing to indicate \"[deleted]\".\n\n### Content Sorting System\n\nTHE system SHALL offer configurable sorting algorithms:\n- Hot: Combines vote scores with time decay factors\n- New: Chronological ordering (newest first)\n- Top: Vote-based ranking with time filters\n- Controversial: Balanced upvote/downvote ratio prioritization\n\nWHEN calculating hot scores, THE system SHALL use:\n- Score = log10(Max(|upvotes - downvotes|, 1)) + Sign × TimeFactor\n- Sign = 1 if upvotes > downvotes, 0 if equal, -1 if downvotes > upvotes\n- TimeFactor = Hours since epoch reference / Scaling factor\n\nWHEN applying top sorting, THE system SHALL support time filters:\n- Today (past 24 hours)\n- Week (past 7 days)\n- Month (past 30 days)\n- Year (past 365 days)\n- All time (no time limit)\n\n### Subscription System\n\n```mermaid\ngraph LR\n  AA[\"User Access Community\"] --> AB{\"Check Subscription\"}\n  AB -->|Subscribed| AC[\"Show Full Content\"]\n  AB -->|Not Subscribed| AD[\"Show Public Preview\"]\n  AD --> AE[\"Offer Subscribe Option\"]\n  AC --> AF[\"Include in User Feed\"]\n```\n\nWHEN a member subscribes to a community, THE system SHALL:\n- Add community to user's subscription list\n- Include community posts in personalized feed\n- Initialize notification preferences for the community\n\nTHE system SHALL limit users to 10,000 community subscriptions to prevent performance issues.\n\n### User Profile System\n\nTHE system SHALL display user profiles with:\n- Username and registration date\n- Total karma score aggregating post and comment votes\n- Recent post and comment history\n- Community subscription list\n\nWHEN a member accesses their own profile, THE system SHALL show additional controls:\n- Account settings modification\n- Privacy preference configuration\n- Content management tools\n\n### Content Reporting System\n\nTHE system SHALL offer these reporting categories:\n- Spam or misleading content\n- Harassment or bullying\n- Hate speech or discrimination\n- Violence or threats\n- Personal information sharing\n- Sexual content\n- Illegal activities\n- Other (with text explanation)\n\nWHEN a user submits a report, THE system SHALL:\n- Prevent duplicate reports for same content\n- Add report to community-specific moderation queue\n- Generate ticket with reporter identification (if not anonymous)\n- Notify appropriate moderators based on community\n\n## Business Rules and Constraints\n\nTHE system SHALL enforce these business constraints:\n\n1. Account Management:\n   - Users must validate email within 24 hours of registration\n   - Deleted accounts retain content but anonymize user information\n   - Password changes invalidate all existing sessions\n\n2. Content Rules:\n   - Posts associated with exactly one community at creation\n   - Post titles required for all post types (1-300 characters)\n   - Links must begin with http:// or https:// protocols\n   - Images restricted to JPEG, PNG, and GIF formats\n\n3. Voting Limitations:\n   - Users cannot vote on their own content\n   - One vote per content item per user\n   - Vote changes update immediately without page refresh\n\n4. Comment Restrictions:\n   - Maximum nesting depth of 10 levels\n   - Text limit of 10,000 characters per comment\n   - Deletion only allowed for comments without replies\n\n5. Community Policies:\n   - Unique names required across the platform\n   - Names must be URL-safe (alphanumeric, underscore, hyphen)\n   - Public communities visible to guests\n   - Private communities require moderator approval\n\n## Error Handling and Edge Cases\n\nTHE system SHALL handle these error scenarios:\n\nIF database connection fails, THEN user actions SHALL result in friendly error messages with retry options.\n\nIF content violates size or format limits, THEN THE system SHALL specify exact error reasons without data loss.\n\nIF authentication tokens expire, THEN THE system SHALL provide seamless renewal when refresh tokens exist.\n\nIF users attempt unauthorized actions, THEN THE system SHALL display permission errors without exposing system internals.\n\nIF content is deleted during user interaction, THEN THE system SHALL gracefully handle broken references.\n\n## Performance Requirements\n\nTHE system SHALL operate with these performance benchmarks:\n\nWHEN loading homepage views, THE system SHALL deliver content within 2 seconds under normal conditions.\n\nWHEN submitting votes, THE system SHALL complete the interaction within 500 milliseconds.\n\nWHEN creating or editing content, THE system SHALL update UI immediately after server confirmation.\n\nWHEN processing search queries, THE system SHALL return results within 1 second.\n\nTHE system SHALL support concurrent usage by 10,000 active users without degradation.\n\n## Success Metrics and KPIs\n\nTHE system SHALL track these key performance indicators:\n\n1. User Engagement:\n   - Daily Active Users (DAU) growth\n   - Average session duration\n   - Posts and comments per active user\n   - Returning user retention rate\n\n2. Community Health:\n   - Number of active communities\n   - Subscriber growth rates per community\n   - Moderator response times for reports\n   - User-generated content volume\n\n3. System Performance:\n   - API response time measurements\n   - Database query efficiency metrics\n   - Cache hit ratios for sorted content\n   - Error rates and resolution tracking\n\n4. Content Quality Indicators:\n   - High-vote content ratio\n   - Moderation action effectiveness\n   - Spam and policy violation detection rates\n   - User satisfaction with content discovery\n\n> *Developer Note: This document defines **business requirements only**. Implementation decisions including architecture, APIs, database design, and technology stack are at the development team's discretion.*"},{"filename":"06-voting-system.md","reason":"Specify the upvote/downvote functionality for posts and comments","documentType":"requirement","outline":["Voting Mechanics","Vote Tracking","Karma Calculation","Vote Restrictions"],"audience":"backend developers","keyQuestions":["How does voting work?","How is karma calculated?","Are there any voting restrictions?"],"detailLevel":"detailed","relatedDocuments":[],"constraints":[],"content":"# Voting System Requirements for Reddit-like Community Platform\n\n## Voting Mechanics\n\n### Core Voting Functions\nThe voting system enables users to express their approval or disapproval of posts and comments through upvotes and downvotes, which directly affect content visibility and user reputation scores.\n\n### Post Voting Behavior\nWHEN a member clicks the upvote button on a post, THE system SHALL increase the post's vote score by 1\nWHEN a member clicks the downvote button on a post, THE system SHALL decrease the post's vote score by 1\nWHEN a member clicks an already selected vote button on a post, THE system SHALL remove that vote and reset the button to neutral state\nWHEN a member changes a previous vote on a post, THE system SHALL update the post's vote score accordingly (from +1 to -1 or vice versa)\n\n### Comment Voting Behavior\nWHEN a member clicks the upvote button on a comment, THE system SHALL increase the comment's vote score by 1\nWHEN a member clicks the downvote button on a comment, THE system SHALL decrease the comment's vote score by 1\nWHEN a member clicks an already selected vote button on a comment, THE system SHALL remove that vote and reset the button to neutral state\nWHEN a member changes a previous vote on a comment, THE system SHALL update the comment's vote score accordingly (from +1 to -1 or vice versa)\n\n### User Interface States\nTHE system SHALL display three distinct visual states for voting buttons:\n- Neutral state (default appearance)\n- Upvoted state (visually distinct to show user has upvoted)\n- Downvoted state (visually distinct to show user has downvoted)\n\n### Vote Visibility\nTHE system SHALL display the current vote score for each post and comment publicly\nTHE system SHALL NOT display which specific users have voted on content\nTHE system SHALL show the user their own voting choices on content they have interacted with\n\n## Vote Tracking\n\n### Vote Recording\nWHEN a member votes on a post or comment, THE system SHALL record:\n- The voter's user ID\n- The content ID (post or comment)\n- The vote type (upvote or downvote)\n- The timestamp of the vote action\n- The previous vote state (if any)\n\n### Vote Data Association\nTHE system SHALL associate each vote with exactly one piece of content (either a post or comment)\nTHE system SHALL associate each vote with exactly one user\nTHE system SHALL track both the current vote score and individual user voting actions\n\n### Vote Modification Tracking\nWHEN a member changes their vote on content, THE system SHALL update their previous vote record rather than creating a new one\nWHEN a member removes their vote on content, THE system SHALL mark the vote record as nullified with a timestamp\n\n### Vote Consistency\nTHE system SHALL prevent users from casting multiple votes on the same content\nTHE system SHALL maintain atomic operations for vote changes to prevent race conditions\nTHE system SHALL ensure vote counts accurately reflect the difference between upvotes and downvotes\n\n## Karma Calculation\n\n### Post Karma Calculation\nWHEN a member's post receives an upvote, THE system SHALL increase that member's post karma score by 1\nWHEN a member's post receives a downvote, THE system SHALL decrease that member's post karma score by 1\nWHEN a member's post has a vote removed, THE system SHALL adjust the member's post karma score accordingly\n\n### Comment Karma Calculation\nWHEN a member's comment receives an upvote, THE system SHALL increase that member's comment karma score by 1\nWHEN a member's comment receives a downvote, THE system SHALL decrease that member's comment karma score by 1\nWHEN a member's comment has a vote removed, THE system SHALL adjust the member's comment karma score accordingly\n\n### Total Karma Calculation\nTHE system SHALL calculate a member's total karma as the sum of their post karma and comment karma scores\nTHE system SHALL update total karma in real-time as individual post and comment votes are modified\n\n### Karma Visibility\nTHE system SHALL display a member's total karma score on their public profile\nTHE system SHALL display a member's post karma score on their public profile\nTHE system SHALL display a member's comment karma score on their public profile\nTHE system SHALL update karma scores instantly in the user interface when votes occur\n\n### Self-Voting Restriction\nTHE system SHALL NOT award karma points to users who vote on their own posts or comments\nTHE system SHALL prevent users from voting on their own content\n\n## Vote Restrictions\n\n### Authentication Requirements\nWHEN a guest attempts to vote on a post, THE system SHALL redirect them to the login page\nWHEN a guest attempts to vote on a comment, THE system SHALL redirect them to the login page\n\n### Rate Limiting\nTHE system SHALL limit individual members to 100 voting actions per hour to prevent abuse\nWHEN a member exceeds the hourly voting limit, THE system SHALL prevent further votes and display an appropriate error message\n\n### Vote Reversal Restrictions\nTHE system SHALL allow members to change or remove their votes at any time while the content exists\nTHE system SHALL NOT allow vote changes on deleted or removed content\n\n### Moderator and Admin Voting\nWHERE a moderator role is applied, THE system SHALL allow voting on all community content following the same rules as members\nWHERE an admin role is applied, THE system SHALL allow voting on all community content following the same rules as members\nTHE system SHALL NOT give moderators or admins special voting privileges beyond standard users\n\n### Community Restrictions\nWHEN a community is set to \"private\" mode, THE system SHALL continue allowing voting for subscribed members\nWHEN content is removed by moderators, THE system SHALL disable voting on that content\nWHEN content is deleted by the author, THE system SHALL disable voting on that content\n\n## Error Handling and Edge Cases\n\n### Invalid Content Handling\nWHEN a user attempts to vote on non-existent content, THE system SHALL return an error message \"Content not found\"\nWHEN a user attempts to vote on content in a non-existent community, THE system SHALL return an error message \"Community not found\"\n\n### Concurrent Vote Handling\nWHEN multiple vote actions occur simultaneously on the same content, THE system SHALL process them sequentially to ensure data integrity\n\n### System Failure Handling\nIF a vote action fails to record due to system issues, THEN THE system SHALL display an error message \"Unable to process vote. Please try again.\"\nIF a vote action fails due to network issues, THEN THE system SHALL display an error message \"Network connection failed. Please check your connection and try again.\"\n\n## Performance Requirements\n\n### Vote Processing\nTHE system SHALL process individual vote actions and update displayed scores within 1 second\nTHE system SHALL update karma scores in user profiles within 1 second of vote actions\n\n### Vote History Retrieval\nTHE system SHALL retrieve a user's voting history for their profile display within 3 seconds\nTHE system SHALL calculate content vote scores for sorting algorithms within 100 milliseconds\n\n```mermaid\ngraph LR\n    A[\"User Vote Interaction\"] --> B{\"Is User Authenticated?\"}\n    B -->|\"No\"| C[\"Redirect to Login\"]\n    B -->|\"Yes\"| D[\"Process Vote Action\"]\n    D --> E{\"Is Content Valid?\"}\n    E -->|\"No\"| F[\"Show Error: Content Not Found\"]\n    E -->|\"Yes\"| G[\"Record Vote\"]\n    G --> H[\"Update Content Score\"]\n    H --> I{\"Is Self-Vote?\"}\n    I -->|\"Yes\"| J[\"Block Karma Award\"]\n    I -->|\"No\"| K[\"Update User Karma\"]\n    K --> L[\"Update UI Instantly\"]\n    J --> L\n```"},{"filename":"07-commenting-system.md","reason":"Detail the nested commenting functionality requirements","documentType":"requirement","outline":["Comment Creation","Nested Replies","Comment Management","Comment Display"],"audience":"backend developers","keyQuestions":["How do users comment on posts?","How are nested replies handled?","Can users edit/delete comments?"],"detailLevel":"comprehensive","relatedDocuments":[],"constraints":[],"content":"# Reddit-like Community Platform Requirements Analysis Report\n\n## 1. Service Overview\n\n### 1.1 Platform Vision\nTHE redditClone service SHALL provide users with a platform for community-driven content sharing and discussion similar to Reddit, organized by topic-specific communities.\n\nWHEN users access the platform, THE system SHALL present a familiar interface with communities (subreddits), user-generated posts, and threaded discussions to facilitate knowledge sharing and social interaction.\n\nWHERE users seek specific topic discussions, THE system SHALL enable creation of dedicated communities where like-minded individuals can share content and engage in meaningful conversations.\n\nWHILE maintaining content quality and adherence to community standards, THE system SHALL empower users with community-driven moderation tools and quality control mechanisms through voting systems and reporting features.\n\n### 1.2 Core Features Summary\nTHE redditClone platform SHALL implement these core functionalities:\n- User registration and authentication system\n- Community (subreddit-like) creation and management capabilities\n- Multi-format content posting (text, links, images)\n- Comprehensive voting system (upvotes/downvotes) for content curation\n- Nested commenting system with reply threading functionality\n- User reputation system based on community engagement (karma)\n- Advanced content sorting algorithms (hot, new, top, controversial)\n- Community subscription mechanism for personalized content feeds\n- Detailed user profile pages displaying activity history\n- Content reporting and moderation workflow for inappropriate material\n\n## 2. User Roles\n\n### 2.1 Guest Users\nGuest users represent unauthenticated visitors to the platform with limited access capabilities:\n\nTHE guest role SHALL allow users to:\n- Browse public communities and their publicly visible content\n- View posts and comments without engaging in interactions\n- Search for communities by name or description keywords\n- Access registration and login interfaces to create accounts\n\nWHEN a guest attempts restricted actions such as posting, voting, or commenting, THE system SHALL redirect them to the login page with explanatory messaging about authentication requirements.\n\n### 2.2 Member Users\nMember users are authenticated participants forming the core community base:\n\nTHE member role SHALL permit users to:\n- Create text, link, and image posts in communities they have access to\n- Upvote and downvote posts and comments made by others\n- Create original comments on existing posts\n- Reply to comments with supporting nested reply functionality\n- Subscribe and unsubscribe from communities of interest\n- View and customize their own user profile settings\n- Report inappropriate or violating content to moderators\n- Access all public communities and their content\n\nWHEN a member accesses private or restricted community content, THE system SHALL verify their membership status and display appropriate permission messages for unauthorized access.\n\n### 2.3 Moderator Users\nModerators are trusted community members with specialized management capabilities:\n\nTHE moderator role SHALL inherit all member permissions and additionally allow users to:\n- Remove posts and comments that violate community rules\n- Ban and unban users from communities under their jurisdiction\n- Modify community settings including description, rules, and appearance\n- Review and resolve reported content within their assigned communities\n- Approve or reject posts in communities requiring pre-moderation\n- Add or remove other users as moderators for their community\n\nWHEN a moderator performs any moderation action, THE system SHALL log the event with timestamp, user identifier, and affected content for audit purposes.\n\n### 2.4 Admin Users\nAdministrators maintain system-wide oversight and management responsibilities:\n\nTHE admin role SHALL inherit all member permissions and additionally allow users to:\n- Manage all communities regardless of their subscription status\n- Access and review all reported content across the platform\n- Ban and unban users from the entire system\n- Remove any post or comment regardless of community context\n- Configure global system settings and content policies\n- Access administrative dashboards and comprehensive system reports\n\nWHEN an admin performs system-level administrative actions, THE system SHALL log the event with timestamp, user identifier, and detailed affected entities for audit purposes.\n\n## 3. Functional Requirements\n\n### 3.1 Registration and Authentication System\n\nWHEN a guest accesses the platform, THE system SHALL present distinct registration and login options interfaces.\n\nWHEN a guest selects registration, THE system SHALL collect username, email address, and password credentials using appropriate input validation.\n\nWHEN a user submits registration information, THE system SHALL validate these requirements:\n- Username SHALL contain 3-20 alphanumeric characters including underscores only\n- Email SHALL conform to valid email format specifications\n- Password SHALL have minimum 8 characters with at least one uppercase letter, one lowercase letter, and one numerical digit\n\nWHEN registration data successfully validates, THE system SHALL create a member account with default permissions and send email verification.\n\nWHEN a user provides valid credentials for successful login authentication, THE system SHALL establish an authenticated session with appropriate role permissions.\n\nWHEN a user requests logout, THE system SHALL immediately terminate the current session and redirect to guest access view.\n\nWHERE users attempt multiple failed login attempts, THE system SHALL implement rate limiting measures and temporary account lockouts.\n\n### 3.2 Community Management System\n\nWHEN an authenticated member chooses to create a community, THE system SHALL require:\n- Unique community name with 3-21 URL-safe characters (alphanumeric, hyphens, underscores)\n- Community description with maximum 500 characters\n- Privacy settings selection from public, restricted, or private options\n\nTHE system SHALL automatically assign community creators as initial moderators with full management capabilities.\n\nWHEN a moderator accesses community administration settings, THE system SHALL permit modification of:\n- Community name and description text\n- Privacy configuration and access restrictions\n- Banner and icon image assets\n- Community rules and behavioral guidelines\n- Moderator team member management\n\nWHEN a moderator removes violating posts or comments, THE system SHALL:\n- Archive the removed content for potential recovery or audit purposes\n- Display standardized notice to users that content was removed by moderator\n- Log the administrative action with timestamp and reason metadata\n\nWHEN community privacy settings change from public to private, THE system SHALL:\n- Preserve existing member subscriptions\n- Require future subscriptions to undergo moderator approval process\n- Implement appropriate access restrictions for new visitors\n\n### 3.3 Content Posting System\n\nWHEN a member chooses to create a post, THE system SHALL offer these three content types:\n- Text posts supporting up to 40,000 characters of plain text content\n- Link posts requiring valid URL validation and optional titles\n- Image posts accepting JPG, PNG, or GIF formats with maximum 10MB size\n\nTHE system SHALL require each new post submission to include:\n- Title with 1-300 characters in length\n- Target community from user's currently subscribed communities\n- Content appropriate to the selected post type specifications\n\nWHEN a user submits new text post content, THE system SHALL validate:\n- Body content length contains between 1-40,000 characters\n- Title length remains within 1-300 character boundaries\n- Community selection is valid and accessible to posting user\n\nWHEN a user submits new link post content, THE system SHALL validate:\n- URL validity according to web address specifications (http/https protocols)\n- Title length remains within 1-300 character boundaries\n- Community selection is valid and accessible to posting user\n\nWHEN a user submits new image post content, THE system SHALL validate:\n- Image format is either JPG, PNG, or GIF type\n- File size does not exceed 10MB maximum\n- Title length remains within 1-300 character boundaries\n- Community selection is valid and accessible to posting user\n\nTHE system SHALL store all posts with complete metadata including:\n- Creation timestamp with ISO 8601 date-time format\n- Author user identification for attribution purposes\n- Community association for content organization\n- Vote counts tracking upvotes, downvotes, and net scores\n- Comment count for engagement statistics\n- Content type identification (text, link, image)\n\nWHERE users attempt to submit duplicate content, THE system SHALL detect and prevent identical submissions to the same community within 24 hours.\n\n### 3.4 Voting Mechanisms System\n\nWHEN a member interacts with any post or comment content, THE system SHALL provide distinct upvote and downvote selection options with visual feedback.\n\nWHEN a member successfully upvotes content, THE system SHALL:\n- Increment the target content's upvote count by exactly one\n- Add one point to the author's karma score reflecting community engagement\n- Track the user's voting action to prevent multiple votes on single content\n\nWHEN a member successfully downvotes content, THE system SHALL:\n- Increment the target content's downvote count by exactly one\n- Subtract one point from the author's karma score reflecting community feedback\n- Track the user's voting action to prevent multiple votes on single content\n\nTHE system SHALL allow users to modify their previous voting choices:\n\nIF a user previously upvoted content and selects downvote, THEN THE system SHALL:\n- Decrease the previous upvote count by one\n- Increase the current downvote count by one\n- Update the author's karma score accordingly\n\nIF a user previously downvoted content and selects upvote, THEN THE system SHALL:\n- Decrease the previous downvote count by one\n- Increase the current upvote count by one\n- Update the author's karma score accordingly\n\nIF a user clicks the same existing vote option twice, THEN THE system SHALL:\n- Remove that specific vote from the content's count\n- Update the author's karma score to reflect vote removal\n- Delete the user's voting tracking record for that content\n\nTHE system SHALL update all publicly displayed score metrics in real-time upon processing any user voting action.\n\n### 3.5 Commenting Functionality System\n\nWHEN a member chooses to submit an original comment to a post, THE system SHALL provide text input supporting up to 10,000 characters of content.\n\nWHEN a member opts to reply directly to an existing comment, THE system SHALL create a nested reply structure with these characteristics:\n- Parent-child relationship linking the reply to target comment\n- Visual indentation hierarchy showing response threading\n- Support for up to 10 levels of nested conversation depth\n\nWHEN a user submits new comment or reply content, THE system SHALL:\n- Validate that comments contain text between 1-10,000 characters\n- Maintain parent-child relationships for nested reply tracking\n- Update the parent post's total comment counter metrics\n- Notify subscribed users based on configured notification preferences\n\nTHE system SHALL allow users to edit their own recently created comments within 15 minutes of original posting.\n\nTHE system SHALL allow users to delete their own comments if they have no existing replies to the content.\n\nWHEN a comment contains nested replies, THE system SHALL prevent direct deletion but SHALL allow editing to indicate \"[deleted]\" placeholder status.\n\nTHE system SHALL display comment sorting options including best, top, new, and controversial organizational methods.\n\n### 3.6 Content Sorting Algorithms System\n\nTHE system SHALL implement four distinct content ranking algorithms:\n\nWHEN displaying posts sorted by \"Hot\" algorithm, THE system SHALL use calculation formula:\n- Score = Log10(Max(|upvotes - downvotes|, 1)) + Sign × TimeFactor\n- Where Sign = 1 if (upvotes > downvotes), 0 if (upvotes = downvotes), -1 if (upvotes < downvotes)\n- TimeFactor = (Post creation time - Epoch reference time: January 1, 2025 00:00:00 UTC) / 45000\n\nWHEN displaying posts sorted by \"New\" algorithm, THE system SHALL organize posts in chronological sequence with newest content appearing first.\n\nWHEN displaying posts sorted by \"Top\" algorithm, THE system SHALL rank posts by net vote score (upvotes minus downvotes):\n\nWHEN displaying top posts, THE system SHALL provide these time filtering options:\n- Today (posts from previous 24 hours)\n- This week (posts from previous 7 days)\n- This month (posts from previous 30 days)\n- This year (posts from previous 365 days)\n- All time (complete post history)\n\nWHEN calculating controversial posts, THE system SHALL apply algorithm favoring posts with:\n- High absolute vote counts (sum of upvotes plus downvotes)\n- Balanced voting ratios near 1:1 upvote to downvote distribution\n\n### 3.7 Subscription System\n\nWHEN a member visits any community landing page, THE system SHALL provide a user interface toggle displaying either \"subscribe\" or \"unsubscribe\" based on current subscription status.\n\nWHEN a user selects subscribe to a community, THE system SHALL:\n- Add the target community to the user's personal subscription list\n- Include content from this community in the user's personalized home feed\n- Apply default notification settings for new community content\n\nWHEN a user selects unsubscribe from a community, THE system SHALL:\n- Remove the target community from the user's personal subscription list\n- Immediately exclude content from this community from the user's personalized home feed\n- Disable all active notifications for this community\n\nTHE system SHALL display all subscribed communities in each user's public profile page with subscription timestamps.\n\nTHE system SHALL implement a maximum subscription quantity limit of 10,000 communities per user to prevent performance degradation.\n\n### 3.8 User Profiles System\n\nTHE system SHALL display standard user profile pages containing these elements:\n- Username identification and account registration date\n- Current karma score reflecting community engagement\n- List of recent posts created by the profile owner\n- List of recent comments created by the profile owner\n- List of subscribed communities for content interest areas\n\nWHEN a user visits their own profile page, THE system SHALL additionally provide:\n- Account configuration for privacy and notification settings\n- Content history sorting preferences configuration\n- Data export tools for personal content access\n\nWHEN a user visits another user's profile page, THE system SHALL:\n- Display only publicly accessible information\n- Apply community privacy settings to shown content\n- Hide personal account configuration details and settings\n\n### 3.9 Reporting and Moderation System\n\nWHEN a member encounters inappropriate or violating content, THE system SHALL provide report submission interface with these categorical options:\n- Spam or misleading promotional content\n- Harassment or personal bullying behavior\n- Hate speech or discriminatory messaging\n- Violence or credible threat material\n- Personal information sharing violations\n- Sexual or explicit inappropriate content\n- Illegal activity related posting material\n- Other unspecified reason (custom text input)\n\nWHEN a user submits content violation report, THE system SHALL:\n- Store complete report metadata (timestamp, reporter ID, content ID, reason category)\n- Add the report to moderator queue for assigned community\n- Prevent identical duplicate reports from same user for same content\n- Immediately assign unique report identification number\n\nTHE system SHALL implement standard moderation workflow with these processing steps:\n1. Report submission creates new moderation ticket in queue system\n2. Moderators can view, filter, and sort tickets by community assignment\n3. Moderators can mark tickets as reviewed with resolution explanation\n4. Moderators can execute actions (content removal, user warnings, account suspensions)\n5. Original reporters receive automated notifications on ticket resolution\n\nWHEN a moderator removes reported content, THE system SHALL:\n- Archive the removed content for potential later reference or recovery\n- Display standard community notice that content was removed for guideline violations\n- Update the original reporter's ticket with resolution status and timestamp\n- Apply appropriate community user karma adjustments for content quality\n\nWHEN an administrator bans user account, THE system SHALL:\n- Immediately terminate all existing user authentication sessions\n- Prevent future login attempts with error notification\n- Display system notice that the account has been suspended for violations\n- Log the ban reason with responsible administrator identification\n- Apply appropriate community user karma removals for violating behavior\n\n## 4. Business Rules\n\n### 4.1 Account Management Rules\n\nTHE system SHALL enforce these core account governance rules:\n- Users MUST verify email address ownership before posting content privileges\n- All username identifiers MUST remain unique across entire platform scope\n- Deleted user accounts SHALL retain content metadata for historical tracking\n\n### 4.2 Content Management Rules\n\nTHE system SHALL enforce these content related regulations:\n- Posts SHALL maintain association with exactly one community assignment\n- Posts SHALL be permanently fixed to initial community without movement capability\n- Comments MUST maintain association with exactly one specific post\n- All links in posts SHALL pass validation as accessible web addresses\n\n### 4.3 Community Governance Rules\n\nTHE system SHALL enforce these platform community standards:\n- Community names SHALL remain unique and URL-safe compliant\n- Community creators SHALL automatically become assigned moderators\n- Only moderator role users can modify specific community settings\n- Each community SHALL retain at least one active moderator assigned\n\n### 4.4 Moderation Policies\n\nTHE system SHALL enforce these content moderation regulations:\n- Users SHALL only report identical content violations one time\n- Moderators SHALL only moderate communities under their authority\n- Administrators SHALL have access to all platform moderation capabilities\n- Content removal actions SHALL provide owner visible reasons for decisions\n\n## 5. Error Handling Requirements\n\nIF a user attempts access restricted platform functionality without authentication, THEN THE system SHALL redirect to the required login page interface.\n\nIF a user submits invalid registration credentials, THEN THE system SHALL display these appropriate validation error messages:\n- \"Username must contain between 3 and 20 alphanumeric or underscore characters\"\n- \"Email address format is invalid and cannot be used for registration\"\n- \"Password must have minimum 8 characters with uppercase, lowercase, and digits\"\n\nIF a user attempts to post invalid content formats, THEN THE system SHALL display these appropriate error messages:\n- \"Title is required and must remain between 1-300 characters in length\"\n- \"URL provided for link post is invalid and cannot be processed\"\n- \"Image exceeds maximum 10MB size limit and cannot be uploaded\"\n- \"Image format not supported - must use JPG, PNG, or GIF formats\"\n\nIF a user attempts to subscribe to more than system limit of 10,000 communities, THEN THE system SHALL display error message: \"Maximum subscription boundary reached.\"\n\nIF a user attempts to access non-existent communities, THEN THE system SHALL display error message: \"Community identifier not found within system.\"\n\nIF a user attempts to create community with pre-existing name, THEN THE system SHALL display error message: \"Community name already taken by existing group.\"\n\nIF a user attempts to vote multiple times on identical content, THEN THE system SHALL reject additional votes with message about existing choice.\n\nIF a user attempts to submit duplicate content within 24 hours, THEN THE system SHALL prevent posting with duplicate submission notice.\n\n## 6. Performance Requirements\n\nWHEN a user loads standard homepage content, THE system SHALL display data within maximum 2 seconds response time.\n\nWHEN a user submits new post content, THE system SHALL process and display the content within maximum 1 second response time.\n\nWHEN a user votes on any target content, THE system SHALL update public vote counts through instantaneous real-time updates.\n\nWHEN a user submits new comment content, THE system SHALL display the comment within maximum 500 milliseconds processing time.\n\nWHEN searching for community identifiers, THE system SHALL return complete results within maximum 1 second query execution time.\n\nTHE system SHALL support platform operations with up to 10,000 concurrent user sessions.\n\nTHE system SHALL maintain uptime availability of at least 99.5% during operational periods.\n\nWHEN retrieving detailed user profile information, THE system SHALL respond within maximum 1.5 seconds processing duration.\n\nTHE system SHALL implement caching for hot post rankings with 5 minute update intervals to optimize traffic performance.\n\nWHERE system performance degrades during high traffic periods, THE system SHALL prioritize authenticated user functionality over guest user accessibility.\n\n## 7. Success Metrics Framework\n\nTHE system SHALL track these key user engagement performance indicators:\n- Daily Active Users (DAU) measurement\n- Monthly Active Users (MAU) tracking\n- Average user session duration metrics\n- Total posts created per calendar day\n- Daily comment submission quantities\n\nTHE system SHALL monitor these community growth evaluation measurements:\n- New community creation frequencies\n- Community subscription adoption rates\n- Community activity levels (posts and comments per day metrics)\n- User retention in established communities\n\nTHE system SHALL analyze these content quality assessment benchmarks:\n- Average content report resolution timing\n- User satisfaction scores with content relevance\n- High karma scoring content ratio distribution\n- Community moderation effectiveness ratios\n\nTHE system SHALL evaluate these technical performance baseline indicators:\n- Average page and content load timing measurements\n- System uptime percentage tracking\n- Concurrent user session capacity utilization\n- Database query response duration monitoring\n\nTHE system SHALL store historical analytics data for minimum 2 years to support business decision making processes.\n\nTHE system SHALL provide dashboard accessibility for administrators to view real-time platform health metrics and performance indicators."},{"filename":"08-content-sorting.md","reason":"Define requirements for sorting posts by different criteria","documentType":"requirement","outline":["Sorting Algorithms","Hot Posts Calculation","Top Posts Periods","Controversial Posts"],"audience":"backend developers","keyQuestions":["How are posts sorted?","What algorithms determine hot posts?","How are top posts calculated?"],"detailLevel":"detailed","relatedDocuments":[],"constraints":[],"content":"# Content Sorting Requirements\n\n## Overview\nTHE redditClone platform SHALL provide users with multiple content sorting algorithms to help them discover relevant posts based on their preferences.\n\n## Sorting Algorithms\n\n### Hot Posts Calculation\nWHEN calculating hot posts, THE system SHALL use the following algorithm:\n- Score = Log10(Max(|upvotes - downvotes|, 1)) + Sign × TimeFactor\n- Where Sign = 1 if (upvotes > downvotes), 0 if (upvotes = downvotes), -1 if (upvotes < downvotes)\n- TimeFactor = (Post creation time - Epoch reference time) / 45000\n- Epoch reference time SHALL be set to January 1, 2025 00:00:00 UTC\n\nWHEN a post receives a new vote, THE system SHALL recalculate its hotness score immediately.\n\nTHE system SHALL order posts by hotness score in descending order.\n\nPosts created within the last 24 hours SHALL receive a 10% boost to their hotness score.\n\nPosts with deleted or banned status SHALL be excluded from hot sorting.\n\n### Top Posts Periods\nTHE system SHALL provide these time period filters for top posts:\n- All time: All posts since platform inception\n- Year: Posts from the past 365 days\n- Month: Posts from the past 30 days\n- Week: Posts from the past 7 days\n- Day: Posts from the past 24 hours\n\nWHEN a user accesses \"Top\" sorting without specifying a time period, THE system SHALL default to \"All time\" sorting.\n\nTHE system SHALL calculate top post scores using the formula: Score = upvotes - downvotes.\n\nPosts SHALL be ordered by this score in descending order within each time period.\n\nPosts with deleted or banned status SHALL be excluded from top sorting results.\n\n### Controversial Posts\nWHEN identifying controversial posts, THE system SHALL apply these criteria:\n- Posts with at least 5 upvotes AND 5 downvotes\n- Posts with a vote ratio between 0.25 and 0.75 (where ratio = upvotes / (upvotes + downvotes))\n\nTHE system SHALL calculate controversy scores using the formula: Score = Max(upvotes, downvotes) / |upvotes - downvotes|.\n\nPosts SHALL be ordered by this controversy score in descending order.\n\nPosts with deleted or banned status SHALL be excluded from controversial sorting.\n\n### New Posts\nTHE system SHALL order new posts by creation time in descending order (newest first).\n\nWHEN a user accesses a community with \"New\" sorting, THE system SHALL display all new posts in chronological order.\n\nEach page of new posts SHALL contain exactly 25 posts.\n\nPosts with deleted or banned status SHALL be excluded from new sorting results.\n\n## User Interface\n\n### Sorting Options Display\nTHE system SHALL provide a dropdown menu on all community pages with these sorting options:\n- Hot (default)\n- New\n- Top (with submenu for time periods)\n- Controversial\n\nWHERE a user has set a preferred sorting method in their profile settings, THE system SHALL use that preference as default for all community browsing.\n\nWHEN a user changes sorting options, THE system SHALL preserve that setting for their current browsing session.\n\n### Performance Requirements\nTHE system SHALL load sorted post listings within 2 seconds for communities with fewer than 10,000 posts.\n\nTHE system SHALL implement pagination for sorted post listings with 25 posts per page.\n\nWHEN retrieving sorted posts from the database, THE system SHALL utilize indexed queries for optimal performance.\n\nTHE system SHALL cache hot post rankings for 5 minutes to reduce computational overhead.\n\n### Error Handling\nIF a sorting algorithm calculation fails due to data inconsistencies, THEN THE system SHALL log the error and default to sorting by creation time (New).\n\nIF a user attempts to access a non-existent sorting method, THEN THE system SHALL return HTTP 400 with error code SORT_INVALID_METHOD.\n\nIF database queries for sorted posts exceed timeout limits, THEN THE system SHALL return an empty result set with error code SORT_QUERY_TIMEOUT.\n\nWHEN a community has no posts available for sorting, THE system SHALL display an appropriate message informing the user that no content is available."},{"filename":"09-subscription-system.md","reason":"Specify how users subscribe to communities functionality","documentType":"requirement","outline":["Subscription Mechanics","Subscription Tracking","Community Feed","Notification Settings"],"audience":"backend developers","keyQuestions":["How do users subscribe to communities?","How is subscription tracked?","What appears in user feeds?"],"detailLevel":"comprehensive","relatedDocuments":[],"constraints":[],"content":"# Subscription System Requirements\n\n## Subscription Mechanics\n\n### Guest Access Limitations\nWHEN a guest user attempts to subscribe to a community, THE system SHALL redirect them to the login page with a message indicating subscription requires authentication.\n\nWHEN a guest user attempts to access subscription management features, THE system SHALL redirect them to the login page.\n\n### Member Subscription Process\nWHEN an authenticated member browses a community page, THE system SHALL display a \"Subscribe\" button if they are not currently subscribed to that community.\n\nWHEN an authenticated member clicks the \"Subscribe\" button, THE system SHALL add that community to their subscriptions and change the button to \"Unsubscribe\".\n\nWHEN an authenticated member clicks the \"Unsubscribe\" button, THE system SHALL display a confirmation dialog asking if they want to unsubscribe from the community.\n\nWHEN an authenticated member confirms unsubscribing from a community through the confirmation dialog, THE system SHALL remove that community from their subscriptions and change the button to \"Subscribe\" on future visits.\n\n### Moderator and Admin Subscription Overrides\nWHERE a user has moderator or admin privileges for a community, THE system SHALL maintain these permissions separately from subscription status.\n\nWHEN a moderator or admin subscribes to a community they moderate, THE system SHALL indicate their special role status.\n\nWHEN an admin accesses subscription management for any community, THE system SHALL allow overriding normal subscription rules.\n\n### Community Type Restrictions\nTHE system SHALL allow members to subscribe to any public community without approval.\n\nTHE system SHALL allow members to subscribe to restricted communities following the same rules as public communities.\n\nTHE system SHALL allow members to request subscription to private communities, which requires moderator approval.\n\nWHEN a member requests to subscribe to a private community, THE system SHALL place the request in a pending state until approved by a moderator.\n\nIF a private community moderator approves a subscription request, THEN THE system SHALL activate the subscription immediately.\n\nIF a private community moderator rejects a subscription request, THEN THE system SHALL notify the user of the rejection.\n\n### Community Status Changes\nIF a private community changes to public status, THEN THE system SHALL automatically approve all pending subscription requests for that community.\n\nIF a public community changes to private status, THEN THE system SHALL preserve existing subscriptions but require new subscriptions to go through approval process.\n\nIF a subscribed community is deleted or banned, THEN THE system SHALL automatically unsubscribe all members from that community.\n\n## Subscription Tracking\n\n### Subscription Data Model\nTHE system SHALL maintain a record of each user's community subscriptions including:\n- User identifier\n- Community identifier\n- Subscription timestamp\n- Subscription status (active, pending, rejected)\n\nTHE system SHALL track the total number of subscribers for each community and display this count on the community page.\n\nTHE system SHALL update subscriber counts in real-time when users subscribe or unsubscribe from communities.\n\n### User Profile Integration\nWHEN a user views their profile, THE system SHALL display a list of communities they are subscribed to with subscription dates.\n\nWHEN a user views another user's public profile, THE system SHALL display their subscribed communities if privacy settings allow.\n\nWHEN a user accesses their account settings, THE system SHALL provide access to subscription management interface.\n\n### Subscription State Management\nTHE system SHALL maintain the following subscription states:\n- Active: User has access to community content\n- Pending: User has requested access to private community awaiting approval\n- Rejected: User's subscription request was denied by moderator\n- Inactive: User has unsubscribed or was removed by system\n\nWHILE a user is subscribed to a community in active state, THE system SHALL include posts from that community in their personalized feed.\n\nIF a user account is suspended or deleted, THEN THE system SHALL automatically unsubscribe that user from all communities.\n\n### Subscription Limits\nTHE system SHALL limit users to a maximum of 10,000 community subscriptions to prevent performance issues.\n\nWHEN a user attempts to exceed subscription limits, THE system SHALL display error message \"Maximum subscription limit of 10,000 communities reached\".\n\n## Community Feed\n\n### Feed Composition\nTHE system SHALL create a personalized feed for each authenticated user containing posts from all communities they are subscribed to in active state.\n\nWHEN a user accesses their feed, THE system SHALL display posts sorted by \"new\" as the default sorting method.\n\nWHERE a user has no community subscriptions, THE system SHALL display a recommendation of popular communities to subscribe to.\n\n### Feed Content Delivery\nTHE system SHALL ensure posts from subscribed communities appear in users' feeds within 30 seconds of posting.\n\nWHEN a user unsubscribes from a community, THE system SHALL remove posts from that community from their feed within 1 minute.\n\nTHE system SHALL display a maximum of 25 posts per page in the user's feed.\n\nIF a user attempts to access their feed and has network connectivity issues, THEN THE system SHALL display a cached version of their recent feed content if available.\n\nIF a subscribed community has no posts, THEN THE system SHALL not display any content from that community in the user's feed.\n\n### Data Consistency\nWHEN a user's subscription status changes, THE system SHALL update their feed content within 1 minute.\n\nTHE system SHALL maintain consistency between subscription records and feed content delivery.\n\n## Notification Settings\n\n### Default Notification Behavior\nWHEN a user subscribes to a community, THE system SHALL enable \"new post\" notifications for that community by default.\n\nTHE system SHALL allow users to customize notification preferences for each subscribed community, including:\n- New post notifications (enabled by default)\n- Hot post notifications (disabled by default)\n- Community announcement notifications (enabled by default)\n- Comment notifications (disabled by default)\n\n### Unsubscribe Notification Effects\nWHEN a user unsubscribes from a community, THE system SHALL automatically disable all notifications for that community.\n\n### Notification Delivery\nTHE system SHALL deliver notifications for subscribed community content within 1 minute of creation during peak hours (08:00-22:00 local time).\n\nTHE system SHALL deliver notifications for subscribed community content within 5 minutes of creation during non-peak hours.\n\nWHERE a user has disabled all notifications in their device settings, THE system SHALL queue notifications for 24 hours and attempt redelivery when notifications are re-enabled.\n\nIF a notification fails to deliver to a user, THEN THE system SHALL retry delivery up to 3 times with exponential backoff.\n\n### Notification Frequency Management\nTHE system SHALL allow users to configure notification frequency preferences including:\n- Real-time delivery\n- Digest delivery (hourly summaries)\n- Daily digest only\n- Notifications disabled\n\nWHEN a moderator posts in a community, THE system SHALL prioritize those notifications for all subscribers to that community.\n\n### Notification Preference Storage\nTHE system SHALL store notification preferences per user per community combination.\n\nTHE system SHALL provide users with a centralized notification settings page where they can manage preferences for all subscribed communities.\n\nIF a user changes their global notification settings, THEN THE system SHALL apply those changes to all community-specific notification preferences.\n\n## Performance Requirements\n\n### Response Time Standards\nWHEN a user subscribes or unsubscribes from a community, THE system SHALL process the request and update UI within 2 seconds.\n\nWHEN a user accesses their subscription management page, THE system SHALL load the page within 3 seconds.\n\nWHEN retrieving feed content based on subscriptions, THE system SHALL respond within 2 seconds for standard load.\n\n### Scalability Requirements\nTHE system SHALL support 1 million concurrent users with active subscriptions.\n\nTHE system SHALL maintain subscription data consistency across distributed systems.\n\n## Error Handling Scenarios\n\n### Subscription Process Errors\nIF a user attempts to subscribe to a non-existent community, THEN THE system SHALL display error message \"Community not found\".\n\nIF the system experiences a database error during subscription processing, THEN THE system SHALL display error message \"Unable to process subscription request. Please try again later.\" and preserve user intent.\n\nIF a user attempts to subscribe while rate-limited, THEN THE system SHALL display error message \"Too many subscription requests. Please wait before trying again.\".\n\n### Notification Errors\nIF notification delivery consistently fails for a user, THEN THE system SHALL mark their notification preferences as potentially invalid and prompt for verification.\n\nIF a user's notification settings cannot be retrieved, THEN THE system SHALL default to standard notification delivery and log the error.\n\n### System Integration Errors\nIF subscription data becomes inconsistent with community access permissions, THEN THE system SHALL reconcile the data during next user session and log discrepancy.\n\n## Business Rules and Constraints\n\n### Data Privacy\nWHERE user subscription information is private, THE system SHALL not display it to other users.\n\nTHE system SHALL encrypt subscription data in transit and at rest.\n\n### Account Lifecycle\nWHEN a user account is deleted, THE system SHALL remove all subscription associations but preserve community analytics data in aggregate form.\n\nWHEN a user account is suspended, THE system SHALL temporarily disable all subscription-based features.\n\n### Cross-Platform Consistency\nTHE system SHALL maintain consistent subscription states across all user devices and platforms.\n\n## Implementation Guidelines\n\n### User Interface Requirements\nTHE system SHALL provide visual indicators for subscription status on community pages.\n\nTHE system SHALL allow bulk subscription management operations.\n\n### Data Synchronization\nTHE system SHALL synchronize subscription data across all platform services within 5 minutes.\n\n### Audit Requirements\nTHE system SHALL log all subscription-related actions for audit purposes including:\n- Subscription creation\n- Subscription removal\n- Subscription approval\n- Subscription rejection\n\n```mermaid\ngraph LR\n    A[\"User Views Community Page\"] --> B{\"Already Subscribed\"}\n    B -->|Yes| C[\"Show Unsubscribe Button\"]\n    B -->|No| D[\"Show Subscribe Button\"]\n    D --> E[\"User Clicks Subscribe\"]\n    E --> F[\"Validate User Authentication\"]\n    F --> G[\"Add to User Subscriptions\"]\n    G --> H[\"Update Subscriber Count\"]\n    G --> I[\"Enable Default Notifications\"]\n    C --> J[\"User Clicks Unsubscribe\"]\n    J --> K{\"Show Confirmation Dialog\"}\n    K -->|User Confirms| L[\"Remove from Subscriptions\"]\n    L --> M[\"Update Subscriber Count\"]\n    L --> N[\"Disable All Notifications\"]\n    K -->|User Cancels| O[\"Return to Community Page\"]\n```"},{"filename":"10-user-profiles.md","reason":"Detail requirements for user profile functionality","documentType":"requirement","outline":["Profile Information","Activity Display","Post History","Comment History"],"audience":"backend developers","keyQuestions":["What information appears on user profiles?","How is user activity displayed?","What history is shown?"],"detailLevel":"detailed","relatedDocuments":[],"constraints":[],"content":"# User Profiles Requirements for RedditClone Platform\n\n## Profile Information\n\nTHE user profile system SHALL display the following information for each member:\n- Username (unique identifier selected during registration)\n- Account creation date\n- Karma score (derived from upvotes received on posts and comments)\n- Community subscriptions count\n- Brief user bio text (optional, up to 200 characters)\n- Post count (total posts created by the user)\n- Comment count (total comments created by the user)\n\nTHE user profile system SHALL allow users to view their own profile with additional information:\n- Email address (private, visible only to the profile owner)\n- Account status (active, suspended, etc.)\n- Last login timestamp\n- Connected social accounts (if any)\n\nTHE user profile system SHALL display moderator badge for users who moderate at least one community.\n\nTHE user profile system SHALL display admin badge for users with administrative privileges.\n\nWHEN a guest accesses a user profile, THE system SHALL show only public information and exclude private details.\n\nWHEN a member accesses another member's profile, THE system SHALL show only public information and exclude private details.\n\nWHEN a user accesses their own profile, THE system SHALL display both public and private information.\n\nTHE profile system SHALL display user's karma score prominently at the top of their profile.\n\nTHE profile system SHALL show subscription count as a numerical value.\n\nTHE profile system SHALL limit bio text to 200 characters maximum.\n\nIF a user's bio text exceeds 200 characters, THEN THE system SHALL truncate the text and show error message \"Bio must be 200 characters or less\".\n\nTHE profile system SHALL calculate and display total post count in real-time.\n\nTHE profile system SHALL calculate and display total comment count in real-time.\n\n## Activity Display\n\nTHE activity display system SHALL organize user content into filterable tabs:\n- \"Overview\" tab showing recent posts and comments\n- \"Posts\" tab showing user's post history\n- \"Comments\" tab showing user's comment history\n\nTHE activity display system SHALL show at most 10 items per page in the overview tab.\n\nTHE activity display system SHALL load additional content through pagination when users navigate to next pages.\n\nWHEN a user accesses a profile, THE system SHALL display the overview tab by default.\n\nWHEN a user selects the posts tab, THE system SHALL show only posts created by that user.\n\nWHEN a user selects the comments tab, THE system SHALL show only comments created by that user.\n\nTHE activity display system SHALL show relative timestamps (e.g., \"2 hours ago\", \"3 days ago\") for all activity items.\n\nTHE activity display system SHALL display community names as links to the respective community pages.\n\nTHE activity display system SHALL indicate deleted posts or comments with \"[deleted]\" text when displayed in activity feeds.\n\nTHE activity display system SHALL indicate removed posts or comments by moderators with \"[removed]\" text when displayed in activity feeds.\n\nWHILE loading profile activity, THE system SHALL display a loading indicator.\n\nIF profile activity fails to load, THEN THE system SHALL display error message \"Unable to load user activity. Please try again later.\"\n\nTHE activity display system SHALL sort items in descending chronological order (newest first) by default.\n\nWHERE a user has no activity, THE system SHALL display message \"This user has no activity yet\" in the respective tab.\n\n## Post History\n\nTHE post history system SHALL display all posts created by a user in the posts tab.\n\nTHE post history system SHALL organize posts by the following criteria:\n- Creation date (newest first by default)\n- Community where posted\n- Post type (text, link, image)\n\nTHE post history system SHALL show at most 20 posts per page.\n\nTHE post history system SHALL display the following information for each post:\n- Post title\n- Post type indicator (text/link/image)\n- Community name where posted\n- Creation timestamp\n- Upvote count\n- Downvote count\n- Comment count\n- Preview text for text posts (first 100 characters)\n- Preview image for image posts (thumbnail)\n- Domain name for link posts\n\nWHEN viewing their own post history, THE system SHALL show draft posts and scheduled posts.\n\nWHEN viewing another user's post history, THE system SHALL exclude draft posts and scheduled posts.\n\nTHE post history system SHALL indicate NSFW posts with appropriate badge.\n\nTHE post history system SHALL indicate spoiler posts with appropriate badge.\n\nTHE post history system SHALL indicate locked posts with appropriate badge.\n\nTHE post history system SHALL indicate pinned posts with appropriate badge.\n\nIF a post's community has been deleted, THEN THE system SHALL display \"[community deleted]\" instead of the community name.\n\nIF a post has been deleted by its author, THEN THE system SHALL show \"[deleted by author]\" message.\n\nIF a post has been removed by a moderator, THEN THE system SHALL show \"[removed by moderator]\" message.\n\nTHE post history system SHALL enable sorting by:\n- New (creation date, newest first)\n- Top (highest karma first)\n- Controversial (controversy score)\n\n## Comment History\n\nTHE comment history system SHALL display all comments created by a user in the comments tab.\n\nTHE comment history system SHALL organize comments by:\n- Creation date (newest first by default)\n- Thread context (post title that comment belongs to)\n- Community context (community of the post)\n\nTHE comment history system SHALL show at most 20 comments per page.\n\nTHE comment history system SHALL display the following information for each comment:\n- Post title (that the comment belongs to)\n- Community name where the post exists\n- Creation timestamp\n- Upvote count\n- Downvote count\n- Comment text preview (first 100 characters)\n- Reply count to the comment\n\nTHE comment history system SHALL enable sorting by:\n- New (creation date, newest first)\n- Top (highest karma first)\n- Controversial (controversy score)\n\nTHE comment history system SHALL include comments on posts in communities the viewing user doesn't have access to, but SHALL hide post and community information, displaying only \"[restricted]\" text.\n\nIF a comment's parent post has been deleted, THEN THE system SHALL display \"[parent post deleted]\" instead of the post title.\n\nIF a comment has been deleted by its author, THEN THE system SHALL show \"[deleted by author]\" message.\n\nIF a comment has been removed by a moderator, THEN THE system SHALL show \"[removed by moderator]\" message.\n\nIF a comment's text exceeds 100 characters, THEN THE system SHALL truncate for preview and show \"...\" indicator.\n\nTHE comment history system SHALL display nested context for replies with indentation visual cues.\n\nTHE comment history system SHALL limit displayed nesting depth to 5 levels for performance reasons.\n\nWHEN viewing their own comment history, THE system SHALL include deleted comments with appropriate indicators.\n\nWHEN viewing another user's comment history, THE system SHALL exclude comments deleted by the author or removed by moderators from display.\n\n## Privacy and Visibility Controls\n\nTHE profile visibility system SHALL allow users to set their profile as:\n- Public (visible to all users including guests)\n- Private (visible only to the user themselves)\n\nTHE profile visibility system SHALL default to Public for all new user accounts.\n\nWHEN a user sets their profile to private, THE system SHALL restrict access to their profile information for all users except the account owner.\n\nWHEN a guest attempts to access a private profile, THE system SHALL deny access and redirect to login page with message \"This user's profile is private. You need to login to view profiles.\"\n\nWHEN a member attempts to access a private profile that is not their own, THE system SHALL deny access and display message \"This user's profile is private.\"\n\nTHE bio text SHALL be visible only when the profile visibility is set to Public.\n\nTHE post history SHALL be visible only when the profile visibility is set to Public.\n\nTHE comment history SHALL be visible only when the profile visibility is set to Public.\n\nTHE subscription information SHALL be visible only when the profile visibility is set to Public.\n\nTHE karma score SHALL be visible even when profile visibility is set to Private.\n\n## Performance Requirements\n\nWHEN a user accesses any profile page, THE system SHALL load and display the page within 2 seconds under normal conditions.\n\nWHEN filtering or sorting profile content, THE system SHALL update the view within 1 second.\n\nTHE profile system SHALL cache user activity data to meet performance requirements.\n\nTHE profile system SHALL implement pagination for all history listings to maintain performance with large data sets.\n\n## Error Handling\n\nIF a requested user profile does not exist, THEN THE system SHALL return HTTP 404 with message \"User profile not found.\"\n\nIF a user account has been suspended, THEN THE profile system SHALL display message \"This user account has been suspended\" instead of normal profile information.\n\nIF the profile system experiences a temporary failure, THEN THE system SHALL display message \"Profiles are temporarily unavailable. Please try again later.\"\n\nIF a user attempts to sort by an invalid criterion, THEN THE system SHALL default to sorting by creation date (newest first) and log the error."},{"filename":"11-content-reporting.md","reason":"Define the content reporting and moderation system","documentType":"requirement","outline":["Reporting Mechanism","Report Categories","Moderation Workflow","Admin Actions"],"audience":"backend developers","keyQuestions":["How do users report content?","How are reports processed?","What actions can moderators take?"],"detailLevel":"comprehensive","relatedDocuments":[],"constraints":[],"content":"# Content Reporting Requirements\n\n## Reporting Mechanism\n\n### Core Reporting Functions\n\nWHEN a member encounters inappropriate content, THE system SHALL provide a reporting mechanism accessible from each post and comment.\n\nWHEN a user clicks the \"Report\" button on a post or comment, THE system SHALL display a modal dialog with report categories.\n\nTHE system SHALL allow users to submit reports with an optional text explanation (maximum 1000 characters).\n\nWHEN a user submits a report, THE system SHALL validate that:\n- The reporter is an authenticated member (guests cannot report)\n- The reported content exists and is accessible\n- A valid report category has been selected\n- Any explanation text does not exceed 1000 characters\n\nWHEN a user submits a valid report, THE system SHALL create a report record including:\n- Unique report identifier\n- Reporter user ID\n- Reported content ID (post or comment)\n- Report category selection\n- Optional explanation text\n- Report submission timestamp\n- Report status (pending, reviewed, resolved)\n\nWHEN a user attempts to report content they've already reported, THE system SHALL display a message indicating they've already submitted a report for that content.\n\n### Report Categories\n\nTHE system SHALL provide the following predefined report categories:\n- Spam or misleading content\n- Harassment or bullying\n- Hate speech or discrimination\n- Violence or threats\n- Personal information sharing\n- Sexual content\n- Illegal activities\n- Other (requires explanation)\n\nWHEN a user selects the \"Other\" report category, THE system SHALL require them to provide an explanation text (1-1000 characters).\n\n### Report Processing Workflow\n\nWHEN an admin accesses the moderation dashboard, THE system SHALL display pending reports sorted by submission timestamp (newest first).\n\nWHEN a moderator accesses the moderation dashboard for their communities, THE system SHALL display reports related to content in those communities only.\n\nTHE system SHALL track report statistics including:\n- Total reports submitted\n- Reports by category\n- Resolution times\n- Moderator actions taken\n\n## Moderation Workflow\n\n### Initial Report Review\n\nWHEN a moderator or admin reviews a pending report, THE system SHALL display:\n- The reported content with full context\n- Report category and explanation\n- Reporter information\n- Report submission timestamp\n\nTHE system SHALL prevent moderators from reviewing reports in communities they do not moderate.\n\nWHEN a moderator determines a report is valid, THE system SHALL allow them to:\n- Remove the reported content\n- Issue a warning to the content author\n- Temporarily ban the content author from the community\n- Permanently ban the content author from the community\n\nWHEN a moderator determines a report is invalid, THE system SHALL allow them to dismiss the report with an optional reason.\n\n### Content Removal Actions\n\nWHEN a moderator removes reported content, THE system SHALL:\n- Mark the content as \"removed by moderator\"\n- Hide the content from public view\n- Send a notification to the content author explaining the removal\n- Update the report status to \"resolved\"\n- Log the removal action with timestamp and moderator ID\n\nWHEN an admin permanently deletes content (rather than removing it), THE system SHALL:\n- Completely remove the content from the database\n- Update the report status to \"resolved\"\n- Log the deletion action with timestamp and admin ID\n\n### User Notifications\n\nWHEN a user's content is removed by a moderator, THE system SHALL send them a notification within 1 minute that includes:\n- Reference to the removed content\n- Report category that triggered the removal\n- Link to community rules that were violated\n- Instructions for appealing the removal if applicable\n\nWHEN a user's content is deleted by an admin, THE system SHALL send them a notification within 1 minute that includes:\n- Reference to the deleted content\n- Report category that triggered the deletion\n- Information about appeal processes (if any)\n\n## Admin Actions\n\n### Administrative Privileges\n\nWHERE an admin role is applied, THE system SHALL grant additional capabilities:\n- Access to all reports across all communities\n- Ability to permanently delete content (not just remove)\n- Ability to ban users from the entire platform\n- Access to detailed user activity logs\n- Ability to override moderator decisions\n\n### User Ban Management\n\nWHEN an admin bans a user from the platform, THE system SHALL:\n- Immediately invalidate all user sessions\n- Prevent all login attempts from that user\n- Hide all the user's existing content from public view\n- Prevent the user from creating new content\n- Log the ban action with timestamp, admin ID, and reason\n\nWHEN a moderator bans a user from a community, THE system SHALL:\n- Prevent the user from posting or commenting in that community\n- Allow the user to continue participating in other communities\n- Send a notification to the user about the community ban\n- Log the ban action with timestamp, moderator ID, and reason\n\n### Report Resolution Tracking\n\nTHE system SHALL maintain an audit trail of all report resolutions including:\n- Report ID and content that was reported\n- Moderator or admin who processed the report\n- Action taken (content removal, user warning, user ban, dismissal)\n- Resolution timestamp\n- Optional resolution notes from the moderator/admin\n\n### Escalation Procedures\n\nIF a moderator cannot resolve a report, THEN THE system SHALL allow escalation to admin level.\n\nWHEN a report is escalated to admin level, THE system SHALL:\n- Reassign the report to admins only\n- Notify relevant admins of the escalation\n- Preserve all previous report information and context\n\n### Appeal Processes\n\nTHE system SHALL allow content authors to appeal removal decisions through a dedicated appeal form.\n\nWHEN a user submits an appeal, THE system SHALL:\n- Create an appeal record linked to the original report\n- Assign the appeal to an admin for review\n- Send notification to the user acknowledging receipt\n\nWHEN an admin reviews an appeal, THE system SHALL allow them to:\n- Uphold the original removal decision\n- Restore the removed content\n- Modify the original removal action\n\n## Error Handling and Validation\n\n### Invalid Reporting Attempts\n\nIF a guest attempts to report content, THEN THE system SHALL redirect them to the login page.\n\nIF a user attempts to report non-existent content, THEN THE system SHALL display an error message: \"The content you're trying to report is no longer available.\"\n\nIF a user attempts to submit a report without selecting a category, THEN THE system SHALL display an error message: \"Please select a report category.\"\n\nIF a user submits an explanation text exceeding 1000 characters, THEN THE system SHALL display an error message: \"Explanation text must be 1000 characters or less.\"\n\n### Moderation Access Control\n\nIF a moderator attempts to access reports outside their communities, THEN THE system SHALL deny access with an appropriate error message.\n\nIF a user attempts to access moderation tools without proper permissions, THEN THE system SHALL deny access and log the attempt.\n\n### System Limitations\n\nTHE system SHALL limit users to submitting 10 reports per hour to prevent abuse.\n\nWHERE a user exceeds the hourly report limit, THE system SHALL display an error message and prevent further reports until the limit resets.\n\n## Performance and Technical Requirements\n\n### Report Processing\n\nWHEN a user submits a report, THE system SHALL process and store it within 500 milliseconds.\n\nTHE system SHALL display new reports in the moderation dashboard within 1 second of submission.\n\nWHEN a moderator resolves a report, THE system SHALL update report status within 200 milliseconds.\n\n### Notification Delivery\n\nTHE system SHALL deliver moderation-related notifications within 1 minute of the triggering action during peak hours.\n\nTHE system SHALL deliver moderation-related notifications within 5 minutes during non-peak hours.\n\nWHEN notification delivery fails, THE system SHALL retry delivery up to 3 times before marking as failed.\n\n### Data Retention\n\nTHE system SHALL maintain report records for at least 1 year for audit purposes.\n\nWHEN content is removed or deleted, THE system SHALL preserve the report connection for audit trails.\n\n### Privacy and Security\n\nTHE system SHALL restrict report visibility to authorized personnel only (moderators for their communities, admins for all reports).\n\nTHE system SHALL log all report access and actions for security auditing.\n\nIF a user account is deleted, THEN THE system SHALL preserve their reports with anonymized user references."}],"created_at":"2025-10-16T02:37:14.744Z","completed_at":"2025-10-16T02:38:19.383Z","step":0}]