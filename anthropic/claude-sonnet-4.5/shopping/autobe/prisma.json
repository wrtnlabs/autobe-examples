{"files":[{"filename":"schema-01-systematic.prisma","namespace":"Systematic","models":[{"name":"shopping_mall_system_configs","description":"Global platform configuration settings and operational parameters. Stores key-value pairs for system-wide settings including feature toggles, business thresholds, default values, and platform behavior controls. This table provides centralized configuration management for the entire e-commerce platform.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"config_key","type":"string","description":"Unique configuration key identifier using dot notation (e.g., 'platform.commission.default_rate', 'order.cancellation.window_hours'). Used to retrieve specific configuration values.","nullable":false},{"name":"config_value","type":"string","description":"Configuration value stored as string. Can represent various data types (numbers, booleans, JSON) that are parsed by the application layer based on the config_key.","nullable":false},{"name":"data_type","type":"string","description":"Data type indicator for the config_value (e.g., 'string', 'integer', 'decimal', 'boolean', 'json'). Helps application layer parse the value correctly.","nullable":false},{"name":"description","type":"string","description":"Human-readable description explaining the purpose and usage of this configuration setting. Helps administrators understand what the setting controls.","nullable":false},{"name":"category","type":"string","description":"Configuration category for grouping related settings (e.g., 'platform', 'payment', 'shipping', 'notification', 'security'). Enables organized configuration management.","nullable":false},{"name":"is_editable","type":"boolean","description":"Whether this configuration can be modified through admin interface. System-critical configurations are marked as non-editable to prevent accidental changes.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when this configuration entry was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when this configuration entry was last modified.","nullable":false}],"uniqueIndexes":[{"fieldNames":["config_key"],"unique":true}],"plainIndexes":[{"fieldNames":["category","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_channels","description":"Sales channels and marketplace segmentation configuration. Represents different distribution channels through which products are sold (e.g., web platform, mobile app, regional marketplaces, partner channels). Channels allow segmentation of products, customers, and orders for business analytics and operational management.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"channel_code","type":"string","description":"Unique channel identifier code (e.g., 'WEB', 'MOBILE_APP', 'US_MARKET', 'EU_MARKET'). Used as short reference in application logic and analytics.","nullable":false},{"name":"channel_name","type":"string","description":"Human-readable channel name displayed in admin dashboard and reports (e.g., 'Web Platform', 'Mobile Application', 'United States Market').","nullable":false},{"name":"description","type":"string","description":"Detailed description of the channel's purpose, target audience, and operational scope. Helps administrators understand channel segmentation strategy.","nullable":false},{"name":"channel_type","type":"string","description":"Channel classification type (e.g., 'platform', 'regional', 'partner', 'mobile'). Used for grouping and filtering channels by operational category.","nullable":false},{"name":"is_active","type":"boolean","description":"Whether this channel is currently active and accepting orders. Inactive channels are hidden from customer-facing interfaces but data is retained.","nullable":false},{"name":"default_currency","type":"string","description":"Default currency code for this channel following ISO 4217 standard (e.g., 'USD', 'EUR', 'GBP'). Used for pricing display and transaction processing.","nullable":false},{"name":"default_language","type":"string","description":"Default language code for this channel following ISO 639-1 standard (e.g., 'en', 'es', 'fr'). Used for content localization and communication templates.","nullable":false},{"name":"timezone","type":"string","description":"Channel timezone identifier in IANA format (e.g., 'America/New_York', 'Europe/London'). Used for displaying dates/times and scheduling operations.","nullable":false},{"name":"commission_rate","type":"double","description":"Platform commission rate for this channel as decimal percentage (e.g., 0.10 for 10%). Channel-specific commission overrides global platform defaults.","nullable":false},{"name":"settings_json","type":"string","description":"Channel-specific configuration settings stored as JSON. Contains customizable parameters like shipping methods, payment gateways, feature flags specific to this channel.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when this channel was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when this channel configuration was last modified.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp. When set, the channel is marked as deleted but data is retained for historical orders and analytics.","nullable":true}],"uniqueIndexes":[{"fieldNames":["channel_code"],"unique":true}],"plainIndexes":[{"fieldNames":["is_active","created_at"]},{"fieldNames":["channel_type","is_active"]}],"ginIndexes":[{"fieldName":"channel_name"}]},{"name":"shopping_mall_email_templates","description":"Email template management for transactional and marketing communications. Stores reusable email templates with dynamic content placeholders for order confirmations, shipping notifications, account verification, password reset, and promotional campaigns. Supports multi-language and channel-specific customization.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_channel_id","type":"uuid","description":"Optional channel association. {@link shopping_mall_channels.id}. When set, this template is specific to a channel; null indicates platform-wide template.","relation":{"name":"channel","targetModel":"shopping_mall_channels"},"unique":false,"nullable":true}],"plainFields":[{"name":"template_code","type":"string","description":"Unique template identifier code (e.g., 'ORDER_CONFIRMATION', 'SHIPMENT_NOTIFICATION', 'PASSWORD_RESET', 'WELCOME_EMAIL'). Used by application to select appropriate template.","nullable":false},{"name":"template_name","type":"string","description":"Human-readable template name displayed in admin interface (e.g., 'Order Confirmation Email', 'Shipping Notification').","nullable":false},{"name":"description","type":"string","description":"Description of template purpose, usage context, and available variables. Helps administrators understand when this template is sent.","nullable":false},{"name":"category","type":"string","description":"Template category for organization (e.g., 'transactional', 'marketing', 'authentication', 'notification'). Enables filtering and management by business function.","nullable":false},{"name":"language_code","type":"string","description":"Language code for template content following ISO 639-1 standard (e.g., 'en', 'es', 'fr'). Supports multi-language email communications.","nullable":false},{"name":"subject","type":"string","description":"Email subject line with support for variable placeholders (e.g., 'Your Order {{order_number}} has been confirmed'). Placeholders are replaced with actual values when email is sent.","nullable":false},{"name":"body_html","type":"string","description":"HTML email body content with variable placeholders and styling. Used for rich-formatted email display in modern email clients supporting HTML.","nullable":false},{"name":"body_text","type":"string","description":"Plain text email body content with variable placeholders. Used as fallback for email clients that don't support HTML or for accessibility.","nullable":false},{"name":"variables_json","type":"string","description":"JSON array of available template variables with descriptions (e.g., [{\"key\": \"order_number\", \"description\": \"Order ID\"}, {\"key\": \"customer_name\", \"description\": \"Customer full name\"}]). Documents available placeholders for template customization.","nullable":true},{"name":"from_email","type":"string","description":"Sender email address for this template (e.g., 'noreply@shoppingmall.com', 'support@shoppingmall.com'). Overrides default platform sender if specified.","nullable":true},{"name":"from_name","type":"string","description":"Sender name displayed to recipients (e.g., 'Shopping Mall Support', 'Order Team'). Provides friendly sender identification.","nullable":true},{"name":"reply_to_email","type":"string","description":"Reply-to email address if different from sender. Allows customers to respond to specific departments or support channels.","nullable":true},{"name":"is_active","type":"boolean","description":"Whether this template is active and can be used for sending emails. Inactive templates are retained but not available for selection.","nullable":false},{"name":"version","type":"int","description":"Template version number incremented on each update. Enables version tracking and rollback capability for template changes.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when this template was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when this template was last modified.","nullable":false}],"uniqueIndexes":[{"fieldNames":["template_code","language_code","shopping_mall_channel_id"],"unique":true}],"plainIndexes":[{"fieldNames":["category","is_active"]},{"fieldNames":["language_code","is_active"]}],"ginIndexes":[{"fieldName":"subject"},{"fieldName":"body_text"}]}]},{"filename":"schema-02-actors.prisma","namespace":"Actors","models":[{"name":"shopping_mall_customers","description":"Customer accounts representing individual shoppers on the platform. Customers can browse products, manage shopping carts and wishlists, place orders, write reviews, and manage delivery addresses. This is a primary user role with independent account management and full e-commerce capabilities.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"email","type":"string","description":"Customer's email address used for authentication and communication. Must be unique across all customers.","nullable":false},{"name":"password_hash","type":"string","description":"Hashed password for customer authentication. Stored using bcrypt or Argon2, never in plain text.","nullable":false},{"name":"name","type":"string","description":"Customer's full name for profile display and order processing.","nullable":false},{"name":"phone","type":"string","description":"Customer's phone number for order delivery contact and account verification.","nullable":true},{"name":"account_status","type":"string","description":"Current status of the customer account. Values: active (normal operation), suspended (temporary restriction due to policy violations), deleted (account deactivated by customer or admin). Controls access to platform features.","nullable":false},{"name":"email_verified","type":"boolean","description":"Whether the customer has verified their email address. Unverified accounts have restricted access to features like purchasing and reviewing.","nullable":false},{"name":"email_verification_token","type":"string","description":"Unique token sent to customer email for account verification. Expires after 24 hours.","nullable":true},{"name":"email_verification_sent_at","type":"datetime","description":"Timestamp when the verification email was last sent. Used for rate limiting resend requests.","nullable":true},{"name":"password_reset_token","type":"string","description":"Unique token for password reset requests. Expires after 1 hour.","nullable":true},{"name":"password_reset_expires_at","type":"datetime","description":"Expiration timestamp for the password reset token.","nullable":true},{"name":"failed_login_attempts","type":"int","description":"Count of consecutive failed login attempts. Resets to zero on successful login. Account locks after 5 failed attempts.","nullable":false},{"name":"failed_login_window_start_at","type":"datetime","description":"Timestamp when the current failed login attempt window started. Used to implement the 15-minute window rule: account locks after 5 failures within 15 minutes. Reset when window expires or login succeeds.","nullable":true},{"name":"account_locked_until","type":"datetime","description":"Timestamp until which the account is locked due to failed login attempts. Automatically unlocks after 30 minutes.","nullable":true},{"name":"password_changed_at","type":"datetime","description":"Timestamp of the last password change. Used for security auditing and password age policies.","nullable":true},{"name":"password_history","type":"string","description":"JSON array storing hashes of the last 5 passwords to prevent password reuse. Format: [{\"hash\": \"bcrypt_hash\", \"changed_at\": \"timestamp\"}]. Enforces password history policy.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when the customer account was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when the customer account was last updated.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp. When set, the account is marked as deleted but data is retained for legal and audit purposes.","nullable":true}],"uniqueIndexes":[{"fieldNames":["email"],"unique":true}],"plainIndexes":[{"fieldNames":["account_status","email_verified"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_sellers","description":"Seller accounts representing vendors who list and manage products on the platform. Sellers can create product listings, manage inventory per SKU, process orders, access sales analytics, and configure shipping and payout settings. This is a primary business user role requiring verification and approval.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"approved_by_admin_id","type":"uuid","description":"Admin who approved this seller account. {@link shopping_mall_admins.id}. Null for pending or rejected sellers. SET NULL on admin deletion to preserve seller account while losing approval reference.","relation":{"name":"approvedByAdmin","targetModel":"shopping_mall_admins"},"unique":false,"nullable":true}],"plainFields":[{"name":"email","type":"string","description":"Seller's email address used for authentication, business communication, and notifications. Must be unique across all sellers.","nullable":false},{"name":"password_hash","type":"string","description":"Hashed password for seller authentication. Stored using bcrypt or Argon2, never in plain text.","nullable":false},{"name":"business_name","type":"string","description":"Legal business name or store name publicly displayed to customers.","nullable":false},{"name":"business_type","type":"string","description":"Type of business entity. Values: individual, LLC, corporation, partnership.","nullable":false},{"name":"business_registration_number","type":"string","description":"Government-issued business registration number or business license number for verification purposes.","nullable":true},{"name":"tax_id","type":"string","description":"Tax identification number (EIN or SSN) for tax reporting and payout processing.","nullable":false},{"name":"contact_person_name","type":"string","description":"Full name of the primary contact person for the seller account.","nullable":false},{"name":"phone","type":"string","description":"Business phone number for customer service and platform communication.","nullable":false},{"name":"business_address","type":"string","description":"Physical business address for verification and legal compliance.","nullable":false},{"name":"bank_account_number","type":"string","description":"Bank account number for seller payouts. Stored encrypted for security.","nullable":true},{"name":"bank_routing_number","type":"string","description":"Bank routing number for payout transfers.","nullable":true},{"name":"bank_account_holder_name","type":"string","description":"Name on the bank account, must match business name for verification.","nullable":true},{"name":"store_url_slug","type":"string","description":"Unique URL slug for the seller's store page. Customizable by seller, must be unique across platform.","nullable":true},{"name":"store_description","type":"string","description":"Seller's store description and about information displayed on store page.","nullable":true},{"name":"store_logo_url","type":"uri","description":"URL to the seller's store logo image. JPEG, PNG, or WebP format, maximum 500KB.","nullable":true},{"name":"store_banner_url","type":"uri","description":"URL to the seller's store banner image for store page header. JPEG, PNG, or WebP format, maximum 2MB.","nullable":true},{"name":"account_status","type":"string","description":"Current status of the seller account. Values: pending_approval (application submitted, awaiting admin verification), active (approved and can sell), suspended (temporary restriction due to policy violations or performance issues), banned (permanent removal), on_hold (account frozen pending investigation). Controls ability to list products and receive orders.","nullable":false},{"name":"email_verified","type":"boolean","description":"Whether the seller has verified their email address. Required before account approval.","nullable":false},{"name":"email_verification_token","type":"string","description":"Unique token sent to seller email for account verification. Expires after 24 hours.","nullable":true},{"name":"email_verification_sent_at","type":"datetime","description":"Timestamp when the verification email was last sent. Used for rate limiting resend requests (max 1 per 5 minutes).","nullable":true},{"name":"documents_verified","type":"boolean","description":"Whether admin has verified business documents (registration, tax ID, bank info). Required for account activation.","nullable":false},{"name":"approved_at","type":"datetime","description":"Timestamp when the seller account was approved by admin.","nullable":true},{"name":"commission_rate","type":"double","description":"Platform commission rate for this seller as decimal (0.10 = 10%). Can be customized per seller, default is platform standard rate.","nullable":false},{"name":"free_shipping_threshold","type":"double","description":"Minimum order value for free shipping offered by this seller. Null if seller does not offer free shipping.","nullable":true},{"name":"return_policy","type":"string","description":"Seller's return and refund policy text displayed to customers.","nullable":true},{"name":"shipping_policy","type":"string","description":"Seller's shipping policy including processing times and shipping methods offered.","nullable":true},{"name":"password_reset_token","type":"string","description":"Unique token for password reset requests. Expires after 1 hour.","nullable":true},{"name":"password_reset_expires_at","type":"datetime","description":"Expiration timestamp for the password reset token.","nullable":true},{"name":"failed_login_attempts","type":"int","description":"Count of consecutive failed login attempts. Resets to zero on successful login. Account locks after 5 failed attempts within 15-minute window.","nullable":false},{"name":"failed_login_window_start_at","type":"datetime","description":"Timestamp when the current failed login attempt window started. Used to implement the 15-minute window rule. Reset when window expires or login succeeds.","nullable":true},{"name":"account_locked_until","type":"datetime","description":"Timestamp until which the account is locked due to failed login attempts. Automatically unlocks after 30 minutes.","nullable":true},{"name":"password_changed_at","type":"datetime","description":"Timestamp of the last password change. Used for security auditing and password age policies.","nullable":true},{"name":"password_history","type":"string","description":"JSON array storing hashes of the last 5 passwords to prevent password reuse. Format: [{\"hash\": \"bcrypt_hash\", \"changed_at\": \"timestamp\"}]. Enforces password history policy.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when the seller account was created and application was submitted.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when the seller account was last updated.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp. When set, the seller account is marked as deleted but data is retained for order history and compliance.","nullable":true}],"uniqueIndexes":[{"fieldNames":["email"],"unique":true},{"fieldNames":["store_url_slug"],"unique":true}],"plainIndexes":[{"fieldNames":["account_status","documents_verified"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"business_name"}]},{"name":"shopping_mall_admins","description":"Administrator accounts with platform-wide management capabilities. Admins can manage all orders, products, users, sellers, approve refunds, moderate content, and configure system settings. Admin accounts cannot be self-registered and must be created by existing admins. This is a primary privileged user role with full platform access.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"created_by_admin_id","type":"uuid","description":"Admin who created this admin account. Self-referential foreign key. {@link shopping_mall_admins.id}","relation":{"name":"createdByAdmin","targetModel":"shopping_mall_admins","mappingName":"recursive"},"unique":false,"nullable":true}],"plainFields":[{"name":"email","type":"string","description":"Admin's email address used for authentication and platform notifications. Must be unique across all admins.","nullable":false},{"name":"password_hash","type":"string","description":"Hashed password for admin authentication. Stored using bcrypt or Argon2, never in plain text. Requires strong password policy.","nullable":false},{"name":"name","type":"string","description":"Admin's full name for identification in audit logs and admin interface.","nullable":false},{"name":"role_level","type":"string","description":"Admin role defining permission level. Values: super_admin (full platform access, can create other admins), order_manager (order and refund management only), content_moderator (product and review moderation only), support_admin (customer service and basic operations). Roles are hierarchical with super_admin having all permissions.","nullable":false},{"name":"is_active","type":"boolean","description":"Whether the admin account is currently active. Inactive admins cannot log in or perform administrative actions.","nullable":false},{"name":"email_verified","type":"boolean","description":"Whether the admin has verified their email address. Required before granting admin access.","nullable":false},{"name":"email_verification_token","type":"string","description":"Unique token sent to admin email for account verification. Expires after 24 hours.","nullable":true},{"name":"email_verification_sent_at","type":"datetime","description":"Timestamp when the verification email was last sent. Used for rate limiting resend requests.","nullable":true},{"name":"mfa_enabled","type":"boolean","description":"Whether multi-factor authentication is enabled for this admin account. Required for super_admin role.","nullable":false},{"name":"mfa_secret","type":"string","description":"Encrypted MFA secret key for TOTP-based two-factor authentication.","nullable":true},{"name":"last_login_at","type":"datetime","description":"Timestamp of the admin's most recent successful login.","nullable":true},{"name":"last_login_ip","type":"string","description":"IP address from which the admin last logged in. Used for security monitoring.","nullable":true},{"name":"password_reset_token","type":"string","description":"Unique token for password reset requests. Expires after 1 hour.","nullable":true},{"name":"password_reset_expires_at","type":"datetime","description":"Expiration timestamp for the password reset token.","nullable":true},{"name":"failed_login_attempts","type":"int","description":"Count of consecutive failed login attempts. Resets to zero on successful login. Account locks after 5 failed attempts within 15-minute window.","nullable":false},{"name":"failed_login_window_start_at","type":"datetime","description":"Timestamp when the current failed login attempt window started. Used to implement the 15-minute window rule. Reset when window expires or login succeeds.","nullable":true},{"name":"account_locked_until","type":"datetime","description":"Timestamp until which the account is locked due to failed login attempts. Automatically unlocks after 30 minutes.","nullable":true},{"name":"password_changed_at","type":"datetime","description":"Timestamp of the last password change. Used for security auditing and enforcing password rotation policies.","nullable":true},{"name":"password_history","type":"string","description":"JSON array storing hashes of the last 5 passwords to prevent password reuse. Format: [{\"hash\": \"bcrypt_hash\", \"changed_at\": \"timestamp\"}]. Enforces password history policy.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when the admin account was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when the admin account was last updated.","nullable":false}],"uniqueIndexes":[{"fieldNames":["email"],"unique":true}],"plainIndexes":[{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_sessions","description":"User session records for authentication and session management across all user types (customers, sellers, admins). Tracks active sessions with JWT refresh tokens, device information, and activity monitoring. Sessions support multi-device login and provide security features like session revocation and timeout. This is a subsidiary entity managed by the authentication system.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"customer_id","type":"uuid","description":"Customer who owns this session. Null if session belongs to seller or admin. {@link shopping_mall_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":true},{"name":"seller_id","type":"uuid","description":"Seller who owns this session. Null if session belongs to customer or admin. {@link shopping_mall_sellers.id}","relation":{"name":"seller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":true},{"name":"admin_id","type":"uuid","description":"Admin who owns this session. Null if session belongs to customer or seller. {@link shopping_mall_admins.id}","relation":{"name":"admin","targetModel":"shopping_mall_admins"},"unique":false,"nullable":true}],"plainFields":[{"name":"user_type","type":"string","description":"Type of user this session belongs to. Values: customer, seller, admin. Used as discriminator to determine which foreign key (customer_id, seller_id, admin_id) is populated. Must be kept in sync with populated foreign key.","nullable":false},{"name":"refresh_token","type":"string","description":"JWT refresh token for generating new access tokens. Unique per session, used for token refresh flow.","nullable":false},{"name":"refresh_token_expires_at","type":"datetime","description":"Expiration timestamp for the refresh token. Typically 30 days from session creation.","nullable":false},{"name":"ip_address","type":"string","description":"IP address from which the session was initiated. Used for security monitoring and fraud detection.","nullable":false},{"name":"user_agent","type":"string","description":"Browser user agent string for device identification and session display to users.","nullable":false},{"name":"device_type","type":"string","description":"Detected device type. Values: mobile, tablet, desktop. Parsed from user agent.","nullable":true},{"name":"device_name","type":"string","description":"User-friendly device name for session display (e.g., 'Chrome on Windows', 'Safari on iPhone'). Shown to users in active sessions list.","nullable":true},{"name":"browser_name","type":"string","description":"Browser name parsed from user agent (Chrome, Firefox, Safari, etc.).","nullable":true},{"name":"operating_system","type":"string","description":"Operating system parsed from user agent (Windows, macOS, iOS, Android, Linux).","nullable":true},{"name":"approximate_location","type":"string","description":"Approximate geographic location based on IP address (e.g., 'New York, US', 'London, UK'). Used for security monitoring and session display.","nullable":true},{"name":"is_revoked","type":"boolean","description":"Whether this session has been manually revoked by the user or admin. Revoked sessions cannot be used for token refresh.","nullable":false},{"name":"revoked_at","type":"datetime","description":"Timestamp when the session was revoked. Null if session is still active.","nullable":true},{"name":"last_activity_at","type":"datetime","description":"Timestamp of the last activity in this session. Updated on each token refresh or important action. Sessions auto-expire after 30 days of inactivity.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when the session was created (user logged in).","nullable":false}],"uniqueIndexes":[{"fieldNames":["refresh_token"],"unique":true}],"plainIndexes":[{"fieldNames":["user_type","customer_id"]},{"fieldNames":["user_type","seller_id"]},{"fieldNames":["user_type","admin_id"]},{"fieldNames":["refresh_token_expires_at","is_revoked"]},{"fieldNames":["created_at"]}],"ginIndexes":[]}]},{"filename":"schema-03-addresses.prisma","namespace":"Addresses","models":[{"name":"shopping_mall_addresses","description":"Delivery addresses for customers, sellers, and admins. Supports multiple addresses per user with default address designation. Addresses are soft-deleted to preserve historical order data. Used during checkout for order delivery destination and preserved as snapshots in completed orders.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Customer who owns this address (null if owned by seller or admin). {@link shopping_mall_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":true},{"name":"shopping_mall_seller_id","type":"uuid","description":"Seller who owns this address (null if owned by customer or admin). {@link shopping_mall_sellers.id}","relation":{"name":"seller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":true},{"name":"shopping_mall_admin_id","type":"uuid","description":"Admin who owns this address (null if owned by customer or seller). {@link shopping_mall_admins.id}","relation":{"name":"admin","targetModel":"shopping_mall_admins"},"unique":false,"nullable":true}],"plainFields":[{"name":"user_type","type":"string","description":"Type of user who owns this address. Valid values: 'customer', 'seller', 'admin'. Must match the populated foreign key (customer_id, seller_id, or admin_id).","nullable":false},{"name":"recipient_name","type":"string","description":"Full name of the person who will receive deliveries at this address. May differ from account holder name for gift deliveries or business addresses.","nullable":false},{"name":"phone_number","type":"string","description":"Contact phone number for delivery coordination. Used by shipping carriers to contact recipient. Format validated by application layer for international compatibility.","nullable":false},{"name":"address_line1","type":"string","description":"Primary street address including house/building number and street name. Required field for all delivery addresses.","nullable":false},{"name":"address_line2","type":"string","description":"Secondary address information such as apartment number, suite, unit, floor, or building name. Optional field for additional address details.","nullable":true},{"name":"city","type":"string","description":"City or locality name for the delivery address. Required for address validation and shipping cost calculation.","nullable":false},{"name":"state_province","type":"string","description":"State, province, or administrative region for the delivery address. Used for tax calculation and address validation.","nullable":false},{"name":"postal_code","type":"string","description":"ZIP code or postal code for the delivery address. Format varies by country. Used for address validation, shipping cost calculation, and delivery routing.","nullable":false},{"name":"country","type":"string","description":"Country name or ISO 3166-1 alpha-2 country code for the delivery address. Determines address format validation rules, postal code format, and international shipping availability.","nullable":false},{"name":"country_code","type":"string","description":"ISO 3166-1 alpha-2 country code (US, GB, FR, etc.) for standardized country identification. Enables consistent filtering, grouping, and international shipping logic.","nullable":false},{"name":"is_default","type":"boolean","description":"Whether this address is the user's default delivery address. Only one address per user should be marked as default. Default address is pre-selected during checkout.","nullable":false},{"name":"label","type":"string","description":"Optional user-defined label for the address such as 'Home', 'Office', 'Parents House'. Helps users identify addresses quickly. Must be unique per user if provided.","nullable":true},{"name":"is_verified","type":"boolean","description":"Whether this address has been verified through address validation service. Unverified addresses may require customer confirmation during checkout.","nullable":false},{"name":"verified_at","type":"datetime","description":"Timestamp when the address was last verified through validation service. Used to determine if revalidation is needed.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when the address was first created by the user. Used for audit trail and chronological ordering of addresses.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp of the last modification to the address. Updated whenever any address field is changed. Used for tracking address changes and validation updates.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp. When set, indicates the address has been deleted by the user but preserved for historical order references. Null for active addresses.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_customer_id","label"],"unique":true},{"fieldNames":["shopping_mall_seller_id","label"],"unique":true},{"fieldNames":["shopping_mall_admin_id","label"],"unique":true}],"plainIndexes":[{"fieldNames":["user_type","shopping_mall_customer_id","deleted_at"]},{"fieldNames":["user_type","shopping_mall_seller_id","deleted_at"]},{"fieldNames":["user_type","shopping_mall_admin_id","deleted_at"]},{"fieldNames":["user_type","shopping_mall_customer_id","is_default"]},{"fieldNames":["user_type","shopping_mall_seller_id","is_default"]},{"fieldNames":["user_type","shopping_mall_admin_id","is_default"]},{"fieldNames":["postal_code"]},{"fieldNames":["country_code","state_province"]}],"ginIndexes":[{"fieldName":"recipient_name"}]}]},{"filename":"schema-04-categories.prisma","namespace":"Categories","models":[{"name":"shopping_mall_categories","description":"Product category hierarchy supporting unlimited depth parent-child relationships. Categories organize the product catalog with self-referential structure enabling breadcrumb navigation, taxonomy management, and flexible product organization. Root categories have null parent_id, and each category can have multiple children.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"parent_id","type":"uuid","description":"Parent category's {@link shopping_mall_categories.id}. Null for root-level categories. Creates hierarchical tree structure enabling unlimited depth taxonomy.","relation":{"name":"parent","targetModel":"shopping_mall_categories","mappingName":"recursive"},"unique":false,"nullable":true}],"plainFields":[{"name":"name","type":"string","description":"Category name displayed to users (e.g., 'Electronics', 'Laptops', 'Gaming Laptops'). Required for category identification and navigation.","nullable":false},{"name":"description","type":"string","description":"Optional detailed description of the category explaining what products belong here. Helps customers understand category scope and improves SEO.","nullable":true},{"name":"slug","type":"string","description":"URL-friendly unique identifier for category (e.g., 'gaming-laptops'). Used in category page URLs and routing. Must be globally unique across all categories.","nullable":false},{"name":"display_order","type":"int","description":"Sort order for displaying categories at the same hierarchy level. Lower numbers appear first. Used to control category presentation order in navigation and listings.","nullable":false},{"name":"is_active","type":"boolean","description":"Whether the category is active and visible to customers. Inactive categories are hidden but preserved for historical product associations. Allows toggling visibility without deletion.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp. When set, category is considered deleted but data preserved for audit trail and historical product-category relationships. Null indicates active category.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when the category was created. Used for audit trail and chronological tracking of category additions.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when the category was last modified. Updated whenever category properties change. Used for audit trail and change tracking.","nullable":false}],"uniqueIndexes":[{"fieldNames":["slug"],"unique":true}],"plainIndexes":[{"fieldNames":["parent_id","display_order"]},{"fieldNames":["is_active"]},{"fieldNames":["deleted_at"]}],"ginIndexes":[{"fieldName":"name"}]}]},{"filename":"schema-05-products.prisma","namespace":"Products","models":[{"name":"shopping_mall_products","description":"Core product entity representing items available for sale in the marketplace. Each product can have multiple variants (SKUs) with different color, size, and option combinations. Products are owned by sellers and organized into categories. Supports complete product lifecycle from draft to discontinued states with soft deletion capability.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_category_id","type":"uuid","description":"Product category assignment. {@link shopping_mall_categories.id}","relation":{"name":"category","targetModel":"shopping_mall_categories"},"unique":false,"nullable":false},{"name":"shopping_mall_seller_id","type":"uuid","description":"Seller who owns and manages this product. {@link shopping_mall_sellers.id}","relation":{"name":"seller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":false}],"plainFields":[{"name":"name","type":"string","description":"Product name displayed to customers. Must be between 3-200 characters.","nullable":false},{"name":"description","type":"string","description":"Detailed product description with minimum 20 characters, maximum 5000 characters. Supports rich text formatting.","nullable":false},{"name":"base_price","type":"double","description":"Base product price in USD. Individual SKU variants may have different prices. Must be positive number greater than zero.","nullable":false},{"name":"status","type":"string","description":"Product lifecycle status: draft (being created), active (published and visible), inactive (temporarily hidden), out_of_stock (all variants unavailable), discontinued (permanently removed).","nullable":false},{"name":"brand","type":"string","description":"Brand or manufacturer name. Optional branding information.","nullable":true},{"name":"tags","type":"string","description":"Comma-separated keywords for improved searchability and filtering. Examples: waterproof, eco-friendly, bestseller.","nullable":true},{"name":"specifications","type":"string","description":"Technical details in JSON format storing key-value pairs like weight, dimensions, materials, etc.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when product was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when product was last modified.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp. When set, product is hidden but preserved for order history.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_seller_id","name"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_seller_id","status","created_at"]},{"fieldNames":["status","created_at"]},{"fieldNames":["shopping_mall_category_id","status"]}],"ginIndexes":[{"fieldName":"name"},{"fieldName":"description"}]},{"name":"shopping_mall_skus","description":"Stock Keeping Unit representing a specific product variant with unique combination of attributes (color, size, options). Each SKU has independent pricing and inventory tracking. The actual purchasable unit in orders and carts.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Parent product this SKU variant belongs to. {@link shopping_mall_products.id}","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false},{"name":"shopping_mall_sku_color_id","type":"uuid","description":"Color variant attribute if applicable. {@link shopping_mall_sku_colors.id}","relation":{"name":"color","targetModel":"shopping_mall_sku_colors"},"unique":false,"nullable":true},{"name":"shopping_mall_sku_size_id","type":"uuid","description":"Size variant attribute if applicable. {@link shopping_mall_sku_sizes.id}","relation":{"name":"size","targetModel":"shopping_mall_sku_sizes"},"unique":false,"nullable":true},{"name":"shopping_mall_sku_option_id","type":"uuid","description":"Custom option variant attribute if applicable (storage, material, etc.). {@link shopping_mall_sku_options.id}","relation":{"name":"option","targetModel":"shopping_mall_sku_options"},"unique":false,"nullable":true}],"plainFields":[{"name":"sku_code","type":"string","description":"Unique SKU identifier code combining product ID and variant attributes. Must be unique platform-wide.","nullable":false},{"name":"price","type":"double","description":"SKU-specific price which may differ from base product price. Positive number greater than zero.","nullable":false},{"name":"available_quantity","type":"int","description":"Current stock available for purchase. Non-negative integer.","nullable":false},{"name":"reserved_quantity","type":"int","description":"Stock reserved for pending orders and active carts. Non-negative integer.","nullable":false},{"name":"low_stock_threshold","type":"int","description":"Inventory level that triggers low stock alerts to seller. Default 10 units.","nullable":false},{"name":"is_active","type":"boolean","description":"Whether this SKU variant is currently available for purchase. Inactive SKUs are hidden from customers.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when SKU was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when SKU was last modified.","nullable":false}],"uniqueIndexes":[{"fieldNames":["sku_code"],"unique":true},{"fieldNames":["shopping_mall_product_id","shopping_mall_sku_color_id","shopping_mall_sku_size_id","shopping_mall_sku_option_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_product_id","is_active"]},{"fieldNames":["is_active","available_quantity"]}],"ginIndexes":[]},{"name":"shopping_mall_sku_colors","description":"Color variant attribute for SKUs. Stores color name and optional hex code for visual representation. Used to differentiate product variants by color.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"name","type":"string","description":"Color name displayed to customers. Examples: Navy Blue, Forest Green, Crimson Red.","nullable":false},{"name":"hex_code","type":"string","description":"Optional hex color code for visual swatch display. Format: #RRGGBB.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when color was created.","nullable":false}],"uniqueIndexes":[{"fieldNames":["name"],"unique":true}],"plainIndexes":[],"ginIndexes":[]},{"name":"shopping_mall_sku_sizes","description":"Size variant attribute for SKUs. Stores size value and optional category for different sizing systems (US, EU, One Size, etc.).","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"value","type":"string","description":"Size value displayed to customers. Examples: Small, Medium, Large, 38, 40, 42.","nullable":false},{"name":"category","type":"string","description":"Size category or system. Examples: US Sizes, EU Sizes, One Size, Numeric.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when size was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when size was last modified.","nullable":false}],"uniqueIndexes":[{"fieldNames":["value","category"],"unique":true}],"plainIndexes":[],"ginIndexes":[]},{"name":"shopping_mall_sku_options","description":"Custom option variant attribute for SKUs. Stores seller-defined product options beyond color and size, such as storage capacity, material type, package quantity, subscription period, etc.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"option_name","type":"string","description":"Name of the custom option. Examples: Storage Capacity, Material Type, Package Quantity.","nullable":false},{"name":"option_value","type":"string","description":"Value of the custom option. Examples: 128GB, Cotton, 12-Pack.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when option was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when option was last modified.","nullable":false}],"uniqueIndexes":[{"fieldNames":["option_name","option_value"],"unique":true}],"plainIndexes":[],"ginIndexes":[]},{"name":"shopping_mall_inventory_transactions","description":"Complete audit trail of all inventory changes for SKUs. Records every inventory movement including sales, restocks, adjustments, returns, and cancellations with timestamp, reason, and actor tracking. Append-only historical data for compliance and reconciliation.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_sku_id","type":"uuid","description":"SKU whose inventory changed. {@link shopping_mall_skus.id}","relation":{"name":"sku","targetModel":"shopping_mall_skus"},"unique":false,"nullable":false},{"name":"shopping_mall_order_id","type":"uuid","description":"Related order if transaction is due to sale or cancellation. {@link shopping_mall_orders.id}","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":true},{"name":"actor_seller_id","type":"uuid","description":"Seller who initiated the inventory change if manual adjustment. {@link shopping_mall_sellers.id}","relation":{"name":"actorSeller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":true},{"name":"actor_admin_id","type":"uuid","description":"Admin who initiated the inventory change if administrative action. {@link shopping_mall_admins.id}","relation":{"name":"actorAdmin","targetModel":"shopping_mall_admins"},"unique":false,"nullable":true}],"plainFields":[{"name":"transaction_type","type":"string","description":"Type of inventory transaction: sale, restock, adjustment, damage_loss, return, cancellation.","nullable":false},{"name":"quantity_change","type":"int","description":"Quantity change - positive for additions (restock, return), negative for reductions (sale, damage).","nullable":false},{"name":"quantity_after","type":"int","description":"Resulting available quantity after this transaction. For audit verification.","nullable":false},{"name":"transaction_status","type":"string","description":"Processing status of the inventory transaction: pending (reservation), completed (permanent allocation), reversed (cancellation/refund). Critical for tracking concurrent inventory operations and order state.","nullable":false},{"name":"reason","type":"string","description":"Explanation or reason for the inventory change. Required for adjustments and corrections.","nullable":true},{"name":"notes","type":"string","description":"Additional notes or details about the transaction.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when inventory transaction occurred.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_sku_id","created_at"]},{"fieldNames":["transaction_type","transaction_status","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_product_images","description":"Product images for visual display in catalog and detail pages. Supports multiple images per product with ordering for gallery display. Includes variant-specific images when applicable.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Product this image belongs to. {@link shopping_mall_products.id}","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false},{"name":"shopping_mall_sku_id","type":"uuid","description":"Specific SKU variant this image represents, if variant-specific. {@link shopping_mall_skus.id}","relation":{"name":"sku","targetModel":"shopping_mall_skus"},"unique":false,"nullable":true}],"plainFields":[{"name":"image_url","type":"uri","description":"URL to the stored product image. JPEG, PNG, or WebP format, minimum 800x800 pixels.","nullable":false},{"name":"display_order","type":"int","description":"Order position for image gallery display. Lower numbers appear first. First image (0) is main product image.","nullable":false},{"name":"is_primary","type":"boolean","description":"Whether this is the primary/main product image shown in listings. Only one image per product should be primary.","nullable":false},{"name":"alt_text","type":"string","description":"Alternative text for accessibility and SEO. Describes the image content.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when image was uploaded.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_product_id","display_order"]},{"fieldNames":["shopping_mall_sku_id","display_order"]}],"ginIndexes":[]}]},{"filename":"schema-06-shopping.prisma","namespace":"Shopping","models":[{"name":"shopping_mall_carts","description":"Shopping cart for customers. Each customer has one active cart that persists across sessions. Carts are soft-deleted when cleared but retained for analytics. The cart serves as a container for cart items and enables customers to collect products before checkout.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Customer who owns this cart. {@link shopping_mall_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":false}],"plainFields":[{"name":"created_at","type":"datetime","description":"Timestamp when the cart was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when the cart was last updated.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp. Null means cart is active, non-null means cart was cleared or abandoned.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_customer_id","deleted_at"],"unique":true}],"plainIndexes":[{"fieldNames":["created_at"]},{"fieldNames":["updated_at"]}],"ginIndexes":[]},{"name":"shopping_mall_cart_items","description":"Individual items within a shopping cart. Each item represents a specific SKU with quantity and price snapshot. Customers manage cart items by adding, updating quantities, or removing items. Price is snapshotted at addition time to track price changes.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_cart_id","type":"uuid","description":"Cart that contains this item. {@link shopping_mall_carts.id}","relation":{"name":"cart","targetModel":"shopping_mall_carts"},"unique":false,"nullable":false},{"name":"shopping_mall_sku_id","type":"uuid","description":"Product SKU being added to cart. {@link shopping_mall_skus.id}","relation":{"name":"sku","targetModel":"shopping_mall_skus"},"unique":false,"nullable":false}],"plainFields":[{"name":"quantity","type":"int","description":"Quantity of this SKU in the cart. Must be positive integer.","nullable":false},{"name":"unit_price","type":"double","description":"Price per unit at the time item was added to cart. Snapshot for price change tracking.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when the item was added to cart.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when the item was last updated (quantity or price change).","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_cart_id","shopping_mall_sku_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_cart_id","created_at"]},{"fieldNames":["shopping_mall_sku_id"]}],"ginIndexes":[]},{"name":"shopping_mall_wishlists","description":"Customer wishlists for saving products for future purchase. Customers can create multiple named wishlists to organize products (e.g., 'Holiday Gifts', 'Favorites', 'Birthday Ideas'). Wishlists are soft-deleted when removed but retained for analytics.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Customer who owns this wishlist. {@link shopping_mall_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":false}],"plainFields":[{"name":"name","type":"string","description":"Name of the wishlist for organization (e.g., 'Favorites', 'Holiday Gifts', 'Birthday Ideas').","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when the wishlist was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when the wishlist was last updated.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp. Null means wishlist is active, non-null means wishlist was deleted.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_customer_id","created_at"]},{"fieldNames":["updated_at"]}],"ginIndexes":[]},{"name":"shopping_mall_wishlist_items","description":"Individual items within a wishlist. Each item represents a specific SKU that the customer wants to save for future purchase. Customers can add items to wishlist from product pages and later move them to cart when ready to buy.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_wishlist_id","type":"uuid","description":"Wishlist that contains this item. {@link shopping_mall_wishlists.id}","relation":{"name":"wishlist","targetModel":"shopping_mall_wishlists"},"unique":false,"nullable":false},{"name":"shopping_mall_sku_id","type":"uuid","description":"Product SKU saved in the wishlist. {@link shopping_mall_skus.id}","relation":{"name":"sku","targetModel":"shopping_mall_skus"},"unique":false,"nullable":false}],"plainFields":[{"name":"created_at","type":"datetime","description":"Timestamp when the item was added to wishlist.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when the item was last updated.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_wishlist_id","shopping_mall_sku_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_wishlist_id","created_at"]},{"fieldNames":["shopping_mall_sku_id"]}],"ginIndexes":[]}]},{"filename":"schema-07-orders.prisma","namespace":"Orders","models":[{"name":"shopping_mall_orders","description":"Core order entity representing a customer's purchase from a single seller. Multi-seller carts result in multiple order records, one per seller. Tracks complete order lifecycle from placement through delivery or cancellation. Orders snapshot critical data at checkout time (address, prices) to preserve historical accuracy even when products or addresses are later modified.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Customer who placed this order. {@link shopping_mall_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":false},{"name":"shopping_mall_seller_id","type":"uuid","description":"Seller fulfilling this order. Multi-seller carts create separate orders per seller. {@link shopping_mall_sellers.id}","relation":{"name":"seller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":false}],"plainFields":[{"name":"order_number","type":"string","description":"Unique human-readable order identifier in format ORD-YYYYMMDD-NNNNNN (e.g., ORD-20251013-000001) displayed to customers and sellers.","nullable":false},{"name":"checkout_transaction_id","type":"uuid","description":"Groups orders created from the same checkout session. Multi-seller carts result in multiple orders sharing the same checkout_transaction_id, enabling display of 'orders from same purchase'.","nullable":false},{"name":"status","type":"string","description":"Current order status: pending_payment, payment_confirmed, awaiting_seller_confirmation, confirmed, processing, preparing_shipment, shipped, in_transit, out_for_delivery, delivered, completed, cancelled, refund_requested, refund_approved, refunded, failed.","nullable":false},{"name":"shipping_method","type":"string","description":"Shipping method selected at checkout: standard (5-7 days), express (2-3 days), overnight (1 day), free_shipping. Required for shipping cost calculation and delivery estimation.","nullable":false},{"name":"shipping_cost","type":"double","description":"Shipping fee for this order calculated based on shipping method and destination.","nullable":false},{"name":"tax_amount","type":"double","description":"Tax amount calculated based on delivery address jurisdiction.","nullable":false},{"name":"total_amount","type":"double","description":"Final order total: sum of order_items subtotals + shipping_cost + tax_amount. Calculated at checkout and preserved as snapshot.","nullable":false},{"name":"currency","type":"string","description":"ISO 4217 currency code for order amounts (e.g., USD, EUR, GBP).","nullable":false},{"name":"delivery_recipient_name","type":"string","description":"Recipient name snapshotted from delivery address at checkout. Preserved for historical order display.","nullable":false},{"name":"delivery_phone","type":"string","description":"Delivery contact phone snapshotted from address at checkout.","nullable":false},{"name":"delivery_address_line1","type":"string","description":"Primary street address snapshotted at checkout.","nullable":false},{"name":"delivery_address_line2","type":"string","description":"Secondary address information snapshotted at checkout (apartment, suite, etc.).","nullable":true},{"name":"delivery_city","type":"string","description":"Delivery city snapshotted at checkout.","nullable":false},{"name":"delivery_state_province","type":"string","description":"Delivery state/province snapshotted at checkout.","nullable":false},{"name":"delivery_postal_code","type":"string","description":"Delivery postal code snapshotted at checkout.","nullable":false},{"name":"delivery_country","type":"string","description":"Delivery country snapshotted at checkout.","nullable":false},{"name":"customer_notes","type":"string","description":"Optional special instructions or notes from customer for order fulfillment.","nullable":true},{"name":"placed_from_ip","type":"string","description":"IP address from which order was placed. Used for fraud detection and security monitoring.","nullable":true},{"name":"estimated_delivery_date","type":"datetime","description":"Estimated delivery date based on shipping method and seller processing time.","nullable":true},{"name":"payment_confirmed_at","type":"datetime","description":"Timestamp when payment was successfully confirmed. Denormalized from status history for efficient timeline queries.","nullable":true},{"name":"seller_confirmed_at","type":"datetime","description":"Timestamp when seller confirmed they can fulfill the order. Required for tracking 24-hour confirmation deadline. Null if seller hasn't confirmed yet.","nullable":true},{"name":"shipped_at","type":"datetime","description":"Timestamp when order was marked as shipped. Denormalized from status history for efficient timeline display.","nullable":true},{"name":"delivered_at","type":"datetime","description":"Timestamp when order was delivered to customer. Denormalized from status history for performance.","nullable":true},{"name":"completed_at","type":"datetime","description":"Timestamp when order was marked as completed (customer confirmed receipt or auto-completed after 7 days).","nullable":true},{"name":"cancelled_at","type":"datetime","description":"Timestamp when order was cancelled.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when order was created (placed by customer).","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when order was last modified.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp for cancelled orders. Null indicates active order.","nullable":true}],"uniqueIndexes":[{"fieldNames":["order_number"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_customer_id","created_at"]},{"fieldNames":["shopping_mall_seller_id","status","created_at"]},{"fieldNames":["status","created_at"]},{"fieldNames":["checkout_transaction_id"]}],"ginIndexes":[]},{"name":"shopping_mall_order_items","description":"Individual line items within an order representing specific SKUs purchased with quantities and prices at time of order. Snapshots product display information (name, variant details, images) to preserve historical accuracy even when products are updated or deleted. Enables partial fulfillment tracking and accurate order detail display.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Parent order containing this item. {@link shopping_mall_orders.id}","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false},{"name":"shopping_mall_sku_id","type":"uuid","description":"Product SKU variant that was ordered. Preserves SKU reference even if product later discontinued. {@link shopping_mall_skus.id}","relation":{"name":"sku","targetModel":"shopping_mall_skus"},"unique":false,"nullable":false}],"plainFields":[{"name":"product_name","type":"string","description":"Product name snapshotted at time of purchase. Preserved for historical order display even if seller later renames product.","nullable":false},{"name":"variant_attributes","type":"string","description":"SKU variant attributes as JSON (color, size, options) snapshotted at purchase time. Example: {\"color\": \"Navy Blue\", \"size\": \"Large\"}. Enables accurate historical variant display.","nullable":true},{"name":"product_image_url","type":"string","description":"Primary product image URL snapshotted at purchase time for order history display.","nullable":true},{"name":"quantity","type":"int","description":"Quantity of this SKU ordered by customer.","nullable":false},{"name":"unit_price","type":"double","description":"Price per unit at time of order placement (captured from SKU price at checkout).","nullable":false},{"name":"item_status","type":"string","description":"Individual item status for partial fulfillment: pending, confirmed, preparing, shipped, delivered, cancelled, refunded.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when order item was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when order item was last modified.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_order_id","shopping_mall_sku_id"]}],"ginIndexes":[]},{"name":"shopping_mall_order_status_history","description":"Audit trail tracking all order status transitions with timestamps and actors. Implements snapshot pattern for compliance and order lifecycle visibility. Append-only table preserving complete order history.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Order whose status changed. {@link shopping_mall_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false},{"name":"shopping_mall_customer_id","type":"uuid","description":"Customer who triggered status change (if customer-initiated). {@link shopping_mall_customers.id}.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":true},{"name":"shopping_mall_seller_id","type":"uuid","description":"Seller who triggered status change (if seller-initiated). {@link shopping_mall_sellers.id}.","relation":{"name":"seller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":true},{"name":"shopping_mall_admin_id","type":"uuid","description":"Admin who triggered status change (if admin-initiated). {@link shopping_mall_admins.id}.","relation":{"name":"admin","targetModel":"shopping_mall_admins"},"unique":false,"nullable":true}],"plainFields":[{"name":"previous_status","type":"string","description":"Order status before this change.","nullable":true},{"name":"new_status","type":"string","description":"Order status after this change.","nullable":false},{"name":"change_reason","type":"string","description":"Explanation for status change (e.g., payment_confirmed, seller_shipped, customer_cancelled).","nullable":true},{"name":"notes","type":"string","description":"Additional notes or details about the status change.","nullable":true},{"name":"is_system_generated","type":"boolean","description":"True if status change was automatic (e.g., payment gateway callback), false if manually triggered by user.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when status change occurred.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_order_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_shipments","description":"Shipping and tracking information for order fulfillment. Links orders to carriers and provides tracking capabilities. Created by sellers when marking orders as shipped. Tracks shipment status through carrier integration.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Order being shipped. {@link shopping_mall_orders.id}","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false},{"name":"created_by_seller_id","type":"uuid","description":"Seller who created this shipment record and provided tracking information. {@link shopping_mall_sellers.id}","relation":{"name":"createdBySeller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":false}],"plainFields":[{"name":"carrier_name","type":"string","description":"Shipping carrier name (e.g., FedEx, UPS, USPS, DHL).","nullable":false},{"name":"tracking_number","type":"string","description":"Carrier tracking number for shipment tracking.","nullable":false},{"name":"shipping_method","type":"string","description":"Shipping service level used: standard, express, overnight, free_shipping.","nullable":false},{"name":"shipment_status","type":"string","description":"Current shipment status: label_created, picked_up, in_transit, out_for_delivery, delivered, exception, failed_delivery.","nullable":false},{"name":"shipped_at","type":"datetime","description":"Timestamp when seller marked order as shipped and handed to carrier.","nullable":false},{"name":"estimated_delivery_date","type":"datetime","description":"Carrier's estimated delivery date.","nullable":true},{"name":"actual_delivery_date","type":"datetime","description":"Actual delivery timestamp from carrier confirmation.","nullable":true},{"name":"delivery_signature","type":"string","description":"Delivery signature or proof of delivery if provided by carrier.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when shipment record was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when shipment information was last updated.","nullable":false}],"uniqueIndexes":[{"fieldNames":["tracking_number"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_order_id"]},{"fieldNames":["shipment_status","shipped_at"]},{"fieldNames":["created_by_seller_id","shipped_at"]}],"ginIndexes":[]},{"name":"shopping_mall_cancellations","description":"Order cancellation requests and approvals. Tracks cancellation workflow including requester, reason, approval status, and refund processing. Supports customer, seller, and admin-initiated cancellations.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Order being cancelled. {@link shopping_mall_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":true,"nullable":false},{"name":"requester_customer_id","type":"uuid","description":"Customer who requested cancellation (if customer-initiated). {@link shopping_mall_customers.id}.","relation":{"name":"requesterCustomer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":true},{"name":"requester_seller_id","type":"uuid","description":"Seller who requested cancellation (if seller-initiated). {@link shopping_mall_sellers.id}.","relation":{"name":"requesterSeller","targetModel":"shopping_mall_sellers","mappingName":"shopping_mall_cancellations_of_requester_seller_id"},"unique":false,"nullable":true},{"name":"requester_admin_id","type":"uuid","description":"Admin who requested cancellation (if admin-initiated). {@link shopping_mall_admins.id}.","relation":{"name":"requesterAdmin","targetModel":"shopping_mall_admins","mappingName":"shopping_mall_cancellations_of_requester_admin_id"},"unique":false,"nullable":true},{"name":"approver_seller_id","type":"uuid","description":"Seller who approved cancellation request (if approval required). {@link shopping_mall_sellers.id}.","relation":{"name":"approverSeller","targetModel":"shopping_mall_sellers","mappingName":"shopping_mall_cancellations_of_approver_seller_id"},"unique":false,"nullable":true},{"name":"approver_admin_id","type":"uuid","description":"Admin who approved cancellation request (if admin approval required). {@link shopping_mall_admins.id}.","relation":{"name":"approverAdmin","targetModel":"shopping_mall_admins","mappingName":"shopping_mall_cancellations_of_approver_admin_id"},"unique":false,"nullable":true}],"plainFields":[{"name":"cancellation_reason","type":"string","description":"Reason for cancellation: customer_changed_mind, found_better_price, order_mistake, delivery_too_long, out_of_stock, pricing_error, other.","nullable":false},{"name":"cancellation_notes","type":"string","description":"Additional details or explanation for cancellation.","nullable":true},{"name":"cancellation_status","type":"string","description":"Cancellation workflow status: pending_approval, approved, rejected, completed.","nullable":false},{"name":"refund_amount","type":"double","description":"Amount to be refunded to customer (typically full order total).","nullable":false},{"name":"refund_processed","type":"boolean","description":"True if refund payment has been processed to customer.","nullable":false},{"name":"requested_at","type":"datetime","description":"Timestamp when cancellation was requested.","nullable":false},{"name":"approved_at","type":"datetime","description":"Timestamp when cancellation was approved.","nullable":true},{"name":"completed_at","type":"datetime","description":"Timestamp when cancellation and refund were fully completed.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when cancellation record was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when cancellation record was last updated.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["cancellation_status","requested_at"]}],"ginIndexes":[]},{"name":"shopping_mall_refund_requests","description":"Post-delivery refund requests from customers with approval workflow. Supports full and partial refunds with seller and admin review. Tracks refund reason, evidence, approval status, and payment processing. Customers and sellers need independent access to search and manage refund requests, requiring primary stance for dedicated API endpoints.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Order for which refund is requested. {@link shopping_mall_orders.id}","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false},{"name":"shopping_mall_customer_id","type":"uuid","description":"Customer requesting the refund. {@link shopping_mall_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":false},{"name":"reviewer_seller_id","type":"uuid","description":"Seller who reviewed the refund request. {@link shopping_mall_sellers.id}","relation":{"name":"reviewerSeller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":true},{"name":"reviewer_admin_id","type":"uuid","description":"Admin who reviewed or overrode refund decision. {@link shopping_mall_admins.id}","relation":{"name":"reviewerAdmin","targetModel":"shopping_mall_admins"},"unique":false,"nullable":true}],"plainFields":[{"name":"refund_reason","type":"string","description":"Reason for refund request: defective_damaged, wrong_item, does_not_match_description, changed_mind, found_better_price, quality_not_expected, other.","nullable":false},{"name":"refund_description","type":"string","description":"Detailed explanation from customer about why refund is requested.","nullable":false},{"name":"refund_amount_requested","type":"double","description":"Amount customer is requesting for refund.","nullable":false},{"name":"refund_amount_approved","type":"double","description":"Amount approved by seller or admin (can be partial refund).","nullable":true},{"name":"refund_status","type":"string","description":"Refund workflow status: pending_review, pending_seller_response, approved, rejected, processing, completed.","nullable":false},{"name":"return_required","type":"boolean","description":"True if customer must return product for refund to be processed.","nullable":false},{"name":"return_tracking_number","type":"string","description":"Tracking number for returned product shipment (if return required).","nullable":true},{"name":"review_notes","type":"string","description":"Notes from seller or admin during refund review.","nullable":true},{"name":"requested_at","type":"datetime","description":"Timestamp when customer submitted refund request.","nullable":false},{"name":"seller_response_deadline","type":"datetime","description":"Deadline for seller to respond (3 business days from request). Auto-approves if seller doesn't respond by this time.","nullable":false},{"name":"reviewed_at","type":"datetime","description":"Timestamp when seller or admin reviewed the request.","nullable":true},{"name":"completed_at","type":"datetime","description":"Timestamp when refund payment was processed.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when refund request was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when refund request was last updated.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_order_id","requested_at"]},{"fieldNames":["shopping_mall_customer_id","refund_status"]},{"fieldNames":["reviewer_seller_id","refund_status","requested_at"]},{"fieldNames":["refund_status","seller_response_deadline"]}],"ginIndexes":[]}]},{"filename":"schema-08-payments.prisma","namespace":"Payments","models":[{"name":"shopping_mall_payment_transactions","description":"Payment transaction records for customer order payments. Stores payment gateway integration details, transaction status, and payment method information. Each transaction represents a financial payment processed through a payment gateway (Stripe, PayPal, etc.) for a specific order. Supports PCI-compliant tokenized payment processing and maintains complete audit trail for financial compliance. Links to orders, customers, and payment methods.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Customer making the payment. {@link shopping_mall_customers.id}.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":false},{"name":"shopping_mall_payment_method_id","type":"uuid","description":"Saved payment method used for this transaction (if applicable). {@link shopping_mall_payment_methods.id}.","relation":{"name":"paymentMethod","targetModel":"shopping_mall_payment_methods"},"unique":false,"nullable":true}],"plainFields":[{"name":"payment_gateway","type":"string","description":"Payment gateway provider name (Stripe, PayPal, Braintree, etc.).","nullable":false},{"name":"gateway_transaction_id","type":"string","description":"Unique transaction identifier from the payment gateway for idempotency and reconciliation.","nullable":false},{"name":"payment_type","type":"string","description":"Payment method type (credit_card, debit_card, paypal, apple_pay, google_pay, bank_transfer).","nullable":false},{"name":"amount","type":"double","description":"Total payment amount in the specified currency.","nullable":false},{"name":"currency","type":"string","description":"ISO 4217 currency code (USD, EUR, GBP, etc.).","nullable":false},{"name":"status","type":"string","description":"Payment transaction status (pending, authorized, captured, failed, cancelled, refunded).","nullable":false},{"name":"card_last_four","type":"string","description":"Last 4 digits of card number for customer reference (PCI compliant).","nullable":true},{"name":"card_brand","type":"string","description":"Card brand or issuer (Visa, MasterCard, American Express, Discover).","nullable":true},{"name":"billing_address_snapshot","type":"string","description":"JSON snapshot of billing address at time of payment for audit and fraud prevention.","nullable":true},{"name":"gateway_response","type":"string","description":"Raw JSON response from payment gateway for audit trail and dispute resolution.","nullable":true},{"name":"attempt_number","type":"int","description":"Payment attempt number for this order (1 for first attempt, up to 3 for retries). Supports payment retry limit enforcement per business rules.","nullable":false},{"name":"authorized_at","type":"datetime","description":"Timestamp when payment was authorized by the gateway.","nullable":true},{"name":"captured_at","type":"datetime","description":"Timestamp when payment was captured (funds transferred).","nullable":true},{"name":"failed_at","type":"datetime","description":"Timestamp when payment failed.","nullable":true},{"name":"failure_reason","type":"string","description":"Reason for payment failure (insufficient_funds, card_declined, invalid_cvv, fraud_detection, etc.).","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when the payment transaction record was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when the payment transaction was last updated.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp for audit compliance (financial records must be preserved).","nullable":true}],"uniqueIndexes":[{"fieldNames":["gateway_transaction_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_customer_id","created_at"]},{"fieldNames":["status","created_at"]},{"fieldNames":["payment_gateway","status"]}],"ginIndexes":[]},{"name":"shopping_mall_payment_methods","description":"Saved customer payment methods for repeat purchases. Stores tokenized payment instruments (credit cards, digital wallets, bank accounts) in PCI-compliant manner. Payment methods are tokenized by payment gateways and only tokens are stored, never full card numbers. Customers can save multiple payment methods and designate one as default. Links to {@link shopping_mall_customers} and {@link shopping_mall_addresses}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Customer who owns this payment method. {@link shopping_mall_customers.id}.","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":false},{"name":"shopping_mall_billing_address_id","type":"uuid","description":"Billing address associated with this payment method. {@link shopping_mall_addresses.id}.","relation":{"name":"billingAddress","targetModel":"shopping_mall_addresses"},"unique":false,"nullable":true}],"plainFields":[{"name":"payment_type","type":"string","description":"Payment method type (credit_card, debit_card, paypal, bank_account, digital_wallet).","nullable":false},{"name":"payment_gateway","type":"string","description":"Payment gateway storing the tokenized payment method (Stripe, PayPal, Braintree).","nullable":false},{"name":"gateway_token","type":"string","description":"Tokenized payment method identifier from the gateway (PCI compliant token).","nullable":false},{"name":"card_last_four","type":"string","description":"Last 4 digits of card number for customer identification.","nullable":true},{"name":"card_brand","type":"string","description":"Card brand (Visa, MasterCard, American Express, Discover).","nullable":true},{"name":"card_expiry_month","type":"int","description":"Card expiration month (1-12).","nullable":true},{"name":"card_expiry_year","type":"int","description":"Card expiration year (4-digit year).","nullable":true},{"name":"billing_name","type":"string","description":"Name on the payment method (cardholder name).","nullable":false},{"name":"is_default","type":"boolean","description":"Whether this is the customer's default payment method for checkout.","nullable":false},{"name":"is_expired","type":"boolean","description":"Whether the payment method is expired (calculated from expiry date or manually set).","nullable":false},{"name":"nickname","type":"string","description":"User-friendly label for the payment method (My Visa, Work Card, etc.).","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when the payment method was saved.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when the payment method was last updated.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp when customer removed the payment method.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_customer_id","gateway_token"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_customer_id","is_default"]}],"ginIndexes":[]},{"name":"shopping_mall_refunds","description":"Financial refund transactions reversing original payments. Records all refund operations including full and partial refunds for cancelled or returned orders. Each refund references the original payment transaction and may be linked to a refund request. Tracks refund lifecycle through payment gateway and maintains audit trail for financial compliance. Supports polymorphic actor tracking to identify who initiated the refund (customer, seller, admin, or system).","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_payment_transaction_id","type":"uuid","description":"Original payment transaction being refunded. {@link shopping_mall_payment_transactions.id}.","relation":{"name":"paymentTransaction","targetModel":"shopping_mall_payment_transactions"},"unique":false,"nullable":false},{"name":"shopping_mall_refund_request_id","type":"uuid","description":"Associated customer refund request that initiated this refund (if applicable). Null for cancellation refunds. {@link shopping_mall_refund_requests.id}.","relation":{"name":"refundRequest","targetModel":"shopping_mall_refund_requests"},"unique":false,"nullable":true},{"name":"shopping_mall_order_id","type":"uuid","description":"Order being refunded for context and reporting. {@link shopping_mall_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false},{"name":"initiated_by_customer_id","type":"uuid","description":"Customer who initiated the refund (if customer-initiated). Null if initiated by seller, admin, or system. {@link shopping_mall_customers.id}.","relation":{"name":"initiatedByCustomer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":true},{"name":"initiated_by_seller_id","type":"uuid","description":"Seller who initiated the refund (if seller-initiated cancellation). Null if initiated by customer, admin, or system. {@link shopping_mall_sellers.id}.","relation":{"name":"initiatedBySeller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":true},{"name":"initiated_by_admin_id","type":"uuid","description":"Admin who initiated the refund (if admin override or admin-initiated cancellation). Null if initiated by customer, seller, or system. {@link shopping_mall_admins.id}.","relation":{"name":"initiatedByAdmin","targetModel":"shopping_mall_admins"},"unique":false,"nullable":true}],"plainFields":[{"name":"refund_amount","type":"double","description":"Amount being refunded (can be partial refund, must not exceed original payment).","nullable":false},{"name":"refund_reason","type":"string","description":"Reason for refund (order_cancellation, defective_product, customer_request, wrong_item, policy_violation, etc.).","nullable":false},{"name":"gateway_refund_id","type":"string","description":"Unique refund transaction identifier from the payment gateway.","nullable":false},{"name":"status","type":"string","description":"Refund processing status (pending, processing, completed, failed).","nullable":false},{"name":"initiated_by_type","type":"string","description":"Type of actor who initiated the refund (customer, seller, admin, system). Used with initiated_by_*_id foreign keys for polymorphic pattern.","nullable":false},{"name":"processed_at","type":"datetime","description":"Timestamp when refund processing began.","nullable":true},{"name":"completed_at","type":"datetime","description":"Timestamp when refund was successfully completed and funds returned.","nullable":true},{"name":"failed_at","type":"datetime","description":"Timestamp when refund processing failed.","nullable":true},{"name":"failure_reason","type":"string","description":"Reason for refund failure (gateway_error, insufficient_funds, invalid_account, etc.).","nullable":true},{"name":"notes","type":"string","description":"Administrative notes or additional context about the refund.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when the refund record was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when the refund was last updated.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp for audit compliance.","nullable":true}],"uniqueIndexes":[{"fieldNames":["gateway_refund_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_payment_transaction_id"]},{"fieldNames":["shopping_mall_order_id","status"]},{"fieldNames":["status","created_at"]},{"fieldNames":["initiated_by_type","status"]}],"ginIndexes":[]},{"name":"shopping_mall_seller_payouts","description":"Platform-to-seller payment settlements with commission and fee deductions. Records periodic payouts to sellers after deducting platform commission, refunds, and processing fees. Each payout represents a settlement period (typically weekly or monthly) and calculates net amount owed to seller. Tracks payout processing status through bank transfer or other payout methods. Essential for multi-seller marketplace financial operations.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_seller_id","type":"uuid","description":"Seller receiving the payout. {@link shopping_mall_sellers.id}.","relation":{"name":"seller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":false}],"plainFields":[{"name":"payout_period_start","type":"datetime","description":"Start date of the settlement period covered by this payout.","nullable":false},{"name":"payout_period_end","type":"datetime","description":"End date of the settlement period covered by this payout.","nullable":false},{"name":"total_order_amount","type":"double","description":"Total gross revenue from seller's orders in the payout period.","nullable":false},{"name":"platform_commission_amount","type":"double","description":"Platform commission deducted from seller's revenue (typically percentage-based).","nullable":false},{"name":"refund_deduction_amount","type":"double","description":"Amount deducted for refunds processed during the payout period.","nullable":false},{"name":"processing_fee_amount","type":"double","description":"Payment processing fees deducted from seller's earnings.","nullable":false},{"name":"net_payout_amount","type":"double","description":"Final net amount paid to seller after all deductions (total_order - commission - refunds - fees).","nullable":false},{"name":"currency","type":"string","description":"ISO 4217 currency code for the payout (USD, EUR, GBP, etc.).","nullable":false},{"name":"status","type":"string","description":"Payout processing status (pending, processing, completed, failed, on_hold).","nullable":false},{"name":"payout_method","type":"string","description":"Method used for payout (bank_transfer, paypal, stripe_connect, wire_transfer).","nullable":false},{"name":"payout_reference","type":"string","description":"Bank transfer reference number or payment service transaction ID.","nullable":true},{"name":"payout_date","type":"datetime","description":"Scheduled or actual date when payout was processed.","nullable":true},{"name":"processed_at","type":"datetime","description":"Timestamp when payout processing was initiated.","nullable":true},{"name":"failed_at","type":"datetime","description":"Timestamp when payout processing failed.","nullable":true},{"name":"failure_reason","type":"string","description":"Reason for payout failure (invalid_bank_account, insufficient_platform_funds, account_on_hold, etc.).","nullable":true},{"name":"notes","type":"string","description":"Administrative notes or adjustments made to the payout calculation.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when the payout record was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when the payout was last updated.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp for audit compliance.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_seller_id","status"]},{"fieldNames":["shopping_mall_seller_id","payout_period_end"]},{"fieldNames":["status","payout_date"]},{"fieldNames":["payout_period_start","payout_period_end"]}],"ginIndexes":[]}]},{"filename":"schema-09-reviews.prisma","namespace":"Reviews","models":[{"name":"shopping_mall_reviews","description":"Customer product reviews with star ratings and optional written feedback. Reviews can only be submitted by verified purchasers (customers who completed an order for the product). Each customer can submit one review per product. Reviews support text content, star ratings (1-5), and optional customer-uploaded images. All reviews go through moderation workflow before publication. Customers can edit reviews within 30 days and delete at any time. Admins can moderate and remove policy-violating reviews. The review system builds marketplace trust through verified purchase badges and helpfulness voting.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Customer who wrote this review (reviewer). {@link shopping_mall_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":false},{"name":"shopping_mall_product_id","type":"uuid","description":"Product being reviewed. {@link shopping_mall_products.id}","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false},{"name":"shopping_mall_sku_id","type":"uuid","description":"Specific SKU variant reviewed (optional, if customer wants to review specific color/size). {@link shopping_mall_skus.id}","relation":{"name":"sku","targetModel":"shopping_mall_skus"},"unique":false,"nullable":true},{"name":"shopping_mall_order_id","type":"uuid","description":"Order that enabled this verified purchase review. {@link shopping_mall_orders.id}","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false}],"plainFields":[{"name":"rating","type":"int","description":"Star rating from 1 to 5 stars (required). 5=Excellent, 4=Good, 3=Average, 2=Poor, 1=Terrible.","nullable":false},{"name":"title","type":"string","description":"Optional review title or short summary (maximum 100 characters).","nullable":true},{"name":"review_text","type":"string","description":"Optional detailed review text (minimum 10 characters, maximum 5000 characters). Customer can submit rating-only reviews without text.","nullable":true},{"name":"verified_purchase","type":"boolean","description":"Whether this review is from a verified purchase through the platform. Always true since only verified purchasers can review.","nullable":false},{"name":"status","type":"string","description":"Review moderation status: pending_moderation (awaiting approval), approved (published and visible), rejected (violates policies). Reviews go through moderation before publication.","nullable":false},{"name":"helpful_count","type":"int","description":"Count of helpful votes (customers who found this review helpful). Aggregated from shopping_mall_review_helpfulness_votes where is_helpful is true.","nullable":false},{"name":"not_helpful_count","type":"int","description":"Count of not-helpful votes (tracked internally, not publicly displayed). Aggregated from shopping_mall_review_helpfulness_votes where is_helpful is false.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when the review was originally submitted.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when the review was last edited. Reviews can be edited within 30 days of submission. Shows 'edited' badge to customers.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp. Reviews can be deleted by customer (any time) or removed by admin (policy violations). Null if review is active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_customer_id","shopping_mall_product_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_product_id","status","created_at"]},{"fieldNames":["status","created_at"]},{"fieldNames":["shopping_mall_customer_id"]}],"ginIndexes":[{"fieldName":"review_text"}]},{"name":"shopping_mall_review_images","description":"Customer-uploaded images attached to product reviews. Customers can upload up to 5 images per review (JPEG, PNG, WebP formats, 5MB max per image). Images provide visual evidence and context for the review, especially valuable for defective/damaged product claims in refund requests. Images are displayed in review gallery and included in moderation review. Managed entirely through the parent review lifecycle (subsidiary entity).","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_review_id","type":"uuid","description":"Parent review containing this image. {@link shopping_mall_reviews.id}","relation":{"name":"review","targetModel":"shopping_mall_reviews"},"unique":false,"nullable":false}],"plainFields":[{"name":"image_url","type":"string","description":"Storage path or URL for the uploaded review image. System generates thumbnails and optimized versions for display.","nullable":false},{"name":"display_order","type":"int","description":"Display order of this image in the review image gallery (1-based index). Customer can reorder images when editing review.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when the image was uploaded with the review.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_review_id","display_order"]}],"ginIndexes":[]},{"name":"shopping_mall_review_helpfulness_votes","description":"Customer votes on whether reviews were helpful. Any customer (including non-purchasers) can vote 'Helpful' or 'Not Helpful' on reviews. One vote per customer per review. Customers can change their vote (updates existing record). Reviewers cannot vote on their own reviews. Helpful vote counts are displayed publicly with reviews and influence 'Most Helpful' sorting. Not-helpful counts are tracked internally but not publicly displayed to avoid negative sentiment. Subsidiary entity managed entirely through review context.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_review_id","type":"uuid","description":"Review being voted on. {@link shopping_mall_reviews.id}","relation":{"name":"review","targetModel":"shopping_mall_reviews"},"unique":false,"nullable":false},{"name":"shopping_mall_customer_id","type":"uuid","description":"Customer who cast this vote. {@link shopping_mall_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_customers"},"unique":false,"nullable":false}],"plainFields":[{"name":"is_helpful","type":"boolean","description":"Whether the customer found this review helpful. True = Helpful vote, False = Not Helpful vote. Customer can update this value to change their vote.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when the vote was originally cast.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when the vote was last changed (if customer changed from helpful to not helpful or vice versa).","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_review_id","shopping_mall_customer_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_review_id"]}],"ginIndexes":[]},{"name":"shopping_mall_seller_responses","description":"Seller responses to customer reviews on their products. Sellers can post one response per review to address customer concerns, provide explanations, or thank customers for positive feedback. Responses are limited to 2000 characters. All seller responses require admin moderation before publication. Sellers can edit responses within 7 days of submission. After 7 days, responses become locked and cannot be modified. Sellers can delete their responses at any time (soft delete). Seller responses are displayed directly below the customer review with clear visual distinction. Independent management entity requiring dedicated CRUD operations and moderation workflows.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_review_id","type":"uuid","description":"Customer review being responded to. {@link shopping_mall_reviews.id}","relation":{"name":"review","targetModel":"shopping_mall_reviews"},"unique":true,"nullable":false},{"name":"shopping_mall_seller_id","type":"uuid","description":"Seller who posted this response (must be the seller of the reviewed product). {@link shopping_mall_sellers.id}","relation":{"name":"seller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":false}],"plainFields":[{"name":"response_text","type":"string","description":"Seller's response text (maximum 2000 characters). Should be professional, address customer concerns, and avoid promotional content or requests to remove reviews.","nullable":false},{"name":"status","type":"string","description":"Moderation status: pending_moderation (awaiting admin approval), approved (published and visible), rejected (violates response guidelines). All responses require admin approval before publication.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when the response was originally submitted.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when the response was last edited. Responses can be edited within 7 days of creation, after which they become locked.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp. Sellers can delete their responses at any time. Null if response is active.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_seller_id","status"]},{"fieldNames":["status","created_at"]}],"ginIndexes":[]}]}]}