import { Controller } from "@nestjs/common";
import { TypedRoute, TypedBody } from "@nestia/core";
import typia from "typia";
import { patchShoppingMallAdminCancellations } from "../../../../providers/patchShoppingMallAdminCancellations";
import { AdminAuth } from "../../../../decorators/AdminAuth";
import { AdminPayload } from "../../../../decorators/payload/AdminPayload";

import { IPageIShoppingMallCancellation } from "../../../../api/structures/IPageIShoppingMallCancellation";
import { IShoppingMallCancellation } from "../../../../api/structures/IShoppingMallCancellation";

@Controller("/shoppingMall/admin/cancellations")
export class ShoppingmallAdminCancellationsController {
  /**
   * Search and retrieve filtered list of order cancellation records for admins.
   *
   * Retrieves a comprehensive, paginated list of order cancellation records
   * from the shopping_mall_cancellations table with advanced filtering,
   * searching, and sorting capabilities. This admin-specific endpoint enables
   * platform administrators to oversee all cancellations across the marketplace
   * for dispute resolution, fraud detection, and performance analytics.
   *
   * Admins use this endpoint to oversee all platform cancellations for dispute
   * resolution, fraud detection, and performance analytics. Admins can filter
   * by any criteria to identify patterns such as high cancellation rates from
   * specific sellers, common cancellation reasons, or cancellations requiring
   * administrative intervention. The comprehensive view supports platform
   * quality monitoring and seller performance evaluation.
   *
   * The operation supports sophisticated filtering including cancellation
   * status (pending_approval, approved, rejected, completed), requester type
   * filtering (customer, seller, admin), date range queries for requested_at
   * timestamp, refund processing status, and approval workflow states. Sorting
   * options include most recent cancellations first, highest refund amounts,
   * and cancellations approaching approval deadlines.
   *
   * Security and authorization provide admins with unrestricted access to all
   * cancellation data across all sellers and customers. This comprehensive
   * visibility enables effective platform oversight and dispute resolution.
   *
   * The response includes complete cancellation details: order information,
   * requester and approver identities, cancellation reason and notes, refund
   * amounts, processing status, and complete timeline from request through
   * approval to refund completion. Pagination enables efficient handling of
   * large result sets across the entire platform.
   *
   * @param connection
   * @param body Search criteria, filters, sorting options, and pagination
   *   parameters for cancellation queries
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Patch()
  public async index(
    @AdminAuth()
    admin: AdminPayload,
    @TypedBody()
    body: IShoppingMallCancellation.IRequest,
  ): Promise<IPageIShoppingMallCancellation> {
    try {
      return await patchShoppingMallAdminCancellations({
        admin,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }
}
