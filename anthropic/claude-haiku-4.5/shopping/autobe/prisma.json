{"files":[{"filename":"schema-01-authentication.prisma","namespace":"Authentication","models":[{"name":"shopping_mall_auth_tokens","description":"JWT token storage for authentication. Stores both access tokens and refresh tokens issued during login. Access tokens are short-lived (15 minutes) for immediate API access, while refresh tokens are long-lived (30 days) for session continuation. Tokens are stored hashed (never plaintext) for security compliance. Tracks token status (active, revoked, expired) and associated session information.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Reference to authenticated user (customer, seller, or admin). {@link shopping_mall_customer.id}","relation":{"name":"user","targetModel":"shopping_mall_customer"},"unique":false,"nullable":false}],"plainFields":[{"name":"token_type","type":"string","description":"Type of token: 'access' for short-lived API tokens (15 min) or 'refresh' for long-lived session tokens (30 days). Determines token expiration and usage rules.","nullable":false},{"name":"token_hash","type":"string","description":"Bcrypt-hashed token value for secure storage. Never store plaintext tokens. Hash generated with 12 salt rounds. Original token returned to client only at creation time.","nullable":false},{"name":"issued_at","type":"datetime","description":"ISO 8601 timestamp when token was issued. Used to calculate token age and enforce expiration. Immutable after creation.","nullable":false},{"name":"expires_at","type":"datetime","description":"ISO 8601 timestamp when token expires and becomes invalid. Access tokens expire at issued_at + 15 minutes, refresh tokens at issued_at + 30 days.","nullable":false},{"name":"revoked_at","type":"datetime","description":"ISO 8601 timestamp when token was revoked (if applicable). Null if token has never been revoked. Tokens are revoked on logout or during security incidents.","nullable":true},{"name":"last_used_at","type":"datetime","description":"ISO 8601 timestamp when token was last used in an API request. Null if token has never been used. Updated on each token usage for tracking activity patterns.","nullable":true},{"name":"device_id","type":"string","description":"Device fingerprint hash identifying the device/browser that requested the token. Used to detect token usage from unexpected devices. Generated from user agent and IP address.","nullable":false},{"name":"ip_address","type":"string","description":"IP address from which token was requested. Used for geolocation checks and detecting unusual access patterns. Supports both IPv4 and IPv6 formats.","nullable":false},{"name":"user_agent","type":"string","description":"Browser/device user agent string from token request. Used for device fingerprinting and detecting browser changes. Maximum 500 characters.","nullable":false},{"name":"status","type":"string","description":"Current token status: 'active' (valid for use), 'revoked' (invalidated), 'expired' (past expiration time). Tokens transition from active to expired at expiration timestamp.","nullable":false}],"uniqueIndexes":[{"fieldNames":["token_hash"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_customer_id","status"]},{"fieldNames":["expires_at"]},{"fieldNames":["issued_at"]}],"ginIndexes":[]},{"name":"shopping_mall_sessions","description":"Server-side session management tracking user authentication state across requests. Each active session represents a user logged in from a specific device/browser. Stores session metadata, device information, and tracks login/activity timestamps. Implements concurrent session limits (5 for regular users, 10 for admins) by terminating oldest sessions when limit exceeded.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Reference to authenticated user who owns this session (customer, seller, or admin). {@link shopping_mall_customer.id}","relation":{"name":"user","targetModel":"shopping_mall_customer"},"unique":false,"nullable":false}],"plainFields":[{"name":"session_token","type":"string","description":"Cryptographically secure session identifier (minimum 32 random characters). Used to associate requests with this session. Unique globally across all sessions.","nullable":false},{"name":"created_at","type":"datetime","description":"ISO 8601 timestamp when session was created (user login time). Immutable after creation. Used to calculate session age and enforce 90-day session lifetime.","nullable":false},{"name":"last_activity_at","type":"datetime","description":"ISO 8601 timestamp of most recent request using this session. Updated on every API request. Used to detect inactive sessions and calculate idle time.","nullable":false},{"name":"expires_at","type":"datetime","description":"ISO 8601 timestamp when session expires. Sessions expire 90 days after creation regardless of activity. When expired, new login required.","nullable":false},{"name":"ip_address","type":"string","description":"Primary IP address from which session was initiated. Used for geolocation tracking and detecting impossible travel patterns. May change during mobile roaming.","nullable":false},{"name":"user_agent","type":"string","description":"Browser/device user agent string at session creation. Used for device fingerprinting and detecting suspicious agent changes. Maximum 500 characters.","nullable":false},{"name":"device_fingerprint","type":"string","description":"Cryptographic hash of device characteristics (user agent, browser, screen resolution). Used to detect when same session is used from different devices.","nullable":false},{"name":"browser_name","type":"string","description":"Parsed browser name from user agent (Chrome, Firefox, Safari, etc.). Used for security analysis and user device identification.","nullable":true},{"name":"operating_system","type":"string","description":"Parsed operating system from user agent (Windows, macOS, iOS, Android, Linux). Used for device type classification.","nullable":true},{"name":"device_type","type":"string","description":"Device category: 'mobile', 'tablet', 'desktop'. Determined from user agent parsing. Used for responsive experience and security classification.","nullable":true},{"name":"status","type":"string","description":"Session status: 'active' (usable), 'suspended' (locked for investigation), 'expired' (past expiration time), 'terminated' (user logout). Determines whether session can be used.","nullable":false}],"uniqueIndexes":[{"fieldNames":["session_token"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_customer_id","status"]},{"fieldNames":["last_activity_at"]},{"fieldNames":["expires_at"]},{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_session_devices","description":"Device tracking for multi-device session management. Records each unique device/browser combination a user logs in from. Used to enforce concurrent session limits (5 for users, 10 for admins), detect unauthorized devices, and improve security through device recognition. Links devices to sessions for holistic user authentication history.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Reference to user who owns this device record. {@link shopping_mall_customer.id}","relation":{"name":"user","targetModel":"shopping_mall_customer"},"unique":false,"nullable":false},{"name":"shopping_mall_session_id","type":"uuid","description":"Reference to the session associated with this device login. {@link shopping_mall_sessions.id}","relation":{"name":"session","targetModel":"shopping_mall_sessions"},"unique":false,"nullable":true}],"plainFields":[{"name":"device_name","type":"string","description":"User-friendly device name set by user (e.g., 'My Laptop', 'iPhone 14 Pro', 'Office Desktop'). Optional custom name for easy device identification. Maximum 100 characters.","nullable":true},{"name":"device_fingerprint","type":"string","description":"Cryptographic hash identifying this specific device/browser combination. Generated from user agent, resolution, plugins, timezone, and other characteristics.","nullable":false},{"name":"browser_name","type":"string","description":"Browser name parsed from user agent (Chrome, Firefox, Safari, Edge). Used for device classification and user-friendly display.","nullable":true},{"name":"browser_version","type":"string","description":"Browser version number (e.g., '120.0.1234.567'). Used for security checks and deprecation warnings for outdated browsers.","nullable":true},{"name":"operating_system","type":"string","description":"Operating system name (Windows, macOS, iOS, Android, Linux). Used for device classification and compatibility tracking.","nullable":true},{"name":"os_version","type":"string","description":"Operating system version (e.g., 'Windows 11', 'macOS 14.1'). Used for security analysis and support decisions.","nullable":true},{"name":"device_type","type":"string","description":"Device category: 'mobile', 'tablet', 'desktop'. Determines responsive behavior and interaction patterns.","nullable":true},{"name":"first_login_at","type":"datetime","description":"ISO 8601 timestamp of first login from this device. Used to identify new devices and track device age.","nullable":false},{"name":"last_login_at","type":"datetime","description":"ISO 8601 timestamp of most recent login from this device. Updated on each login from this device.","nullable":false},{"name":"login_count","type":"int","description":"Total number of times user has logged in from this device. Incremented on each successful login. Used to identify frequently used devices.","nullable":false},{"name":"last_ip_address","type":"string","description":"Most recent IP address used with this device. May change for mobile devices due to roaming. Used for location tracking.","nullable":true},{"name":"trust_status","type":"string","description":"Device trust level: 'trusted' (recognized), 'new' (first use, may require verification), 'suspicious' (flagged for unusual behavior). Used to determine if extra verification needed.","nullable":false},{"name":"is_active","type":"boolean","description":"Whether device is currently active. True if device has been used within last 30 days. False marks device as dormant.","nullable":false}],"uniqueIndexes":[{"fieldNames":["device_fingerprint","shopping_mall_customer_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_customer_id","is_active"]},{"fieldNames":["last_login_at"]},{"fieldNames":["first_login_at"]}],"ginIndexes":[]},{"name":"shopping_mall_password_reset_tokens","description":"Secure password reset token management for account recovery. Issues time-limited (1 hour) tokens that allow users to reset forgotten passwords. Tokens are one-time use only - invalidated after first use to prevent brute force attacks. Tracks token status, usage timestamps, and consumed status for security.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Reference to user account requesting password reset. {@link shopping_mall_customer.id}","relation":{"name":"user","targetModel":"shopping_mall_customer"},"unique":false,"nullable":false}],"plainFields":[{"name":"token","type":"string","description":"Cryptographically secure reset token (minimum 32 random characters). Sent to user's email. Must be provided to verify password reset request. Never displayed to user after initial generation.","nullable":false},{"name":"token_hash","type":"string","description":"Bcrypt-hashed token value stored in database. Original token never stored plaintext. Hash generated with 12 salt rounds for security.","nullable":false},{"name":"created_at","type":"datetime","description":"ISO 8601 timestamp when reset token was generated. Used to calculate token age and enforce 1-hour expiration window.","nullable":false},{"name":"expires_at","type":"datetime","description":"ISO 8601 timestamp when token expires and becomes unusable. Set to created_at + 1 hour. More restrictive than access tokens (1 hour vs 15 minutes) for security.","nullable":false},{"name":"used_at","type":"datetime","description":"ISO 8601 timestamp when token was successfully used to reset password. Null if never used. Indicates token has been consumed.","nullable":true},{"name":"ip_address","type":"string","description":"IP address from which token was requested. Used for fraud detection and tracking password reset requests. May differ from IP of actual password reset.","nullable":false},{"name":"user_agent","type":"string","description":"Browser/device user agent string from token request. Used for device fingerprinting and detecting suspicious reset patterns.","nullable":false},{"name":"status","type":"string","description":"Token status: 'pending' (waiting for use), 'used' (successfully redeemed), 'expired' (past expiration time). Tokens transition from pending to used on successful password reset.","nullable":false}],"uniqueIndexes":[{"fieldNames":["token_hash"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_customer_id","status"]},{"fieldNames":["expires_at"]},{"fieldNames":["created_at"]}],"ginIndexes":[]}]},{"filename":"schema-02-actors.prisma","namespace":"Actors","models":[{"name":"shopping_mall_customer","description":"Customer user accounts representing authenticated buyers on the platform. Stores core customer profile information including personal details, account status, email verification state, and security settings. Customers are the primary users who browse products, create orders, write reviews, and manage their shopping experience on the platform.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"email","type":"string","nullable":false,"description":"Customer's email address used for login and communication. Must be unique across all customers on the platform. Email is verified during registration before account activation."},{"name":"password_hash","type":"string","nullable":false,"description":"Bcrypt-hashed password for account authentication. The plain password is never stored; only the cryptographic hash is maintained for security. Password updates create new hash."},{"name":"first_name","type":"string","nullable":false,"description":"Customer's first name. Used for personalization in communications and order fulfillment. Required field for all customers."},{"name":"last_name","type":"string","nullable":false,"description":"Customer's last name. Combined with first name for complete customer identification in orders and communications."},{"name":"phone_number","type":"string","nullable":true,"description":"Customer's contact phone number in international format. Optional field that enables SMS notifications and seller communication. Stored in E.164 format (e.g., +1-555-123-4567)."},{"name":"date_of_birth","type":"datetime","nullable":true,"description":"Customer's date of birth for age verification and personalization. Optional field used for age-restricted products and birthday promotions."},{"name":"gender","type":"string","nullable":true,"description":"Customer's gender for personalization and targeted recommendations. Values: 'M', 'F', 'O' (Other), 'N' (Prefer not to say). Optional field."},{"name":"profile_image_url","type":"uri","nullable":true,"description":"URL to customer's profile picture. Used for display in reviews, comments, and public-facing customer profiles. Optional field."},{"name":"account_status","type":"string","nullable":false,"description":"Current status of customer account: 'ACTIVE' (normal operation), 'SUSPENDED' (temporary restriction), 'DEACTIVATED' (account closed), 'PENDING_EMAIL_VERIFICATION' (awaiting email confirmation). Controls account access and functionality."},{"name":"email_verified","type":"boolean","nullable":false,"description":"Flag indicating whether customer's email address has been verified. Email verification is required for account activation and must be completed within 24 hours of registration."},{"name":"two_factor_enabled","type":"boolean","nullable":false,"description":"Whether two-factor authentication (2FA) is enabled for this customer account. When enabled, login requires secondary verification (SMS code, authenticator app)."},{"name":"two_factor_method","type":"string","nullable":true,"description":"Method used for two-factor authentication if enabled. Values: 'SMS', 'EMAIL', 'AUTHENTICATOR_APP', 'BACKUP_CODES'. Null if 2FA not enabled."},{"name":"last_login_at","type":"datetime","nullable":true,"description":"Timestamp of customer's most recent successful login. Used for tracking account activity and detecting suspicious access patterns."},{"name":"account_locked_until","type":"datetime","nullable":true,"description":"Timestamp until which account is locked due to failed login attempts. Account automatically unlocks when this timestamp is reached. Null if account is not locked."},{"name":"failed_login_attempts","type":"int","nullable":false,"description":"Count of consecutive failed login attempts. Resets to zero on successful login. Account locks after 5 failed attempts within 15 minutes."},{"name":"created_at","type":"datetime","nullable":false,"description":"Timestamp when customer account was created. Immutable field set at registration completion."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Timestamp of most recent account update including profile changes, status changes, or password updates."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft delete timestamp when customer account was permanently deleted. Null for active/suspended accounts. Enables account recovery within compliance window."},{"name":"account_flags","type":"string","nullable":true,"description":"Comma-separated flags for account restrictions or notes: 'FRAUD_INVESTIGATION', 'POLICY_VIOLATION', 'CHARGEBACK_HISTORY', 'MULTIPLE_RETURNS'. Used by admins for account moderation."}],"uniqueIndexes":[{"fieldNames":["email"],"unique":true}],"plainIndexes":[{"fieldNames":["account_status"]},{"fieldNames":["email_verified"]},{"fieldNames":["created_at"]},{"fieldNames":["last_login_at"]}],"ginIndexes":[{"fieldName":"first_name"},{"fieldName":"last_name"}]},{"name":"shopping_mall_seller","description":"Seller merchant accounts representing businesses selling products on the platform. Stores seller business profile, verification status, commission configuration, and account settings. Sellers manage product inventory, fulfill customer orders, and operate their online stores within the marketplace ecosystem.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"email","type":"string","nullable":false,"description":"Seller's business email address used for login and official communications. Must be unique across all sellers. Email is verified during onboarding."},{"name":"password_hash","type":"string","nullable":false,"description":"Bcrypt-hashed password for seller account authentication. Plain password never stored for security compliance."},{"name":"store_name","type":"string","nullable":false,"description":"Official name of seller's store as displayed to customers. Must be unique across platform. Used in product listings, orders, and customer communications."},{"name":"store_code","type":"string","nullable":false,"description":"Unique alphanumeric code for seller store (e.g., 'SELLER-001'). Used for internal routing and metrics. Format: seller-assigned or system-generated during registration."},{"name":"store_description","type":"string","nullable":true,"description":"Seller's store description visible on public store page. Up to 5000 characters describing business, policies, and seller story. Optional field."},{"name":"store_logo_url","type":"uri","nullable":true,"description":"URL to seller's store logo displayed on store page and product listings. Optional field for branding."},{"name":"store_banner_url","type":"uri","nullable":true,"description":"URL to seller's store banner image displayed at top of store page. Optional field for visual branding."},{"name":"business_type","type":"string","nullable":false,"description":"Type of business entity: 'INDIVIDUAL' (sole proprietor), 'SMALL_BUSINESS' (1-50 employees), 'MEDIUM_BUSINESS' (50-500 employees), 'ENTERPRISE' (500+ employees). Affects commission rates and feature access."},{"name":"business_registration_number","type":"string","nullable":true,"description":"Official business registration number (e.g., EIN, Company Registration Number). Varies by jurisdiction. Optional for individual sellers in some regions."},{"name":"tax_id","type":"string","nullable":true,"description":"Tax identification number (e.g., VAT ID, GST number) for tax compliance. Encrypted in database. Optional field."},{"name":"contact_person_name","type":"string","nullable":false,"description":"Name of primary contact person for seller account. Used for communication and verification purposes."},{"name":"contact_phone","type":"string","nullable":false,"description":"Business phone number in international format. Used for seller contact and verification."},{"name":"business_address","type":"string","nullable":false,"description":"Complete business address including street, city, state, postal code, country. Used for order fulfillment and seller identity verification."},{"name":"country","type":"string","nullable":false,"description":"Country code (ISO 3166-1 alpha-2) where seller business is registered. Affects tax rates, shipping capabilities, and payment processing."},{"name":"account_status","type":"string","nullable":false,"description":"Seller account status: 'PENDING_VERIFICATION' (awaiting approval), 'VERIFIED' (approved to sell), 'REJECTED' (application rejected), 'SUSPENDED' (temporary restriction), 'DEACTIVATED' (account closed). Only verified sellers can list and sell products."},{"name":"verification_status","type":"string","nullable":false,"description":"Document verification status: 'PENDING' (awaiting review), 'VERIFIED' (documents approved), 'REJECTED' (documents not acceptable), 'EXPIRED' (verification documents expired). Separate from account_status."},{"name":"average_rating","type":"double","nullable":false,"description":"Seller's average rating calculated from customer reviews. Range: 1.0 to 5.0. Updated when new reviews are published. Used for seller visibility and trust metrics."},{"name":"total_reviews","type":"int","nullable":false,"description":"Total count of approved customer reviews for this seller's products. Updated when reviews are published or removed."},{"name":"fulfillment_rate","type":"double","nullable":false,"description":"Percentage of orders successfully fulfilled on time (0-100). Calculated as: (on-time orders / total orders) * 100. Used for seller ranking and visibility."},{"name":"response_time_hours","type":"double","nullable":false,"description":"Average response time to customer inquiries in hours. Calculated from support ticket response times. Used for seller performance metrics."},{"name":"commission_rate","type":"double","nullable":false,"description":"Percentage commission charged on seller's sales (0-100). Default: 10%. Premium sellers or negotiated rates may differ. Updated when seller tier changes."},{"name":"seller_tier","type":"string","nullable":false,"description":"Seller's tier/status level: 'STANDARD' (default), 'PREMIUM' (top performer), 'ENTERPRISE' (high volume). Affects commission rates and feature access."},{"name":"two_factor_enabled","type":"boolean","nullable":false,"description":"Whether two-factor authentication is enabled for seller account."},{"name":"last_login_at","type":"datetime","nullable":true,"description":"Timestamp of most recent seller dashboard login."},{"name":"account_locked_until","type":"datetime","nullable":true,"description":"Timestamp until which seller account is locked due to failed login attempts. Null if not locked."},{"name":"failed_login_attempts","type":"int","nullable":false,"description":"Count of consecutive failed seller login attempts. Resets on successful login."},{"name":"created_at","type":"datetime","nullable":false,"description":"Timestamp when seller account was created during registration."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Timestamp of most recent seller account update."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft delete timestamp when seller account was closed. Null for active accounts. Enables account data retention for compliance."},{"name":"account_flags","type":"string","nullable":true,"description":"Comma-separated admin flags: 'FRAUD_INVESTIGATION', 'POLICY_VIOLATION', 'HIGH_CHARGEBACK_RATE'. Used for account moderation."}],"uniqueIndexes":[{"fieldNames":["email"],"unique":true},{"fieldNames":["store_name"],"unique":true},{"fieldNames":["store_code"],"unique":true}],"plainIndexes":[{"fieldNames":["account_status"]},{"fieldNames":["verification_status"]},{"fieldNames":["average_rating"]},{"fieldNames":["created_at"]},{"fieldNames":["seller_tier"]}],"ginIndexes":[{"fieldName":"store_description"}]},{"name":"shopping_mall_admin","description":"Administrator accounts with platform management and moderation capabilities. Admins have elevated permissions to manage users, approve products, handle disputes, process refunds, configure settings, and access audit logs. Admin accounts track access control levels and maintain security audit trails.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"email","type":"string","nullable":false,"description":"Admin's email address used for login and official administrative communications. Must be unique across all admins."},{"name":"password_hash","type":"string","nullable":false,"description":"Bcrypt-hashed password for admin authentication. Plain password never stored."},{"name":"first_name","type":"string","nullable":false,"description":"Admin's first name for identification and audit trails."},{"name":"last_name","type":"string","nullable":false,"description":"Admin's last name for identification in administrative records."},{"name":"admin_role","type":"string","nullable":false,"description":"Admin permission level: 'SUPER_ADMIN' (full platform access), 'ADMIN' (general admin functions), 'MODERATOR' (content moderation only), 'SUPPORT_ADMIN' (customer support), 'FINANCE_ADMIN' (payment management). Determines feature access."},{"name":"permission_level","type":"int","nullable":false,"description":"Numeric permission hierarchy (0-100): 100=Super Admin with all permissions, 75=Admin with most permissions, 50=Moderator with moderation-only permissions, 25=Support with limited access. Used for permission checks."},{"name":"account_status","type":"string","nullable":false,"description":"Admin account status: 'ACTIVE' (can access platform), 'INACTIVE' (cannot access), 'SUSPENDED' (temporary restriction). Controls admin access."},{"name":"two_factor_enabled","type":"boolean","nullable":false,"description":"Whether two-factor authentication is required for this admin. Mandatory for Super Admin and recommended for all admins."},{"name":"last_login_at","type":"datetime","nullable":true,"description":"Timestamp of admin's most recent login."},{"name":"account_locked_until","type":"datetime","nullable":true,"description":"Timestamp until which admin account is locked due to failed login attempts. Null if not locked."},{"name":"failed_login_attempts","type":"int","nullable":false,"description":"Count of consecutive failed admin login attempts. Resets on successful login."},{"name":"created_at","type":"datetime","nullable":false,"description":"Timestamp when admin account was created."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Timestamp of most recent admin account update."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft delete timestamp when admin account was deactivated. Null for active accounts. Enables audit trail preservation."},{"name":"notes","type":"string","nullable":true,"description":"Administrative notes about this admin account (e.g., department, responsibilities, creation reason). Optional field for documentation."}],"uniqueIndexes":[{"fieldNames":["email"],"unique":true}],"plainIndexes":[{"fieldNames":["admin_role"]},{"fieldNames":["permission_level"]},{"fieldNames":["account_status"]},{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_guest","description":"Guest user profiles for unauthenticated users browsing the platform. Tracks guest sessions for analytics, recommendations, and fraud detection. Guests can browse products and read reviews but cannot purchase or create accounts. Guest data enables anonymous user experience tracking and recommendations.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"guest_code","type":"string","nullable":false,"description":"Unique anonymous identifier for guest session. Generated format: 'GUEST-' + random string. Used to track guest activity without personal identification."},{"name":"session_id","type":"uuid","nullable":false,"description":"Reference to the guest's current session. Links to session tracking system for timeout and activity monitoring."},{"name":"device_fingerprint","type":"string","nullable":true,"description":"Hash of device characteristics (user agent, IP, browser) for fraud detection and session security. Can identify same device accessing platform."},{"name":"ip_address","type":"string","nullable":true,"description":"IP address of guest user request. Used for geographic targeting and fraud detection. Stored for security audit."},{"name":"country","type":"string","nullable":true,"description":"Country code (ISO 3166-1 alpha-2) derived from IP or user preference. Used for product availability and recommendation localization."},{"name":"preferred_language","type":"string","nullable":true,"description":"Guest's language preference (ISO 639-1 code, e.g., 'en', 'fr'). Can be inferred from browser settings or explicitly set."},{"name":"browsing_history","type":"string","nullable":true,"description":"Comma-separated list of recently viewed product IDs for recommendation engine. Stored as denormalized data for performance. Cleared on session timeout."},{"name":"cart_items_count","type":"int","nullable":false,"description":"Count of items in guest's temporary shopping cart (not persisted if guest doesn't register). Used for analytics."},{"name":"created_at","type":"datetime","nullable":false,"description":"Timestamp when guest session was initiated."},{"name":"last_activity_at","type":"datetime","nullable":false,"description":"Timestamp of guest's most recent activity. Used to determine session timeout."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft delete timestamp when guest session expired or ended. Null for active guest sessions."}],"uniqueIndexes":[{"fieldNames":["guest_code"],"unique":true},{"fieldNames":["session_id"],"unique":true}],"plainIndexes":[{"fieldNames":["created_at"]},{"fieldNames":["last_activity_at"]},{"fieldNames":["country"]}],"ginIndexes":[]},{"name":"shopping_mall_customer_addresses","description":"Multiple delivery addresses associated with customers for flexible order fulfillment. Customers can save multiple addresses (home, work, family, etc.) and select delivery address during checkout. Addresses include validation status and default address tracking for convenient ordering.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_customer_id","type":"uuid","description":"Reference to the customer who owns this address. {@link shopping_mall_customer.id}","relation":{"name":"customer","targetModel":"shopping_mall_customer"},"unique":false,"nullable":false}],"plainFields":[{"name":"address_label","type":"string","nullable":false,"description":"User-defined label for address: 'Home', 'Work', 'Office', 'Parents', 'Vacation Home', etc. Helps customer quickly identify desired address during checkout."},{"name":"is_default","type":"boolean","nullable":false,"description":"Whether this is the customer's default delivery address. Used for quick checkout. Only one address per customer can be default."},{"name":"recipient_name","type":"string","nullable":false,"description":"Name of person who will receive delivery at this address. May differ from customer name for household members or business locations."},{"name":"recipient_phone","type":"string","nullable":false,"description":"Contact phone number for delivery. Used by shipping carriers for delivery coordination and exception handling."},{"name":"street_address","type":"string","nullable":false,"description":"Full street address including number and street name. Example: '123 Main Street Apt 4B' or 'PO Box 456'."},{"name":"city","type":"string","nullable":false,"description":"City or town name where address is located."},{"name":"state_province","type":"string","nullable":false,"description":"State, province, or region code. Format varies by country (e.g., 'CA' for California, 'BC' for British Columbia)."},{"name":"postal_code","type":"string","nullable":false,"description":"Postal code in country-specific format. Examples: '90210' (USA), 'V6B 4X8' (Canada), 'SW1A 1AA' (UK). Validated against country format rules."},{"name":"country","type":"string","nullable":false,"description":"Country code (ISO 3166-1 alpha-2) where address is located. Determines shipping availability and tax calculations."},{"name":"address_type","type":"string","nullable":false,"description":"Type of address: 'RESIDENTIAL' (home address), 'BUSINESS' (office/business), 'PO_BOX' (postal box). Used for delivery method selection."},{"name":"delivery_instructions","type":"string","nullable":true,"description":"Special delivery instructions (e.g., 'Use back gate', 'Leave with neighbor', 'Ring twice'). Passed to shipping carrier for delivery optimization."},{"name":"is_verified","type":"boolean","nullable":false,"description":"Whether address has been verified as deliverable by shipping carriers. Unverified addresses may have delivery issues."},{"name":"created_at","type":"datetime","nullable":false,"description":"Timestamp when customer added this address."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Timestamp of most recent address modification."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft delete timestamp when customer archived address. Null for active addresses. Allows removal without losing order history."}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_customer_id","is_default"]},{"fieldNames":["shopping_customer_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_seller_bank_accounts","description":"Bank account information for seller commission payouts and fund transfers. Stores encrypted bank details for financial transactions and seller fund management. Includes verification status and preferred payment method configuration. Critical for seller payment processing and financial reconciliation.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_seller_id","type":"uuid","description":"Reference to the seller who owns this bank account. {@link shopping_mall_seller.id}","relation":{"name":"seller","targetModel":"shopping_mall_seller"},"unique":false,"nullable":false}],"plainFields":[{"name":"account_holder_name","type":"string","nullable":false,"description":"Name of bank account holder. Must match bank records for account verification and compliance."},{"name":"bank_name","type":"string","nullable":false,"description":"Official name of the bank issuing the account. Example: 'JPMorgan Chase', 'Bank of America'."},{"name":"bank_code","type":"string","nullable":false,"description":"Bank's routing number (USA), SWIFT code, or country-specific bank code for wire transfers."},{"name":"account_number_encrypted","type":"string","nullable":false,"description":"Bank account number encrypted using application-level encryption. Never stored in plain text for PCI compliance. Encryption key stored separately."},{"name":"account_number_last4","type":"string","nullable":false,"description":"Last 4 digits of bank account for customer reference (e.g., '5678'). Used to display account without revealing full number."},{"name":"account_type","type":"string","nullable":false,"description":"Type of bank account: 'CHECKING' (standard business account), 'SAVINGS' (interest-bearing), 'MONEY_MARKET' (limited transfers). Affects transfer capabilities."},{"name":"currency","type":"string","nullable":false,"description":"ISO 4217 currency code for the bank account (e.g., 'USD', 'EUR', 'GBP'). Payouts are made in this currency."},{"name":"is_primary","type":"boolean","nullable":false,"description":"Whether this is the primary payout account for commissions. Only one account per seller can be primary. Fallback for disputes and reversals."},{"name":"verification_status","type":"string","nullable":false,"description":"Bank account verification status: 'PENDING' (awaiting verification), 'VERIFIED' (confirmed valid), 'FAILED' (rejected during verification), 'UNVERIFIED' (needs re-verification). Only verified accounts receive payouts."},{"name":"verification_attempts","type":"int","nullable":false,"description":"Number of verification attempts made for this bank account. Failed verification may indicate incorrect account details."},{"name":"verified_at","type":"datetime","nullable":true,"description":"Timestamp when bank account was successfully verified. Null if not verified."},{"name":"created_at","type":"datetime","nullable":false,"description":"Timestamp when seller added this bank account."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Timestamp of most recent bank account update."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft delete timestamp when bank account was removed. Null for active accounts. Preserves payment history."}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_seller_id","is_primary"]},{"fieldNames":["verification_status"]}],"ginIndexes":[]},{"name":"shopping_mall_seller_verification_documents","description":"Seller identity and business verification documents for regulatory compliance and fraud prevention. Stores document types, upload status, verification results, and rejection reasons. Enables multi-step seller onboarding with document validation and compliance tracking.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_seller_id","type":"uuid","description":"Reference to the seller who submitted this verification document. {@link shopping_mall_seller.id}","relation":{"name":"seller","targetModel":"shopping_mall_seller"},"unique":false,"nullable":false}],"plainFields":[{"name":"document_type","type":"string","nullable":false,"description":"Type of verification document submitted: 'BUSINESS_LICENSE' (official business registration), 'TAX_ID_DOCUMENT' (tax identification), 'BANK_STATEMENT' (account verification), 'OWNER_ID' (identity verification), 'ARTICLES_OF_INCORPORATION' (business formation), 'PASSPORT' (personal identification), 'UTILITY_BILL' (address verification). Determines validation requirements."},{"name":"document_url","type":"uri","nullable":false,"description":"URL to uploaded document file. Stored in secure cloud storage with access restricted to authorized personnel. Documents expire and must be re-uploaded periodically."},{"name":"document_name","type":"string","nullable":false,"description":"Original filename of uploaded document. Used for reference in verification process."},{"name":"document_issue_date","type":"datetime","nullable":true,"description":"Date document was issued by issuing authority. Null if not applicable. Used for expiration calculation."},{"name":"document_expiry_date","type":"datetime","nullable":true,"description":"Date document expires if applicable. Null for non-expiring documents. System alerts seller when expiry approaches."},{"name":"verification_status","type":"string","nullable":false,"description":"Document verification status: 'PENDING_REVIEW' (awaiting human review), 'VERIFIED' (approved as valid), 'REJECTED' (failed verification), 'EXPIRED' (document needs renewal). Controls seller account eligibility."},{"name":"verification_notes","type":"string","nullable":true,"description":"Admin notes from verification process. For rejected documents, explains reason for rejection (e.g., 'Document illegible', 'Expired', 'Does not match seller information'). Guides seller on corrective action."},{"name":"verified_by_admin_id","type":"uuid","nullable":true,"description":"Reference to admin who verified this document. Null if not yet verified. Used for audit trail."},{"name":"verified_at","type":"datetime","nullable":true,"description":"Timestamp when document was verified or rejected. Null if still pending."},{"name":"created_at","type":"datetime","nullable":false,"description":"Timestamp when seller uploaded this document."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Timestamp of most recent document status update."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft delete timestamp when document was archived. Null for active documents. Preserves verification history."}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_seller_id","document_type"]},{"fieldNames":["verification_status"]},{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_user_preferences","description":"User-configurable preferences and settings for personalized platform experience. Enables customers to customize interface language, currency display, search preferences, recommendation settings, and shopping behavior. Applies to both customers and sellers for UX personalization.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_customer_id","type":"uuid","description":"Reference to the customer these preferences belong to. {@link shopping_mall_customer.id} Set for customer preferences, null for seller preferences.","relation":{"name":"customer","targetModel":"shopping_mall_customer"},"unique":true,"nullable":true},{"name":"shopping_seller_id","type":"uuid","description":"Reference to the seller these preferences belong to. {@link shopping_mall_seller.id} Set for seller preferences, null for customer preferences.","relation":{"name":"seller","targetModel":"shopping_mall_seller"},"unique":true,"nullable":true}],"plainFields":[{"name":"preferred_language","type":"string","nullable":false,"description":"ISO 639-1 language code for UI language (e.g., 'en', 'es', 'fr', 'de', 'zh', 'ja'). Defaults to account creation language."},{"name":"preferred_currency","type":"string","nullable":false,"description":"ISO 4217 currency code for price display (e.g., 'USD', 'EUR', 'GBP', 'JPY'). Can differ from account currency."},{"name":"timezone","type":"string","nullable":false,"description":"IANA timezone identifier (e.g., 'America/New_York', 'Europe/London', 'Asia/Tokyo'). Used for time-based notifications and reports."},{"name":"enable_search_history","type":"boolean","nullable":false,"description":"Whether to save search history for personalized recommendations. Users can delete history anytime."},{"name":"enable_personalized_recommendations","type":"boolean","nullable":false,"description":"Whether to enable AI-powered product recommendations based on browsing and purchase history."},{"name":"enable_price_drop_alerts","type":"boolean","nullable":false,"description":"Whether to enable notifications when prices drop on wishlisted items."},{"name":"theme_preference","type":"string","nullable":false,"description":"UI theme preference: 'LIGHT' (light mode), 'DARK' (dark mode), 'AUTO' (follow system preference). Default: 'LIGHT'."},{"name":"product_sorting_default","type":"string","nullable":false,"description":"Default product sort order: 'RELEVANCE' (search relevance), 'PRICE_ASC' (low to high), 'PRICE_DESC' (high to low), 'NEWEST' (latest first), 'BEST_RATED' (highest rating). Default: 'RELEVANCE'."},{"name":"items_per_page","type":"int","nullable":false,"description":"Number of items displayed per page (20, 50, 100). Default: 50. Affects pagination."},{"name":"show_adult_products","type":"boolean","nullable":false,"description":"Whether to show age-restricted products in search results. Default: false (unless user verified as adult)."},{"name":"created_at","type":"datetime","nullable":false,"description":"Timestamp when preference record was created (usually at user registration)."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Timestamp of most recent preference update."}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_customer_id"]},{"fieldNames":["shopping_seller_id"]}],"ginIndexes":[]},{"name":"shopping_mall_user_notification_settings","description":"Detailed notification channel preferences and frequency controls for both customers and sellers. Enables granular control over email, SMS, in-app, and push notifications for different event types. Supports opt-in/opt-out by channel and event category with quiet hours configuration.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_customer_id","type":"uuid","description":"Reference to the customer these notification settings belong to. {@link shopping_mall_customer.id} Set for customer notification settings, null for seller settings.","relation":{"name":"customer","targetModel":"shopping_mall_customer"},"unique":true,"nullable":true},{"name":"shopping_seller_id","type":"uuid","description":"Reference to the seller these notification settings belong to. {@link shopping_mall_seller.id} Set for seller notification settings, null for customer settings.","relation":{"name":"seller","targetModel":"shopping_mall_seller"},"unique":true,"nullable":true}],"plainFields":[{"name":"email_enabled","type":"boolean","nullable":false,"description":"Whether to receive email notifications. Controls all email-based alerts. Default: true."},{"name":"sms_enabled","type":"boolean","nullable":false,"description":"Whether to receive SMS text notifications. Requires verified phone number. Default: false."},{"name":"push_enabled","type":"boolean","nullable":false,"description":"Whether to receive push notifications on mobile app. Default: true (if app installed)."},{"name":"in_app_enabled","type":"boolean","nullable":false,"description":"Whether to receive in-app notifications. These always appear regardless of other settings. Default: true."},{"name":"order_notifications_enabled","type":"boolean","nullable":false,"description":"Whether to receive order-related notifications (confirmation, shipping, delivery). Default: true."},{"name":"review_notifications_enabled","type":"boolean","nullable":false,"description":"Whether to receive notifications about product reviews and ratings. Default: true."},{"name":"promotion_notifications_enabled","type":"boolean","nullable":false,"description":"Whether to receive promotional and marketing notifications (deals, new arrivals). Default: true."},{"name":"message_notifications_enabled","type":"boolean","nullable":false,"description":"Whether to receive notifications about direct messages from sellers/customers. Default: true."},{"name":"payment_notifications_enabled","type":"boolean","nullable":false,"description":"Whether to receive payment and billing notifications. Default: true."},{"name":"notification_frequency","type":"string","nullable":false,"description":"Frequency of non-urgent notifications: 'REAL_TIME' (immediate), 'DAILY_DIGEST' (batched daily), 'WEEKLY_DIGEST' (batched weekly). Default: 'REAL_TIME'."},{"name":"quiet_hours_start","type":"string","nullable":true,"description":"Start time of quiet hours in HH:MM format (24-hour). No notifications sent during quiet hours. Example: '21:00'. Null if quiet hours disabled."},{"name":"quiet_hours_end","type":"string","nullable":true,"description":"End time of quiet hours in HH:MM format (24-hour). Example: '08:00'. Null if quiet hours disabled. Can be next day if wraps midnight."},{"name":"quiet_hours_enabled","type":"boolean","nullable":false,"description":"Whether quiet hours (do-not-disturb period) are enabled. Default: false."},{"name":"unsubscribe_all_marketing","type":"boolean","nullable":false,"description":"One-click unsubscribe from all marketing communications. GDPR/CAN-SPAM compliance. Default: false."},{"name":"created_at","type":"datetime","nullable":false,"description":"Timestamp when notification settings were first created (usually at user registration)."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Timestamp of most recent notification settings update."}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_customer_id"]},{"fieldNames":["shopping_seller_id"]}],"ginIndexes":[]}]},{"filename":"schema-03-systematic.prisma","namespace":"Systematic","models":[{"name":"shopping_mall_categories","description":"Product categories representing the hierarchical taxonomy of products. This is a foundational system table that organizes all products into logical groupings (e.g., Electronics, Clothing, Home & Garden). Categories are used for product browsing, filtering, and navigation within the platform. Works in conjunction with {@link shopping_mall_category_hierarchy} for multi-level category organization.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"category_name","type":"string","description":"Name of the category (e.g., 'Electronics', 'Clothing', 'Home & Garden'). Must be unique within the system to prevent duplicate categories.","nullable":false},{"name":"description","type":"string","description":"Detailed description of what products are included in this category. Helps customers understand the category scope and purpose.","nullable":true},{"name":"category_code","type":"string","description":"System-generated unique code for the category used in APIs and internal references. Format: uppercase alphanumeric (e.g., 'ELEC', 'CLOTH').","nullable":false},{"name":"is_active","type":"boolean","description":"Whether this category is currently active and visible to customers. Inactive categories are hidden from browse but can be reactivated without data loss.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when the category was created in ISO 8601 format (UTC timezone).","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when the category was last modified. Auto-updated on any changes to category information.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Timestamp when category was soft-deleted (archived). Null if category is active. Allows recovery of deleted categories.","nullable":true}],"uniqueIndexes":[{"fieldNames":["category_name"],"unique":true},{"fieldNames":["category_code"],"unique":true}],"plainIndexes":[{"fieldNames":["is_active","created_at"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"description"}]},{"name":"shopping_mall_category_hierarchy","description":"Defines the hierarchical parent-child relationships between categories, enabling multi-level category structures (e.g., Electronics > Computers > Laptops). This allows categories to be organized into a tree structure for improved product navigation and filtering. Works with {@link shopping_mall_categories} to establish the category taxonomy.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"parent_category_id","type":"uuid","description":"Reference to the parent category's {@link shopping_mall_categories.id}. This establishes the hierarchical relationship. Root-level categories have null parent_id.","relation":{"name":"parentCategory","targetModel":"shopping_mall_categories","mappingName":"shopping_mall_category_hierarchy_of_parent_category_id"},"unique":false,"nullable":true},{"name":"child_category_id","type":"uuid","description":"Reference to the child category's {@link shopping_mall_categories.id}. This is the subcategory in the hierarchical relationship.","relation":{"name":"childCategory","targetModel":"shopping_mall_categories","mappingName":"shopping_mall_category_hierarchy_of_child_category_id"},"unique":false,"nullable":false}],"plainFields":[{"name":"hierarchy_level","type":"int","description":"Depth level in the hierarchy (1 for root, 2 for first-level children, 3 for second-level, etc.). Used for navigation and breadcrumb generation.","nullable":false},{"name":"sort_order","type":"int","description":"Display order of this subcategory within its parent category siblings. Used for consistent category ordering in UI.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when the hierarchy relationship was established.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when the hierarchy relationship was last modified.","nullable":false}],"uniqueIndexes":[{"fieldNames":["parent_category_id","child_category_id"],"unique":true}],"plainIndexes":[{"fieldNames":["parent_category_id","hierarchy_level"]},{"fieldNames":["child_category_id"]},{"fieldNames":["hierarchy_level"]}],"ginIndexes":[]},{"name":"shopping_mall_sections","description":"Major platform sections that organize content and features into distinct areas (e.g., Featured Products, New Arrivals, Flash Sales, Top Sellers). Sections are different from categories - they represent feature areas or promotional sections that may contain products from multiple categories. These are configured by admins to organize the customer shopping experience.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"section_name","type":"string","description":"Display name of the section visible to customers (e.g., 'Featured Products', 'New Arrivals', 'Flash Sales'). Should be concise and clear.","nullable":false},{"name":"section_type","type":"string","description":"Type classification of section (e.g., 'featured', 'new_arrivals', 'flash_sale', 'top_sellers', 'curated'). Used for organizing and filtering sections by type.","nullable":false},{"name":"description","type":"string","description":"Detailed description explaining the section's purpose and what customers can expect to find. Helps customers understand the content.","nullable":true},{"name":"sort_order","type":"int","description":"Display order of this section on the platform homepage and section pages. Lower numbers appear first.","nullable":false},{"name":"is_active","type":"boolean","description":"Whether this section is currently visible to customers. Inactive sections are hidden but can be reactivated.","nullable":false},{"name":"is_featured_on_homepage","type":"boolean","description":"Whether this section should be displayed on the platform homepage. Allows selective promotion of important sections.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when the section was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when the section was last modified.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Timestamp when section was soft-deleted (archived). Null if section is active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["section_name"],"unique":true}],"plainIndexes":[{"fieldNames":["section_type","is_active"]},{"fieldNames":["is_featured_on_homepage"]},{"fieldNames":["sort_order"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"description"}]},{"name":"shopping_mall_channels","description":"Distribution channels representing different sales paths or business models (e.g., Direct Sales, Marketplace, B2B Channel, Wholesale, Premium Channel). Channels allow the platform to segment products and sellers for different sales strategies and customer groups. Products and sellers can be assigned to specific channels.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"channel_name","type":"string","description":"Name of the sales channel (e.g., 'Direct Sales', 'Marketplace', 'B2B', 'Wholesale', 'Premium'). Identifies the channel for admin configuration.","nullable":false},{"name":"channel_code","type":"string","description":"System code for the channel used in APIs and internal references. Format: uppercase alphanumeric (e.g., 'DIRECT', 'MARKETPLACE').","nullable":false},{"name":"description","type":"string","description":"Detailed description of the channel's purpose, target audience, and business model. Helps stakeholders understand channel positioning.","nullable":true},{"name":"commission_rate","type":"double","description":"Default commission rate (as percentage) for sellers on this channel. Example: 0.10 for 10% commission. Can be overridden per seller.","nullable":false},{"name":"min_order_value","type":"double","description":"Minimum order value required for purchases on this channel. Orders below this value are not processed. Example: 10.00 for $10 minimum.","nullable":true},{"name":"max_order_value","type":"double","description":"Maximum order value allowed for purchases on this channel. Orders exceeding this value are rejected. Used to prevent fraud or system issues.","nullable":true},{"name":"is_active","type":"boolean","description":"Whether this channel is currently active and accepting orders. Inactive channels are temporarily closed.","nullable":false},{"name":"is_public","type":"boolean","description":"Whether this channel is visible to customers. Private channels can be used for internal testing or invitation-only access.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when the channel was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when the channel was last modified.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Timestamp when channel was soft-deleted (archived). Null if channel is active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["channel_name"],"unique":true},{"fieldNames":["channel_code"],"unique":true}],"plainIndexes":[{"fieldNames":["is_active","is_public"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"description"}]},{"name":"shopping_mall_system_configurations","description":"Global system configuration settings that control platform behavior, policies, and operational parameters. Includes settings for commission rates, refund policies, shipping rules, fraud detection thresholds, and other operational constants. These configurations are managed by admins and affect all users across the platform.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"config_key","type":"string","description":"Unique identifier/name for this configuration setting. Format: CONSTANT_CASE (e.g., 'DEFAULT_COMMISSION_RATE', 'REFUND_WINDOW_DAYS', 'MAX_CART_ITEMS'). Used for programmatic access.","nullable":false},{"name":"config_value","type":"string","description":"The configuration value as a string. Can represent various types (percentage, number, boolean, text, JSON). Must be parsed appropriately by application based on config_key.","nullable":false},{"name":"data_type","type":"string","description":"Data type of the configuration value (e.g., 'string', 'number', 'boolean', 'percentage', 'json'). Helps application parse the config_value correctly.","nullable":false},{"name":"description","type":"string","description":"Human-readable explanation of what this configuration controls and its impact on platform behavior. Helps admins understand the setting.","nullable":false},{"name":"is_editable","type":"boolean","description":"Whether this configuration can be modified by admins. Some critical settings may be read-only after initial setup.","nullable":false},{"name":"environment","type":"string","description":"Environment where this configuration applies (e.g., 'development', 'staging', 'production', 'all'). Allows different configurations per environment.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when this configuration was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when this configuration was last modified.","nullable":false},{"name":"updated_by","type":"string","description":"Admin ID or username who last updated this configuration. For audit trail purposes.","nullable":true}],"uniqueIndexes":[{"fieldNames":["config_key","environment"],"unique":true}],"plainIndexes":[{"fieldNames":["config_key"]},{"fieldNames":["environment"]},{"fieldNames":["updated_at"]}],"ginIndexes":[{"fieldName":"description"}]},{"name":"shopping_mall_feature_flags","description":"Feature flags enabling/disabling platform features for A/B testing, gradual rollouts, and controlled feature releases. Allows admins to toggle features on/off without code deployment. Supports targeting by user segment (e.g., enable for 10% of users, specific user roles, specific regions).","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"feature_name","type":"string","description":"Unique identifier for this feature flag (e.g., 'new_checkout_flow', 'ai_recommendations', 'one_click_purchase'). Used to check flag status in application code.","nullable":false},{"name":"feature_description","type":"string","description":"Human-readable description of what this feature does and why it exists. Helps admins understand the feature's purpose and impact.","nullable":false},{"name":"is_enabled","type":"boolean","description":"Master toggle controlling whether this feature is enabled globally. When false, the feature is disabled for all users regardless of other settings.","nullable":false},{"name":"rollout_percentage","type":"int","description":"Percentage of users who see this feature (0-100). Example: 25 means 25% of users get the feature, 75% don't. Enables gradual rollout.","nullable":false},{"name":"target_user_roles","type":"string","description":"Comma-separated list of user roles who can access this feature (e.g., 'customer,seller,admin' or 'admin' for admins only). Empty/null means all roles.","nullable":true},{"name":"target_regions","type":"string","description":"Comma-separated list of country codes where feature is available (e.g., 'US,CA,UK' or 'ALL' for all regions). Enables regional feature testing.","nullable":true},{"name":"environment","type":"string","description":"Environment where this flag applies (e.g., 'development', 'staging', 'production', 'all'). Allows different flag states per environment.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when this feature flag was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when this feature flag was last modified.","nullable":false},{"name":"created_by","type":"string","description":"Admin ID or username who created this feature flag.","nullable":true},{"name":"updated_by","type":"string","description":"Admin ID or username who last updated this feature flag.","nullable":true}],"uniqueIndexes":[{"fieldNames":["feature_name","environment"],"unique":true}],"plainIndexes":[{"fieldNames":["feature_name"]},{"fieldNames":["is_enabled","environment"]},{"fieldNames":["environment"]},{"fieldNames":["updated_at"]}],"ginIndexes":[{"fieldName":"feature_description"}]}]},{"filename":"schema-04-products.prisma","namespace":"Products","models":[{"name":"shopping_mall_products","description":"Core product entity representing individual products in the shopping mall catalog. Each product is a distinct offering with metadata, category assignment, seller ownership, and status tracking. Products progress through lifecycle states from DRAFT (initial creation) through ACTIVE (published and available for purchase) to INACTIVE (temporarily hidden) or ARCHIVED (historical record). This is the main product table that anchors all variant, image, specification, and approval data. Products are distinct from shopping_mall_product_variants which represent specific SKU combinations with independent pricing.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_seller_id","type":"uuid","description":"Seller who owns and manages this product. References the seller's {@link shopping_mall_seller.id} account.","relation":{"name":"seller","targetModel":"shopping_mall_seller"},"unique":false,"nullable":false},{"name":"shopping_mall_category_id","type":"uuid","description":"Primary category assignment for product organization and browsing. References {@link shopping_mall_categories.id}. Required for catalog organization.","relation":{"name":"category","targetModel":"shopping_mall_categories"},"unique":false,"nullable":false}],"plainFields":[{"name":"product_name","type":"string","description":"Display name of the product for catalog and search. Required field between 3-255 characters. Examples: 'Premium Cotton T-Shirt', 'Wireless Bluetooth Headphones'.","nullable":false},{"name":"product_description","type":"string","description":"Detailed product description and usage information provided by seller. Required field between 10-5000 characters. HTML formatting allowed but sanitized for XSS prevention. Should include material composition, care instructions, and key features.","nullable":false},{"name":"brand","type":"string","description":"Product brand or manufacturer name. Optional field between 1-100 characters. Examples: 'Nike', 'Samsung', 'Apple'. Used for brand-based filtering in catalog.","nullable":true},{"name":"base_price","type":"double","description":"Base/default price for the product in platform currency (typically USD). Stored with exactly 2 decimal places. Minimum $0.01, maximum $999,999.99. Individual variant SKUs may have different prices. Used as default when variant-specific pricing not defined.","nullable":false},{"name":"weight","type":"double","description":"Product weight in kilograms (kg) for shipping cost calculation. Used in logistics and fulfillment operations. Optional field. Example: 0.5 for 500 grams.","nullable":true},{"name":"product_status","type":"string","description":"Lifecycle status of the product: 'DRAFT' (being created, not visible), 'ACTIVE' (published and available for purchase), 'INACTIVE' (temporarily hidden but data preserved), 'ARCHIVED' (permanently historical record, no new orders). Status determines search visibility and purchase eligibility.","nullable":false},{"name":"sku_prefix","type":"string","description":"Optional prefix for auto-generated SKU identifiers for this product's variants. Examples: 'TSHIRT', 'HEADPHONE'. Used in variant SKU generation for easier identification of product families.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when product was initially created. ISO 8601 format in UTC. Immutable field set at creation. Used for sorting and audit trails.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp of last product information modification. ISO 8601 format in UTC. Auto-updated whenever product details change. Used for change tracking and freshness indicators.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Timestamp when product was soft-deleted. NULL if product is active. ISO 8601 format in UTC. Enables data recovery and audit trail of deletions. Used for implementing soft delete pattern.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_seller_id","product_name"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_seller_id"]},{"fieldNames":["shopping_mall_category_id","product_status"]},{"fieldNames":["product_status"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"product_name"},{"fieldName":"product_description"}]},{"name":"shopping_mall_product_variants","description":"Product variant entities representing specific SKU (Stock Keeping Unit) combinations with distinct variant attributes (color, size, material, etc.), independent pricing, and inventory tracking. Each variant is a purchasable unit with its own SKU identifier, price, and inventory record in the shopping_mall_inventory_skus table. Multiple variants of the same product enable customers to select specific attribute combinations (e.g., Blue Size-M vs Red Size-L). Variants inherit basic information from parent product but have independent operational characteristics. Each variant maps to exactly one inventory SKU record for stock tracking.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Parent product that this variant belongs to. References {@link shopping_mall_products.id}. All variants of a product share the same parent product record.","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false}],"plainFields":[{"name":"sku","type":"string","description":"Globally unique Stock Keeping Unit identifier for this specific variant combination. Format typically: {PRODUCT_PREFIX}-{VARIANT_CODE} (e.g., 'TSHIRT-BLU-M' for Blue Medium T-Shirt). Must be unique across entire platform and immutable after creation. Used for inventory tracking, order fulfillment, and customer reference.","nullable":false},{"name":"variant_combination_code","type":"string","description":"Machine-readable identifier for variant attribute combination. Encodes the specific combination of variant options like color+size. Examples: 'blue-large', 'red-small-cotton'. Used for programmatic variant identification and grouping.","nullable":false},{"name":"variant_price","type":"double","description":"Price specific to this variant, overriding the product base price if set. Stored with exactly 2 decimal places. Minimum $0.01, maximum $999,999.99. If null, base product price is used. Enables premium pricing for larger sizes or special colors.","nullable":true},{"name":"variant_display_order","type":"int","description":"Display sequence for ordering variants on product detail page. Lower numbers display first. Used to highlight popular variants or organize presentation logically. Default: 0 (sequential order if not specified).","nullable":true},{"name":"is_active","type":"boolean","description":"Whether this specific variant is available for purchase. False to hide variant without deleting data. Used to temporarily disable variants while preserving order history and inventory records.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when variant was created. ISO 8601 format in UTC. Immutable field. Used for audit trail and variant lifecycle tracking.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp of last variant modification. ISO 8601 format in UTC. Auto-updated on changes to pricing, status, or variant attributes.","nullable":false}],"uniqueIndexes":[{"fieldNames":["sku"],"unique":true},{"fieldNames":["shopping_mall_product_id","variant_combination_code"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_product_id"]},{"fieldNames":["is_active"]},{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_product_variant_options","description":"Individual variant attribute values that compose product variants. Each record represents an atomic variant attribute (e.g., Color='Blue', Size='Large', Material='Cotton'). Multiple variant_options combine to form a complete variant combination. For example, a T-shirt variant 'TSHIRT-BLU-M' is composed of: variant_option(Color=Blue), variant_option(Size=Medium). These options enable flexible variant definition and searchable attribute filtering in product catalog.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_variant_id","type":"uuid","description":"Parent variant that contains this option. References {@link shopping_mall_product_variants.id}. Multiple variant_options belong to each variant.","relation":{"name":"variant","targetModel":"shopping_mall_product_variants"},"unique":false,"nullable":false}],"plainFields":[{"name":"option_type","type":"string","description":"Type/category of variant attribute. Standard types: 'color' (Color/Finish), 'size' (Size dimension), 'material' (Material composition), 'style' (Alternative style), 'pattern' (Visual pattern), 'configuration' (Product-specific config). Used for organizing variant attributes logically.","nullable":false},{"name":"option_value","type":"string","description":"Specific value for this variant attribute. Examples for color: 'Blue', 'Red', 'Black'; for size: 'Small', 'Medium', 'Large'; for material: 'Cotton', 'Polyester'. Used for customer-facing variant selection display and filtering.","nullable":false},{"name":"option_display_order","type":"int","description":"Display sequence for ordering this option within its type. Lower numbers display first. Used to highlight preferred options or organize presentation. Default: 0.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when variant option was created. ISO 8601 format in UTC. Immutable field used for audit trail.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_product_variant_id","option_type","option_value"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_product_variant_id"]},{"fieldNames":["option_type"]}],"ginIndexes":[]},{"name":"shopping_mall_product_images","description":"Product images for visual catalog presentation. Each image represents a single product photo with ordering for display sequencing on product detail pages. Exactly one image per product should be marked as primary (used as thumbnail in search results and category listings). Images are stored as URI references to external image storage (CDN) rather than as BLOB data in database. Soft deletion is implemented through status changes rather than hard deletion to preserve order history references.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Product that this image belongs to. References {@link shopping_mall_products.id}. Multiple images can belong to single product.","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false}],"plainFields":[{"name":"image_url","type":"uri","description":"URL/URI pointing to the actual image file stored in CDN or external storage. Should be a direct HTTP(S) link to the image file. Examples: 'https://cdn.example.com/products/img123.jpg', 'https://storage.example.com/images/product456.png'. Never stored as BLOB in database.","nullable":false},{"name":"is_primary","type":"boolean","description":"Whether this image is the primary/thumbnail image for the product. Only one image per product should have is_primary=true. Used in search results, category listings, and product cards. Used for determining which image to display when full gallery not available.","nullable":false},{"name":"image_display_order","type":"int","description":"Display sequence for image ordering in product gallery. Lower numbers display first. Used to show product photos in seller-preferred order. Typically: primary image first (order 0), then additional angles/details.","nullable":false},{"name":"alt_text","type":"string","description":"Accessibility alt text describing image content for screen readers. Should clearly describe what the image shows. Example: 'Blue cotton t-shirt worn by model, showing front design'. Used for accessibility compliance and SEO.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when image record was created. ISO 8601 format in UTC. Immutable field used for audit trail.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_product_id","is_primary"]},{"fieldNames":["image_display_order"]}],"ginIndexes":[]},{"name":"shopping_mall_product_specifications","description":"Product specifications and detailed attribute information stored as flexible key-value pairs. Specifications include technical details like dimensions, weight, material composition, care instructions, battery life, processor specs, etc. This model provides extensible attribute storage without requiring schema changes for new specification types. Unlike rigid structured fields, specifications allow sellers to define arbitrary attributes relevant to their product categories.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Product that this specification describes. References {@link shopping_mall_products.id}. Multiple specifications can describe single product.","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false}],"plainFields":[{"name":"spec_key","type":"string","description":"Specification attribute name/key. Examples: 'material', 'dimensions', 'weight', 'battery_life', 'processor', 'memory', 'color', 'warranty_period'. Seller-defined keys allow flexible attribute representation without schema modifications.","nullable":false},{"name":"spec_value","type":"string","description":"Specification attribute value. Examples: 'Cotton 100%', '10cm x 5cm x 2cm', '250g', '20 hours', 'Intel i7', '16GB', 'Care: Hand wash only, dry flat'. Can store complex specification details as text.","nullable":false},{"name":"spec_display_order","type":"int","description":"Display sequence for specification on product detail page. Lower numbers display first. Organizes specifications in logical groupings (e.g., material specs before care specs).","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when specification was added. ISO 8601 format in UTC. Immutable field used for audit trail.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_product_id"]},{"fieldNames":["spec_key"]}],"ginIndexes":[{"fieldName":"spec_value"}]},{"name":"shopping_mall_product_tags","description":"Searchable tags for product categorization, SEO optimization, and enhanced product discovery beyond the hierarchical category system. Tags enable cross-category product finding and flexible organization. Unlike rigid category hierarchies, tags allow multiple overlapping classifications (e.g., 'outdoor', 'waterproof', 'summer-collection', 'trending' on same product). Tags are indexed for full-text search enabling customers to find products by multiple faceted attributes.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Product that this tag is applied to. References {@link shopping_mall_products.id}. Multiple tags can be applied to single product.","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false}],"plainFields":[{"name":"tag_name","type":"string","description":"Searchable tag keyword for product discovery. Examples: 'eco-friendly', 'bestseller', 'new-arrival', 'premium', 'outdoor', 'waterproof', 'organic'. Tags enable flexible faceted search and product filtering beyond category hierarchy. Should be lowercase, hyphen-separated for consistency.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when tag was applied to product. ISO 8601 format in UTC. Immutable field used for audit trail.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_product_id","tag_name"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_product_id"]}],"ginIndexes":[{"fieldName":"tag_name"}]},{"name":"shopping_mall_product_approvals","description":"Audit trail and approval workflow history for product submissions and modifications. Captures all product approval decisions made by administrators including approval/rejection decisions, timestamps, and admin notes. This snapshot/audit table preserves complete product lifecycle history tracking when products were submitted, approved, rejected, and why. Each approval record is immutable, creating a complete accountability record for product catalog governance. Multiple approval records per product track submission iterations (e.g., initial rejection, resubmission, approval).","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Product that was approved or rejected. References {@link shopping_mall_products.id}. Multiple approval records track approval history for single product.","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false},{"name":"shopping_mall_admin_id","type":"uuid","description":"Administrator who made the approval decision. References {@link shopping_mall_admin.id}. Tracks accountability for approval decisions.","relation":{"name":"admin","targetModel":"shopping_mall_admin"},"unique":false,"nullable":false}],"plainFields":[{"name":"approval_status","type":"string","description":"Decision on product approval: 'PENDING' (awaiting admin review), 'APPROVED' (product published to catalog), 'REJECTED' (product not approved, returned for corrections). Tracks product submission outcomes.","nullable":false},{"name":"admin_notes","type":"string","description":"Administrative notes explaining approval decision or rejection reason. For approvals: general comments. For rejections: specific issues requiring correction (e.g., 'Image resolution too low - minimum 1000x1000px required', 'Product description contains prohibited keywords'). Max 2000 characters for detailed feedback.","nullable":true},{"name":"decision_timestamp","type":"datetime","description":"Timestamp when approval decision was made. ISO 8601 format in UTC. Records exact moment of approval/rejection decision. Immutable field used for accountability and audit trail.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when approval record was created. ISO 8601 format in UTC. Typically matches decision_timestamp but may differ if retroactive recording occurs. Immutable audit field.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["approval_status"]},{"fieldNames":["shopping_mall_admin_id"]},{"fieldNames":["shopping_mall_product_id","decision_timestamp"]}],"ginIndexes":[{"fieldName":"admin_notes"}]}]},{"filename":"schema-05-inventory.prisma","namespace":"Inventory","models":[{"name":"shopping_mall_inventory_skus","description":"Master SKU inventory records tracking unique product variants with seller ownership. Represents each Stock Keeping Unit (color, size, options combination) separately for independent inventory management. Links to product variants and enables multi-warehouse inventory operations. Core table for inventory domain that connects to all inventory transactions and stock levels.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_variant_id","type":"uuid","description":"Reference to product variant defining this SKU's characteristics. {@link shopping_mall_product_variants.id}","relation":{"name":"productVariant","targetModel":"shopping_mall_product_variants"},"unique":true,"nullable":false},{"name":"shopping_mall_seller_id","type":"uuid","description":"Reference to seller who owns and manages this SKU's inventory. {@link shopping_mall_seller.id}","relation":{"name":"seller","targetModel":"shopping_mall_seller"},"unique":false,"nullable":false}],"plainFields":[{"name":"sku_code","type":"string","description":"Unique SKU identifier code combining product ID and variant options (e.g., PROD-123-BLU-M). Used for human reference and order line item tracking.","nullable":false},{"name":"reorder_level","type":"int","description":"Minimum inventory threshold before low stock alert triggers. Seller configurable, typically 10 units. Helps seller manage restocking proactively.","nullable":false},{"name":"status","type":"string","description":"Current SKU status: active (available for sale), inactive (temporarily unavailable but data preserved), discontinued (no longer sold, archived). Controls whether SKU appears in catalog.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when this SKU was created, typically when product variant is first set up for inventory tracking.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last modification timestamp for SKU metadata. Updated when status or reorder level changes.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_seller_id","sku_code"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_seller_id","status"]},{"fieldNames":["status"]}],"ginIndexes":[{"fieldName":"sku_code"}]},{"name":"shopping_mall_inventory_quantities","description":"Real-time stock quantity tracking at SKU level. Maintains current on-hand inventory, reserved quantities (committed to orders), and calculated available quantities. Critical for preventing overselling. Optimized for frequent reads and updates during order processing. Separate from transactions table for performance.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_inventory_sku_id","type":"uuid","description":"Reference to the SKU master record for which this quantity record maintains stock levels. {@link shopping_mall_inventory_skus.id}","relation":{"name":"sku","targetModel":"shopping_mall_inventory_skus"},"unique":true,"nullable":false}],"plainFields":[{"name":"current_quantity","type":"int","description":"Total on-hand inventory units available (should never be negative). Decreases when orders confirmed, increases when returns received or manual adjustments add stock.","nullable":false},{"name":"reserved_quantity","type":"int","description":"Inventory units committed to confirmed but not yet shipped orders. Reserved = placed in active orders, not available for new orders. Calculated from reservation records.","nullable":false},{"name":"available_quantity","type":"int","description":"Calculated field: current_quantity minus reserved_quantity. Represents actual available inventory for new orders. Read-only calculated value.","nullable":false},{"name":"last_updated_at","type":"datetime","description":"Timestamp of most recent inventory change (order, adjustment, return, etc.). Enables tracking of inventory update frequency for monitoring purposes.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["current_quantity"]}],"ginIndexes":[]},{"name":"shopping_mall_inventory_transactions","description":"Immutable audit trail of all inventory changes (orders, adjustments, returns, damages). Append-only transaction log ensuring complete accountability for every inventory unit moved. Supports compliance auditing, historical analysis, and reconciliation. Snapshot stance because transactions are permanent historical records never modified after creation.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_inventory_sku_id","type":"uuid","description":"Reference to the SKU affected by this transaction. {@link shopping_mall_inventory_skus.id}","relation":{"name":"sku","targetModel":"shopping_mall_inventory_skus"},"unique":false,"nullable":false},{"name":"shopping_mall_order_id","type":"uuid","description":"Reference to order that triggered this inventory transaction, if applicable. {@link shopping_mall_orders.id}","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":true},{"name":"shopping_mall_inventory_adjustment_id","type":"uuid","description":"Reference to manual adjustment request that triggered this transaction, if applicable. {@link shopping_mall_inventory_adjustments.id}","relation":{"name":"adjustment","targetModel":"shopping_mall_inventory_adjustments"},"unique":false,"nullable":true}],"plainFields":[{"name":"transaction_type","type":"string","description":"Type of transaction: order_fulfillment (inventory allocated to order), order_cancellation (order cancelled, inventory restored), return_received (customer returned items), manual_adjustment (seller or admin adjusted stock), damage_reported (items damaged or lost), inventory_correction (system correction).","nullable":false},{"name":"quantity_change","type":"int","description":"Net quantity change: positive for additions (returns, restocks), negative for deductions (orders, damage). Can be positive or negative depending on transaction type.","nullable":false},{"name":"quantity_before","type":"int","description":"Inventory quantity before this transaction. Enables before/after verification and reconciliation.","nullable":false},{"name":"quantity_after","type":"int","description":"Inventory quantity after this transaction. Should equal quantity_before + quantity_change.","nullable":false},{"name":"reason","type":"string","description":"Detailed reason for transaction from predefined list: Restock, Damage/Loss, Physical Count Correction, Return Received, System Error Correction, Order Fulfillment, Other. Helps categorize and analyze inventory changes.","nullable":false},{"name":"notes","type":"string","description":"Optional detailed notes about the transaction (max 500 characters). May include explanation of discrepancies, damage details, or adjustment justification.","nullable":true},{"name":"initiated_by_type","type":"string","description":"Type of user initiating transaction: seller (seller-initiated adjustment), admin (admin-initiated correction), system (automatic order/return processing). Tracks responsibility for changes.","nullable":false},{"name":"initiated_by_id","type":"uuid","description":"UUID of user (seller or admin) or system identifier initiating this transaction. Enables audit trail showing who made change.","nullable":false},{"name":"ip_address","type":"string","description":"IP address from which transaction was initiated, if applicable (seller/admin adjustment). Null for system-generated transactions. Security audit trail.","nullable":true},{"name":"transaction_timestamp","type":"datetime","description":"Exact timestamp when transaction occurred. Enables precise sequencing of inventory changes for reconciliation.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_inventory_sku_id","transaction_timestamp"]},{"fieldNames":["shopping_mall_order_id"]},{"fieldNames":["transaction_type"]},{"fieldNames":["transaction_timestamp"]}],"ginIndexes":[]},{"name":"shopping_mall_inventory_reservations","description":"Inventory holds for pending or processing orders. Tracks reserved quantities to prevent overselling when multiple customers simultaneously purchase limited stock. Reservation timeout mechanism (15 minutes typical) releases expired holds. Bridges order system with inventory tracking for concurrent safety. Primary stance because sellers may directly query their reservations.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_inventory_sku_id","type":"uuid","description":"Reference to SKU whose inventory is being reserved. {@link shopping_mall_inventory_skus.id}","relation":{"name":"sku","targetModel":"shopping_mall_inventory_skus"},"unique":false,"nullable":false},{"name":"shopping_mall_order_id","type":"uuid","description":"Reference to order for which inventory is reserved. {@link shopping_mall_orders.id}","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false},{"name":"shopping_mall_order_item_id","type":"uuid","description":"Reference to specific order line item being reserved. {@link shopping_mall_order_items.id}","relation":{"name":"orderItem","targetModel":"shopping_mall_order_items"},"unique":false,"nullable":false}],"plainFields":[{"name":"reserved_quantity","type":"int","description":"Number of units reserved for this order item. Subtracted from available inventory until order confirms or reservation expires.","nullable":false},{"name":"status","type":"string","description":"Reservation status: reserved (hold active), released (hold cancelled/expired), committed (converted to permanent allocation). Tracks lifecycle of hold.","nullable":false},{"name":"reserved_at","type":"datetime","description":"Timestamp when inventory was reserved for this order. Marks start of hold period.","nullable":false},{"name":"reservation_expires_at","type":"datetime","description":"When this reservation automatically expires if not converted to confirmed order (typically 15 minutes after reserved_at). Prevents indefinite holds.","nullable":false},{"name":"confirmed_at","type":"datetime","description":"Timestamp when reservation was confirmed (converted to permanent inventory allocation when order payment processed). Null if still reserved or released.","nullable":true},{"name":"released_at","type":"datetime","description":"Timestamp when reservation was released (order cancelled, session timeout, or refund processed). Null if still reserved or committed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_order_item_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_inventory_sku_id","status"]},{"fieldNames":["shopping_mall_order_id"]},{"fieldNames":["status","reservation_expires_at"]}],"ginIndexes":[]},{"name":"shopping_mall_inventory_adjustments","description":"Records seller-initiated inventory quantity adjustments for restock, damage corrections, or physical count discrepancies. Requires documentation of reason and optional admin approval for certain adjustment types. Bridges manual operations with inventory transaction audit trail. Enables tracking of all inventory modifications with approval workflows.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_inventory_sku_id","type":"uuid","description":"Reference to SKU being adjusted. {@link shopping_mall_inventory_skus.id}","relation":{"name":"sku","targetModel":"shopping_mall_inventory_skus"},"unique":false,"nullable":false},{"name":"shopping_mall_seller_id","type":"uuid","description":"Reference to seller initiating this adjustment. {@link shopping_mall_seller.id}","relation":{"name":"seller","targetModel":"shopping_mall_seller"},"unique":false,"nullable":false}],"plainFields":[{"name":"adjustment_type","type":"string","description":"Type of adjustment: restock (adding new inventory), correction (fixing count discrepancy), damage (removing damaged units), loss (theft/missing units), return_received (manual return entry), other. Categorizes reason for change.","nullable":false},{"name":"quantity_change","type":"int","description":"Net quantity adjustment: positive for additions (restocking), negative for removals (damage, correction). Applied to current inventory.","nullable":false},{"name":"reason","type":"string","description":"Detailed reason for adjustment from predefined list: Restock, Damage/Loss, Physical Count Correction, Return Received, System Error Correction, Other. Explains justification for change.","nullable":false},{"name":"notes","type":"string","description":"Optional seller notes providing additional context (max 1000 characters). May explain discrepancy details, damage circumstances, or correction justification.","nullable":true},{"name":"requires_approval","type":"boolean","description":"Whether this adjustment requires admin approval before taking effect (true for damage/loss/corrections exceeding threshold, false for routine restock). Controls workflow.","nullable":false},{"name":"approval_status","type":"string","description":"Status of approval workflow: pending (awaiting admin review), approved (admin approved, applied), rejected (admin rejected, not applied). If requires_approval=false, defaults to approved immediately.","nullable":false},{"name":"approved_by_id","type":"uuid","description":"Admin ID who approved or rejected this adjustment. Null if pending or not requiring approval. Tracks admin accountability.","nullable":true},{"name":"approval_notes","type":"string","description":"Admin comments on approval/rejection decision (max 500 characters). Explains approval reasoning or rejection justification.","nullable":true},{"name":"requested_at","type":"datetime","description":"Timestamp when seller submitted adjustment request. Marks beginning of approval workflow.","nullable":false},{"name":"approved_at","type":"datetime","description":"Timestamp when adjustment was approved and applied. Null if pending or rejected.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_seller_id","approval_status"]},{"fieldNames":["approval_status"]},{"fieldNames":["requested_at"]}],"ginIndexes":[]},{"name":"shopping_mall_low_stock_alerts","description":"Alerts triggered when SKU inventory falls below seller-configured reorder level threshold. Tracks alert generation, seller acknowledgment, and resolution status. Supports seller notifications and inventory management workflows. Enables inventory forecasting showing estimated days to stockout based on sales velocity. Helps prevent unexpected stock shortages.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_inventory_sku_id","type":"uuid","description":"Reference to SKU that triggered the low stock alert. {@link shopping_mall_inventory_skus.id}","relation":{"name":"sku","targetModel":"shopping_mall_inventory_skus"},"unique":false,"nullable":false}],"plainFields":[{"name":"alert_type","type":"string","description":"Type of alert: low_stock (below threshold but>0), out_of_stock (quantity=0), critical_stock (below 5 units). Differentiates severity of inventory situation.","nullable":false},{"name":"threshold_value","type":"int","description":"Reorder threshold that was breached to trigger this alert. Typically 10 units or seller-configured value. For reference to understand alert trigger.","nullable":false},{"name":"current_quantity","type":"int","description":"SKU quantity at time alert was triggered. Captures stock level context for alert history.","nullable":false},{"name":"status","type":"string","description":"Alert status: pending (new alert, not yet addressed), acknowledged (seller reviewed), resolved (inventory restocked/addressed). Tracks alert lifecycle.","nullable":false},{"name":"estimated_days_to_stockout","type":"int","description":"Forecast of days until inventory reaches zero based on recent sales velocity. Helps seller prioritize restocking urgency. Null if insufficient sales history.","nullable":true},{"name":"recent_sales_velocity","type":"double","description":"Average units sold per day in last 30 days. Used to calculate estimated_days_to_stockout. Null if insufficient sales history.","nullable":true},{"name":"alert_triggered_at","type":"datetime","description":"Timestamp when alert was generated and detected by system. Marks when stock fell below threshold.","nullable":false},{"name":"acknowledged_at","type":"datetime","description":"Timestamp when seller acknowledged/reviewed this alert. Null if still pending.","nullable":true},{"name":"resolved_at","type":"datetime","description":"Timestamp when alert was resolved (inventory was restocked or issue addressed). Null if still pending or acknowledged.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_inventory_sku_id","status"]},{"fieldNames":["status","alert_triggered_at"]},{"fieldNames":["alert_type"]}],"ginIndexes":[]},{"name":"shopping_mall_inventory_history","description":"Historical snapshots of SKU inventory quantities at point-in-time intervals for reporting and trend analysis. Complements transaction log with period summaries. Enables historical reporting, forecasting, and inventory trending analysis. Read-only archival data supporting business intelligence. Snapshot stance because records are immutable historical captures.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_inventory_sku_id","type":"uuid","description":"Reference to SKU for which this is a historical snapshot. {@link shopping_mall_inventory_skus.id}","relation":{"name":"sku","targetModel":"shopping_mall_inventory_skus"},"unique":false,"nullable":false}],"plainFields":[{"name":"current_quantity","type":"int","description":"SKU quantity at snapshot time. Captures point-in-time inventory level for historical tracking.","nullable":false},{"name":"reserved_quantity","type":"int","description":"SKU reserved quantity at snapshot time. Shows how much inventory was on hold for pending orders.","nullable":false},{"name":"available_quantity","type":"int","description":"Calculated available quantity at snapshot time (current - reserved). Shows actual sellable inventory at historical point.","nullable":false},{"name":"snapshot_period","type":"string","description":"Snapshot aggregation period: daily (once per day), weekly (once per week), monthly (once per month). Helps categorize history granularity.","nullable":false},{"name":"snapshot_date","type":"datetime","description":"Date (typically end of period) for which this snapshot was taken. For daily snapshots, represents that calendar day.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when this historical snapshot record was created/captured. Precise timing of when snapshot was recorded.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_inventory_sku_id","snapshot_date","snapshot_period"],"unique":true}],"plainIndexes":[{"fieldNames":["snapshot_date"]},{"fieldNames":["shopping_mall_inventory_sku_id","snapshot_date"]}],"ginIndexes":[]}]},{"filename":"schema-06-shopping.prisma","namespace":"Shopping","models":[{"name":"shopping_mall_shopping_carts","description":"Customer shopping carts representing temporary collections of items prepared for purchase. Each authenticated customer has at most one active cart at any given time. Carts track items the customer intends to buy in current session, with status lifecycle (active, abandoned, converted_to_order). Carts persist across sessions enabling interrupted shopping experiences. Related to {@link shopping_mall_customer.id}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"customer_id","type":"uuid","description":"Customer who owns this shopping cart. Reference to {@link shopping_mall_customer.id}.","relation":{"name":"customer","targetModel":"shopping_mall_customer"},"unique":false,"nullable":false}],"plainFields":[{"name":"status","type":"string","description":"Cart status lifecycle: 'active' (current shopping), 'abandoned' (inactive 30+ days), 'converted_to_order' (checkout completed). Tracks cart state for recovery campaigns and analytics.","nullable":false},{"name":"total_items","type":"int","description":"Denormalized count of items in cart (updated on item addition/removal) for quick dashboard display without joins. Should match sum of quantities in shopping_cart_items.","nullable":false},{"name":"subtotal_amount","type":"double","description":"Denormalized subtotal of all items (price × quantity per item, summed). Calculated from cart items but cached here for performance. In seller's currency.","nullable":false},{"name":"estimated_tax","type":"double","description":"Estimated tax based on current delivery address and product types. Recalculated when address changes or items added. Null if no address selected yet.","nullable":true},{"name":"estimated_shipping","type":"double","description":"Estimated shipping cost based on destination address and selected shipping method. Null if address or method not yet selected.","nullable":true},{"name":"promo_code","type":"string","description":"Applied promotional code if customer entered discount code. Null if no promo applied. Used to validate discount applicability.","nullable":true},{"name":"discount_amount","type":"double","description":"Discount amount from applied promo code or store credits. In seller's currency. Zero if no discount.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when cart was created. ISO 8601 format, UTC timezone.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when cart was last modified (item added/removed/quantity changed). ISO 8601 format, UTC timezone.","nullable":false},{"name":"abandoned_at","type":"datetime","description":"Timestamp when cart was marked as abandoned. Null while cart is active. Used for recovery campaign targeting.","nullable":true},{"name":"converted_to_order_id","type":"uuid","description":"If cart was converted to order, stores the resulting order ID for reference. Null for active/abandoned carts. Enables tracking cart→order conversion.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["status"]},{"fieldNames":["created_at"]},{"fieldNames":["updated_at"]},{"fieldNames":["customer_id","status"]}],"ginIndexes":[]},{"name":"shopping_mall_shopping_cart_items","description":"Individual items within a shopping cart. Each cart item represents one product variant (SKU) at a specific quantity with price snapshot. Items store prices at addition time to prevent price-change surprises during shopping. Multiple cart items can reference same SKU from different customers. Related to {@link shopping_mall_shopping_carts.id} and {@link shopping_mall_product_variants.id}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_cart_id","type":"uuid","description":"Shopping cart this item belongs to. Reference to {@link shopping_mall_shopping_carts.id}.","relation":{"name":"shoppingCart","targetModel":"shopping_mall_shopping_carts"},"unique":false,"nullable":false},{"name":"product_variant_id","type":"uuid","description":"Product variant (SKU) being added to cart. Reference to {@link shopping_mall_product_variants.id}.","relation":{"name":"productVariant","targetModel":"shopping_mall_product_variants"},"unique":false,"nullable":false}],"plainFields":[{"name":"quantity","type":"int","description":"Number of units of this SKU in the cart. Must be positive integer (1-999 per business rules). Customer can adjust this value.","nullable":false},{"name":"unit_price_snapshot","type":"double","description":"Price of one unit at time item was added to cart. Captured for historical accuracy - prevents price increase surprises. In seller's currency.","nullable":false},{"name":"line_total","type":"double","description":"Total for this line item (unit_price_snapshot × quantity). Calculated at addition, may differ from current price if product price changed.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when item was added to cart. ISO 8601 format, UTC timezone.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when item details were last modified (quantity changed). ISO 8601 format, UTC timezone.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["product_variant_id"]},{"fieldNames":["shopping_cart_id","product_variant_id"]},{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_wishlists","description":"Customer wishlists for saving products to review later. Each customer can create multiple wishlists (e.g., 'Birthday Gift Ideas', 'Home Decor', 'Tech Wishlist'). Wishlists persist indefinitely enabling long-term shopping plans and price tracking. Unlike carts, wishlists don't convert to orders but rather customers add items from wishlist to cart. Related to {@link shopping_mall_customer.id}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"customer_id","type":"uuid","description":"Customer who owns this wishlist. Reference to {@link shopping_mall_customer.id}.","relation":{"name":"customer","targetModel":"shopping_mall_customer"},"unique":false,"nullable":false}],"plainFields":[{"name":"name","type":"string","description":"Display name for wishlist provided by customer. Examples: 'Birthday Ideas', 'Home Decor', 'Tech Gadgets'. Max 100 characters.","nullable":false},{"name":"description","type":"string","description":"Optional description of wishlist purpose. Max 500 characters. Helps customer remember what this wishlist is for.","nullable":true},{"name":"is_public","type":"boolean","description":"Whether this wishlist is publicly shareable with others or private to customer only. True = shareable link generated, false = private.","nullable":false},{"name":"total_items","type":"int","description":"Denormalized count of items in wishlist for quick display. Should match count in wishlist_items table.","nullable":false},{"name":"total_value","type":"double","description":"Denormalized sum of current prices of all items in wishlist. Used to show customer total value of saved items.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when wishlist was created. ISO 8601 format, UTC timezone.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when wishlist was last modified (item added/removed). ISO 8601 format, UTC timezone.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["is_public"]},{"fieldNames":["created_at"]},{"fieldNames":["customer_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_wishlist_items","description":"Individual items saved in a wishlist. Each wishlist item represents one product variant (SKU) customer wants to track. Unlike cart items, wishlist items don't have quantity (one per item - customer can add to cart with desired quantity later). Stores price history to track if item is on sale. Related to {@link shopping_mall_wishlists.id} and {@link shopping_mall_product_variants.id}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"wishlist_id","type":"uuid","description":"Wishlist this item belongs to. Reference to {@link shopping_mall_wishlists.id}.","relation":{"name":"wishlist","targetModel":"shopping_mall_wishlists"},"unique":false,"nullable":false},{"name":"product_variant_id","type":"uuid","description":"Product variant (SKU) saved in wishlist. Reference to {@link shopping_mall_product_variants.id}.","relation":{"name":"productVariant","targetModel":"shopping_mall_product_variants"},"unique":false,"nullable":false}],"plainFields":[{"name":"price_when_added","type":"double","description":"Price of product when customer added it to wishlist. Stored to track price changes - enables 'item on sale' notifications. In seller's currency.","nullable":false},{"name":"priority","type":"string","description":"Wishlist item priority: 'low', 'medium', 'high'. Allows customer to mark must-have items. Helps with gift registry use cases.","nullable":false},{"name":"customer_notes","type":"string","description":"Personal notes customer can add about why they saved this item. Max 500 characters. Examples: 'Color preference: Blue', 'Size: Large'.","nullable":true},{"name":"price_drop_notified","type":"boolean","description":"Whether customer has already been notified about a price drop on this item. Prevents duplicate notifications.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when item was added to wishlist. ISO 8601 format, UTC timezone.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when wishlist item was last modified (notes changed, priority changed). ISO 8601 format, UTC timezone.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["product_variant_id"]},{"fieldNames":["wishlist_id","product_variant_id"]},{"fieldNames":["priority"]},{"fieldNames":["created_at"]}],"ginIndexes":[]}]},{"filename":"schema-07-orders.prisma","namespace":"Orders","models":[{"name":"shopping_mall_orders","description":"Main order records capturing complete customer purchases with transactional context. Each order represents a committed transaction from a customer containing one or more items from potentially multiple sellers. Orders maintain immutable pricing snapshots and track complete lifecycle from creation through fulfillment or cancellation. Central hub linking customers to their purchases with complete billing and shipping information.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Owned customer's {@link shopping_mall_customer.id}","relation":{"name":"customer","targetModel":"shopping_mall_customer"},"unique":false,"nullable":false},{"name":"shopping_mall_payment_id","type":"uuid","description":"Associated payment transaction's {@link shopping_mall_payments.id}","relation":{"name":"payment","targetModel":"shopping_mall_payments"},"unique":true,"nullable":true}],"plainFields":[{"name":"order_number","type":"string","description":"Human-readable order number in format ORD-YYYYMMDD-XXXXXX for customer reference. Unique identifier visible to customer.","nullable":false},{"name":"order_status","type":"string","description":"Current order lifecycle status: PENDING (awaiting payment), CONFIRMED (payment received), PROCESSING (seller preparing), SHIPPED (handed to carrier), DELIVERED (received by customer), COMPLETED (order finalized), CANCELLED (cancelled), RETURNED (return processed). Immutable status history maintained in order_status_history table.","nullable":false},{"name":"payment_status","type":"string","description":"Payment status: PENDING (awaiting payment processing), COMPLETED (payment received and captured), FAILED (payment declined/failed), REFUNDED (refund issued). Tracks payment lifecycle independent of order status.","nullable":false},{"name":"shipping_status","type":"string","description":"Shipping/fulfillment status: NOT_SHIPPED (not yet sent), IN_TRANSIT (with carrier), DELIVERED (confirmed delivery), EXCEPTION (delivery issue). Updated from shipment tracking.","nullable":false},{"name":"subtotal","type":"double","description":"Calculated sum of all order items (unit_price × quantity for each item). Excludes taxes and shipping. Snapshot value at order time.","nullable":false},{"name":"tax_amount","type":"double","description":"Calculated tax amount based on delivery address jurisdiction and applicable tax rate. Immutable snapshot at order confirmation time.","nullable":false},{"name":"tax_rate","type":"double","description":"Tax rate percentage applied to this order (e.g., 0.08 for 8%). Stored for historical accuracy and audit purposes.","nullable":false},{"name":"shipping_cost","type":"double","description":"Selected shipping method cost. Calculated based on destination, weight, and shipping method selected by customer. Immutable after confirmation.","nullable":false},{"name":"shipping_method","type":"string","description":"Selected shipping method name: Standard (5-7 days), Express (2-3 days), Overnight (1 day), Same-Day (same day for local), Economy (7-14 days). Determines delivery timeline and cost.","nullable":false},{"name":"discount_amount","type":"double","description":"Total discount amount applied from promotional codes or platform promotions. Snapshot value at order confirmation. Stored for financial reporting and audit.","nullable":false},{"name":"total_amount","type":"double","description":"Final order total: subtotal + tax + shipping - discount. This is the amount charged to customer. Immutable after payment confirmation for billing accuracy.","nullable":false},{"name":"delivery_address","type":"string","description":"Complete delivery address in JSON format captured at order time: {street, city, state, zip, country, recipient_name, phone}. Immutable snapshot ensures historical accuracy if customer changes address later.","nullable":false},{"name":"billing_address","type":"string","description":"Complete billing address in JSON format captured at order time. May differ from delivery address. Used for payment processing and verification.","nullable":false},{"name":"customer_email","type":"string","description":"Customer email address at time of order (snapshot). Ensures confirmation emails can be sent even if customer updates email later.","nullable":false},{"name":"customer_phone","type":"string","description":"Customer phone number at time of order (snapshot). Used for shipping coordination if needed.","nullable":true},{"name":"order_notes","type":"string","description":"Internal platform notes about order for admin/support. Limited to 500 characters. Examples: special handling, customer service issues, fulfillment notes.","nullable":true},{"name":"created_at","type":"datetime","description":"Order creation timestamp in ISO 8601 UTC. Marks when customer initiated checkout and order was created in PENDING status.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last modification timestamp. Updated when order status changes, payment confirmed, or administrative updates occur.","nullable":false},{"name":"confirmed_at","type":"datetime","description":"Timestamp when payment was successfully confirmed and order transitioned to CONFIRMED status. Null until payment completes.","nullable":true},{"name":"cancelled_at","type":"datetime","description":"Timestamp when order was cancelled. Null for non-cancelled orders. Set when order transitions to CANCELLED status.","nullable":true},{"name":"refund_status","type":"string","description":"Refund status if applicable: NO_REFUND (no refund needed), PENDING (refund requested but not processed), PROCESSING (refund in progress), COMPLETED (refund issued), REJECTED (refund denied). Tracks refund lifecycle separate from order status.","nullable":false}],"uniqueIndexes":[{"fieldNames":["order_number"],"unique":true}],"plainIndexes":[{"fieldNames":["payment_status"]},{"fieldNames":["created_at"]},{"fieldNames":["shopping_mall_customer_id","created_at"]},{"fieldNames":["order_status","created_at"]}],"ginIndexes":[{"fieldName":"order_notes"}]},{"name":"shopping_mall_order_items","description":"Line items within orders representing individual products with quantities and pricing. Each order contains one or more items which may be from different sellers. Items capture immutable price snapshots at order time ensuring billing accuracy. Items are managed exclusively through parent order operations and represent the detailed product composition of each purchase.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Parent order's {@link shopping_mall_orders.id}","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false},{"name":"shopping_mall_product_variant_id","type":"uuid","description":"SKU variant's {@link shopping_mall_product_variants.id}","relation":{"name":"productVariant","targetModel":"shopping_mall_product_variants"},"unique":false,"nullable":false},{"name":"shopping_mall_seller_id","type":"uuid","description":"Seller owning this product's {@link shopping_mall_seller.id}","relation":{"name":"seller","targetModel":"shopping_mall_seller"},"unique":false,"nullable":false}],"plainFields":[{"name":"product_name","type":"string","description":"Product name snapshot at order time. Captured immutably so order displays original product name even if seller updates name later.","nullable":false},{"name":"variant_details","type":"string","description":"Variant details JSON snapshot: {color, size, material, other_options}. Documents exact variant customer ordered (e.g., 'Blue, Size M, Cotton').","nullable":false},{"name":"unit_price","type":"double","description":"Price per unit at time of order (immutable snapshot). This is the price charged, not affected by any later price changes by seller.","nullable":false},{"name":"quantity","type":"int","description":"Number of units ordered for this line item. Positive integer between 1 and 999.","nullable":false},{"name":"line_total","type":"double","description":"Line item total: unit_price × quantity (immutable). Pre-calculated and stored for quick access and audit trail.","nullable":false},{"name":"item_status","type":"string","description":"Individual item fulfillment status within order: PENDING (awaiting fulfillment), PROCESSING (seller preparing), SHIPPED (shipped), DELIVERED (received), CANCELLED (item cancelled), RETURNED (returned by customer). Enables per-item tracking in multi-seller orders.","nullable":false},{"name":"created_at","type":"datetime","description":"Line item creation timestamp. Same as parent order creation time (set when order is created).","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_product_variant_id"]},{"fieldNames":["shopping_mall_seller_id"]},{"fieldNames":["shopping_mall_order_id","item_status"]}],"ginIndexes":[{"fieldName":"product_name"},{"fieldName":"variant_details"}]},{"name":"shopping_mall_order_status_history","description":"Audit trail capturing every order status transition with complete metadata for compliance and troubleshooting. Each record documents when and why order status changed, who made the change, and supporting notes. Implements snapshot pattern for historical accuracy - append-only records never modified after creation. Essential for dispute resolution, SLA tracking, and operational auditing.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Order being tracked's {@link shopping_mall_orders.id}","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false}],"plainFields":[{"name":"status_from","type":"string","description":"Previous order status before this transition (e.g., PENDING, CONFIRMED, PROCESSING). Documents the state being transitioned from.","nullable":false},{"name":"status_to","type":"string","description":"New order status after this transition (e.g., CONFIRMED, PROCESSING, SHIPPED). Documents the new state being entered.","nullable":false},{"name":"changed_by","type":"string","description":"Identifier of who triggered the status change: admin_user_id, seller_id, system, customer. Tracks origin of status change for audit.","nullable":false},{"name":"changed_by_type","type":"string","description":"Type of entity making the change: ADMIN, SELLER, SYSTEM, CUSTOMER. Helps identify source of change for auditing.","nullable":false},{"name":"reason","type":"string","description":"Explanation for the status change. Examples: 'Payment received', 'Seller accepted order', 'Customer cancelled', 'Delivery confirmed'. Limited to 500 characters.","nullable":true},{"name":"admin_notes","type":"string","description":"Internal admin notes about this status change. Used for documenting special circumstances or operational decisions. Limited to 1000 characters.","nullable":true},{"name":"ip_address","type":"string","description":"IP address of the entity making the change. Used for security audit trail. Can be null for system-generated changes.","nullable":true},{"name":"user_agent","type":"string","description":"User agent/device info for the entity making the change. Helps track which system/device initiated change.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when status transition occurred. Records exact moment of change for audit trail.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["created_at"]},{"fieldNames":["shopping_mall_order_id","created_at"]}],"ginIndexes":[{"fieldName":"reason"},{"fieldName":"admin_notes"}]},{"name":"shopping_mall_order_notes","description":"Flexible note system for operational and administrative communication about orders. Captures notes from sellers, customers, and admins with visibility controls determining who can see each note. Enables tracking of special requests, fulfillment issues, customer service interactions, and internal coordination. Notes are append-only (not edited after creation) for audit trail integrity.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Associated order's {@link shopping_mall_orders.id}","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false}],"plainFields":[{"name":"note_type","type":"string","description":"Type of note: INTERNAL_ADMIN (admin-only internal notes), CUSTOMER_VISIBLE (customer can see on order), SELLER_NOTE (seller-to-admin communication), CUSTOMER_REQUEST (customer-provided special requests). Determines visibility and context.","nullable":false},{"name":"content","type":"string","description":"Note text content. Maximum 5000 characters. Examples: special delivery instructions, customer service issues, fulfillment coordination, operational notes.","nullable":false},{"name":"created_by","type":"string","description":"Identifier of who created the note: admin_id, seller_id, customer_id, or 'system'. Tracks origin for audit.","nullable":false},{"name":"created_by_type","type":"string","description":"Type of creator: ADMIN, SELLER, CUSTOMER, SYSTEM. Indicates role of person/system creating the note.","nullable":false},{"name":"visibility_scope","type":"string","description":"Who can view this note: ADMIN_ONLY (admin and support staff), SELLER_ONLY (seller and admin), CUSTOMER_VISIBLE (customer, seller, and admin), INTERNAL (all internal parties). Controls access per business rules.","nullable":false},{"name":"created_at","type":"datetime","description":"Note creation timestamp. Immutable - notes have permanent creation time.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_order_id"]},{"fieldNames":["created_at"]},{"fieldNames":["note_type"]}],"ginIndexes":[{"fieldName":"content"}]},{"name":"shopping_mall_order_timestamps","description":"Complete lifecycle timestamps for order tracking and SLA management. Captures all significant temporal events in order progression from creation through fulfillment or cancellation. Separates timestamp concerns from main orders table for clarity and enables efficient timeline queries. All timestamps stored in UTC ISO 8601 format. Implements 1:1 relationship with shopping_mall_orders enabling optional addition without polluting main table.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Corresponding order's {@link shopping_mall_orders.id}","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":true,"nullable":false}],"plainFields":[{"name":"created_at","type":"datetime","description":"Order creation timestamp. When order was first placed in PENDING status. Marks start of order lifecycle.","nullable":false},{"name":"confirmed_at","type":"datetime","description":"Payment confirmation timestamp. When payment was successfully processed and order transitioned to CONFIRMED status. Null until payment completes.","nullable":true},{"name":"processing_started_at","type":"datetime","description":"Fulfillment start timestamp. When seller marked order as PROCESSING and began preparing items. Null until seller begins fulfillment.","nullable":true},{"name":"shipped_at","type":"datetime","description":"Shipment timestamp. When seller provided tracking number and order transitioned to SHIPPED status. Marks handoff to carrier.","nullable":true},{"name":"delivered_at","type":"datetime","description":"Delivery confirmation timestamp. When carrier confirmed delivery and order transitioned to DELIVERED status. Marks customer receipt.","nullable":true},{"name":"completed_at","type":"datetime","description":"Order completion timestamp. When order transitioned to COMPLETED status, typically 7 days after delivery when return window closes. Marks end of active order lifecycle.","nullable":true},{"name":"cancelled_at","type":"datetime","description":"Cancellation timestamp. When order was cancelled and transitioned to CANCELLED status. Null for non-cancelled orders.","nullable":true},{"name":"refunded_at","type":"datetime","description":"Refund completion timestamp. When refund was successfully processed and paid to customer. Null if no refund occurred.","nullable":true},{"name":"last_updated_at","type":"datetime","description":"Last status update timestamp. Most recent timestamp when any order event occurred. Used for identifying recently active orders.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_order_id"],"unique":true}],"plainIndexes":[{"fieldNames":["created_at"]},{"fieldNames":["delivered_at"]},{"fieldNames":["last_updated_at"]}],"ginIndexes":[]}]},{"filename":"schema-08-payments.prisma","namespace":"Payments","models":[{"name":"shopping_mall_payments","description":"Main payment records for customer orders. Stores complete payment information including payment method, amount, status, and order reference. Serves as the primary transaction record for all customer payments processed through the platform. Links each payment to a specific order and customer for financial tracking and reconciliation.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Customer making the payment. References {@link shopping_mall_customer.id}.","relation":{"name":"customer","targetModel":"shopping_mall_customer"},"unique":false,"nullable":false},{"name":"shopping_mall_payment_method_id","type":"uuid","description":"Payment method used for this payment. References {@link shopping_mall_payment_methods.id}.","relation":{"name":"paymentMethod","targetModel":"shopping_mall_payment_methods"},"unique":false,"nullable":false}],"plainFields":[{"name":"amount","type":"double","description":"Amount charged to customer in smallest currency unit (e.g., cents for USD). Must match order total exactly with no variance.","nullable":false},{"name":"currency_code","type":"string","description":"ISO 4217 currency code for payment (e.g., USD, EUR, GBP). Must match order currency code.","nullable":false},{"name":"payment_status","type":"string","description":"Current payment status: PENDING (awaiting processing), COMPLETED (successfully charged), FAILED (declined or error), REFUNDED (money returned), DISPUTED (chargeback filed). Status transitions are: PENDING → COMPLETED|FAILED, COMPLETED → REFUNDED|DISPUTED.","nullable":false},{"name":"payment_method_type","type":"string","description":"Type of payment method: CREDIT_CARD (Visa, Mastercard, etc.), DEBIT_CARD, DIGITAL_WALLET (Apple Pay, Google Pay), BANK_TRANSFER. Snapshot of method type at time of payment.","nullable":false},{"name":"settlement_status","type":"string","description":"Settlement status with payment processor: NOT_SETTLED (awaiting batch settlement), SETTLED (funds received by merchant), DISPUTED (funds held due to chargeback), CHARGEDBACK (customer won dispute). Tracks fund availability.","nullable":false},{"name":"error_code","type":"string","description":"Payment processor error code if payment failed. Examples: INSUFFICIENT_FUNDS, CARD_EXPIRED, FRAUD_DETECTED, NETWORK_ERROR. Null for successful payments.","nullable":true},{"name":"error_message","type":"string","description":"Human-readable error message from payment gateway if payment failed. For customer communication and troubleshooting.","nullable":true},{"name":"idempotency_key","type":"string","description":"Unique idempotency key to prevent duplicate charge attempts. Combines order ID, customer ID, and timestamp. Used to detect and reject duplicate payment submissions.","nullable":true},{"name":"attempts","type":"int","description":"Number of payment processing attempts made for this order. Starts at 1. Incremented on automatic retry. Helps identify problematic payments requiring manual review.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when payment record was created (payment initiated by customer).","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp of last payment status update.","nullable":false},{"name":"completed_at","type":"datetime","description":"Timestamp when payment was successfully completed or finally failed. Null until payment reaches terminal state.","nullable":true},{"name":"settled_at","type":"datetime","description":"Timestamp when payment settlement was confirmed by payment processor. Null until funds are actually received.","nullable":true},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp. Null for active records. Set when payment is archived (no longer needed for active operations).","nullable":true}],"uniqueIndexes":[{"fieldNames":["idempotency_key"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_payment_method_id"]},{"fieldNames":["payment_status"]},{"fieldNames":["settlement_status"]},{"fieldNames":["created_at"]},{"fieldNames":["shopping_mall_customer_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_payment_transactions","description":"Individual transaction records for each payment processing attempt. Multiple transactions can exist per payment if retry logic is triggered. Each transaction captures complete request/response details with payment gateway including authorization codes, processor references, and all transaction metadata. Supports payment reconciliation and transaction tracking.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_payment_id","type":"uuid","description":"Reference to parent payment record. Links this transaction to {@link shopping_mall_payments.id}.","relation":{"name":"payment","targetModel":"shopping_mall_payments"},"unique":false,"nullable":false},{"name":"shopping_mall_payment_gateway_record_id","type":"uuid","description":"Reference to payment gateway record with external processor details. Links to {@link shopping_mall_payment_gateway_records.id}.","relation":{"name":"gatewayRecord","targetModel":"shopping_mall_payment_gateway_records"},"unique":false,"nullable":true}],"plainFields":[{"name":"transaction_sequence","type":"int","description":"Sequence number of this transaction attempt (1 for first attempt, 2 for first retry, etc.). Helps identify transaction history and retry attempts.","nullable":false},{"name":"transaction_type","type":"string","description":"Type of transaction: AUTHORIZATION (card authorization), CAPTURE (fund capture), REFUND (refund processing), VOID (cancellation). Tracks transaction purpose.","nullable":false},{"name":"amount","type":"double","description":"Amount involved in this specific transaction in smallest currency unit. May differ from parent payment amount if partial transaction.","nullable":false},{"name":"transaction_status","type":"string","description":"Transaction status: SUBMITTED (sent to gateway), PROCESSING (gateway processing), APPROVED (gateway approved), DECLINED (gateway declined), ERROR (technical error), TIMEOUT (no response received within timeout period).","nullable":false},{"name":"gateway_response_code","type":"string","description":"Code returned by payment gateway (e.g., 00 for approval, 05 for declined). Specific to payment processor used.","nullable":true},{"name":"gateway_response_message","type":"string","description":"Message returned by payment gateway describing transaction result. May be error description or success confirmation.","nullable":true},{"name":"authorization_code","type":"string","description":"Authorization code from payment processor for approved transactions. Used for settlement and reconciliation. Null for declined/error transactions.","nullable":true},{"name":"processor_transaction_id","type":"string","description":"Unique transaction identifier assigned by payment processor. Used for dispute investigation and transaction lookup with payment provider.","nullable":true},{"name":"avs_result_code","type":"string","description":"Address Verification System result code from processor. Examples: M (match), N (no match), U (unavailable). Used for fraud detection.","nullable":true},{"name":"cvv_result_code","type":"string","description":"CVV verification result code from processor. M (match), N (no match), U (unavailable). Used for fraud detection.","nullable":true},{"name":"request_ip_address","type":"string","description":"Customer's IP address when payment was submitted. Used for fraud detection and geographic verification.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when transaction was submitted to payment gateway.","nullable":false},{"name":"response_received_at","type":"datetime","description":"Timestamp when response was received from payment gateway. Null if no response (timeout).","nullable":true},{"name":"processing_duration_ms","type":"int","description":"Time in milliseconds from submission to response received. Null if timeout. Used for performance monitoring.","nullable":true}],"uniqueIndexes":[{"fieldNames":["processor_transaction_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_payment_id"]},{"fieldNames":["shopping_mall_payment_gateway_record_id"]},{"fieldNames":["transaction_status"]},{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_payment_methods","description":"Secure storage of payment method information including tokenized card data, digital wallet references, and bank account details. Implements PCI-DSS compliance by storing only card tokens (never full card numbers), last 4 digits, card brand, and issuer information. Supports multiple payment method types: credit cards, debit cards, digital wallets, and bank transfers. Each payment method is tied to a customer for future reference and recurring payments.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Customer who owns this payment method. References {@link shopping_mall_customer.id}.","relation":{"name":"customer","targetModel":"shopping_mall_customer"},"unique":false,"nullable":false}],"plainFields":[{"name":"payment_method_type","type":"string","description":"Type of payment method: CREDIT_CARD, DEBIT_CARD, DIGITAL_WALLET (Apple Pay, Google Pay), BANK_TRANSFER. Determines which fields are populated.","nullable":false},{"name":"card_token","type":"string","description":"Tokenized card data from payment gateway. PCI-compliant - replaces full card number. Never contains full 16-digit card number. Null for bank transfer methods.","nullable":true},{"name":"card_last_four","type":"string","description":"Last 4 digits of card number for customer reference and verification (e.g., 4242). Used for displaying card in UI. Null for non-card methods.","nullable":true},{"name":"card_brand","type":"string","description":"Card brand/network: VISA, MASTERCARD, AMEX, DISCOVER, DINERS, JCB, etc. Null for non-card methods. Used for displaying payment option.","nullable":true},{"name":"card_issuer","type":"string","description":"Issuing bank or financial institution name (e.g., Bank of America, Chase). Optional for customer reference. Null if not available.","nullable":true},{"name":"card_expiration_month","type":"int","description":"Card expiration month (1-12). Must be validated at each payment attempt. Null for non-card methods.","nullable":true},{"name":"card_expiration_year","type":"int","description":"Card expiration year (e.g., 2025). Used to validate card hasn't expired. Null for non-card methods.","nullable":true},{"name":"cardholder_name","type":"string","description":"Name on the card as it appears. Used for validation. Null for non-card methods.","nullable":true},{"name":"wallet_provider","type":"string","description":"Digital wallet provider name: APPLE_PAY, GOOGLE_PAY, PAYPAL, etc. Null for card/bank methods.","nullable":true},{"name":"wallet_token","type":"string","description":"Token received from digital wallet provider. Used for payment processing. Null for non-wallet methods.","nullable":true},{"name":"bank_account_token","type":"string","description":"Tokenized bank account from gateway for bank transfers. PCI-compliant alternative to storing full account numbers. Null for non-bank methods.","nullable":true},{"name":"bank_account_last_four","type":"string","description":"Last 4 digits of bank account number for customer reference. Null for non-bank methods.","nullable":true},{"name":"bank_routing_number_last_four","type":"string","description":"Last 4 digits of routing number for bank transfers. For customer reference only. Null for non-bank methods.","nullable":true},{"name":"bank_name","type":"string","description":"Bank name associated with bank transfer method. Null for non-bank methods.","nullable":true},{"name":"is_default","type":"boolean","description":"Whether this is customer's default payment method. Used for checkout default selection. Only one method per customer should have is_default=true.","nullable":false},{"name":"is_active","type":"boolean","description":"Whether this payment method is currently active and available for use. Set to false if customer reports the method as invalid or compromised.","nullable":false},{"name":"failed_attempts","type":"int","description":"Count of consecutive failed payment attempts using this method. Reset to 0 on successful payment. Incremented on failures. Helps identify problematic payment methods.","nullable":false},{"name":"last_used_at","type":"datetime","description":"Timestamp of last successful payment using this method. Null if never successfully used. Used to identify stale/forgotten payment methods.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when payment method was added to customer's account.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when payment method details were last updated (e.g., card reactivated).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp. Set when customer removes payment method. Preserves payment history.","nullable":true}],"uniqueIndexes":[{"fieldNames":["card_token"],"unique":true},{"fieldNames":["wallet_token"],"unique":true},{"fieldNames":["bank_account_token"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_customer_id"]},{"fieldNames":["payment_method_type"]},{"fieldNames":["is_active"]},{"fieldNames":["last_used_at"]}],"ginIndexes":[]},{"name":"shopping_mall_payment_gateway_records","description":"Records of all requests sent to and responses received from external payment gateway providers (e.g., Stripe, PayPal). Captures complete request/response payloads for troubleshooting, reconciliation, and audit purposes. Implements PCI compliance by not storing sensitive card data. Enables investigation of gateway issues and payment discrepancies. Each record represents one complete interaction with payment provider.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_payment_id","type":"uuid","description":"Reference to payment record for this gateway interaction. Links to {@link shopping_mall_payments.id}.","relation":{"name":"payment","targetModel":"shopping_mall_payments"},"unique":false,"nullable":false}],"plainFields":[{"name":"gateway_provider","type":"string","description":"Name of payment gateway provider: STRIPE, PAYPAL, SQUARE, AUTHORIZE_NET, etc. Identifies which processor this record is for.","nullable":false},{"name":"gateway_api_version","type":"string","description":"API version of payment gateway used for this request (e.g., v1, v2). Helps track compatibility issues across gateway versions.","nullable":true},{"name":"request_id","type":"string","description":"Unique request identifier generated by platform for request tracking. Used to correlate requests across systems.","nullable":false},{"name":"gateway_request_id","type":"string","description":"Request ID assigned by payment gateway provider. May be null if request never reached gateway (network error).","nullable":true},{"name":"request_type","type":"string","description":"Type of gateway request: AUTHORIZATION, CAPTURE, REFUND, VOID, INQUIRY, CHARGEBACK_INQUIRY. Determines request payload structure.","nullable":false},{"name":"request_payload","type":"string","description":"Complete JSON request payload sent to payment gateway. IMPORTANT: Sensitive data (full card numbers, CVV) must be masked or not included. Format: sanitized JSON string.","nullable":false},{"name":"response_payload","type":"string","description":"Complete JSON response payload received from payment gateway. Contains transaction result, error codes, authorization codes, processor references. Format: JSON string.","nullable":true},{"name":"response_status_code","type":"int","description":"HTTP status code from gateway: 200 (success), 400 (bad request), 401 (unauthorized), 500 (server error). Helps identify gateway communication issues.","nullable":true},{"name":"response_received","type":"boolean","description":"Whether response was successfully received from gateway. False indicates timeout or network failure. True means HTTP response received (may still indicate transaction decline).","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when request was submitted to payment gateway.","nullable":false},{"name":"response_received_at","type":"datetime","description":"Timestamp when response was received from gateway. Null if request timed out or never reached gateway.","nullable":true}],"uniqueIndexes":[{"fieldNames":["request_id"],"unique":true},{"fieldNames":["gateway_request_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_payment_id"]},{"fieldNames":["gateway_provider"]},{"fieldNames":["request_type"]},{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_payment_refunds","description":"Records of refund requests and refund processing for customer orders. Tracks complete refund lifecycle from request submission through refund completion. Supports full refunds (entire order amount) and partial refunds (specific line items). Records refund approvals, denials, reversals, and completion status. Links to original payment for reversal operations. Enables tracking of refund status including estimated arrival date for customer communication.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_payment_id","type":"uuid","description":"Reference to original payment being refunded. Links to {@link shopping_mall_payments.id}.","relation":{"name":"payment","targetModel":"shopping_mall_payments"},"unique":false,"nullable":false},{"name":"shopping_mall_order_id","type":"uuid","description":"Reference to the order for which refund is being processed. Links to {@link shopping_mall_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false},{"name":"requested_by_admin_id","type":"uuid","description":"Admin user who requested or approved the refund (if admin-initiated). References {@link shopping_mall_admin.id}. Null if customer-initiated refund.","relation":{"name":"requestedByAdmin","targetModel":"shopping_mall_admin"},"unique":false,"nullable":true}],"plainFields":[{"name":"refund_amount","type":"double","description":"Amount to be refunded in smallest currency unit. May be less than original payment amount for partial refunds.","nullable":false},{"name":"original_payment_amount","type":"double","description":"Original payment amount for reference. Used to validate partial vs full refund.","nullable":false},{"name":"refund_status","type":"string","description":"Current refund status: REQUESTED (awaiting approval), APPROVED (admin approved, awaiting processing), PROCESSING (refund submitted to gateway), COMPLETED (refund successfully processed), FAILED (refund attempt failed), REVERSED (refund was reversed/cancelled). Status progression: REQUESTED → APPROVED → PROCESSING → COMPLETED|FAILED.","nullable":false},{"name":"refund_reason","type":"string","description":"Reason for refund: CUSTOMER_REQUEST, PRODUCT_DEFECTIVE, PRODUCT_NOT_AS_DESCRIBED, WRONG_ITEM_SHIPPED, DAMAGED_IN_TRANSIT, DUPLICATE_CHARGE, FRAUD, PAYMENT_ERROR, SELLER_FRAUD, ORDER_CANCELLED, RETURN_RECEIVED. Used for analytics and dispute handling.","nullable":false},{"name":"refund_method","type":"string","description":"How refund will be issued: ORIGINAL_METHOD (back to original card/payment method), STORE_CREDIT (account credit), WALLET (digital wallet). ORIGINAL_METHOD is default if payment method supports reversal.","nullable":false},{"name":"is_full_refund","type":"boolean","description":"Whether this is full refund of entire order (true) or partial refund of specific items (false). Affects eligibility checks and processing.","nullable":false},{"name":"affected_order_items","type":"string","description":"For partial refunds, JSON array of order item IDs being refunded. Format: [\"item_id_1\", \"item_id_2\"]. Empty array for full refund. Used to calculate proportional tax and shipping.","nullable":true},{"name":"notes","type":"string","description":"Admin or system notes about the refund request. May include reason clarifications, dispute details, or special handling instructions.","nullable":true},{"name":"gateway_refund_id","type":"string","description":"Refund transaction ID assigned by payment gateway after processing. Used for tracking with payment provider and reconciliation.","nullable":true},{"name":"requested_at","type":"datetime","description":"Timestamp when refund was requested (by customer or admin).","nullable":false},{"name":"approved_at","type":"datetime","description":"Timestamp when refund was approved by admin or automatically approved based on policy. Null until approval occurs.","nullable":true},{"name":"processing_started_at","type":"datetime","description":"Timestamp when refund processing began (submitted to payment gateway). Null until processing starts.","nullable":true},{"name":"completed_at","type":"datetime","description":"Timestamp when refund was completed successfully. Funds have been returned to customer. Null until completion.","nullable":true},{"name":"estimated_completion_date","type":"datetime","description":"Estimated date refund will appear in customer's account. Typically 3-7 business days for card refunds. Used for customer communication.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when refund record was created in system.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when refund record was last updated.","nullable":false}],"uniqueIndexes":[{"fieldNames":["gateway_refund_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_payment_id"]},{"fieldNames":["shopping_mall_order_id"]},{"fieldNames":["refund_status"]},{"fieldNames":["requested_at"]},{"fieldNames":["completed_at"]}],"ginIndexes":[]},{"name":"shopping_mall_payment_disputes","description":"Records of payment disputes and chargebacks filed by customers or payment processors. Tracks dispute lifecycle from initial filing through investigation and final resolution. Supports multiple dispute types: chargeback (card processor initiated), payment complaint (customer initiated), fraud claim (security concern). Records all evidence, communications, and resolution details. Links to payment and includes admin investigation tracking for fair resolution of payment conflicts.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_payment_id","type":"uuid","description":"Reference to payment under dispute. Links to {@link shopping_mall_payments.id}.","relation":{"name":"payment","targetModel":"shopping_mall_payments"},"unique":false,"nullable":false},{"name":"shopping_mall_order_id","type":"uuid","description":"Reference to order associated with disputed payment. Links to {@link shopping_mall_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false},{"name":"investigating_admin_id","type":"uuid","description":"Admin assigned to investigate this dispute. References {@link shopping_mall_admin.id}. Null if dispute not yet assigned.","relation":{"name":"investigatingAdmin","targetModel":"shopping_mall_admin"},"unique":false,"nullable":true}],"plainFields":[{"name":"dispute_type","type":"string","description":"Type of dispute: CHARGEBACK (card processor), FRAUD_CLAIM (security concern), CUSTOMER_COMPLAINT (customer filed), PAYMENT_ERROR (system/gateway error). Determines investigation approach.","nullable":false},{"name":"dispute_status","type":"string","description":"Current dispute status: OPEN (filed, awaiting investigation), INVESTIGATING (admin reviewing evidence), PENDING_RESOLUTION (awaiting final decision), RESOLVED (decision made - customer wins, merchant wins, or partial), APPEALING (one party appealed). Progression: OPEN → INVESTIGATING → PENDING_RESOLUTION → RESOLVED|APPEALING.","nullable":false},{"name":"dispute_amount","type":"double","description":"Amount in dispute in smallest currency unit. May be less than full payment amount.","nullable":false},{"name":"customer_complaint","type":"string","description":"Customer's description of the dispute issue. Null for chargebacks initiated by card processor. User complaint text for investigation.","nullable":true},{"name":"processor_chargeback_code","type":"string","description":"Chargeback code from card processor (e.g., 4855, 1040, etc.). Null for non-chargeback disputes. Used to understand processor's reason category.","nullable":true},{"name":"processor_chargeback_reason","type":"string","description":"Human-readable reason provided by processor for the chargeback. Examples: 'Fraudulent Transaction', 'Product Not Received', 'Unauthorized'. Null for non-chargeback disputes.","nullable":true},{"name":"investigation_notes","type":"string","description":"Admin's investigation notes including findings, evidence reviewed, and reasoning. Updated as investigation progresses.","nullable":true},{"name":"resolution_decision","type":"string","description":"Final resolution decision: CUSTOMER_WINS (refund issued), MERCHANT_WINS (dispute rejected), PARTIAL (compromise reached). Null until dispute resolved.","nullable":true},{"name":"resolution_reason","type":"string","description":"Detailed explanation of resolution decision for both parties. Explains findings and reasoning for outcome.","nullable":true},{"name":"evidence_customer_provided","type":"string","description":"JSON array of evidence URLs provided by customer or on their behalf. Examples: [\"https://evidence1.pdf\", \"https://evidence2.jpg\"]. Used for investigation.","nullable":true},{"name":"evidence_merchant_provided","type":"string","description":"JSON array of evidence URLs provided by merchant/admin. Examples: delivery confirmation, customer communication, etc.","nullable":true},{"name":"is_appealed","type":"boolean","description":"Whether dispute has been appealed by either party. If true, should create appeal workflow.","nullable":false},{"name":"filed_at","type":"datetime","description":"Timestamp when dispute was filed (by customer, processor, or system).","nullable":false},{"name":"investigation_started_at","type":"datetime","description":"Timestamp when investigation began (admin assigned). Null until investigation starts.","nullable":true},{"name":"deadline_for_response","type":"datetime","description":"Processor deadline for merchant to respond to chargeback (typically 7-10 days from filing). Critical for compliance with payment processor requirements.","nullable":true},{"name":"resolved_at","type":"datetime","description":"Timestamp when dispute was resolved with final decision. Null until resolution occurs.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when dispute record was created in system.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when dispute record was last updated.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_payment_id"]},{"fieldNames":["shopping_mall_order_id"]},{"fieldNames":["dispute_status"]},{"fieldNames":["dispute_type"]},{"fieldNames":["filed_at"]},{"fieldNames":["deadline_for_response"]}],"ginIndexes":[]},{"name":"shopping_mall_payment_reconciliation","description":"Records of batch payment reconciliation processes comparing platform transaction records against payment processor settlement reports. Tracks daily/weekly/monthly reconciliation cycles identifying discrepancies, missing transactions, and settlement confirmations. Enables identification and investigation of payment anomalies and ensures all payments are properly accounted for. Stores reconciliation results and any identified issues requiring manual intervention.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"reconciliation_admin_id","type":"uuid","description":"Admin user responsible for initiating or managing this reconciliation. References {@link shopping_mall_admin.id}. Null if reconciliation is automated.","relation":{"name":"reconciliationAdmin","targetModel":"shopping_mall_admin"},"unique":false,"nullable":true}],"plainFields":[{"name":"reconciliation_type","type":"string","description":"Type of reconciliation: DAILY (end of day), WEEKLY (weekly summary), MONTHLY (monthly close), ON_DEMAND (manual ad-hoc). Determines reconciliation scope and frequency.","nullable":false},{"name":"reconciliation_period_start","type":"datetime","description":"Start timestamp for transactions included in reconciliation period. Inclusive.","nullable":false},{"name":"reconciliation_period_end","type":"datetime","description":"End timestamp for transactions included in reconciliation period. Inclusive.","nullable":false},{"name":"reconciliation_status","type":"string","description":"Status of reconciliation: PENDING (in progress), COMPLETED (successfully reconciled), DISCREPANCIES_FOUND (mismatches identified), REQUIRES_INVESTIGATION (manual review needed), RESOLVED (issues resolved). Indicates reconciliation outcome.","nullable":false},{"name":"platform_transaction_count","type":"int","description":"Count of transactions recorded in platform during reconciliation period.","nullable":false},{"name":"platform_transaction_total","type":"double","description":"Total value of all transactions recorded in platform during reconciliation period (smallest currency unit).","nullable":false},{"name":"processor_transaction_count","type":"int","description":"Count of transactions reported by payment processor for reconciliation period.","nullable":false},{"name":"processor_transaction_total","type":"double","description":"Total value of transactions reported by payment processor for reconciliation period (smallest currency unit).","nullable":false},{"name":"matched_transaction_count","type":"int","description":"Count of transactions that matched between platform and processor records.","nullable":false},{"name":"unmatched_in_platform","type":"int","description":"Count of transactions in platform records but missing from processor report. May indicate settlement lag or processing issues.","nullable":false},{"name":"unmatched_in_processor","type":"int","description":"Count of transactions in processor report but missing from platform records. May indicate late transaction creation or system errors.","nullable":false},{"name":"total_discrepancy_amount","type":"double","description":"Total dollar amount of discrepancies found (smallest currency unit). Absolute value of platform total vs processor total difference.","nullable":false},{"name":"discrepancy_details","type":"string","description":"JSON structure describing identified discrepancies: {unmatched_transaction_ids: [...], amount_differences: [{transaction_id, platform_amount, processor_amount}]}. Null if no discrepancies.","nullable":true},{"name":"processor_gateway","type":"string","description":"Name of payment processor being reconciled: STRIPE, PAYPAL, SQUARE, AUTHORIZE_NET, etc. Identifies which processor's report this reconciliation covers.","nullable":false},{"name":"processor_settlement_batch_id","type":"string","description":"Settlement batch ID from processor for this reconciliation. Used to match against processor records. Null if not provided.","nullable":true},{"name":"investigation_required","type":"boolean","description":"Whether this reconciliation requires admin investigation. Set to true if discrepancies exceed threshold or errors detected.","nullable":false},{"name":"investigation_notes","type":"string","description":"Admin notes about investigation findings and actions taken to resolve discrepancies.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when reconciliation process was created/initiated.","nullable":false},{"name":"completed_at","type":"datetime","description":"Timestamp when reconciliation process completed. Null if reconciliation still in progress.","nullable":true},{"name":"updated_at","type":"datetime","description":"Timestamp when reconciliation record was last updated.","nullable":false}],"uniqueIndexes":[{"fieldNames":["processor_settlement_batch_id"],"unique":true}],"plainIndexes":[{"fieldNames":["reconciliation_type"]},{"fieldNames":["reconciliation_status"]},{"fieldNames":["reconciliation_period_start"]},{"fieldNames":["reconciliation_period_end"]},{"fieldNames":["processor_gateway"]},{"fieldNames":["created_at"]},{"fieldNames":["investigation_required"]}],"ginIndexes":[]}]},{"filename":"schema-09-shipping.prisma","namespace":"Shipping","models":[{"name":"shopping_mall_shipments","description":"Primary shipment records representing the physical fulfillment unit created from orders. Contains shipment-level information including carrier, tracking status, and timeline. Each shipment may contain multiple items from an order and represents a distinct fulfillment package sent to customer.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_order_id","type":"uuid","description":"Reference to the order being fulfilled. {@link shopping_mall_orders.id}","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false},{"name":"shopping_shipping_carrier_id","type":"uuid","description":"Reference to the carrier handling this shipment. {@link shopping_mall_shipping_carriers.id}","relation":{"name":"carrier","targetModel":"shopping_mall_shipping_carriers"},"unique":false,"nullable":false},{"name":"shopping_shipping_address_id","type":"uuid","description":"Reference to the validated delivery address for this shipment. {@link shopping_mall_shipping_addresses.id}","relation":{"name":"shippingAddress","targetModel":"shopping_mall_shipping_addresses"},"unique":true,"nullable":false}],"plainFields":[{"name":"shipment_number","type":"string","description":"Human-readable shipment identifier in format SHIP-YYYYMMDD-XXXXXX for customer reference and tracking.","nullable":false},{"name":"tracking_number","type":"string","description":"Carrier-provided tracking number for real-time package tracking. Unique identifier from shipping carrier.","nullable":false},{"name":"carrier_service_code","type":"string","description":"Carrier-specific service code (e.g., 'FEDEX_GROUND', 'UPS_EXPRESS', 'DHL_INTERNATIONAL') identifying service level selected.","nullable":false},{"name":"status","type":"string","description":"Current shipment status from carrier: pending_pickup, picked_up, in_transit, out_for_delivery, delivered, exception, returned_to_sender. Reflects carrier-reported status.","nullable":false},{"name":"weight_kg","type":"double","description":"Total weight of shipment in kilograms including all items and packaging. Used for shipping cost calculation and carrier requirements.","nullable":false},{"name":"estimated_delivery_date","type":"datetime","description":"Expected delivery date and time provided by carrier based on service level. May be updated as shipment progresses.","nullable":false},{"name":"actual_delivery_date","type":"datetime","description":"Actual date and time when delivery was confirmed by carrier. Null until delivery is confirmed.","nullable":true},{"name":"signature_required","type":"boolean","description":"Whether signature is required upon delivery for added security and proof of delivery.","nullable":false},{"name":"insurance_amount","type":"double","description":"Insurance coverage amount in order currency for high-value shipments. Null if no insurance purchased.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when shipment record was created in system (when shipped from warehouse).","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp of last update to shipment status or information.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp if shipment record is archived or voided. Null for active shipments.","nullable":true}],"uniqueIndexes":[{"fieldNames":["tracking_number"],"unique":true},{"fieldNames":["shipment_number"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_shipping_carrier_id"]},{"fieldNames":["status"]},{"fieldNames":["created_at"]},{"fieldNames":["shopping_order_id","status"]}],"ginIndexes":[]},{"name":"shopping_mall_shipment_items","description":"Individual items contained within a shipment. Represents line-items that are part of a specific shipment, linking SKU/inventory to the shipment. Each item references an order item and its corresponding inventory. Enables per-item tracking and management within shipment.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_shipment_id","type":"uuid","description":"Reference to the parent shipment containing this item. {@link shopping_mall_shipments.id}","relation":{"name":"shipment","targetModel":"shopping_mall_shipments"},"unique":false,"nullable":false},{"name":"shopping_order_item_id","type":"uuid","description":"Reference to the order line item being shipped. {@link shopping_mall_order_items.id}","relation":{"name":"orderItem","targetModel":"shopping_mall_order_items"},"unique":false,"nullable":false},{"name":"shopping_inventory_sku_id","type":"uuid","description":"Reference to the SKU inventory record for this item. {@link shopping_mall_inventory_skus.id}","relation":{"name":"inventorySku","targetModel":"shopping_mall_inventory_skus"},"unique":false,"nullable":false}],"plainFields":[{"name":"quantity","type":"int","description":"Quantity of this SKU included in the shipment. May be partial if order item split across multiple shipments.","nullable":false},{"name":"item_status","type":"string","description":"Status of this specific item within shipment: pending, packed, scanned, in_transit, out_for_delivery, delivered, damaged, missing.","nullable":false},{"name":"tracking_status","type":"string","description":"Item-level tracking status synchronized from shipment tracking. May differ from shipment status if item damaged/missing.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when shipment item record was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp of last update to item status or information.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_shipment_id","shopping_order_item_id"]},{"fieldNames":["shopping_order_item_id"]}],"ginIndexes":[]},{"name":"shopping_mall_shipment_tracking","description":"Immutable audit trail of all tracking events and status updates throughout shipment lifecycle. Records every status change reported by carrier including timestamps, locations, and event details. Enables complete historical tracking and troubleshooting.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_shipment_id","type":"uuid","description":"Reference to the shipment this tracking event belongs to. {@link shopping_mall_shipments.id}","relation":{"name":"shipment","targetModel":"shopping_mall_shipments"},"unique":false,"nullable":false}],"plainFields":[{"name":"event_timestamp","type":"datetime","description":"Timestamp when the tracking event occurred according to carrier (ISO 8601 format UTC timezone).","nullable":false},{"name":"event_code","type":"string","description":"Carrier-specific event code (e.g., 'PKG_DELIVERED', 'IN_TRANSIT', 'DELIVERY_ATTEMPTED'). Enables carrier-agnostic event handling.","nullable":false},{"name":"event_status","type":"string","description":"Status name from event: pending_pickup, picked_up, in_transit, out_for_delivery, delivered, exception, returned. Human-readable status.","nullable":false},{"name":"event_description","type":"string","description":"Detailed description of the tracking event from carrier (e.g., 'Package delivered to customer', 'Delivery attempted - customer not home').","nullable":false},{"name":"location_city","type":"string","description":"City or facility location where event occurred. Null if location unavailable from carrier.","nullable":true},{"name":"location_state","type":"string","description":"State or province of event location. Null if location unavailable.","nullable":true},{"name":"location_country","type":"string","description":"Country of event location. Null if location unavailable.","nullable":true},{"name":"exception_code","type":"string","description":"Carrier exception code if event indicates problem (e.g., 'DELIVERY_FAILED', 'WEATHER_DELAY'). Null if no exception.","nullable":true},{"name":"exception_description","type":"string","description":"Detailed description of exception or problem. Null if no exception. Helps troubleshoot delivery issues.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when tracking record was received and stored in system (server time).","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["event_timestamp"]},{"fieldNames":["shopping_shipment_id","event_timestamp"]},{"fieldNames":["event_status"]}],"ginIndexes":[]},{"name":"shopping_mall_shipping_addresses","description":"Validated delivery addresses for shipments, captured at time of shipment creation for historical accuracy. Denormalizes customer address data to preserve exact delivery location even if customer address changes later. Enables address history tracking and dispute resolution.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"recipient_name","type":"string","description":"Full name of package recipient as provided in shipment order.","nullable":false},{"name":"phone_number","type":"string","description":"Contact phone number for delivery coordination (international format accepted).","nullable":false},{"name":"street_address","type":"string","description":"Street address including street number and name (e.g., '123 Main Street', 'PO Box 456').","nullable":false},{"name":"street_address_2","type":"string","description":"Secondary address line for apartment, suite, building number, etc. Optional for addresses without secondary lines.","nullable":true},{"name":"city","type":"string","description":"City or town name for the delivery address.","nullable":false},{"name":"state_province","type":"string","description":"State, province, or region name depending on country (e.g., 'California', 'Ontario').","nullable":false},{"name":"postal_code","type":"string","description":"ZIP code or postal code in format appropriate to country (e.g., '90210' for US, 'M5V 3A8' for Canada).","nullable":false},{"name":"country","type":"string","description":"Country name or ISO country code for international delivery address validation.","nullable":false},{"name":"special_instructions","type":"string","description":"Delivery instructions from customer (e.g., 'Leave at back door', 'Require signature', 'Call upon arrival'). Max 500 characters.","nullable":true},{"name":"address_validated","type":"boolean","description":"Whether address was validated by carrier API or address verification service before shipment creation.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when shipping address record was created (at shipment time).","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["postal_code"]},{"fieldNames":["city","state_province"]}],"ginIndexes":[]},{"name":"shopping_mall_delivery_confirmations","description":"Final delivery confirmation records representing successful package receipt by customer. Captures proof of delivery details including signature, photos, recipient information, and exact delivery timestamp. Creates immutable record of delivery completion for order fulfillment and dispute resolution.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_shipment_id","type":"uuid","description":"Reference to the delivered shipment. {@link shopping_mall_shipments.id}","relation":{"name":"shipment","targetModel":"shopping_mall_shipments"},"unique":true,"nullable":false}],"plainFields":[{"name":"confirmation_timestamp","type":"datetime","description":"Exact date and time when carrier confirmed delivery (ISO 8601 format UTC timezone).","nullable":false},{"name":"delivered_to","type":"string","description":"Name or description of person/entity that received the package (e.g., 'John Doe', 'Signature on file', 'Left at door').","nullable":false},{"name":"delivery_location","type":"string","description":"Specific location where package was left or delivered (e.g., 'Front porch', 'Back door', 'Delivery box', 'Office entrance').","nullable":true},{"name":"signature_image_url","type":"uri","description":"URL/URI to signature image proof of delivery if signature was required. Null if no signature collected.","nullable":true},{"name":"delivery_photo_url","type":"uri","description":"URL/URI to photo taken at delivery for verification purposes. Null if no photo captured.","nullable":true},{"name":"weather_conditions","type":"string","description":"Weather conditions reported at delivery time (e.g., 'Clear', 'Rainy'). Optional detail from carrier.","nullable":true},{"name":"temperature_fahrenheit","type":"int","description":"Temperature in Fahrenheit at delivery time for temperature-sensitive items tracking. Null if not applicable.","nullable":true},{"name":"carrier_confirmation_code","type":"string","description":"Carrier's confirmation code for this delivery event. Used for dispute resolution and verification.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when delivery confirmation record was created in system.","nullable":false}],"uniqueIndexes":[{"fieldNames":["carrier_confirmation_code"],"unique":true}],"plainIndexes":[{"fieldNames":["confirmation_timestamp"]}],"ginIndexes":[]},{"name":"shopping_mall_return_shipments","description":"Records for return shipments handling reverse logistics when customers return ordered items. Tracks outbound return shipping to seller/warehouse, managing the reverse fulfillment process including return authorization, return tracking, and receipt confirmation. Linked to original shipments for complete order return workflow.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_shipment_id","type":"uuid","description":"Reference to the original forward shipment being returned. {@link shopping_mall_shipments.id}","relation":{"name":"originalShipment","targetModel":"shopping_mall_shipments"},"unique":false,"nullable":false},{"name":"shopping_shipping_carrier_id","type":"uuid","description":"Reference to the carrier handling the return shipment (may differ from forward shipment). {@link shopping_mall_shipping_carriers.id}","relation":{"name":"carrier","targetModel":"shopping_mall_shipping_carriers"},"unique":false,"nullable":false}],"plainFields":[{"name":"return_authorization_number","type":"string","description":"Return authorization (RMA) number issued to customer for return shipment identification and tracking.","nullable":false},{"name":"return_reason","type":"string","description":"Reason for return from customer (e.g., 'defective', 'not_as_described', 'wrong_item', 'changed_mind').","nullable":false},{"name":"return_tracking_number","type":"string","description":"Carrier-provided tracking number for the return shipment. Enables tracking of items returning to seller.","nullable":true},{"name":"return_status","type":"string","description":"Status of return shipment: pending, return_label_issued, in_transit, received_by_seller, inspected, completed, cancelled.","nullable":false},{"name":"return_label_url","type":"uri","description":"URL to downloadable return shipping label PDF for customer to print. Null until label is generated.","nullable":true},{"name":"return_label_expiry_date","type":"datetime","description":"Deadline by which customer must ship return using provided label. After this date label may be invalid.","nullable":true},{"name":"shipment_sent_date","type":"datetime","description":"Date when customer shipped the return package (when tracking picked up by carrier). Null until shipped.","nullable":true},{"name":"return_received_date","type":"datetime","description":"Date when seller received and recorded receipt of returned package. Null until received.","nullable":true},{"name":"inspection_notes","type":"string","description":"Notes from seller's inspection of returned item (condition, damages, completeness check). Null until inspected.","nullable":true},{"name":"inspection_status","type":"string","description":"Result of inspection: pending_inspection, accepted, partial_damage, condition_issue, missing_parts, not_as_returned.","nullable":true},{"name":"prepaid_return_shipping","type":"boolean","description":"Whether return shipping was prepaid by platform/seller (true) or customer responsible (false).","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when return shipment record was created (when return authorized).","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp of last update to return shipment status or information.","nullable":false}],"uniqueIndexes":[{"fieldNames":["return_authorization_number"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_shipment_id"]},{"fieldNames":["return_status"]},{"fieldNames":["return_tracking_number"]},{"fieldNames":["return_received_date"]}],"ginIndexes":[]},{"name":"shopping_mall_shipping_carriers","description":"Carrier master data containing information about shipping service providers (USPS, FedEx, UPS, DHL, etc.). Stores carrier integration details, service codes, supported countries, and API configuration for real-time tracking integration. Enables multi-carrier support and carrier selection during checkout.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"carrier_code","type":"string","description":"Unique carrier code identifier (e.g., 'USPS', 'FEDEX', 'UPS', 'DHL'). Used internally for carrier selection.","nullable":false},{"name":"carrier_name","type":"string","description":"Full human-readable name of carrier for customer display (e.g., 'United States Postal Service', 'FedEx Ground').","nullable":false},{"name":"carrier_logo_url","type":"uri","description":"URL to carrier logo image for customer-facing interfaces. Used in order tracking displays.","nullable":true},{"name":"api_key","type":"string","description":"Carrier API key for authentication with carrier tracking API. Encrypted at rest for security.","nullable":false},{"name":"api_secret","type":"string","description":"Carrier API secret/password for authentication. Encrypted at rest and never exposed in logs.","nullable":true},{"name":"api_endpoint","type":"uri","description":"Base URL for carrier's API endpoint used for tracking lookups and shipping label generation.","nullable":false},{"name":"is_active","type":"boolean","description":"Whether this carrier integration is currently active and available for use in shipment creation.","nullable":false},{"name":"supports_international","type":"boolean","description":"Whether carrier supports international shipping to multiple countries.","nullable":false},{"name":"supported_countries","type":"string","description":"Comma-separated list of ISO country codes this carrier supports (e.g., 'US,CA,MX'). Null if international support limited.","nullable":true},{"name":"tracking_url_template","type":"uri","description":"URL template for customer tracking page (e.g., 'https://tracking.carrier.com/track?number={tracking_number}'). Use {tracking_number} as placeholder.","nullable":false},{"name":"max_package_weight_kg","type":"double","description":"Maximum package weight limit in kilograms this carrier will accept. Null if no limit.","nullable":true},{"name":"max_package_length_cm","type":"double","description":"Maximum package length in centimeters. Combined with width/height used for dimension limits.","nullable":true},{"name":"max_package_width_cm","type":"double","description":"Maximum package width in centimeters.","nullable":true},{"name":"max_package_height_cm","type":"double","description":"Maximum package height in centimeters.","nullable":true},{"name":"estimated_delivery_days_standard","type":"int","description":"Standard estimated delivery time in business days for standard shipping service.","nullable":false},{"name":"estimated_delivery_days_express","type":"int","description":"Estimated delivery time in business days for express shipping service. Null if carrier doesn't offer express.","nullable":true},{"name":"estimated_delivery_days_overnight","type":"int","description":"Estimated delivery time in business days for overnight shipping. Null if not offered.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when carrier record was created/integrated into system.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp of last update to carrier configuration or integration details.","nullable":false}],"uniqueIndexes":[{"fieldNames":["carrier_code"],"unique":true}],"plainIndexes":[{"fieldNames":["is_active"]}],"ginIndexes":[{"fieldName":"carrier_name"}]}]},{"filename":"schema-10-returns.prisma","namespace":"Returns","models":[{"name":"shopping_mall_return_requests","description":"Main return request entity representing customer requests to return purchased items. Captures the complete return workflow from initial request through completion. Links to orders and customers, and tracks return lifecycle including approval status, reason for return, and resolution. Central entity for managing post-fulfillment reverse transactions.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Reference to the original order being returned. Links to {@link shopping_mall_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false},{"name":"shopping_mall_customer_id","type":"uuid","description":"Customer who initiated the return request. Links to {@link shopping_mall_customer.id}.","relation":{"name":"customer","targetModel":"shopping_mall_customer"},"unique":false,"nullable":false},{"name":"shopping_mall_return_reason_id","type":"uuid","description":"Predefined return reason selected by customer. Links to {@link shopping_mall_return_reasons.id}.","relation":{"name":"returnReason","targetModel":"shopping_mall_return_reasons"},"unique":false,"nullable":false}],"plainFields":[{"name":"return_number","type":"string","description":"Unique human-readable return request number in format RET-YYYYMMDD-XXXXXX for customer reference and tracking.","nullable":false},{"name":"return_status","type":"string","description":"Current status of return request: PENDING (awaiting approval), APPROVED (approved by seller/admin), RECEIVED (items received), INSPECTED (inspection completed), COMPLETED (return processed), CANCELLED, REJECTED (by seller).","nullable":false},{"name":"customer_description","type":"string","description":"Detailed description provided by customer explaining reason for return, up to 2000 characters.","nullable":true},{"name":"return_window_days","type":"int","description":"Number of days allowed for customer to initiate return from delivery date, typically 30 days.","nullable":false},{"name":"return_authorization_number","type":"string","description":"Unique Return Merchandise Authorization (RMA) number generated when return is approved, used for shipment tracking.","nullable":true},{"name":"approved_at","type":"datetime","description":"Timestamp when return request was approved by seller or admin.","nullable":true},{"name":"received_at","type":"datetime","description":"Timestamp when returned items were received at return destination.","nullable":true},{"name":"inspection_completed_at","type":"datetime","description":"Timestamp when inspection of returned items was completed.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when return request was initially created by customer.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp of most recent modification to return request.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp for logical deletion while preserving data integrity.","nullable":true}],"uniqueIndexes":[{"fieldNames":["return_number"],"unique":true},{"fieldNames":["return_authorization_number"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_customer_id","created_at"]},{"fieldNames":["shopping_mall_order_id"]},{"fieldNames":["return_status"]},{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_return_items","description":"Individual items included in a return request. Represents specific products being returned from an order. Each return item links to the original order item and captures item-level return information including condition and quantity being returned. Always managed through parent return request.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_return_request_id","type":"uuid","description":"Parent return request containing this item. Links to {@link shopping_mall_return_requests.id}.","relation":{"name":"returnRequest","targetModel":"shopping_mall_return_requests"},"unique":false,"nullable":false},{"name":"shopping_mall_order_item_id","type":"uuid","description":"Original order item being returned. Links to {@link shopping_mall_order_items.id}.","relation":{"name":"orderItem","targetModel":"shopping_mall_order_items"},"unique":false,"nullable":false},{"name":"shopping_mall_product_id","type":"uuid","description":"Product being returned. Links to {@link shopping_mall_products.id}.","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false}],"plainFields":[{"name":"quantity_returned","type":"int","description":"Number of units being returned from original order quantity.","nullable":false},{"name":"item_condition","type":"string","description":"Condition of returned item: UNOPENED (original packaging intact), USED (shows wear but functional), DAMAGED (defective or damaged), OTHER.","nullable":false},{"name":"refund_eligible","type":"boolean","description":"Whether this item is eligible for refund based on condition and return policy.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when return item was added to return request.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_return_request_id"]},{"fieldNames":["shopping_mall_order_item_id"]}],"ginIndexes":[]},{"name":"shopping_mall_return_inspections","description":"Inspection records for quality assurance of returned items. Captures detailed inspection findings when returned items are received and examined. Determines whether items meet return conditions and refund eligibility. Can be searched and managed independently by inspection staff.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_return_item_id","type":"uuid","description":"The return item being inspected. Links to {@link shopping_mall_return_items.id}.","relation":{"name":"returnItem","targetModel":"shopping_mall_return_items"},"unique":false,"nullable":false}],"plainFields":[{"name":"inspection_status","type":"string","description":"Current inspection status: PENDING (awaiting inspection), IN_PROGRESS (inspection underway), APPROVED (item meets conditions), REJECTED (item does not meet conditions).","nullable":false},{"name":"inspection_notes","type":"string","description":"Detailed inspection notes documenting condition of item, damage assessment, and findings, up to 2000 characters.","nullable":true},{"name":"defect_found","type":"boolean","description":"Whether inspection identified defect or damage caused by manufacturer/shipping rather than customer use.","nullable":false},{"name":"customer_damage","type":"boolean","description":"Whether inspection identified damage caused by customer misuse or improper handling.","nullable":false},{"name":"restocking_fee_applicable","type":"double","description":"Percentage restocking fee to be deducted from refund (0-25% depending on condition), if applicable.","nullable":false},{"name":"approved_at","type":"datetime","description":"Timestamp when inspection was completed and approved.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when inspection record was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp of most recent inspection update.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_return_item_id"]},{"fieldNames":["inspection_status"]},{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_refund_requests","description":"Refund request management entity tracking customer requests for financial reimbursement. Represents monetary refund workflows separate from physical return tracking. Links to return requests and orders, tracks refund amounts, methods, and processing status. Requires independent management and API operations.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_return_request_id","type":"uuid","description":"Associated return request if this refund is for returned items. Links to {@link shopping_mall_return_requests.id}.","relation":{"name":"returnRequest","targetModel":"shopping_mall_return_requests"},"unique":false,"nullable":true},{"name":"shopping_mall_order_id","type":"uuid","description":"Original order being refunded. Links to {@link shopping_mall_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false},{"name":"shopping_mall_customer_id","type":"uuid","description":"Customer requesting the refund. Links to {@link shopping_mall_customer.id}.","relation":{"name":"customer","targetModel":"shopping_mall_customer"},"unique":false,"nullable":false}],"plainFields":[{"name":"refund_number","type":"string","description":"Unique human-readable refund request number in format REF-YYYYMMDD-XXXXXX for tracking.","nullable":false},{"name":"refund_status","type":"string","description":"Current refund status: PENDING (awaiting approval), APPROVED (approved for processing), PROCESSING (refund being processed), COMPLETED (refund issued), FAILED (processing failed), CANCELLED.","nullable":false},{"name":"refund_reason","type":"string","description":"Customer-provided reason for refund request, up to 1000 characters.","nullable":false},{"name":"refund_amount","type":"double","description":"Total refund amount in customer's currency after deductions (restocking fees, return shipping, etc.).","nullable":false},{"name":"original_amount","type":"double","description":"Original order amount before any refund deductions.","nullable":false},{"name":"deductions_amount","type":"double","description":"Total amount deducted from refund (restocking fees, return shipping fees, etc.).","nullable":false},{"name":"refund_method","type":"string","description":"Method of refund: ORIGINAL_PAYMENT (back to original payment method), STORE_CREDIT (credit in customer account), OTHER.","nullable":false},{"name":"approved_at","type":"datetime","description":"Timestamp when refund request was approved by seller or admin.","nullable":true},{"name":"processing_started_at","type":"datetime","description":"Timestamp when refund processing began.","nullable":true},{"name":"completed_at","type":"datetime","description":"Timestamp when refund was successfully processed and issued to customer.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when refund request was initially created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp of most recent modification to refund request.","nullable":false}],"uniqueIndexes":[{"fieldNames":["refund_number"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_customer_id","created_at"]},{"fieldNames":["shopping_mall_order_id"]},{"fieldNames":["refund_status"]},{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_refund_processing","description":"Refund processing workflow entity tracking stages in the refund processing pipeline. Represents individual processing steps and actions taken during refund execution. Links to refund requests and tracks payment processing details, approval chain, and processing status at each step.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_refund_request_id","type":"uuid","description":"The refund request being processed. Links to {@link shopping_mall_refund_requests.id}.","relation":{"name":"refundRequest","targetModel":"shopping_mall_refund_requests"},"unique":false,"nullable":false}],"plainFields":[{"name":"processing_step","type":"string","description":"Current processing step: VALIDATION (validating refund eligibility), APPROVAL (awaiting approval), PAYMENT_PROCESSING (submitting to payment gateway), PAYMENT_CONFIRMED (payment processed), COMPLETED (refund issued).","nullable":false},{"name":"processing_status","type":"string","description":"Status of current step: PENDING, IN_PROGRESS, SUCCESSFUL, FAILED.","nullable":false},{"name":"payment_transaction_id","type":"string","description":"Transaction ID from payment gateway when refund is submitted for processing.","nullable":true},{"name":"payment_confirmation_code","type":"string","description":"Confirmation code from payment gateway when refund is successfully processed.","nullable":true},{"name":"processing_notes","type":"string","description":"Notes about processing step, issues encountered, or actions taken, up to 1000 characters.","nullable":true},{"name":"retry_count","type":"int","description":"Number of times this processing step has been retried if failures occurred.","nullable":false},{"name":"next_retry_at","type":"datetime","description":"Scheduled time for next retry attempt if processing step failed.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when processing step was initiated.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp of most recent processing update.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_refund_request_id","processing_step"]},{"fieldNames":["processing_status"]},{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_refund_history","description":"Historical audit trail of all refund transactions and state changes. Append-only snapshot records capturing complete refund processing history for compliance and audit purposes. Read-only from user perspective with immutable records for financial compliance and dispute resolution.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_refund_request_id","type":"uuid","description":"The refund request this history entry is for. Links to {@link shopping_mall_refund_requests.id}.","relation":{"name":"refundRequest","targetModel":"shopping_mall_refund_requests"},"unique":false,"nullable":false}],"plainFields":[{"name":"event_type","type":"string","description":"Type of history event: CREATED (refund request created), APPROVED (refund approved), PROCESSING_STARTED (processing began), PAYMENT_SUBMITTED (payment sent to gateway), PAYMENT_COMPLETED (payment successful), FAILED (processing failed), CANCELLED, COMPLETED.","nullable":false},{"name":"previous_status","type":"string","description":"Previous refund status before this event occurred.","nullable":true},{"name":"new_status","type":"string","description":"New refund status after this event.","nullable":false},{"name":"refund_amount","type":"double","description":"Refund amount at time of this historical event.","nullable":false},{"name":"event_details","type":"string","description":"Detailed information about event (approver, system action, error message, etc.), up to 2000 characters.","nullable":true},{"name":"created_by","type":"string","description":"Who or what caused this event (admin username, system process, customer, automated job, etc.).","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when this history event was recorded (immutable).","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_refund_request_id","created_at"]},{"fieldNames":["event_type"]},{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_return_reasons","description":"Reference table containing predefined return reasons that customers can select when initiating return requests. Static lookup table managed by system administration for standardized return reason categorization. Used for analytics and process improvement.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"reason_code","type":"string","description":"Unique code for this return reason (e.g., DEFECTIVE, WRONG_ITEM, NOT_DESCRIBED, DAMAGED_SHIPPING, CHANGED_MIND).","nullable":false},{"name":"reason_label","type":"string","description":"Customer-facing display label for this return reason, up to 100 characters.","nullable":false},{"name":"reason_description","type":"string","description":"Detailed description explaining this return reason to customers, up to 500 characters.","nullable":true},{"name":"requires_inspection","type":"boolean","description":"Whether items returned for this reason require formal inspection before refund approval.","nullable":false},{"name":"refund_eligibility","type":"string","description":"Refund eligibility for this reason: FULL (full refund), PARTIAL (may incur fees), STORE_CREDIT_ONLY, CASE_BY_CASE.","nullable":false},{"name":"sort_order","type":"int","description":"Display order in customer-facing return reason dropdown (0 = first).","nullable":false},{"name":"is_active","type":"boolean","description":"Whether this reason is currently available for customer selection.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when this return reason was created.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp of most recent update to this return reason.","nullable":false}],"uniqueIndexes":[{"fieldNames":["reason_code"],"unique":true}],"plainIndexes":[{"fieldNames":["is_active"]},{"fieldNames":["sort_order"]}],"ginIndexes":[]}]},{"filename":"schema-11-reviews.prisma","namespace":"Reviews","models":[{"name":"shopping_mall_reviews","description":"Core product review records capturing customer feedback after delivery. Stores verified purchase reviews with content, ratings, and moderation status. Each review represents one customer's experience with one product from one order, enabling comprehensive feedback management and social proof for the platform.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Reference to the customer's order for purchase verification. {@link shopping_mall_orders.id}","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false},{"name":"shopping_mall_product_id","type":"uuid","description":"Reference to the product being reviewed for aggregation and analytics. {@link shopping_mall_products.id}","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false},{"name":"shopping_mall_customer_id","type":"uuid","description":"Reference to the customer who wrote the review for reviewer tracking and activity patterns. {@link shopping_mall_customer.id}","relation":{"name":"customer","targetModel":"shopping_mall_customer"},"unique":false,"nullable":false}],"plainFields":[{"name":"rating","type":"int","description":"Star rating from 1 to 5. Whole numbers only representing customer satisfaction level (1=Terrible, 5=Excellent). Used for average rating calculation and product sorting.","nullable":false},{"name":"title","type":"string","description":"Review title between 5 and 100 characters summarizing the review. Appears in review lists and search results. Used for indexing and display.","nullable":false},{"name":"content","type":"string","description":"Detailed review text between 10 and 2000 characters describing customer experience. Can include product quality feedback, delivery experience, and recommendations. Subject to content moderation before publication.","nullable":false},{"name":"review_status","type":"string","description":"Current moderation status of the review. Values: DRAFT (initial submission), PENDING_MODERATION (awaiting admin review), APPROVED (published and visible), REJECTED (failed moderation), EDITED (customer modified after approval). Determines visibility to other customers.","nullable":false},{"name":"is_verified_purchase","type":"boolean","description":"Whether this review is from a verified purchase verified by matching order delivery. Always true for reviews in this table as unverified reviews are rejected at submission. Used to display 'Verified Purchase' badge to customers.","nullable":false},{"name":"helpful_count","type":"int","description":"Number of customers who marked this review as helpful via voting system. Used for sorting reviews by helpfulness. Updated when review votes are added/removed.","nullable":false},{"name":"unhelpful_count","type":"int","description":"Number of customers who marked this review as unhelpful. Used to calculate net helpfulness score. Updated when review votes change.","nullable":false},{"name":"moderation_notes","type":"string","description":"Internal notes from moderators explaining approval, rejection, or edits made to review content. Visible only to admins. Helps document moderation decisions for compliance.","nullable":true},{"name":"rejection_reason","type":"string","description":"If rejected, the business reason for rejection (PROFANITY, HATE_SPEECH, SPAM, CONTACT_INFO, OFF_TOPIC, etc.). Shown to customer to explain why review was not published.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when review was first submitted by customer in ISO 8601 format. Immutable after creation. Used to enforce 365-day review window and sort reviews chronologically.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when review was last modified by customer or moderator. Updated when review content is edited or status changes. Helps track review history.","nullable":false},{"name":"published_at","type":"datetime","description":"Timestamp when review status changed to APPROVED and became visible to customers. Null until approval. Used to track when review became part of product rating.","nullable":true},{"name":"deleted_at","type":"datetime","description":"Soft delete timestamp if review was removed. Null for active reviews. Used for compliance and audit trails. Allows recovery if needed. Reviews are soft-deleted, not permanently removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_order_id","shopping_mall_product_id","shopping_mall_customer_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_product_id","review_status","published_at"]},{"fieldNames":["shopping_mall_customer_id","created_at"]},{"fieldNames":["shopping_mall_order_id"]},{"fieldNames":["review_status"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"title"},{"fieldName":"content"}]},{"name":"shopping_mall_review_ratings","description":"Aggregated rating statistics for products calculated from individual reviews. Stores pre-calculated average ratings, rating distribution, and review counts. Materialized quasi-view that updates when reviews are approved/rejected. Enables efficient product search sorting and rating display without expensive aggregation queries.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Reference to the product these ratings aggregate. One rating record per product. {@link shopping_mall_products.id}","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":true,"nullable":false}],"plainFields":[{"name":"average_rating","type":"double","description":"Calculated average rating from all approved reviews (1-5 scale with 2 decimal places). Examples: 4.37, 3.82, 5.00. Updated atomically when reviews are approved. Used for product sorting and display.","nullable":false},{"name":"total_reviews","type":"int","description":"Total count of approved reviews for this product. Used for sorting by popularity and displaying review count to customers (e.g., '506 reviews'). Updated when reviews are approved or rejected.","nullable":false},{"name":"five_star_count","type":"int","description":"Count of approved 5-star reviews. Part of rating distribution displayed to customers. Updated atomically with review approvals.","nullable":false},{"name":"four_star_count","type":"int","description":"Count of approved 4-star reviews. Part of rating distribution bar chart.","nullable":false},{"name":"three_star_count","type":"int","description":"Count of approved 3-star reviews. Part of rating distribution.","nullable":false},{"name":"two_star_count","type":"int","description":"Count of approved 2-star reviews. Part of rating distribution.","nullable":false},{"name":"one_star_count","type":"int","description":"Count of approved 1-star reviews. Part of rating distribution.","nullable":false},{"name":"rating_percentage_five_star","type":"double","description":"Percentage of 5-star reviews (0-100). Calculated as (five_star_count / total_reviews * 100). Rounded to 2 decimal places. Used for display and filtering.","nullable":false},{"name":"rating_percentage_four_star","type":"double","description":"Percentage of 4-star reviews.","nullable":false},{"name":"rating_percentage_three_star","type":"double","description":"Percentage of 3-star reviews.","nullable":false},{"name":"rating_percentage_two_star","type":"double","description":"Percentage of 2-star reviews.","nullable":false},{"name":"rating_percentage_one_star","type":"double","description":"Percentage of 1-star reviews.","nullable":false},{"name":"last_updated_at","type":"datetime","description":"Timestamp when ratings were last recalculated. Updated every time a review is approved or rejected. Used to track freshness of aggregated data.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_product_id"],"unique":true}],"plainIndexes":[{"fieldNames":["average_rating","total_reviews"]}],"ginIndexes":[]},{"name":"shopping_mall_review_moderation","description":"Tracks the moderation workflow and approval status for reviews. Records which admin reviewed the review, what decision was made, and notes explaining the decision. Provides audit trail for content moderation compliance and enables tracking of moderation queue status.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_review_id","type":"uuid","description":"Reference to the review being moderated. Each review has at most one moderation record. {@link shopping_mall_reviews.id}","relation":{"name":"review","targetModel":"shopping_mall_reviews"},"unique":true,"nullable":false},{"name":"shopping_mall_admin_id","type":"uuid","description":"Reference to the admin who performed the moderation decision. Tracks which moderator approved or rejected. {@link shopping_mall_admin.id}","relation":{"name":"admin","targetModel":"shopping_mall_admin"},"unique":false,"nullable":true}],"plainFields":[{"name":"moderation_status","type":"string","description":"Current status of moderation review. Values: PENDING (awaiting review), APPROVED (content accepted), REJECTED (content failed policy), EDITED (moderator modified content). Determines if review becomes visible.","nullable":false},{"name":"decision_reason","type":"string","description":"Business reason for the moderation decision. For approvals: 'Content approved' or specific reason. For rejections: PROFANITY, HATE_SPEECH, SPAM, CONTACT_INFO, OFF_TOPIC, PLAGIARISM, UNSUBSTANTIATED_CLAIMS, OTHER.","nullable":false},{"name":"moderator_notes","type":"string","description":"Detailed internal notes from moderator explaining the decision, any content issues found, or actions taken. Only visible to admins. Used for compliance documentation.","nullable":true},{"name":"content_modifications","type":"string","description":"If moderator edited review content, describes what changes were made (e.g., 'Removed external URLs', 'Removed phone number'). Null if no modifications made. Used to track content curation.","nullable":true},{"name":"auto_flagged","type":"boolean","description":"Whether this review was automatically flagged by spam detection system or manually reported by customer. True if automated system flagged for review.","nullable":false},{"name":"flagged_reason","type":"string","description":"If auto-flagged, the specific reason from spam filter (PROFANITY_DETECTED, SPAM_PATTERN, CONTACT_INFO_DETECTED, URL_DETECTED, EXCESSIVE_CAPS, etc.). Null if manually reported.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when review was submitted and entered moderation queue. Records when moderation process started.","nullable":false},{"name":"moderated_at","type":"datetime","description":"Timestamp when moderator completed review and made decision. Null until moderation completes. Used to track moderation SLA (should be <24 hours).","nullable":true},{"name":"appeal_deadline","type":"datetime","description":"Deadline for customer to appeal rejection decision (typically 14 days from rejection). After this date, rejection cannot be appealed. Null for approved reviews.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_review_id"],"unique":true}],"plainIndexes":[{"fieldNames":["moderation_status"]},{"fieldNames":["created_at","moderated_at"]}],"ginIndexes":[]},{"name":"shopping_mall_seller_responses","description":"Seller responses to customer reviews. Allows sellers to respond professionally to feedback within 30 days of review publication. Responses are publicly visible alongside reviews enabling seller accountability and customer trust building. Sellers can edit their responses anytime after initial submission.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_review_id","type":"uuid","description":"Reference to the review being responded to. Each review can have at most one seller response. {@link shopping_mall_reviews.id}","relation":{"name":"review","targetModel":"shopping_mall_reviews"},"unique":true,"nullable":false},{"name":"shopping_mall_seller_id","type":"uuid","description":"Reference to the seller providing the response. Sellers can only respond to reviews of their own products. {@link shopping_mall_seller.id}","relation":{"name":"seller","targetModel":"shopping_mall_seller"},"unique":false,"nullable":false}],"plainFields":[{"name":"response_content","type":"string","description":"Seller's response text (maximum 1000 characters). Professional response to customer feedback. Subject to content moderation. Used to show seller accountability and address customer concerns.","nullable":false},{"name":"response_status","type":"string","description":"Status of seller response. Values: DRAFT (unsaved), PUBLISHED (visible to customers), DELETED (soft deleted by seller). Controls visibility.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when seller first submitted response. Immutable. Used to enforce 30-day response window from review publication.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when seller last edited response. Updated each time response content changes. Shows customers if response was updated after initial submission.","nullable":false},{"name":"published_at","type":"datetime","description":"Timestamp when response status changed to PUBLISHED. Used to track when response became visible to customers.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_review_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_seller_id","created_at"]},{"fieldNames":["response_status"]}],"ginIndexes":[{"fieldName":"response_content"}]},{"name":"shopping_mall_review_votes","description":"Tracks whether customers found reviews helpful or unhelpful. Enables review community voting to identify most helpful reviews. One vote record per customer per review. Used to sort reviews by usefulness and calculate helpfulness metrics.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_review_id","type":"uuid","description":"Reference to the review being voted on. {@link shopping_mall_reviews.id}","relation":{"name":"review","targetModel":"shopping_mall_reviews"},"unique":false,"nullable":false},{"name":"shopping_mall_customer_id","type":"uuid","description":"Reference to the customer casting the vote. Customers can vote only once per review. {@link shopping_mall_customer.id}","relation":{"name":"customer","targetModel":"shopping_mall_customer"},"unique":false,"nullable":false}],"plainFields":[{"name":"vote_type","type":"string","description":"Type of vote cast. Values: HELPFUL (found review useful), UNHELPFUL (did not find useful), or null (vote removed/withdrawn). Determines whether this vote increases helpful or unhelpful counts.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when vote was first cast.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when vote was modified or removed. Used to track vote changes.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_review_id","shopping_mall_customer_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_review_id","vote_type"]},{"fieldNames":["shopping_mall_customer_id"]}],"ginIndexes":[]},{"name":"shopping_mall_review_images","description":"Product images attached to reviews as evidence or proof. Customers can upload 1-3 images per review showing product condition, packaging, or use case. Images are moderated before review publication. Helps other customers evaluate product quality based on real customer photos.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_review_id","type":"uuid","description":"Reference to the review this image belongs to. Multiple images per review allowed (maximum 3). {@link shopping_mall_reviews.id}","relation":{"name":"review","targetModel":"shopping_mall_reviews"},"unique":false,"nullable":false}],"plainFields":[{"name":"image_url","type":"uri","description":"URL pointing to the uploaded product image. Images stored in cloud storage (S3, CloudFront, etc.). Used to display photo evidence in review.","nullable":false},{"name":"thumbnail_url","type":"uri","description":"URL pointing to thumbnail version of the image for list view display. Smaller file size for faster loading in review lists.","nullable":true},{"name":"image_caption","type":"string","description":"Optional customer-provided description of what the image shows (max 200 characters). Examples: 'Product packaging', 'Item quality', 'In use'. Helps other customers understand image context.","nullable":true},{"name":"image_order","type":"int","description":"Display order of this image in the review (1, 2, or 3). Determines sequence when showing review images to customers. Used for consistent display order.","nullable":false},{"name":"image_status","type":"string","description":"Moderation status of the image. Values: PENDING (awaiting scan), APPROVED (scanned and safe), REJECTED (policy violation). Images with explicit content are rejected.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when image was uploaded with review.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_review_id","image_order"]},{"fieldNames":["image_status"]}],"ginIndexes":[]}]},{"filename":"schema-12-commission.prisma","namespace":"Commission","models":[{"name":"shopping_mall_commission_rates","description":"Stores commission rate configurations for sellers. Tracks both default platform commission rates and custom seller-specific rates with effective dating for rate changes over time. Enables flexible commission management and historical rate tracking for financial reconciliation.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_seller_id","type":"uuid","description":"Reference to seller this commission rate applies to. If null, represents default platform commission rate. {@link shopping_mall_seller.id}","relation":{"name":"seller","targetModel":"shopping_mall_seller"},"unique":false,"nullable":true}],"plainFields":[{"name":"commission_rate","type":"double","description":"Commission percentage applied to seller transactions. Valid range 0.0 to 100.0 representing percentage (e.g., 10.0 for 10% commission).","nullable":false},{"name":"commission_type","type":"string","description":"Type of commission: 'PERCENTAGE' for percentage-based commission or 'FIXED' for fixed amount per transaction. Default is PERCENTAGE.","nullable":false},{"name":"effective_from","type":"datetime","description":"Date and time when this commission rate becomes effective. Commission rates can be scheduled for future implementation.","nullable":false},{"name":"effective_to","type":"datetime","description":"Date and time when this commission rate ceases to be effective. Null indicates rate is currently active or no end date set.","nullable":true},{"name":"reason_for_change","type":"string","description":"Explanation for commission rate change (e.g., 'Top seller promotion', 'Performance penalty', 'Seasonal adjustment'). Provides audit trail for rate changes.","nullable":true},{"name":"minimum_order_value","type":"double","description":"Minimum order subtotal that qualifies for this commission rate. Orders below this value may have different commission treatment.","nullable":true},{"name":"maximum_order_value","type":"double","description":"Maximum order subtotal subject to this commission rate. Orders exceeding this value may have tiered commission treatment.","nullable":true},{"name":"is_active","type":"boolean","description":"Whether this commission rate is currently active and applicable to new transactions. Inactive rates are historical only.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when commission rate record was created. Used for audit trail and historical tracking.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when commission rate record was last modified. Null indicates no updates after creation.","nullable":false},{"name":"created_by","type":"uuid","description":"Admin user ID who created this commission rate. Used for audit trail accountability.","nullable":true},{"name":"updated_by","type":"uuid","description":"Admin user ID who last updated this commission rate. Used for audit trail accountability.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_seller_id","effective_from"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_seller_id","is_active"]},{"fieldNames":["effective_from","effective_to"]},{"fieldNames":["is_active","created_at"]}],"ginIndexes":[{"fieldName":"reason_for_change"}]},{"name":"shopping_mall_seller_earnings","description":"Aggregated earnings and commission tracking per seller. Maintains running totals of seller revenue, platform commissions deducted, and pending payouts. Single record per seller enables efficient earnings dashboard queries and payout processing.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_seller_id","type":"uuid","description":"Reference to seller this earnings record belongs to. One-to-one relationship with seller. {@link shopping_mall_seller.id}","relation":{"name":"seller","targetModel":"shopping_mall_seller"},"unique":true,"nullable":false}],"plainFields":[{"name":"total_gross_sales","type":"double","description":"Total gross sales amount (before commission deductions) accumulated over seller's lifetime on platform. Updated whenever order is completed.","nullable":false},{"name":"total_commission_deducted","type":"double","description":"Total platform commission amount deducted from seller's sales over lifetime. Calculated as sum of all commission charges across all orders.","nullable":false},{"name":"total_net_earnings","type":"double","description":"Total net earnings for seller (gross sales minus commissions). Represents seller's cumulative profit after platform fees.","nullable":false},{"name":"current_month_gross_sales","type":"double","description":"Gross sales amount for current calendar month. Reset to zero on first day of each month for monthly reporting.","nullable":false},{"name":"current_month_commission","type":"double","description":"Commission charged to seller in current calendar month. Reset to zero monthly for tracking monthly commission accumulation.","nullable":false},{"name":"current_month_net_earnings","type":"double","description":"Net earnings for seller in current calendar month (current_month_gross_sales - current_month_commission).","nullable":false},{"name":"pending_commission_amount","type":"double","description":"Commission amount that has been calculated but not yet transferred to seller. Amount awaiting payout processing.","nullable":false},{"name":"total_paid_out","type":"double","description":"Total amount that has been successfully paid out to seller through payouts. Cumulative lifetime payout amount.","nullable":false},{"name":"total_orders_completed","type":"int","description":"Count of orders successfully completed by seller that resulted in earnings. Used for seller performance metrics.","nullable":false},{"name":"total_orders_cancelled","type":"int","description":"Count of orders cancelled that affected earnings (refunds issued). Used to track order success rate.","nullable":false},{"name":"total_refunds_issued","type":"double","description":"Total amount refunded to customers from seller's earnings. Represents earnings that were reversed due to returns.","nullable":false},{"name":"commission_rate_applied","type":"double","description":"Current active commission rate percentage applied to this seller's transactions. May differ from platform default rate.","nullable":false},{"name":"last_payout_date","type":"datetime","description":"Date and time when seller received last payout. Null if seller has never been paid out.","nullable":true},{"name":"next_scheduled_payout","type":"datetime","description":"Scheduled date and time for next payout to this seller. Based on payout schedule (typically weekly).","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when seller earnings record was created (typically at seller account creation).","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when seller earnings were last updated. Updated whenever new order is completed or payout processed.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_seller_id"],"unique":true}],"plainIndexes":[{"fieldNames":["last_payout_date","next_scheduled_payout"]},{"fieldNames":["total_orders_completed","total_gross_sales"]},{"fieldNames":["commission_rate_applied","pending_commission_amount"]}],"ginIndexes":[]},{"name":"shopping_mall_seller_payouts","description":"Individual payout transactions sent to sellers. Each record represents one payment sent or scheduled to be sent to a seller. Tracks payout status, amount, method, and processing details for complete financial accounting.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_seller_id","type":"uuid","description":"Reference to seller receiving this payout. {@link shopping_mall_seller.id}","relation":{"name":"seller","targetModel":"shopping_mall_seller"},"unique":false,"nullable":false},{"name":"shopping_mall_seller_earnings_id","type":"uuid","description":"Reference to seller's earnings record this payout applies to. {@link shopping_mall_seller_earnings.id}","relation":{"name":"earnings","targetModel":"shopping_mall_seller_earnings"},"unique":false,"nullable":false}],"plainFields":[{"name":"payout_reference_id","type":"string","description":"Unique identifier for this payout (e.g., PAY-20241016-000123). Used for tracking and reference purposes.","nullable":false},{"name":"payout_amount","type":"double","description":"Amount being paid to seller in this payout. Net amount after all deductions and adjustments.","nullable":false},{"name":"payout_period_start","type":"datetime","description":"Start date of the earning period this payout covers (typically Monday of payout week).","nullable":false},{"name":"payout_period_end","type":"datetime","description":"End date of the earning period this payout covers (typically Sunday of payout week).","nullable":false},{"name":"orders_included_count","type":"int","description":"Number of orders included in this payout calculation. Indicates scope of earnings aggregated.","nullable":false},{"name":"total_commission_deducted","type":"double","description":"Total commission amount deducted from earnings in this payout period.","nullable":false},{"name":"total_adjustments","type":"double","description":"Total amount of adjustments (positive or negative) applied to seller earnings in this payout.","nullable":false},{"name":"payout_method","type":"string","description":"Method of payout: 'BANK_TRANSFER', 'WIRE_TRANSFER', 'DIGITAL_WALLET', 'CHECK'. Indicates how payment will be delivered.","nullable":false},{"name":"bank_account_last_four","type":"string","description":"Last 4 digits of bank account used for payout (for security display and verification).","nullable":true},{"name":"payout_status","type":"string","description":"Current status of payout: 'SCHEDULED', 'PROCESSING', 'COMPLETED', 'FAILED', 'REVERSED'. Tracks payout lifecycle.","nullable":false},{"name":"scheduled_date","type":"datetime","description":"Date when payout is scheduled to be sent. Payout may be scheduled in advance before actual processing.","nullable":false},{"name":"processed_date","type":"datetime","description":"Date and time when payout was actually processed/sent to seller. Null if not yet processed.","nullable":true},{"name":"completed_date","type":"datetime","description":"Date when payout was confirmed as received/completed. Null if not yet completed.","nullable":true},{"name":"failure_reason","type":"string","description":"If payout failed, explanation of failure reason (e.g., 'Invalid bank account', 'Insufficient funds', 'Bank rejected'). Null for successful payouts.","nullable":true},{"name":"retry_count","type":"int","description":"Number of times failed payout was retried. Tracks retry attempts for failed payments.","nullable":false},{"name":"created_at","type":"datetime","description":"Timestamp when payout record was created (when payout was scheduled).","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when payout record was last updated. Updated as payout status changes.","nullable":false}],"uniqueIndexes":[{"fieldNames":["payout_reference_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_seller_id","payout_status"]},{"fieldNames":["scheduled_date","payout_status"]},{"fieldNames":["processed_date","completed_date"]},{"fieldNames":["payout_period_start","payout_period_end"]}],"ginIndexes":[{"fieldName":"failure_reason"}]},{"name":"shopping_mall_payout_history","description":"Complete historical record of all payout transactions. Provides immutable audit trail of seller payments for reconciliation, compliance, and financial reporting. Each record represents finalized payout state.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_seller_id","type":"uuid","description":"Reference to seller who received this payout. {@link shopping_mall_seller.id}","relation":{"name":"seller","targetModel":"shopping_mall_seller"},"unique":false,"nullable":false},{"name":"shopping_mall_seller_payout_id","type":"uuid","description":"Reference to source payout record this history entry documents. {@link shopping_mall_seller_payouts.id}","relation":{"name":"payout","targetModel":"shopping_mall_seller_payouts"},"unique":false,"nullable":true}],"plainFields":[{"name":"payout_reference_id","type":"string","description":"Reference identifier for this payout (copied from payout record for historical tracking).","nullable":false},{"name":"payout_amount","type":"double","description":"Amount paid in this payout transaction. Historical snapshot of paid amount.","nullable":false},{"name":"commission_deducted","type":"double","description":"Commission amount deducted from seller earnings in this period.","nullable":false},{"name":"payout_period_start","type":"datetime","description":"Start of earning period covered by this payout.","nullable":false},{"name":"payout_period_end","type":"datetime","description":"End of earning period covered by this payout.","nullable":false},{"name":"orders_included_count","type":"int","description":"Number of orders included in this payout's calculation.","nullable":false},{"name":"payout_method","type":"string","description":"Method used to deliver payment (BANK_TRANSFER, WIRE_TRANSFER, etc.).","nullable":false},{"name":"final_status","type":"string","description":"Final status of this payout: 'COMPLETED', 'FAILED', or 'REVERSED'. Snapshot of final state.","nullable":false},{"name":"processed_date","type":"datetime","description":"Date payout was actually processed/sent.","nullable":false},{"name":"completed_date","type":"datetime","description":"Date payout was confirmed as completed. Null if failed.","nullable":true},{"name":"failure_reason","type":"string","description":"If payout failed, the reason for failure. Null for successful payouts.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when this history record was created (snapshot capture time).","nullable":false},{"name":"notes","type":"string","description":"Additional notes or details about this payout for audit/reference purposes.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_seller_id","created_at"]},{"fieldNames":["payout_reference_id","final_status"]},{"fieldNames":["processed_date","completed_date"]}],"ginIndexes":[{"fieldName":"failure_reason"},{"fieldName":"notes"}]},{"name":"shopping_mall_commission_calculations","description":"Line-item commission records for individual orders. Each record represents commission calculation for one order from one seller. Provides detailed audit trail of how each commission amount was derived, enabling financial reconciliation and dispute resolution.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_seller_id","type":"uuid","description":"Reference to seller whose commission is being calculated. {@link shopping_mall_seller.id}","relation":{"name":"seller","targetModel":"shopping_mall_seller"},"unique":false,"nullable":false},{"name":"shopping_mall_order_id","type":"uuid","description":"Reference to order that generated this commission. {@link shopping_mall_orders.id}","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false}],"plainFields":[{"name":"order_subtotal","type":"double","description":"Order subtotal amount (sum of item prices before tax/shipping) used as basis for commission calculation.","nullable":false},{"name":"commission_rate_applied","type":"double","description":"Commission rate percentage applied to this order (e.g., 10.0 for 10%). Rate may vary based on seller status at time of order.","nullable":false},{"name":"commission_amount","type":"double","description":"Calculated commission amount (order_subtotal × commission_rate_applied ÷ 100). Amount deducted from seller's earnings.","nullable":false},{"name":"deductions","type":"double","description":"Any additional deductions from commission (e.g., refunds, chargebacks, adjustments). Reduces seller's net amount.","nullable":false},{"name":"net_commission","type":"double","description":"Final commission amount after deductions (commission_amount - deductions). Amount credited to seller.","nullable":false},{"name":"order_date","type":"datetime","description":"Date and time when order was placed. Used for period tracking and payout grouping.","nullable":false},{"name":"order_status","type":"string","description":"Order status when commission was calculated (e.g., 'DELIVERED', 'COMPLETED'). Only calculates commission for delivered/completed orders.","nullable":false},{"name":"is_refunded","type":"boolean","description":"Whether order was refunded. If true, commission may be reversed or adjusted.","nullable":false},{"name":"refund_amount","type":"double","description":"If refunded, the amount refunded to customer. Used to calculate commission reversal.","nullable":true},{"name":"commission_status","type":"string","description":"Status of commission: 'PENDING' (awaiting payout), 'PAID' (included in payout), 'REVERSED' (refunded), 'ADJUSTED' (modified).","nullable":false},{"name":"payout_id","type":"uuid","description":"ID of payout that included this commission (if paid). Null if commission is still pending.","nullable":true},{"name":"calculation_notes","type":"string","description":"Additional notes about commission calculation (e.g., 'Applied top seller rate', 'Partial refund applied'). Audit trail purposes.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when commission was calculated (typically when order transitioned to completed/delivered status).","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when commission record was last updated (if commission was adjusted or refund applied).","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_seller_id","commission_status"]},{"fieldNames":["shopping_mall_order_id","shopping_mall_seller_id"]},{"fieldNames":["order_date","commission_status"]},{"fieldNames":["payout_id","shopping_mall_seller_id"]}],"ginIndexes":[{"fieldName":"calculation_notes"}]},{"name":"shopping_mall_commission_adjustments","description":"Manual adjustments to seller commissions for corrections, penalties, bonuses, or special circumstances. Maintains complete audit trail of all commission modifications with justification and approver information. Enables transparent seller financial management and dispute resolution.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_seller_id","type":"uuid","description":"Reference to seller whose commission is being adjusted. {@link shopping_mall_seller.id}","relation":{"name":"seller","targetModel":"shopping_mall_seller"},"unique":false,"nullable":false},{"name":"shopping_mall_commission_calculation_id","type":"uuid","description":"Reference to specific commission calculation being adjusted. Null if adjustment is to overall seller account. {@link shopping_mall_commission_calculations.id}","relation":{"name":"commissionCalculation","targetModel":"shopping_mall_commission_calculations"},"unique":false,"nullable":true}],"plainFields":[{"name":"adjustment_type","type":"string","description":"Type of adjustment: 'BONUS' (positive addition), 'PENALTY' (negative deduction), 'CORRECTION' (error fix), 'REVERSAL' (undo previous), 'REFUND_ADJUSTMENT' (refund-related).","nullable":false},{"name":"adjustment_amount","type":"double","description":"Amount of adjustment (positive or negative). Positive for bonuses/credits, negative for penalties/deductions.","nullable":false},{"name":"reason","type":"string","description":"Detailed explanation of why adjustment was made. Required for audit trail and seller transparency. Examples: 'Correcting double-commission error', 'Performance bonus for top seller', 'Penalty for policy violation'.","nullable":false},{"name":"adjustment_status","type":"string","description":"Status of adjustment: 'PENDING' (awaiting approval), 'APPROVED' (authorized), 'REJECTED' (denied), 'APPLIED' (included in payout). Workflow status tracking.","nullable":false},{"name":"created_by_admin_id","type":"uuid","description":"Admin user ID who created/requested this adjustment. Audit trail for who initiated the change.","nullable":false},{"name":"approved_by_admin_id","type":"uuid","description":"Admin user ID who approved this adjustment. Null if pending or rejected. Two-level approval for financial changes.","nullable":true},{"name":"requested_date","type":"datetime","description":"Timestamp when adjustment was requested/created. Tracks when change was initiated.","nullable":false},{"name":"approved_date","type":"datetime","description":"Timestamp when adjustment was approved. Null if not yet approved.","nullable":true},{"name":"applied_date","type":"datetime","description":"Timestamp when adjustment was actually applied to seller earnings. Null if not yet applied.","nullable":true},{"name":"rejection_reason","type":"string","description":"If adjustment was rejected, explanation of why. Null for approved adjustments.","nullable":true},{"name":"supporting_documents","type":"string","description":"References to supporting documentation (file IDs, URLs) justifying the adjustment. Used for complex adjustments requiring evidence.","nullable":true},{"name":"related_order_id","type":"uuid","description":"If adjustment relates to specific order, the order ID. Helps track which order triggered the adjustment.","nullable":true},{"name":"notes","type":"string","description":"Additional internal notes about adjustment for admin reference. May include investigation details or follow-up required.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when adjustment record was created in system.","nullable":false},{"name":"updated_at","type":"datetime","description":"Timestamp when adjustment record was last modified (status change, approval, rejection).","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_seller_id","adjustment_status"]},{"fieldNames":["created_by_admin_id","requested_date"]},{"fieldNames":["adjustment_status","approved_date"]},{"fieldNames":["related_order_id","adjustment_type"]}],"ginIndexes":[{"fieldName":"reason"},{"fieldName":"rejection_reason"},{"fieldName":"notes"}]}]}]}