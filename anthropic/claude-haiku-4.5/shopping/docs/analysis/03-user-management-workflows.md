# User Management Workflows\n\n## 1. Overview\n\nTHE user management system enables complete lifecycle management for all platform users, including registration, authentication, profile management, address handling, seller onboarding, and account deactivation. These workflows establish how users interact with the platform from initial signup through account maintenance and eventual deactivation.\n\nTHIS document defines all business processes and user interactions for user management, integrated directly with the authentication system defined in the [User Roles and Authentication Guide](./02-user-roles-authentication.md).\n\n---\n\n## 2. Customer Registration Flow\n\n### 2.1 Registration Process Overview\n\nWHEN a guest user accesses the registration page, THE system SHALL display a registration form requesting the following required information:\n- Email address (required)\n- Full name - first and last name (required)\n- Password (required)\n- Password confirmation (required)\n- Terms and Conditions acceptance (required checkbox)\n- Privacy Policy acceptance (required checkbox)\n\nWHEN a user submits the registration form, THE system SHALL validate all input data before proceeding.\n\nIF all validation passes, THE system SHALL create a new customer account in \"Unverified\" state and automatically send a verification email to the provided email address.\n\nTHEN THE system SHALL display a success message instructing the user to check their email for verification link.\n\n### 2.2 Email Address Validation\n\nWHEN a user submits an email address during registration, THE system SHALL validate the email format according to RFC 5322 email standards.\n\nIF the email format is invalid (missing @, invalid domain, special characters in wrong places), THE system SHALL display an error message: \"Please enter a valid email address (e.g., user@example.com).\"\n\nWHEN a user submits an email address, THE system SHALL query the database to check if another account already exists with that exact email address (using case-insensitive comparison).\n\nIF the email is already registered to another account, THE system SHALL display an error message: \"This email address is already registered. Please log in or use a different email.\"\n\nTHE system SHALL NOT reveal whether the existing account is active or inactive for security reasons.\n\n### 2.3 Password Security Validation\n\nWHEN a user creates a password during registration, THE system SHALL enforce the following password security requirements:\n- Minimum length: 8 characters\n- Maximum length: 128 characters\n- Must contain at least one uppercase letter (A-Z)\n- Must contain at least one lowercase letter (a-z)\n- Must contain at least one number (0-9)\n- Must contain at least one special character from this set: !@#$%^&*\n- Cannot contain the user's name or email address\n- Cannot match any password on the known weak passwords blocklist\n\nIF the password does not meet these requirements, THE system SHALL display specific error messages for each violation, allowing the user to correct the password.\n\nExample error messages:\n- \"Password must be at least 8 characters long\"\n- \"Password must contain at least one uppercase letter\"\n- \"Password cannot contain your name or email address\"\n\nWHEN a user submits a registration form with password and password confirmation fields, THE system SHALL verify that both password fields match exactly (case-sensitive comparison).\n\nIF the passwords do not match, THE system SHALL display an error message: \"Passwords do not match. Please ensure both password fields are identical.\"\n\n### 2.4 Full Name Validation\n\nWHEN a user enters their name during registration, THE system SHALL validate that:\n- First name is provided and not empty\n- Last name is provided and not empty\n- First name contains only letters, spaces, hyphens, and apostrophes (international characters allowed)\n- Last name contains only letters, spaces, hyphens, and apostrophes (international characters allowed)\n- First name is between 2 and 50 characters\n- Last name is between 2 and 50 characters\n- Name fields do not contain leading or trailing whitespace\n\nIF name validation fails, THE system SHALL display specific error message: \"Names may contain only letters, spaces, hyphens, and apostrophes, and must be 2-50 characters each.\"\n\n### 2.5 Registration Validation Summary\n\nTHE following validation checklist MUST complete successfully before account creation:\n\n| Validation Rule | Requirement | Failure Error Message |\n|---|---|---|\n| Email Format | Valid RFC 5322 format with @ and domain | \"Please enter a valid email address\" |\n| Email Uniqueness | No existing account with this email | \"This email is already registered\" |\n| Email Required | Email field must not be empty | \"Email address is required\" |\n| Name Required | First and last name both provided | \"Full name is required\" |\n| Name Format | Only letters, spaces, hyphens, apostrophes | \"Name contains invalid characters\" |\n| Name Length | First name 2-50 chars, Last name 2-50 chars | \"Names must be 2-50 characters each\" |\n| Password Length | Minimum 8 characters, maximum 128 characters | \"Password must be 8-128 characters\" |\n| Password Uppercase | At least one uppercase letter (A-Z) | \"Password must contain uppercase letters\" |\n| Password Lowercase | At least one lowercase letter (a-z) | \"Password must contain lowercase letters\" |\n| Password Number | At least one digit (0-9) | \"Password must contain numbers\" |\n| Password Special | At least one special character (!@#$%^&*) | \"Password must contain special characters\" |\n| Password Match | Password and confirmation fields identical | \"Passwords do not match\" |\n| Terms Acceptance | Terms of Service checkbox marked | \"You must accept the Terms and Conditions\" |\n| Privacy Acceptance | Privacy Policy checkbox marked | \"You must accept the Privacy Policy\" |\n\n### 2.6 Account Creation\n\nWHEN all validations pass, THE system SHALL create a new customer account with the following process:\n\n1. THE system SHALL generate a unique Customer ID (UUID or similar unique identifier)\n2. THE system SHALL hash the password using bcrypt with salt rounds of 12 minimum\n3. THE system SHALL store the hashed password (NEVER storing plain text passwords)\n4. THE system SHALL set initial account status to \"Unverified\"\n5. THE system SHALL record the account creation timestamp (ISO 8601 format)\n6. THE system SHALL initialize empty address list for the new customer\n7. THE system SHALL initialize empty order history\n8. THE system SHALL initialize empty wishlist\n9. THE system SHALL initialize default notification preferences\n10. THE system SHALL store all customer information in the database\n\nTHEN THE system SHALL immediately send a verification email to the provided email address.\n\n### 2.7 Registration Workflow Diagram\n\n```mermaid\ngraph LR\n    A[\"User Submits<br/>Registration Form\"] --> B[\"Validate Email<br/>Format\"]\n    B -->|\"Invalid\"| C[\"Show Error:<br/>Invalid Email Format\"]\n    C --> A\n    B -->|\"Valid\"| D[\"Check Email<br/>Uniqueness\"]\n    D -->|\"Duplicate\"| E[\"Show Error:<br/>Email Already Registered\"]\n    E --> A\n    D -->|\"Unique\"| F[\"Validate Name<br/>Format\"]\n    F -->|\"Invalid\"| G[\"Show Error:<br/>Invalid Name Format\"]\n    G --> A\n    F -->|\"Valid\"| H[\"Validate Password<br/>Requirements\"]\n    H -->|\"Invalid\"| I[\"Show Error:<br/>Password Requirements\"]\n    I --> A\n    H -->|\"Valid\"| J[\"Verify Password<br/>Match\"]\n    J -->|\"Mismatch\"| K[\"Show Error:<br/>Passwords Don't Match\"]\n    K --> A\n    J -->|\"Match\"| L[\"Check Terms<br/>Acceptance\"]\n    L -->|\"Not Accepted\"| M[\"Show Error:<br/>Must Accept Terms\"]\n    M --> A\n    L -->|\"Accepted\"| N[\"Create Customer<br/>Account\"]\n    N --> O[\"Hash & Store<br/>Password\"]\n    O --> P[\"Send Verification<br/>Email\"]\n    P --> Q[\"Display Success<br/>Message\"]\n    Q --> R[\"Redirect to<br/>Check Email Page\"]\n```\n\n---\n\n## 3. Email Verification Process\n\n### 3.1 Verification Token Generation\n\nWHEN a customer account is created, THE system SHALL generate a unique, secure verification token using cryptographic methods (minimum 32 random characters).\n\nTHE verification token SHALL contain encoded information including:\n- Customer account ID\n- Email address\n- Token generation timestamp\n- Random cryptographic string (minimum 32 characters)\n\nTHE verification token SHALL be generated with strong randomness to make it impossible to guess or brute-force.\n\nTHEN THE system SHALL immediately send a verification email to the customer's registered email address containing:\n- Personalized greeting with customer's first name\n- Welcome message explaining the verification requirement\n- Verification link in format: `https://platform.example.com/verify-email?token=[VERIFICATION_TOKEN]`\n- Alternative manual verification code (6-8 alphanumeric characters) for customers who cannot click links\n- Clear instructions for completing email verification\n- Link to request a new verification email if the current link expires\n- Customer support contact information for assistance\n- Expected timeline for receiving the verification\n\nTHE verification email SHALL be delivered within 5 seconds of account creation.\n\n### 3.2 Verification Token Expiration\n\nWHEN a verification token is generated, THE system SHALL set an expiration time of 24 hours from generation.\n\nWHEN a customer clicks the verification link, THE system SHALL:\n1. Extract the verification token from the URL query parameter\n2. Look up the token in the database\n3. Validate that the token exists and has not been used previously\n4. Verify that the token has not expired (current time < token expiration time)\n5. Verify that the email in the URL matches the email associated with the token\n6. Verify that the account associated with the token still exists and is in \"Unverified\" status\n\nIF the token has expired (more than 24 hours since generation), THE system SHALL display: \"Verification link has expired. Please request a new verification email.\"\n\nIF the token is invalid or does not match the provided email, THE system SHALL display: \"Invalid verification link. Please check the link and try again.\"\n\nIF the token has already been used (duplicate click), THE system SHALL display: \"This verification link has already been used. Your email is already verified.\"\n\nIF the account associated with the token no longer exists, THE system SHALL display: \"The account associated with this verification link no longer exists.\"\n\n### 3.3 Verification Completion Process\n\nWHEN a customer successfully verifies their email by clicking the valid verification link or entering the correct verification code, THE system SHALL:\n\n1. Mark the account as \"Email Verified\"\n2. Update the account status to \"Active Customer\"\n3. Record the verification completion timestamp\n4. Invalidate the used verification token (mark as used, prevent reuse)\n5. Invalidate all other unused verification tokens for this customer\n6. Send a confirmation email: \"Your email has been verified successfully. Your account is now active and ready to use.\"\n7. Display success message on the webpage\n\nTHEN THE system SHALL redirect the customer to one of:\n- The login page (if customer was not already logged in)\n- The customer dashboard (if customer was logged in during verification)\n- A \"Verification Complete\" page with next steps and call-to-action\n\n### 3.4 Resend Verification Email Workflow\n\nWHEN an unverified customer requests to resend the verification email, THE system SHALL:\n\n1. Prompt the customer to enter their email address\n2. Validate that the email address format is correct\n3. Search for an account associated with that email\n4. Verify that the account exists and is still in \"Unverified\" status\n\nIF the email address is not found, THE system SHALL display: \"This email is not registered. Please check and try again or create a new account.\"\n\nIF the email address is associated with a verified account, THE system SHALL display: \"This account is already verified. Please log in to your account.\"\n\nIF the account is still unverified:\n1. Generate a new verification token\n2. Mark any previous tokens as expired\n3. Send a new verification email with the new token\n4. Display confirmation message: \"A new verification email has been sent to your email address. Please check your inbox.\"\n\nTHE system SHALL rate-limit resend requests to prevent abuse:\n- Maximum 5 resend requests per email address per 24 hours\n- Minimum 60-second delay between consecutive resend requests for the same email\n\nIF rate limit is exceeded, THE system SHALL display: \"You have requested verification email too many times. Please try again after [TIME].\"\n\n### 3.5 Unverified Account Restrictions\n\nWHILE an account is in \"Unverified\" state, THE customer SHALL be unable to:\n- Place orders or make purchases\n- Create or manage shopping carts\n- Create or manage wishlists\n- Write product reviews or ratings\n- Access order history (no orders exist yet)\n- Manage multiple addresses\n- Process payments\n- Access most customer dashboard features\n\nTHE unverified customer MAY:\n- Browse product catalog as authenticated user\n- Search and filter products\n- View product details and specifications\n- View product reviews and ratings written by other customers\n- View their own account profile (read-only)\n- Attempt login (redirected to verification reminder)\n- Request verification email resend\n- Update their password\n\nWHEN an unverified customer attempts to perform a restricted action, THE system SHALL display: \"Please verify your email address to access this feature. Check your inbox for the verification email. If you haven't received it, you can request a new verification email here [LINK].\"\n\n---\n\n## 4. Login and Session Management\n\n### 4.1 Customer Login Workflow\n\nWHEN a customer accesses the login page, THE system SHALL present a login form requesting:\n- Email address or username field (required)\n- Password field (required)\n- Optional: \"Remember me\" checkbox (for persistent login)\n\nWHEN a customer submits the login form with email and password, THE system SHALL:\n\n1. Validate that both email and password fields are provided and not empty\n2. Search for a customer account with the matching email address (case-insensitive)\n3. Verify that the account exists in the database\n4. Check the account status is \"Active\" or \"Email Verified\" (not suspended, deactivated, or deleted)\n5. Retrieve the stored password hash\n6. Compare the entered password against the stored hash using bcrypt verification\n7. Verify the passwords match\n\nIF email is not found in the system, THE system SHALL display: \"No account found with this email address.\"\n\nIF the password is incorrect, THE system SHALL display: \"Email or password is incorrect.\"\n\nIF the account is unverified, THE system SHALL display: \"Please verify your email address before logging in. Check your inbox for the verification email.\"\n\nIF the account is suspended, THE system SHALL display: \"This account has been suspended. Contact customer support to resolve the issue.\"\n\nIF the account is deactivated, THE system SHALL display: \"This account has been deactivated. Contact customer support if you wish to reactivate it.\"\n\n### 4.2 Successful Login and Session Creation\n\nWHEN login credentials are validated successfully, THE system SHALL:\n\n1. Generate a JWT access token with 15-minute expiration\n2. Generate a JWT refresh token with 7-day expiration\n3. Record the login timestamp (ISO 8601 format)\n4. Capture and record the IP address of the login request\n5. Capture and record the user agent (browser, device information)\n6. Create an active session record in the session store\n7. Associate the session with the customer account\n8. Record device fingerprint information for security tracking\n\nTHE access token SHALL contain the following claims:\n- User ID (customer ID)\n- User email address\n- User role (\"customer\")\n- User name\n- Token type (\"access\")\n- Token expiration timestamp\n- Session ID\n- Token issue time\n\nTHE refresh token SHALL contain:\n- User ID\n- Token type (\"refresh\")\n- Session ID\n- Expiration timestamp (7 days from creation)\n- Device fingerprint\n\nTHEN THE system SHALL:\n1. Return both tokens to the client in JSON response\n2. Redirect the customer to their dashboard or requested page\n3. Display success message: \"Login successful. Welcome back, [CUSTOMER_NAME]!\"\n4. Initialize customer preferences and settings for the session\n\n### 4.3 Session Management for Logged-In Users\n\nWHILE a customer maintains an active session, THE system SHALL validate the access token on each API request and secured endpoint.\n\nWHEN an access token is still valid (not expired), THE system SHALL process the request normally without requiring re-authentication.\n\nWHEN an access token has expired but the refresh token is valid, THE system SHALL:\n1. Automatically generate a new access token\n2. Allow the original request to proceed with the new token\n3. NOT require the customer to manually log in again\n4. Update the access token in the client's session storage\n\nWHEN both access token and refresh token have expired, THE system SHALL:\n1. Terminate the session\n2. Clear all session data\n3. Display message to customer: \"Your session has expired. Please log in again.\"\n4. Redirect to login page\n\n### 4.4 Password Reset Workflow\n\nWHEN a customer clicks \"Forgot Password\" link on the login page, THE system SHALL:\n\n1. Display a password reset form requesting the customer's email address\n2. Accept the email address from the customer\n3. Query the database to validate that an account exists for that email\n4. IF no account is found, THE system SHALL display a generic message (for security): \"If an account exists with this email, you will receive a password reset email shortly.\"\n\nIF an account is found:\n1. Generate a password reset token (similar to email verification token, 24-hour expiration)\n2. Store the reset token securely\n3. Send a password reset email to the customer\n\nWHEN the customer receives the password reset email, it SHALL contain:\n- Personalized greeting with customer's name\n- Password reset link: `https://platform.example.com/reset-password?token=[RESET_TOKEN]`\n- Manual reset code (6-8 alphanumeric characters) as alternative\n- Link expiration information (valid for 1 hour)\n- Security notice: \"If you did not request this, please ignore this email\"\n- Instruction to contact support if they didn't request a reset\n- Customer support contact information\n\nTHE password reset token SHALL expire after 1 hour (more restrictive than email verification for security reasons).\n\nWHEN a customer clicks the password reset link and enters a new password, THE system SHALL:\n1. Validate the reset token (must exist, not expired, not previously used)\n2. Verify token has not expired (current time < token expiration time)\n3. Retrieve the associated customer account\n4. Validate new password meets password security requirements\n5. IF validation passes:\n   - Hash the new password\n   - Update the customer's password hash in database\n   - Invalidate all existing sessions and refresh tokens (force re-login on all devices)\n   - Mark the reset token as used (prevent reuse)\n   - Send confirmation email: \"Your password has been successfully reset.\"\n   - Display confirmation message on screen\n   - Redirect to login page\n\nIF validation fails:\n- Display specific error message\n- Allow customer to try again\n- Preserve the reset token (not yet expired)\n\n### 4.5 Account Lockout Policy\n\nWHEN a customer fails to log in with more than 5 incorrect passwords within 15 minutes, THE system SHALL:\n\n1. Temporarily lock the account\n2. Record the lockout timestamp\n3. Display message: \"Account temporarily locked due to multiple failed login attempts. Please try again after 30 minutes or reset your password.\"\n4. Send email notification: \"Multiple failed login attempts detected on your account. If this wasn't you, please reset your password immediately.\"\n5. Include password reset link in the email\n\nWHEN 30 minutes have passed since the last failed attempt, THE system SHALL automatically unlock the account.\n\nALTERNATIVELY, WHEN a customer verifies their email or successfully resets their password, THE system SHALL unlock any account lockout immediately.\n\n### 4.6 Logout and Session Termination\n\nWHEN a customer clicks the logout button, THE system SHALL:\n\n1. Identify the current session\n2. Invalidate the current access token\n3. Invalidate the current refresh token\n4. Delete the active session record from the session store\n5. Clear all client-side token storage (remove tokens from browser/app storage)\n6. Clear session cookies\n7. Redirect to home page or login page\n8. Display message: \"You have been logged out successfully.\"\n\nWHEN a customer closes the browser or loses connection unexpectedly, THE system SHALL:\n\n1. Maintain the session until token expiration occurs (refresh token timeout = session timeout)\n2. Allow the session to be resumed if customer logs in again within the expiration window\n3. Treat connection loss as normal session idle (no forced logout)\n\n---\n\n## 5. Customer Profile Management\n\n### 5.1 Profile Data Structure\n\nTHE customer profile SHALL contain the following required data:\n- Customer ID (unique identifier, assigned by system)\n- Email address (verified, unique across platform)\n- Full name (first and last name)\n- Phone number (optional)\n- Date of birth (optional)\n- Gender (optional)\n- Account creation timestamp (ISO 8601 format)\n- Last login timestamp\n- Email verification status (verified or unverified)\n- Account status (active, inactive, suspended, deleted)\n- Notification preferences (JSON object)\n- Two-factor authentication status (enabled or disabled)\n- Account privacy settings\n- Preferred language and currency\n- Marketing communication preferences\n\n### 5.2 Profile Retrieval and Display\n\nWHEN a customer accesses their profile page, THE system SHALL:\n\n1. Retrieve the complete customer profile data from the database\n2. Verify the customer has permission to view their own profile (authentication check)\n3. Display all profile information in organized sections:\n   - Personal Information (name, email, phone, birth date)\n   - Account Settings (status, creation date, last login)\n   - Security Settings (password change option, two-factor auth status, active sessions)\n   - Notification Preferences (email subscriptions, push notifications)\n   - Privacy Settings (profile visibility, data sharing options)\n4. Provide options to edit each field\n5. Show profile verification status and completeness indicator\n6. Display account security information\n7. Show connected devices and active sessions\n\n### 5.3 Profile Update Workflow\n\nWHEN a customer updates profile information (name, phone number, date of birth, preferences), THE system SHALL:\n\n1. Accept the updated information from the customer form\n2. Validate all new data according to validation rules (see section 2.4 for name validation, etc.)\n3. IF validation passes:\n   - Update the profile in the database with new values\n   - Record the timestamp of modification\n   - Log this change in the customer's account activity history\n   - Display confirmation: \"Profile updated successfully.\"\n   - Optionally send confirmation email\n4. IF validation fails:\n   - Display specific error messages\n   - Do NOT update the profile\n   - Allow customer to correct and retry\n\n### 5.4 Email Change Request Workflow\n\nWHEN a customer requests to change their email address, THE system SHALL:\n\n1. Request the customer's current password for security verification\n2. Validate the new email address format (must be valid email format)\n3. Validate that the new email is not already in use by another account\n4. Send a verification email to the NEW email address\n5. WHILE the email change is pending verification:\n   - Keep the old email active for account access\n   - Mark the email as \"change pending\"\n   - Display message: \"Please verify your new email address\"\n   - Require email verification from new address within 24 hours\n\nWHEN the customer verifies the new email address:\n1. Update the account email to the new email address\n2. Send confirmation email to BOTH old and new email addresses\n3. Display message: \"Your email address has been successfully updated.\"\n4. Allow customer to continue using the account\n\nIF the email change verification times out after 24 hours:\n1. Cancel the email change request\n2. Keep the original email address active\n3. Send notification: \"Email change was not completed in time. Your email remains unchanged.\"\n\n### 5.5 Name and Personal Information Validation\n\nWHEN a customer enters or updates their name, THE system SHALL validate:\n- First name contains only letters, spaces, hyphens, and apostrophes (international characters supported)\n- Last name contains only letters, spaces, hyphens, and apostrophes (international characters supported)\n- First name is between 2 and 50 characters\n- Last name is between 2 and 50 characters\n- No leading or trailing spaces\n- At least one character in first name and last name\n\nIF validation fails, THE system SHALL display: \"Name contains invalid characters or incorrect length. Names may contain only letters, spaces, hyphens, and apostrophes, and must be 2-50 characters each.\"\n\n### 5.6 Phone Number Validation\n\nWHEN a customer enters a phone number, THE system SHALL:\n\n1. Accept international phone number formats\n2. Remove formatting characters (spaces, dashes, parentheses, dots)\n3. Validate that the resulting string contains only digits and optional plus sign (+) prefix\n4. Validate minimum length of 10 digits\n5. Validate maximum length of 15 digits\n6. Accept phone numbers with country code prefix (e.g., +1 for US, +44 for UK)\n\nIF validation fails, THE system SHALL display: \"Please enter a valid phone number (10-15 digits in international format).\"\n\n---\n\n## 6. Customer Address Management\n\n### 6.1 Multiple Address Support\n\nTHE system SHALL allow each customer to maintain multiple delivery addresses for ordering flexibility.\n\nEACH customer SHALL be able to store up to 10 distinct addresses by default.\n\nTHE system SHALL support both:\n- **Default delivery address**: Automatically selected during checkout, can be changed\n- **Multiple alternative delivery addresses**: Selected explicitly for specific orders\n\n### 6.2 Address Addition Workflow\n\nWHEN a customer clicks \"Add New Address\", THE system SHALL present an address form requesting:\n- Full name of recipient (required)\n- Phone number for delivery (required)\n- Address line 1 - street address and number (required)\n- Address line 2 - apartment, suite, building, etc. (optional)\n- City/Town name (required)\n- State/Province/Region (required)\n- ZIP/Postal code (required, format depends on country)\n- Country (required, selection from supported countries list)\n- Address type/label (Home, Work, Other, Parent's House, etc.)\n- Set as default address (optional checkbox)\n\nWHEN a customer submits the address form, THE system SHALL:\n\n1. Validate all required fields are provided and not empty\n2. Validate address format according to country-specific rules:\n   - ZIP code format matches country requirements (5 digits for US, etc.)\n   - Phone number is valid format for the country\n   - City name is valid and recognized (optional validation)\n3. Perform address standardization:\n   - Normalize spacing and capitalization\n   - Remove extra whitespace\n   - Format ZIP codes consistently\n4. Optionally verify address validity via address verification service (if integrated)\n5. Store the complete address record in the database\n6. Record address creation timestamp\n7. Display success message: \"Address added successfully.\"\n\nIF the customer marks this as default address:\n1. Set this address as the default\n2. Automatically unset any previously default address\n3. Display confirmation: \"This address is now your default delivery address.\"\n\n### 6.3 Address Update and Modification\n\nWHEN a customer selects an existing address to edit, THE system SHALL:\n\n1. Populate the form with current address data\n2. Allow modification of any address field\n3. Perform same validation as address creation\n4. Update all modified fields in the database\n5. Record the modification timestamp\n6. Display confirmation: \"Address updated successfully.\"\n7. Notify customer if this is their default address\n\n### 6.4 Address Deletion\n\nWHEN a customer requests to delete an address, THE system SHALL:\n\n1. Display confirmation dialog: \"Are you sure you want to delete this address?\"\n2. Check if this address is the default address\n\nIF the address is the default address:\n- THE system SHALL display: \"This is your default address. Please set another address as default before deleting this one.\"\n- THE system SHALL NOT allow deletion until another address is set as default\n\nIF the address is not the default:\n1. Delete the address record from the database\n2. Display confirmation: \"Address has been deleted.\"\n3. Update address list display\n4. If this was being used in a pending order, notify customer\n\n### 6.5 Default Address Management\n\nTHE system SHALL maintain exactly one address as the customer's default delivery address.\n\nWHEN a customer has no addresses, THE default address SHALL be null/empty until the first address is created.\n\nWHEN a customer creates their first address:\n- THE system SHALL automatically set it as the default address\n- THE system SHALL display: \"This address is set as your default delivery address.\"\n\nWHEN a customer adds subsequent addresses and marks one as default:\n1. Identify the current default address\n2. Unset it as default\n3. Set the newly selected address as default\n4. Display confirmation: \"Default address changed to: [ADDRESS]\"\n\n### 6.6 Address Validation Rules Detailed\n\n| Field | Validation Rule | Error Message |\n|---|---|---|\n| Recipient Name | 2-50 characters, letters/spaces/apostrophes | \"Recipient name must be 2-50 characters\" |\n| Phone | 10-15 digits in international format | \"Please enter a valid phone number\" |\n| Address Line 1 | Not empty, 5-255 characters, alphanumeric + common chars | \"Street address is required and must be valid\" |\n| Address Line 2 | Optional, max 100 characters if provided | \"Apartment/suite must be 100 characters or less\" |\n| City | 2-50 characters, letters/spaces only | \"Please enter a valid city name\" |\n| State | Must match country's state/province list | \"Please select a valid state\" |\n| ZIP Code | Format specific to selected country | \"Please enter a valid postal code for [COUNTRY]\" |\n| Country | Must be in platform's supported countries | \"Please select a supported country\" |\n\n### 6.7 Delivery vs Billing Address\n\nWHEN placing an order, THE system SHALL:\n\n1. Allow customer to select a delivery address from stored addresses\n2. Allow customer to specify if billing address is same as delivery address\n3. If different: Allow customer to enter a different billing address\n4. THE billing address SHALL follow the same validation rules as delivery addresses\n5. Store both addresses with the order for fulfillment and billing purposes\n\n---\n\n## 7. Seller Account Setup and Onboarding\n\n### 7.1 Seller Registration Requirements\n\nWHEN a customer with verified email address requests to create a seller account, THE system SHALL:\n\n1. Verify the user has an active customer account\n2. Verify the customer's email is already verified\n3. Display seller registration form requesting:\n   - Store name (required, must be unique)\n   - Store description (required, 50-500 characters)\n   - Business type (required selection: individual, small business, enterprise)\n   - Country of operation (required)\n   - Business registration number (required if applicable to country/business type)\n   - Contact person full name (required)\n   - Phone number for business (required)\n   - Business address (required)\n   - Bank account information for commission payouts (required)\n   - Tax ID / VAT number (required if applicable by region)\n\n### 7.2 Store Information Collection and Validation\n\nWHEN collecting seller store information, THE system SHALL validate:\n\n- Store name is 2-100 characters and contains valid characters\n- Store name is unique (no duplicate store names on platform)\n- Store name is not offensive or against policy\n- Store description is 10-5000 characters and contains meaningful content\n- Business phone number follows international format (10-15 digits)\n- Business address follows address validation rules (see section 6.6)\n- Bank account information format is valid for the specified country\n- All required fields for the selected country/business type are completed\n\nIF any validation fails:\n1. Display specific error message for the failing field\n2. Do NOT create seller account\n3. Preserve the customer's entered data (allow retry without re-entering everything)\n\n### 7.3 Identity and Business Verification\n\nWHEN a seller completes registration successfully, THE system SHALL:\n\n1. Review all submitted information for completeness\n2. Mark the seller account as \"Pending Verification\"\n3. Restrict seller from adding products until verified\n4. Send notification to the seller: \"Your seller account has been created and is pending verification. Our team will review your information and approve your account within 1-2 business days.\"\n5. Notify admin dashboard that new seller verification is required\n\nWHEN an admin processes seller verification, THE system SHALL allow admin to:\n\n1. Review all seller information\n2. Verify business registration number (if applicable)\n3. Verify tax ID validity\n4. Confirm banking information\n5. Perform background checks (if configured)\n6. Make determination: **Approve**, **Request More Information**, or **Reject**\n\n### 7.4 Seller Approval Workflow\n\nWHEN an admin approves a seller account, THE system SHALL:\n\n1. Update seller status to \"Active\"\n2. Grant seller permissions to:\n   - Add and manage products\n   - Manage inventory\n   - View and manage orders\n   - Access seller dashboard\n   - View commission and payment information\n3. Send email to seller: \"Your seller account has been approved! You can now start adding products to your store. Log in to the seller dashboard to get started.\"\n4. Provide link to seller dashboard\n5. Display success message to admin\n\nWHEN an admin rejects a seller account, THE system SHALL:\n\n1. Update seller status to \"Rejected\"\n2. Send detailed email to seller explaining reasons for rejection\n3. Provide instructions for reapplication process\n4. Include timeline for when they can reapply\n5. Disable seller account access to product management\n6. Preserve seller application data for appeal/reapplication\n\n### 7.5 Seller Suspension Process\n\nTHE system SHALL allow admins to suspend seller accounts for:\n- Policy violations (fraudulent products, inappropriate behavior, etc.)\n- Poor fulfillment performance (less than 80% on-time delivery rate)\n- Excessive customer complaints (5+ complaints within 30 days)\n- Failure to respond to customer inquiries within 24 hours\n- Quality issues (average rating drops below 2.0 stars)\n- Payment processing failures or chargebacks\n\nWHEN a seller account is suspended:\n1. Update seller status to \"Suspended\"\n2. Hide all active product listings from customer search and browse\n3. Prevent new product listings\n4. Allow existing orders to continue to completion\n5. Send detailed notification to seller with:\n   - Reason for suspension\n   - Duration of suspension (if time-limited)\n   - Actions required to reinstate account\n   - Appeal process and contact information\n6. Withhold seller commission payouts until suspension resolved\n\n### 7.6 Bank Account Information and Commission Setup\n\nTHE system SHALL collect and securely store:\n- Bank account holder name\n- Bank account number (encrypted)\n- Bank routing number or SWIFT code (encrypted)\n- Bank name and branch information\n- Currency for payouts\n- Tax information for commission calculation\n- Payment method preference (direct deposit, wire transfer, etc.)\n\nWHEN a seller updates bank account information:\n1. Validate the new information format\n2. Verify the account information (if possible with payment processor)\n3. Update the stored information\n4. Send verification email to seller confirming account change\n5. Test deposit (optional small deposit to verify account validity)\n\nALL banking information SHALL be encrypted at rest in the database.\n\n---\n\n## 8. Seller Profile Management\n\n### 8.1 Store Information Management\n\nWHEN a seller accesses their profile, THE system SHALL allow them to:\n- View and edit store name (with admin approval required for name changes)\n- View and edit store description (displayed publicly)\n- View and edit business contact information\n- View verification status and completion date\n- View commission rates and schedule\n- View payout information and history\n- View store performance metrics and ratings\n\n### 8.2 Store Branding and Public Presentation\n\nWHEN a seller updates their store description, THE system SHALL:\n1. Accept up to 5000 characters\n2. Validate that description does not contain prohibited content (external URLs, contact info, etc.)\n3. Update the description\n4. Display confirmation: \"Store description updated successfully.\"\n5. Make updated description immediately visible on public store page\n\nTHE store description SHALL be displayed publicly on the seller's store page and used in seller search results.\n\n### 8.3 Seller Verification Status Tracking\n\nWHEN viewing seller profile, THE system SHALL display the current verification status:\n- **Pending Verification**: Account submitted, awaiting admin review (1-2 business days)\n- **Verified**: Account approved and fully active\n- **Rejected**: Account rejected by admin, option to reapply\n- **Suspended**: Account suspended for policy violation, will be restored on [DATE] or upon action\n- **Appeal in Review**: Seller has appealed suspension or rejection\n\nTHE seller SHALL see a message explaining their current status and any required next steps.\n\n### 8.4 Commission and Payment Settings\n\nWHEN a seller views their profile, THE system SHALL display:\n- Current commission rate (percentage charged per transaction)\n- Payout frequency (typically weekly)\n- Minimum payout threshold (usually $5-10)\n- Available balance (pending commission not yet paid)\n- Recent transactions (last 10 sales with commission amounts)\n- Payment history (past payouts with dates and amounts)\n\nWHEN a seller updates payment information:\n1. Validate the new bank account information\n2. Update securely encrypted storage\n3. Send verification email to confirm change\n4. Test the account (optional small deposit)\n\n---\n\n## 9. Account Settings and Preferences\n\n### 9.1 Notification Preferences\n\nWHEN a customer accesses notification settings, THE system SHALL provide toggles for:\n- Order confirmations and status updates (highly recommended)\n- Product reviews and seller responses (important)\n- Promotional emails and special offers (optional)\n- Price drop notifications for wishlisted items (optional)\n- Newsletter subscriptions (optional)\n- Security alerts and login notifications (highly recommended)\n- New feature announcements (optional)\n- Weekly summary digest vs real-time notifications\n\nWHEN a customer modifies notification preferences:\n1. Update preferences immediately in database\n2. Display confirmation: \"Notification preferences updated.\"\n3. Record the preference change in activity log\n4. Apply new preferences to all future communications\n\n### 9.2 Privacy Settings\n\nWHEN a customer accesses privacy settings, THE system SHALL provide options to:\n- Control profile visibility (public/private/friends only)\n- Control review visibility (show all reviews publicly)\n- Control wishlist visibility to other users (private/public)\n- Manage data sharing with third parties (newsletters, analytics, etc.)\n- Control marketing communication preferences\n- Opt-in/opt-out of product recommendations\n\n### 9.3 Security Settings\n\nWHEN a customer accesses security settings, THE system SHALL display:\n- Last login information (date, time, IP address, device type)\n- Active sessions across different devices\n- Password change date and time\n- Two-factor authentication status (enabled/disabled)\n- Connected devices (mobile, desktop, web)\n- Device names and last activity\n\nWHEN a customer requests to view connected devices, THE system SHALL display:\n- Device type (mobile phone, tablet, desktop computer)\n- Browser and operating system information\n- IP address and approximate location\n- Last activity timestamp\n- Options to logout from specific devices\n\nWHEN a customer selects \"logout from all other devices\":\n1. Terminate all sessions except the current one\n2. Invalidate all refresh tokens except current session's token\n3. Send notification email: \"You have been logged out from all other devices. If you didn't authorize this, please reset your password immediately.\"\n4. Display confirmation on screen: \"You have been successfully logged out from all other sessions.\"\n\n### 9.4 Two-Factor Authentication (Optional)\n\nIF two-factor authentication is implemented:\n\nWHEN a customer enables 2FA:\n1. Present option to choose authentication method:\n   - SMS text message (if phone number on file)\n   - Authenticator app (e.g., Google Authenticator, Authy)\n   - Email verification\n2. For SMS/Email: Send verification code immediately\n3. For Authenticator app: Display QR code and backup codes\n4. Require customer to verify 2FA works before enabling\n5. Display backup codes (save in secure location)\n6. Display confirmation: \"Two-factor authentication has been enabled.\"\n\nWHEN a customer logs in with 2FA enabled:\n1. After password verification, prompt for 2FA code\n2. Accept code from chosen 2FA method (SMS, app, email, etc.)\n3. Validate the code\n4. Complete login process\n\n---\n\n## 10. Account Deactivation and Closure\n\n### 10.1 Temporary Account Deactivation\n\nWHEN a customer requests to deactivate their account, THE system SHALL:\n\n1. Display confirmation dialog with clear explanation of deactivation\n2. List impacts: \"You will not be able to purchase. Your orders remain visible in your history. Your profile will not be visible to other users.\"\n3. Request confirmation with checkbox: \"I understand I cannot purchase with a deactivated account\"\n4. Optionally collect feedback: \"Why are you deactivating your account?\" (dropdown menu)\n5. Require password re-entry for security confirmation\n\nWHEN customer confirms deactivation:\n1. Update account status to \"Deactivated\"\n2. Record deactivation timestamp\n3. Invalidate all active sessions and refresh tokens\n4. Hide profile from other users\n5. Remove from customer lists and recommendations\n6. Send confirmation email: \"Your account has been deactivated successfully. You can reactivate it at any time by logging in with your email and password.\"\n7. Display success message\n\nWHILE account is deactivated:\n- Customer cannot log in\n- Customer cannot place new orders\n- Customer cannot manage addresses or preferences\n- Customer order history is preserved (can be viewed upon reactivation)\n- Customer reviews and ratings remain visible (with author hidden)\n- Customer data is retained\n\n### 10.2 Account Reactivation\n\nWHEN a customer with deactivated account requests to log in, THE system SHALL:\n\n1. Identify the account is deactivated\n2. Display message: \"This account has been deactivated. Would you like to reactivate it? Click 'Yes' to continue with login.\"\n3. Allow customer to reactivate by confirming password\n\nWHEN customer confirms reactivation:\n1. Update account status back to \"Active\"\n2. Restore profile visibility\n3. Allow normal login\n4. Send confirmation email: \"Your account has been reactivated. Welcome back!\"\n5. Restore access to all features\n6. Display welcome message on dashboard\n\n### 10.3 Permanent Account Deletion\n\nWHEN a customer requests permanent account deletion, THE system SHALL:\n\n1. Display warning dialog: \"Permanent deletion cannot be undone. Once deleted, your personal information will be removed from our system.\"\n2. List data that will be deleted or retained\n3. Require customer to confirm deletion TWICE (two separate confirmations)\n4. Request password confirmation for security\n5. Provide option to download account data before deletion (optional)\n\nWHEN customer confirms deletion:\n1. Delete personal information (name, email, phone, addresses)\n2. Anonymize the account:\n   - Replace customer name with \"Deleted User\"\n   - Replace email with anonymous identifier\n   - Remove phone numbers\n   - Remove stored addresses\n3. Retain order history and transaction records (for financial/legal purposes)\n4. Retain reviews and ratings (attribute to \"Deleted User\")\n5. Send final confirmation email: \"Your account has been permanently deleted. Your personal information has been removed from our system.\"\n6. Prevent any future login attempts with that email address\n7. Mark email as deleted in database\n\n### 10.4 Data Retention Policies\n\nTHE system SHALL retain the following data after account deletion (for legal/compliance reasons):\n- Order transactions and payment history (7 years - financial records)\n- Shipping and delivery records (3 years - logistics/disputes)\n- Dispute records and refund transactions (3 years - dispute resolution)\n- Reviews and ratings authored (retained but attributed to \"Deleted User\")\n- Admin audit logs (2 years - compliance records)\n- Customer communications (1 year - dispute support)\n\nTHE system SHALL delete the following data upon account deletion:\n- Customer personal identifying information (name, email, phone)\n- Delivery addresses (except those linked to completed orders)\n- Notification preferences and settings\n- Device and session records\n- Shopping cart and wishlist\n- Password hash and authentication tokens\n- Profile information and preferences\n\n### 10.5 Seller Account Closure Requirements\n\nWHEN a seller requests account closure, THE system SHALL verify:\n- All active orders are fulfilled or cancelled (cannot have pending orders)\n- No pending payouts exist (seller has received all commission payments)\n- No disputed transactions exist (all disputes are resolved)\n- All seller products are removed from catalog (archived or deleted)\n- No unresolved customer complaints or refunds\n\nIF any of these conditions are not met:\n- THE system SHALL display: \"Cannot close seller account. Please resolve: [LIST OF ITEMS]. After resolving these items, you can close your account.\"\n- THE system SHALL NOT proceed with closure\n\nWHEN all conditions are satisfied:\n1. Close the seller account\n2. Make all seller products invisible/archived\n3. Prevent future product uploads\n4. Retain seller's transaction history for records\n5. Send confirmation email: \"Your seller account has been closed. Your transaction history remains available for reference.\"\n6. Update seller status to \"Closed\"\n\n### 10.6 Account Recovery Options\n\nWHEN a customer has permanently deleted their account:\n1. THE system SHALL allow creating a new account with the same email (after 30-day waiting period)\n2. THE system SHALL NOT automatically restore or merge the deleted account\n3. THE system SHALL NOT pre-populate old account data into new account\n4. THE customer must register as a completely new customer\n\nIF a customer accidentally deleted their account and contacts support within 7 days:\n- THE support team MAY request verification of account ownership\n- THE support team MAY restore the account from backup\n- THE customer SHALL be required to set a new password\n- THE account restoration is not guaranteed (discretionary)\n\n---\n\n## 11. Account Security Features\n\n### 11.1 Password Change Workflow\n\nWHEN a customer requests to change their password, THE system SHALL:\n\n1. Present form requesting current password\n2. Require customer to enter current password (for security verification)\n3. Validate that current password matches\n4. IF incorrect: Display \"Current password is incorrect\" and do NOT proceed\n5. Present form for new password (required twice for confirmation)\n6. Validate new password meets security requirements\n7. IF validation fails: Display specific error messages\n8. IF all valid: Hash new password and update database\n\nWHEN password change is successful:\n1. Update password hash in database\n2. Invalidate all existing refresh tokens (force re-login on all devices)\n3. Send notification email: \"Your password has been changed. If you didn't make this change, please contact us immediately.\"\n4. Display confirmation: \"Password changed successfully. You have been logged out from all devices for security. Please log in again.\"\n5. Redirect to login page\n\n### 11.2 Account Activity History\n\nWHEN a customer views their account activity, THE system SHALL display:\n- Login attempts (successful and failed) with timestamps, IP addresses, and devices\n- Profile changes (what was changed and when)\n- Address additions/modifications/deletions\n- Password changes\n- Email verification completion\n- Account deactivation/reactivation\n- Two-factor authentication enable/disable\n- Notification preference changes\n\nEach activity entry SHALL show:\n- Type of activity (clear description)\n- Date and time of activity (ISO 8601 format)\n- IP address (if applicable)\n- Device information (browser, OS, device type)\n- Result (success or failure)\n- Location (approximate, if available)\n\n### 11.3 Security Alerts\n\nTHE system SHALL automatically send security alert emails when:\n- New device login detected\n- Password change completed\n- Email address change requested\n- Account locked due to failed attempts\n- Unexpected login from new location (if enabled)\n- Unusual account activity detected\n\nWHEN a customer receives a security alert about activity they did not perform:\n1. THE system SHALL provide immediate password reset link\n2. THE system SHALL provide option to review and logout from all active sessions\n3. THE system SHALL provide contact information for immediate support\n4. THE system SHALL recommend enabling two-factor authentication\n\n---\n\n## 12. Business Rules and Constraints\n\n### 12.1 Email and Account Uniqueness\n\nTHE system SHALL enforce that email addresses are unique across all accounts (case-insensitive comparison).\n\nTHE system SHALL validate email format against RFC 5322 standards.\n\nTHE system SHALL NOT allow two accounts with same email address (even with different capitalization).\n\n### 12.2 Password Security Policy\n\nTHE system SHALL require passwords with:\n- Minimum 8 characters, maximum 128 characters\n- At least one uppercase letter (A-Z)\n- At least one lowercase letter (a-z)\n- At least one number (0-9)\n- At least one special character (!@#$%^&*)\n\nTHE system SHALL prevent passwords that are:\n- Dictionary words or common words\n- User's name or reversed name\n- User's email address or parts of email\n- Previously used passwords (last 5 remembered)\n- Common weak passwords from blocklist\n\n### 12.3 Rate Limiting and Anti-Abuse\n\nWHEN a customer attempts to register multiple accounts:\n- MAXIMUM 5 accounts per IP address per 24 hours\n- IF exceeded: Display \"Too many accounts created from this IP. Please try again later.\"\n\nWHEN a customer attempts password reset:\n- MAXIMUM 5 reset attempts per email per 24 hours\n- IF exceeded: \"Too many password reset attempts. Please try again after 24 hours.\"\n\nWHEN a customer attempts to log in:\n- Track failures per IP address\n- Lock account after 5 failures within 15 minutes\n- Temporary lock duration: 30 minutes\n\nWHEN a customer attempts to resend verification email:\n- MAXIMUM 5 resends per email per 24 hours\n- MINIMUM 60-second delay between consecutive requests\n- IF exceeded: \"Too many verification email requests. Please try again after [TIME].\"\n\n### 12.4 Address Validation Standards\n\nWHEN validating addresses:\n- Normalize spacing and capitalization\n- Validate country selection from supported countries list\n- Validate state/province against country's state list\n- Validate postal code format specific to country\n- Verify required fields based on country\n- Check minimum address completeness\n\n### 12.5 Seller Verification Requirements\n\nWHEN verifying seller accounts, THE system SHALL require:\n- Valid business registration or identification\n- Valid tax ID (varies by country)\n- Verified bank account information\n- Verified business address\n- Business description provided\n- Compliance with platform policies\n\n### 12.6 Data Integrity Rules\n\nTHE system SHALL enforce:\n- No two customers with same email address\n- No two sellers with same store name\n- Customer must have at least one address after first address created\n- Every customer/seller must have valid email\n- All timestamps stored in UTC timezone\n- Deleted/deactivated accounts cannot be reused\n\n---\n\n## 13. Error Handling and Edge Cases\n\n### 13.1 Duplicate Email During Registration\n\nWHEN a user attempts to register with an email that already exists:\n- THE system SHALL reject the registration\n- THE system SHALL display: \"This email address is already registered. Please log in or use a different email address.\"\n- THE system SHALL NOT reveal whether the account is active or inactive\n- THE system SHALL NOT reveal when the account was created\n\n### 13.2 Invalid Email Verification\n\nIF a customer attempts to verify with an expired token:\n- THE system SHALL display: \"Verification link has expired. Please request a new verification email.\"\n- THE system SHALL provide link to request new verification email\n\nIF a customer attempts to verify with an invalid or tampered token:\n- THE system SHALL display: \"Invalid verification link. Please check the link or contact support.\"\n- THE system SHALL NOT provide details about what was invalid\n- THE system SHALL offer option to request new verification email\n\n### 13.3 Session Timeout Scenarios\n\nWHEN a customer's session expires:\n1. Terminate the current operation\n2. Clear tokens from client storage\n3. Display message: \"Your session has expired. Please log in again.\"\n4. Redirect to login page\n5. Preserve any unsaved form data in browser cache (if safe)\n6. Allow customer to quickly log in again\n\n### 13.4 Address Validation Failure\n\nIF a customer enters an address that fails validation:\n1. Display specific field(s) that failed\n2. Provide helpful error messages explaining requirements\n3. Preserve valid data entered (don't clear form)\n4. Allow customer to correct and resubmit\n\n### 13.5 Seller Verification Rejection\n\nWHEN a seller's account is rejected:\n1. Send email with specific reason for rejection\n2. Provide instructions for reapplication\n3. Allow seller to update information and reapply\n4. Set reapplication cooldown of 7 days (can reapply after 7 days)\n\n### 13.6 Concurrent Login Attempts\n\nWHEN a customer attempts to log in from multiple devices simultaneously:\n1. Allow the new login\n2. Keep existing sessions active (multiple concurrent sessions allowed)\n3. Display in security settings all active sessions\n4. Allow customer to view and manage all sessions\n\nWHEN a customer has too many concurrent sessions (>10):\n1. THE system MAY terminate the oldest session\n2. Display notification: \"You have been logged out from another device due to session limit.\"\n3. Update security settings to show new active sessions\n\n### 13.7 Deactivation with Pending Orders\n\nIF a customer requests account deactivation while having pending orders:\n1. Display warning: \"You have pending orders. They will continue to be processed and you will receive updates.\"\n2. Allow deactivation only if confirmed\n3. Continue processing pending orders\n4. Send notifications about order status even after deactivation\n\n---\n\n## 14. Workflow Diagrams\n\n### 14.1 Complete User Registration and Verification Workflow\n\n```mermaid\ngraph TD\n    A[\"Guest User\"] --> B[\"Registration Page\"]\n    B --> C[\"Fill Registration Form\"]\n    C --> D{\"All Fields<br/>Valid?\"}\n    D -->|\"No\"| E[\"Show Validation<br/>Errors\"]\n    E --> C\n    D -->|\"Yes\"| F[\"Create Customer<br/>Account\"]\n    F --> G[\"Hash Password<br/>& Store\"]\n    G --> H[\"Send Verification<br/>Email\"]\n    H --> I[\"Display Success<br/>Message\"]\n    I --> J[\"Customer in<br/>Unverified State\"]\n    J --> K[\"Customer Receives<br/>Verification Email\"]\n    K --> L{\"Click<br/>Verification<br/>Link?\"}\n    L -->|\"Within 24h\"| M[\"Validate Token<br/>& Email\"]\n    M -->|\"Valid\"| N[\"Mark Email<br/>as Verified\"]\n    N --> O[\"Account Status<br/>= Active\"]\n    O --> P[\"Show Success<br/>Message\"]\n    P --> Q[\"Redirect to<br/>Dashboard\"]\n    L -->|\"After 24h\"| R[\"Link Expired\"]\n    R --> S[\"Offer Resend<br/>Verification Email\"]\n    L -->|\"Never\"| T[\"Click Resend<br/>Link in Email\"]\n    T --> S\n    S --> K\n```\n\n### 14.2 Login and Session Management Workflow\n\n```mermaid\ngraph LR\n    A[\"Customer at<br/>Login Page\"] --> B[\"Enter Email<br/>& Password\"]\n    B --> C{\"Email<br/>Found?\"}\n    C -->|\"No\"| D[\"Show Error:<br/>Email Not Found\"]\n    D --> A\n    C -->|\"Yes\"| E{\"Password<br/>Correct?\"}\n    E -->|\"No\"| F[\"Increment Failed<br/>Attempt Counter\"]\n    F --> G{\"5+ Failed<br/>Attempts in<br/>15 min?\"}\n    G -->|\"Yes\"| H[\"Lock Account<br/>30 Minutes\"]\n    H --> I[\"Show Error:<br/>Account Locked\"]\n    G -->|\"No\"| J[\"Show Error:<br/>Wrong Password\"]\n    J --> A\n    E -->|\"Yes\"| K{\"Account<br/>Status?\"}\n    K -->|\"Unverified\"| L[\"Show Error:<br/>Email Not Verified\"]\n    L --> A\n    K -->|\"Active\"| M[\"Create JWT<br/>Access Token\"]\n    M --> N[\"Create JWT<br/>Refresh Token\"]\n    N --> O[\"Create Session<br/>Record\"]\n    O --> P[\"Return Tokens<br/>to Client\"]\n    P --> Q[\"Redirect to<br/>Dashboard\"]\n    Q --> R[\"Customer<br/>Logged In\"]\n```\n\n### 14.3 Password Reset Workflow\n\n```mermaid\ngraph LR\n    A[\"Forgot Password<br/>Page\"] --> B[\"Enter Email\"]\n    B --> C{\"Email<br/>Found?\"}\n    C -->|\"No/Yes\"| D[\"Send Generic<br/>Message\"]\n    D --> E{\"Email<br/>Found?\"}\n    E -->|\"Yes\"| F[\"Generate Reset<br/>Token (1 hour)\"]\n    F --> G[\"Send Reset<br/>Email\"]\n    G --> H[\"Customer Receives<br/>Reset Email\"]\n    H --> I[\"Click Reset<br/>Link\"]\n    I --> J{\"Token<br/>Valid?\"}\n    J -->|\"No/Expired\"| K[\"Show Error:<br/>Link Invalid/Expired\"]\n    K --> L[\"Offer New<br/>Reset Email\"]\n    J -->|\"Yes\"| M[\"Show Password<br/>Reset Form\"]\n    M --> N[\"Enter New<br/>Password (2x)\"]\n    N --> O{\"Password<br/>Valid?\"}\n    O -->|\"No\"| P[\"Show Error:<br/>Password Invalid\"]\n    P --> N\n    O -->|\"Yes\"| Q[\"Hash New<br/>Password\"]\n    Q --> R[\"Update DB\"]\n    R --> S[\"Invalidate All<br/>Refresh Tokens\"]\n    S --> T[\"Send<br/>Confirmation\"]\n    T --> U[\"Redirect to<br/>Login\"]\n```\n\n---\n\n## 15. Summary\n\nTHE user management system provides comprehensive lifecycle management for all platform users from registration through account deactivation. This system ensures secure authentication, flexible profile and address management, seamless seller onboarding, and respectful account closure processes.\n\nAll workflows enforce strong validation rules, security best practices, and business policy compliance while providing clear user communication and error handling at every stage."
