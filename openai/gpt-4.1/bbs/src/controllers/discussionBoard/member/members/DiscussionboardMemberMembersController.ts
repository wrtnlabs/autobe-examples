import { Controller } from "@nestjs/common";
import { TypedRoute, TypedParam, TypedBody } from "@nestia/core";
import typia, { tags } from "typia";
import { putDiscussionBoardMemberMembersMemberId } from "../../../../providers/putDiscussionBoardMemberMembersMemberId";
import { MemberAuth } from "../../../../decorators/MemberAuth";
import { MemberPayload } from "../../../../decorators/payload/MemberPayload";
import { deleteDiscussionBoardMemberMembersMemberId } from "../../../../providers/deleteDiscussionBoardMemberMembersMemberId";

import { IDiscussionBoardMember } from "../../../../api/structures/IDiscussionBoardMember";

@Controller("/discussionBoard/member/members/:memberId")
export class DiscussionboardMemberMembersController {
  /**
   * Update an existing discussion board member (discussion_board_members table)
   * record by memberId.
   *
   * This API allows a discussion board member or an admin to update a member's
   * details. The primary use case is for users to update their own profile
   * information or for admins to update any member's account for management
   * purposes. The operation enforces email and username uniqueness, following
   * the database index constraints. Email changes require subsequent
   * verification, and password changes must use a hashed representation, not
   * plain text. The operation validates all input fields according to business
   * rules: emails must be valid and unique, usernames must not clash with
   * existing users, and passwords must meet established length and complexity
   * rules. The system will reject attempts to set inappropriate values or to
   * update with information that would violate business logic.
   *
   * Security considerations dictate that only the owning member (authenticated
   * via session/JWT) or an administrator may update a member account. Attempts
   * by other members or guests will result in an appropriate authorization
   * failure message. Updated_at is always set to the present time on any
   * update, enabling audit tracing. Soft-deleted accounts (where deleted_at is
   * set) cannot be updated and return an error if attempted.
   *
   * If a member's email is updated, their email_verified status will be reset,
   * and a new verification process must be completed. Admins may update all
   * non-credential fields directly but must handle credential resets according
   * to policy. Invalid updates—such as duplicate email/username or a prohibited
   * password—result in clear error messages with actionable guidance. This
   * endpoint helps members maintain control of their personal information while
   * ensuring system integrity.
   *
   * @param connection
   * @param memberId Unique identifier for the discussion board member to be
   *   updated.
   * @param body Fields required to update an existing member account, following
   *   business rules for uniqueness, non-emptiness, and hashed password
   *   requirements.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Put()
  public async update(
    @MemberAuth()
    member: MemberPayload,
    @TypedParam("memberId")
    memberId: string & tags.Format<"uuid">,
    @TypedBody()
    body: IDiscussionBoardMember.IUpdate,
  ): Promise<IDiscussionBoardMember> {
    try {
      return await putDiscussionBoardMemberMembersMemberId({
        member,
        memberId,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Delete (soft delete) a discussion board member (discussion_board_members
   * table) account by setting deleted_at, identified by memberId.
   *
   * This API allows a member or admin to delete a discussion board member
   * account using a unique memberId. Instead of a hard delete, it marks the
   * account's deleted_at field with the current timestamp (soft delete),
   * supporting future recovery and audit requirements. Deleting an account
   * disables further logins for that member, prevents any authoring of topics
   * or replies, and removes access to personal account settings. Posts and
   * replies authored by the member remain visible unless additional moderation
   * policies require anonymization or removal. Authorization checks ensure that
   * only the member themselves, authenticated via session/JWT, or an admin may
   * perform this deletion. The operation cannot be performed on already
   * soft-deleted accounts and will return an error if attempted. This design
   * preserves discussion continuity and ensures that system audit trails
   * reflect all account changes as mandated by business and compliance rules.
   *
   * Security is enforced by verifying the requesting user's identity and role.
   * Members can only delete their own accounts, while admins can delete any
   * member's account. Attempts to delete another member's account by non-admins
   * will fail with an explicit permission denied message. Deleted accounts are
   * non-recoverable without administrative intervention. If an account is
   * already marked as deleted, a clear error is returned. There is no response
   * body for this operation; success is indicated via standard HTTP status.
   *
   * @param connection
   * @param memberId Unique identifier for the discussion board member to
   *   delete.
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Delete()
  public async erase(
    @MemberAuth()
    member: MemberPayload,
    @TypedParam("memberId")
    memberId: string & tags.Format<"uuid">,
  ): Promise<void> {
    try {
      return await deleteDiscussionBoardMemberMembersMemberId({
        member,
        memberId,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }
}
