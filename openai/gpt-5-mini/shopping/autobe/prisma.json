{"files":[{"filename":"schema-01-systematic.prisma","namespace":"Systematic","models":[{"name":"shopping_mall_categories","description":"Hierarchical category taxonomy for the shoppingMall catalog. Categories support optional parent-child nesting for multi-level organization. Used by product listing, search, and navigation. Contains canonical business identity (slug) and temporal audit fields. Related entity references: {@link shopping_mall_product_categories}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"parent_id","type":"uuid","description":"Self-referential parent category reference. {@link shopping_mall_categories.id}.","relation":{"name":"parent","targetModel":"shopping_mall_categories","mappingName":"recursive"},"unique":false,"nullable":true}],"plainFields":[{"name":"name","type":"string","nullable":false,"description":"Human-friendly category name used in navigation and search."},{"name":"slug","type":"string","nullable":false,"description":"Unique URL-friendly identifier for the category (business key)."},{"name":"description","type":"string","nullable":true,"description":"Optional textual description for the category used in admin and SEO."},{"name":"created_at","type":"datetime","nullable":false,"description":"Record creation timestamp (Asia/Seoul timezone interpretation)."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Record last update timestamp."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft-delete timestamp; null when active."}],"uniqueIndexes":[{"fieldNames":["slug"],"unique":true}],"plainIndexes":[{"fieldNames":["name","created_at"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_product_categories","description":"Junction table linking products to categories. Represents M:N relationship between shopping_mall_products and shopping_mall_categories. Enforces uniqueness per product/category pair to avoid duplicate assignments. Managed as subsidiary data from product/category administration flows.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Belonged product's {@link shopping_mall_products.id}.","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false},{"name":"shopping_mall_category_id","type":"uuid","description":"Belonged category's {@link shopping_mall_categories.id}.","relation":{"name":"category","targetModel":"shopping_mall_categories"},"unique":false,"nullable":false}],"plainFields":[{"name":"created_at","type":"datetime","nullable":false,"description":"When the product was assigned to the category."},{"name":"created_by","type":"uuid","nullable":true,"description":"Actor who created the assignment (nullable; may reference admin or system user)."}],"uniqueIndexes":[{"fieldNames":["shopping_mall_product_id","shopping_mall_category_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_product_id","shopping_mall_category_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_audit_logs","description":"Append-only audit and event log for platform-level critical actions (admin operations, moderation events, system escalations). Designed for immutable historical records, forensic queries, and admin reporting. Entries are append-only and include free-text details for later investigation.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"actor_id","type":"uuid","nullable":true,"description":"Identifier of the actor that caused the event (user/admin/system). May reference other user tables; nullable for system events."},{"name":"action","type":"string","nullable":false,"description":"Short action code or verb (e.g., 'product_publish', 'refund_approved')."},{"name":"entity","type":"string","nullable":false,"description":"Target entity type (e.g., 'product','order','review')."},{"name":"entity_id","type":"uuid","nullable":true,"description":"Identifier of the affected entity (if applicable)."},{"name":"details","type":"string","nullable":true,"description":"Human-readable or structured details about the event (JSON-as-string or text)."},{"name":"created_at","type":"datetime","nullable":false,"description":"Event timestamp (immutable)."}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["entity","entity_id","created_at"]}],"ginIndexes":[{"fieldName":"details"}]},{"name":"shopping_mall_inventory_events","description":"Append-only inventory event stream capturing SKU-level inventory changes (adjustments, reservations, commits, releases). Each event ties to a SKU and optionally to an order or actor. Used for inventory audit, reconciliation, and prevention of oversells.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_sku_id","type":"uuid","description":"Affected SKU reference. {@link shopping_mall_skus.id}.","relation":{"name":"sku","targetModel":"shopping_mall_skus"},"unique":false,"nullable":false}],"plainFields":[{"name":"delta","type":"int","nullable":false,"description":"Signed quantity change (positive for inbound, negative for outbound)."},{"name":"reason","type":"string","nullable":true,"description":"Reason for the inventory change (e.g., 'sale', 'adjustment', 'return', 'reservation_expiry')."},{"name":"reference_order_id","type":"uuid","nullable":true,"description":"Optional order id associated with this event (if applicable). {@link shopping_mall_orders.id}."},{"name":"actor_id","type":"uuid","nullable":true,"description":"Actor who performed the change (seller/admin/system)."},{"name":"created_at","type":"datetime","nullable":false,"description":"Event timestamp (append-only)."}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_sku_id","created_at"]}],"ginIndexes":[{"fieldName":"reason"}]}]},{"filename":"schema-02-actors.prisma","namespace":"Actors","models":[{"name":"shopping_mall_guest","description":"Temporary guest session record used to persist guest carts and wishlists across sessions. Stores a guest token and session metadata. Not an authenticated user; intended for ephemeral guest state management and merges into customer accounts on registration.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"guest_token","type":"string","nullable":false,"description":"Opaque guest token used to associate temporary cart/wishlist sessions with an unauthenticated visitor."},{"name":"user_agent","type":"string","nullable":true,"description":"Optional user-agent string captured at session creation for diagnostics."},{"name":"created_at","type":"datetime","nullable":false,"description":"Creation timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Last update timestamp."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft-delete timestamp when guest session is expired or removed."}],"uniqueIndexes":[{"fieldNames":["guest_token"],"unique":true}],"plainIndexes":[{"fieldNames":["guest_token","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_customer","description":"Registered customer account. Stores authentication credentials, profile metadata and flags required for buyer flows. Customers may have addresses and persistent carts; this is an independent business entity (primary).","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"email","type":"string","nullable":false,"description":"Login email address. Unique across customers."},{"name":"password_hash","type":"string","nullable":false,"description":"Password hash for authentication (do not store raw passwords)."},{"name":"display_name","type":"string","nullable":true,"description":"Optional display or full name for customer-facing UX."},{"name":"phone","type":"string","nullable":true,"description":"Optional contact phone number."},{"name":"email_verified","type":"boolean","nullable":false,"description":"Whether the customer's email address has been verified."},{"name":"last_login_at","type":"datetime","nullable":true,"description":"Timestamp of the last successful login event."},{"name":"created_at","type":"datetime","nullable":false,"description":"Account creation timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Account last update timestamp."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft-delete timestamp for deactivated accounts."}],"uniqueIndexes":[{"fieldNames":["email"],"unique":true}],"plainIndexes":[{"fieldNames":["email_verified","created_at"]}],"ginIndexes":[{"fieldName":"display_name"}]},{"name":"shopping_mall_seller","description":"Seller (merchant) account that owns product listings and SKUs. Contains authentication credentials, business identity fields, and operational flags. Sellers are primary business entities responsible for inventory and fulfillment.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"email","type":"string","nullable":false,"description":"Login email for the seller account."},{"name":"password_hash","type":"string","nullable":false,"description":"Password hash for seller authentication."},{"name":"business_name","type":"string","nullable":false,"description":"Registered business or display name for the seller."},{"name":"contact_phone","type":"string","nullable":true,"description":"Primary contact phone number for the seller."},{"name":"status","type":"string","nullable":false,"description":"Seller account status (e.g., pending_verification, active, suspended)."},{"name":"payout_settings_uri","type":"uri","nullable":true,"description":"Reference to payout settings or external settlement profile."},{"name":"created_at","type":"datetime","nullable":false,"description":"Seller account creation timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Seller account last update timestamp."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft-delete timestamp for deactivated sellers."}],"uniqueIndexes":[{"fieldNames":["email"],"unique":true}],"plainIndexes":[{"fieldNames":["status","created_at"]}],"ginIndexes":[{"fieldName":"business_name"}]},{"name":"shopping_mall_supportagent","description":"Support agent account for platform customer service and dispute handling. Agents have credentials and profile metadata; actions must be auditable via separate audit logs (external).","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"email","type":"string","nullable":false,"description":"Login email for the support agent."},{"name":"password_hash","type":"string","nullable":false,"description":"Password hash for support agent authentication."},{"name":"display_name","type":"string","nullable":true,"description":"Human-readable name for the agent."},{"name":"is_active","type":"boolean","nullable":false,"description":"Whether the support agent account is active."},{"name":"created_at","type":"datetime","nullable":false,"description":"Agent account creation timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Agent account last update timestamp."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft-delete timestamp for removed agent accounts."}],"uniqueIndexes":[{"fieldNames":["email"],"unique":true}],"plainIndexes":[{"fieldNames":["is_active","created_at"]}],"ginIndexes":[{"fieldName":"display_name"}]},{"name":"shopping_mall_admin","description":"Platform administrator accounts with elevated privileges for governance and platform configuration. Admins are primary actors and all admin actions should be recorded in the system audit logs.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"email","type":"string","nullable":false,"description":"Administrator login email."},{"name":"password_hash","type":"string","nullable":false,"description":"Password hash for admin authentication."},{"name":"display_name","type":"string","nullable":true,"description":"Administrator display name."},{"name":"privilege_level","type":"int","nullable":false,"description":"Integer representing privilege tiers for admin accounts; higher value implies broader privileges."},{"name":"created_at","type":"datetime","nullable":false,"description":"Admin account creation timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Admin account last update timestamp."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft-delete timestamp for deactivated admin accounts."}],"uniqueIndexes":[{"fieldNames":["email"],"unique":true}],"plainIndexes":[{"fieldNames":["privilege_level","created_at"]}],"ginIndexes":[{"fieldName":"display_name"}]},{"name":"shopping_mall_addresses","description":"Address records for all roles (customers, sellers, guests, agents, admins). Stores raw address fields used for shipping, billing, and address snapshots on orders. IMPORTANT: Owner foreign keys are intentionally nullable and must NOT cascade on owner deletion; they should be set to NULL (or left as-is) to preserve historical snapshots. Application-level archival / soft-delete must be used to retire actor accounts without deleting address history.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Belonged customer's {@link shopping_mall_customer.id}. Nullable to preserve address snapshots when customer is deleted.","relation":{"name":"customer","targetModel":"shopping_mall_customer"},"unique":false,"nullable":true},{"name":"shopping_mall_seller_id","type":"uuid","description":"Belonged seller's {@link shopping_mall_seller.id}. Nullable to preserve address snapshots when seller is deleted.","relation":{"name":"seller","targetModel":"shopping_mall_seller"},"unique":false,"nullable":true},{"name":"shopping_mall_supportagent_id","type":"uuid","description":"Belonged support agent's {@link shopping_mall_supportagent.id}. Nullable to preserve audit trail when agent account is removed.","relation":{"name":"supportAgent","targetModel":"shopping_mall_supportagent"},"unique":false,"nullable":true},{"name":"shopping_mall_admin_id","type":"uuid","description":"Belonged admin's {@link shopping_mall_admin.id}. Nullable to preserve audit trail when admin account is removed.","relation":{"name":"admin","targetModel":"shopping_mall_admin"},"unique":false,"nullable":true},{"name":"shopping_mall_guest_id","type":"uuid","description":"Belonged guest session {@link shopping_mall_guest.id}. Nullable to allow guest cleanup without removing historical address rows referenced in snapshots.","relation":{"name":"guest","targetModel":"shopping_mall_guest"},"unique":false,"nullable":true}],"plainFields":[{"name":"recipient_name","type":"string","nullable":false,"description":"Name of the recipient for deliveries."},{"name":"line1","type":"string","nullable":false,"description":"Street address line 1."},{"name":"line2","type":"string","nullable":true,"description":"Optional street address line 2 (apartment, suite)."},{"name":"city","type":"string","nullable":false,"description":"City or locality."},{"name":"postal_code","type":"string","nullable":false,"description":"Postal or ZIP code."},{"name":"country","type":"string","nullable":false,"description":"ISO country code or country name for display."},{"name":"phone","type":"string","nullable":true,"description":"Contact phone number for deliveries."},{"name":"is_default","type":"boolean","nullable":false,"description":"Whether this address is the default for the owner. Application should default to false."},{"name":"created_at","type":"datetime","nullable":false,"description":"Address creation timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Address last update timestamp."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft-delete timestamp for removed addresses."}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_customer_id","created_at"]},{"fieldNames":["shopping_mall_seller_id","created_at"]}],"ginIndexes":[]}]},{"filename":"schema-03-sales.prisma","namespace":"Sales","models":[{"name":"shopping_mall_products","description":"Product catalog entry owned by a seller. Contains product-level metadata used on product listing and detail pages. Related entities: {@\\link shopping_mall_skus} for variant-level data and {@\\link shopping_mall_product_categories} for category membership. Business constraints: seller-level code uniqueness enforced by (seller_id, code).","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"seller_id","type":"uuid","description":"Owning seller. {@link shopping_mall_seller.id}.","relation":{"name":"seller","targetModel":"shopping_mall_seller"},"unique":false,"nullable":false}],"plainFields":[{"name":"code","type":"string","nullable":false,"description":"Business identifier/code scoped to seller (unique per seller)."},{"name":"name","type":"string","nullable":false,"description":"Human-facing product title used in listings and search."},{"name":"short_description","type":"string","nullable":true,"description":"Short description used in listing cards."},{"name":"description","type":"string","nullable":true,"description":"Full product description (HTML or markdown may be stored as text)."},{"name":"primary_image_uri","type":"uri","nullable":true,"description":"Primary product image URI for listing thumbnail."},{"name":"created_at","type":"datetime","nullable":false,"description":"Record creation timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Record last update timestamp."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft delete timestamp (nullable)."}],"uniqueIndexes":[{"fieldNames":["seller_id","code"],"unique":true}],"plainIndexes":[{"fieldNames":["seller_id","created_at"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_skus","description":"SKU (Stock Keeping Unit) representing a specific variant of a product (color, size, option). Updated to include explicit search indexing guidance for attributes and to document migration to JSONB for attributes. Retains global sku_code uniqueness; attributes remain stored as string until JSON/JsonB migration is performed.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"product_id","type":"uuid","description":"Belonged product. {@link shopping_mall_products.id}.","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false}],"plainFields":[{"name":"sku_code","type":"string","nullable":false,"description":"Unique SKU code for external lookups (e.g., barcode, merchant SKU). Remains unique globally unless business changes to seller-scoped uniqueness."},{"name":"title","type":"string","nullable":true,"description":"Optional short name for the SKU variant (e.g., \"T-Shirt — Red / M\")."},{"name":"attributes_json","type":"string","nullable":false,"description":"JSON-encoded attribute map (e.g., {\"color\":\"red\",\"size\":\"M\"}). Stored as text for portability in the short term; plan to migrate to native JSON/JSONB and create GIN jsonb_path_ops indexes on keys used for filtering."},{"name":"price","type":"double","nullable":false,"description":"Current price for this SKU in platform currency."},{"name":"currency","type":"string","nullable":false,"description":"ISO currency code (e.g., \"USD\", \"KRW\")."},{"name":"created_at","type":"datetime","nullable":false,"description":"Record creation timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Record last update timestamp."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft delete timestamp (nullable)."}],"uniqueIndexes":[{"fieldNames":["sku_code"],"unique":true}],"plainIndexes":[{"fieldNames":["product_id","price"]},{"fieldNames":["product_id","sku_code"]}],"ginIndexes":[{"fieldName":"attributes_json"}]},{"name":"shopping_mall_inventory","description":"Per-SKU inventory snapshot and operational counters. Added guidance to support low-stock queries and recommended DB-level CHECK constraints for non-negative inventory counts. Keeps sku_id unique to ensure one inventory row per SKU.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"sku_id","type":"uuid","description":"Belonged SKU. {@link shopping_mall_skus.id}.","relation":{"name":"sku","targetModel":"shopping_mall_skus"},"unique":false,"nullable":false},{"name":"last_event_id","type":"uuid","description":"Reference to last processed inventory event for auditing. {@link shopping_mall_inventory_events.id}.","relation":{"name":"lastInventoryEvent","targetModel":"shopping_mall_inventory_events"},"unique":false,"nullable":true}],"plainFields":[{"name":"available_quantity","type":"int","nullable":false,"description":"Quantity available for sale (non-negative). Application and DB-level CHECK constraints recommended to enforce >= 0."},{"name":"reserved_quantity","type":"int","nullable":false,"description":"Quantity currently reserved for carts/orders (non-negative)."},{"name":"location","type":"string","nullable":true,"description":"Optional warehouse/location code."},{"name":"reorder_threshold","type":"int","nullable":true,"description":"Suggested threshold to trigger restock alerts."},{"name":"last_checked_at","type":"datetime","nullable":true,"description":"Last inventory reconciliation or check timestamp."},{"name":"created_at","type":"datetime","nullable":false,"description":"Record creation timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Record last update timestamp."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft delete timestamp (nullable)."}],"uniqueIndexes":[{"fieldNames":["sku_id"],"unique":true}],"plainIndexes":[{"fieldNames":["sku_id","updated_at"]},{"fieldNames":["reorder_threshold","available_quantity"]}],"ginIndexes":[]},{"name":"shopping_mall_reviews","description":"Product/SKU reviews submitted by customers. Added unique constraint to enforce at-most-one review per product per author. Retains moderation flags, verified_purchase, and GIN on body for search.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"product_id","type":"uuid","description":"Reviewed product. {@link shopping_mall_products.id}.","relation":{"name":"product","targetModel":"shopping_mall_products"},"unique":false,"nullable":false},{"name":"sku_id","type":"uuid","description":"Optional referenced SKU for SKU-level reviews. {@link shopping_mall_skus.id}.","relation":{"name":"sku","targetModel":"shopping_mall_skus"},"unique":false,"nullable":true},{"name":"author_id","type":"uuid","description":"Review author as a customer. {@link shopping_mall_customer.id}.","relation":{"name":"author","targetModel":"shopping_mall_customer"},"unique":false,"nullable":false},{"name":"moderator_admin_id","type":"uuid","description":"Optional admin who moderated or removed the review. {@link shopping_mall_admin.id}.","relation":{"name":"moderator","targetModel":"shopping_mall_admin"},"unique":false,"nullable":true}],"plainFields":[{"name":"rating","type":"int","nullable":false,"description":"Numeric rating (e.g., 1-5)."},{"name":"title","type":"string","nullable":true,"description":"Optional short title for the review."},{"name":"body","type":"string","nullable":true,"description":"Long-form review text."},{"name":"photos_json","type":"string","nullable":true,"description":"JSON array of photo URIs attached to the review."},{"name":"verified_purchase","type":"boolean","nullable":false,"description":"Whether purchase was verified (true/false)."},{"name":"moderated","type":"boolean","nullable":false,"description":"Whether review is moderated/hidden from public view."},{"name":"moderation_reason","type":"string","nullable":true,"description":"Optional reason code or free-text for moderation decisions."},{"name":"created_at","type":"datetime","nullable":false,"description":"Record creation timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Record last update timestamp."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft delete timestamp (nullable)."}],"uniqueIndexes":[{"fieldNames":["product_id","author_id"],"unique":true}],"plainIndexes":[{"fieldNames":["product_id","created_at"]},{"fieldNames":["author_id","created_at"]}],"ginIndexes":[{"fieldName":"body"}]}]},{"filename":"schema-04-carts.prisma","namespace":"Carts","models":[{"name":"shopping_mall_carts","description":"Persistent shopping carts and guest carts. A cart may belong to either a registered customer ({@link shopping_mall_customer.id}) or a guest session ({@link shopping_mall_guest.id}). Used to persist items prior to checkout and to support merge behavior when guests log in. Soft-delete and timestamps maintained for auditing and lifecycle management. NOTE: removed single-column unique constraint on shopping_mall_customer_id to allow multiple saved carts per customer. If single active-cart semantics are required, implement a partial unique index on (shopping_mall_customer_id) WHERE status='active' at DB migration time.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Belonged customer's {@link shopping_mall_customer.id}. Nullable to support guest carts.","relation":{"name":"customer","targetModel":"shopping_mall_customer"},"unique":false,"nullable":true},{"name":"shopping_mall_guest_id","type":"uuid","description":"Belonged guest session {@link shopping_mall_guest.id}. Nullable to support persistent customer carts.","relation":{"name":"guest","targetModel":"shopping_mall_guest"},"unique":false,"nullable":true}],"plainFields":[{"name":"guest_token","type":"string","nullable":true,"description":"Optional guest token for client-side mapping of temporary guest carts."},{"name":"reservation_token","type":"string","nullable":true,"description":"Optional reservation identifier used during checkout to correlate reserved inventory or payment attempts. INDEX recommended for lookup performance."},{"name":"status","type":"string","nullable":false,"description":"Cart lifecycle status (for example: 'active', 'merged', 'abandoned'). Application controls valid values; consider using an enum for stronger validation."},{"name":"created_at","type":"datetime","nullable":false,"description":"Creation timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Last update timestamp."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft-delete timestamp for cart recovery and audit."}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_guest_id"]},{"fieldNames":["shopping_mall_customer_id","updated_at"]},{"fieldNames":["created_at","updated_at"]},{"fieldNames":["reservation_token"]}],"ginIndexes":[]},{"name":"shopping_mall_cart_items","description":"Line items within a shopping cart. Each item references a SKU ({@link shopping_mall_skus.id}) and records quantity and unit price snapshot. Items are managed via the parent cart and include optional reservation metadata to support the checkout reservation lifecycle. Added composite unique constraint on (shopping_mall_cart_id, shopping_mall_sku_id) to prevent duplicate lines and simplify upsert logic.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_cart_id","type":"uuid","description":"Parent cart reference. {@link shopping_mall_carts.id}","relation":{"name":"cart","targetModel":"shopping_mall_carts"},"unique":false,"nullable":false},{"name":"shopping_mall_sku_id","type":"uuid","description":"Referenced SKU for this line item. {@link shopping_mall_skus.id}","relation":{"name":"sku","targetModel":"shopping_mall_skus"},"unique":false,"nullable":false}],"plainFields":[{"name":"quantity","type":"int","nullable":false,"description":"Requested quantity for this SKU in the cart. Must be validated against inventory at checkout; non-negative at application level."},{"name":"unit_price","type":"double","nullable":false,"description":"Snapshot of unit price at the time item was added to cart to preserve pricing during checkout."},{"name":"reservation_id","type":"string","nullable":true,"description":"Optional reservation identifier linked to inventory reservation or payment attempt."},{"name":"reserved_until","type":"datetime","nullable":true,"description":"Optional reservation expiry timestamp for this item when a temporary hold on inventory exists."},{"name":"created_at","type":"datetime","nullable":false,"description":"Creation timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Last update timestamp."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft-delete timestamp for item removal history."}],"uniqueIndexes":[{"fieldNames":["shopping_mall_cart_id","shopping_mall_sku_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_cart_id","created_at"]},{"fieldNames":["shopping_mall_sku_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_wishlists","description":"User wishlists for saving SKUs for later. Wishlists may belong to a registered customer ({@link shopping_mall_customer.id}) or a guest session ({@link shopping_mall_guest.id}). Supports named lists and soft-delete for lifecycle management. Recommendation: default is_public to false at DB or application layer to avoid accidental public lists for guests.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Owning customer reference. {@link shopping_mall_customer.id}. Nullable to support guest wishlists.","relation":{"name":"customer","targetModel":"shopping_mall_customer"},"unique":false,"nullable":true},{"name":"shopping_mall_guest_id","type":"uuid","description":"Owning guest session reference. {@link shopping_mall_guest.id}. Nullable to support persistent customer lists.","relation":{"name":"guest","targetModel":"shopping_mall_guest"},"unique":false,"nullable":true}],"plainFields":[{"name":"name","type":"string","nullable":true,"description":"Optional user-visible name for the wishlist (for example 'Birthday ideas')."},{"name":"is_public","type":"boolean","nullable":false,"description":"Whether the wishlist is visible to others. Recommended default: false. Application must enforce visibility semantics for guest vs. authenticated lists."},{"name":"created_at","type":"datetime","nullable":false,"description":"Creation timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Last update timestamp."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft-delete timestamp."}],"uniqueIndexes":[{"fieldNames":["shopping_mall_customer_id","name"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_customer_id","updated_at"]}],"ginIndexes":[]},{"name":"shopping_mall_wishlist_items","description":"Items saved in a wishlist. Each record links a wishlist to a SKU ({@link shopping_mall_skus.id}). Duplicate (wishlist, sku) pairs are prevented by a unique index to avoid redundant entries.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_wishlist_id","type":"uuid","description":"Parent wishlist reference. {@link shopping_mall_wishlists.id}","relation":{"name":"wishlist","targetModel":"shopping_mall_wishlists"},"unique":false,"nullable":false},{"name":"shopping_mall_sku_id","type":"uuid","description":"Referenced SKU saved in the wishlist. {@link shopping_mall_skus.id}","relation":{"name":"sku","targetModel":"shopping_mall_skus"},"unique":false,"nullable":false}],"plainFields":[{"name":"note","type":"string","nullable":true,"description":"Optional user note attached to the wishlist item (for example 'gift for mom')."},{"name":"added_at","type":"datetime","nullable":false,"description":"Timestamp when the SKU was added to the wishlist."},{"name":"created_at","type":"datetime","nullable":false,"description":"Creation timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Last update timestamp."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft-delete timestamp for history and audit."}],"uniqueIndexes":[{"fieldNames":["shopping_mall_wishlist_id","shopping_mall_sku_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_wishlist_id","added_at"]}],"ginIndexes":[]}]},{"filename":"schema-05-orders.prisma","namespace":"Orders","models":[{"name":"shopping_mall_orders","description":"Order header capturing a single buyer-facing order. Stores buyer reference, shipping address snapshot, pricing breakdown, and lifecycle timestamps. Modified to avoid cascading delete cycles with shipments: primary shipment is represented via shipment records rather than a direct foreign key on the order to prevent circular cascade delete issues. Related entities: {@link shopping_mall_order_items}, {@link shopping_mall_payments}, {@link shopping_mall_refund_requests}, {@link shopping_mall_shipments}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_customer_id","type":"uuid","description":"Belonged buyer customer. {@link shopping_mall_customer.id}","relation":{"name":"customer","targetModel":"shopping_mall_customer"},"unique":false,"nullable":false},{"name":"shipping_address_id","type":"uuid","description":"Reference to shipping address snapshot source. {@link shopping_mall_addresses.id}","relation":{"name":"shippingAddress","targetModel":"shopping_mall_addresses"},"unique":false,"nullable":true}],"plainFields":[{"name":"order_number","type":"string","nullable":false,"description":"Business-facing unique order number (human-readable)."},{"name":"order_source","type":"string","nullable":true,"description":"Origin channel of the order (web, mobile, api) for reporting."},{"name":"shipping_address_snapshot","type":"string","nullable":false,"description":"JSON-serialized shipping address snapshot captured at order time to preserve historical accuracy. Consider migrating to native JSON/JsonB where supported."},{"name":"subtotal_amount","type":"double","nullable":false,"description":"Sum of line item amounts before taxes and shipping."},{"name":"shipping_amount","type":"double","nullable":false,"description":"Shipping fee applied to the order."},{"name":"tax_amount","type":"double","nullable":false,"description":"Total tax amount for the order."},{"name":"discount_amount","type":"double","nullable":true,"description":"Sum of discounts applied to the order (if any)."},{"name":"total_amount","type":"double","nullable":false,"description":"Final charged amount for the order (subtotal + shipping + tax - discounts)."},{"name":"currency","type":"string","nullable":false,"description":"Currency code (ISO) used for this order."},{"name":"status","type":"string","nullable":false,"description":"Order lifecycle status (Created, Payment Pending, Paid, Processing, Shipped, Delivered, Cancelled, Refunded, Closed)."},{"name":"payment_state","type":"string","nullable":false,"description":"Payment business state (authorized, captured, failed, refunded)."},{"name":"reserved_until","type":"datetime","nullable":true,"description":"Reservation expiry timestamp for inventory holds related to this order."},{"name":"placed_at","type":"datetime","nullable":false,"description":"Timestamp when the order was created/placed."},{"name":"paid_at","type":"datetime","nullable":true,"description":"Timestamp when payment was captured for the order."},{"name":"closed_at","type":"datetime","nullable":true,"description":"Timestamp when the order lifecycle closed (finalized)."},{"name":"customer_note","type":"string","nullable":true,"description":"Free-text note provided by the customer; searchable via GIN index."},{"name":"internal_note","type":"string","nullable":true,"description":"Internal note for support/admin use; not shown to customers."},{"name":"created_at","type":"datetime","nullable":false,"description":"Record creation timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Record last update timestamp."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft-delete timestamp for the order (if applicable)."}],"uniqueIndexes":[{"fieldNames":["order_number"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_customer_id","created_at"]},{"fieldNames":["status","created_at"]}],"ginIndexes":[{"fieldName":"customer_note"},{"fieldName":"internal_note"}]},{"name":"shopping_mall_order_items","description":"Order line items that belong to an order. Each record captures a snapshot of the SKU and pricing at order time for historical accuracy. Links to {@link shopping_mall_orders.id} and optionally to the live {@link shopping_mall_skus.id} and {@link shopping_mall_seller.id} for seller attribution.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Belonged order header {@link shopping_mall_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false},{"name":"shopping_mall_sku_id","type":"uuid","description":"Referenced SKU for cross-reference {@link shopping_mall_skus.id}. Nullable if SKU removed; keep snapshot for history.","relation":{"name":"sku","targetModel":"shopping_mall_skus"},"unique":false,"nullable":true},{"name":"shopping_mall_seller_id","type":"uuid","description":"Seller that owns this line's SKU {@link shopping_mall_seller.id}.","relation":{"name":"seller","targetModel":"shopping_mall_seller"},"unique":false,"nullable":false},{"name":"shipment_id","type":"uuid","description":"Optional shipment reference for this order line {@link shopping_mall_shipments.id}.","relation":{"name":"shipment","targetModel":"shopping_mall_shipments"},"unique":false,"nullable":true}],"plainFields":[{"name":"sku_snapshot","type":"string","nullable":false,"description":"JSON-serialized snapshot of SKU fields (title, selected attributes, images) at time of order for historical display."},{"name":"name_snapshot","type":"string","nullable":false,"description":"Product/SKU title snapshot for quick display and indexing."},{"name":"quantity","type":"int","nullable":false,"description":"Quantity ordered for this line item."},{"name":"unit_price","type":"double","nullable":false,"description":"Unit price charged at order time."},{"name":"line_total","type":"double","nullable":false,"description":"Quantity * unit_price before line-level discounts and taxes."},{"name":"tax_amount","type":"double","nullable":true,"description":"Tax amount applied to this line."},{"name":"currency","type":"string","nullable":false,"description":"Currency code used for this line."},{"name":"status","type":"string","nullable":false,"description":"Fulfillment status for the line (Pending, Processing, Shipped, Delivered, Returned, Refunded)."},{"name":"created_at","type":"datetime","nullable":false,"description":"Record creation timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Record last update timestamp."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft-delete timestamp for the order item."}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_order_id","created_at"]},{"fieldNames":["shopping_mall_seller_id","status"]}],"ginIndexes":[{"fieldName":"name_snapshot"}]},{"name":"shopping_mall_payments","description":"Payment records tied to orders. Records authorization, capture, refund attempts, external provider ids and minimal payment metadata for reconciliation. Links to {@link shopping_mall_orders.id} and payer {@link shopping_mall_customer.id}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Related order {@link shopping_mall_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false},{"name":"shopping_mall_customer_id","type":"uuid","description":"Paying customer reference {@link shopping_mall_customer.id}.","relation":{"name":"customer","targetModel":"shopping_mall_customer"},"unique":false,"nullable":false}],"plainFields":[{"name":"amount","type":"double","nullable":false,"description":"Amount attempted or captured for this payment event."},{"name":"currency","type":"string","nullable":false,"description":"Currency code for the payment."},{"name":"method","type":"string","nullable":false,"description":"Payment method label (card, wallet, bank_transfer)."},{"name":"provider","type":"string","nullable":true,"description":"External payment provider name."},{"name":"provider_payment_id","type":"string","nullable":true,"description":"Provider-side unique payment identifier for reconciliation."},{"name":"status","type":"string","nullable":false,"description":"Payment status (authorized, captured, failed, refunded)."},{"name":"authorized_at","type":"datetime","nullable":true,"description":"Timestamp when authorization occurred."},{"name":"captured_at","type":"datetime","nullable":true,"description":"Timestamp when capture occurred."},{"name":"refunded_at","type":"datetime","nullable":true,"description":"Timestamp when refund was processed for this payment."},{"name":"metadata","type":"string","nullable":true,"description":"JSON-serialized minimal metadata for provider webhooks or reconciliation context."},{"name":"created_at","type":"datetime","nullable":false,"description":"Record creation timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Record last update timestamp."}],"uniqueIndexes":[{"fieldNames":["provider_payment_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_order_id","status"]},{"fieldNames":["shopping_mall_customer_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_refund_requests","description":"Refund and cancellation request records related to orders or individual order items. Tracks requester (customer or supportAgent), requested amount, reason, processing status and decision metadata. Added nullable supportAgent requester FK to preserve referential integrity for agent-initiated requests.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Associated order. {@link shopping_mall_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false},{"name":"shopping_mall_order_item_id","type":"uuid","description":"Optional line-level association when refund targets specific item. {@link shopping_mall_order_items.id}.","relation":{"name":"orderItem","targetModel":"shopping_mall_order_items"},"unique":false,"nullable":true},{"name":"requester_id","type":"uuid","description":"User who requested refund when requester is a customer. {@link shopping_mall_customer.id}. Nullable when requester is a supportAgent or system actor.","relation":{"name":"requester","targetModel":"shopping_mall_customer"},"unique":false,"nullable":true},{"name":"shopping_mall_supportagent_requester_id","type":"uuid","description":"Optional supportAgent who requested or created the refund on behalf of a customer. {@link shopping_mall_supportagent.id}.","relation":{"name":"supportRequester","targetModel":"shopping_mall_supportagent"},"unique":false,"nullable":true},{"name":"decision_by_admin_id","type":"uuid","description":"Admin who processed the refund decision. {@link shopping_mall_admin.id}.","relation":{"name":"decisionBy","targetModel":"shopping_mall_admin"},"unique":false,"nullable":true}],"plainFields":[{"name":"requested_amount","type":"double","nullable":false,"description":"Amount requested for refund in order currency."},{"name":"currency","type":"string","nullable":false,"description":"Currency code for the refund request."},{"name":"reason","type":"string","nullable":true,"description":"Free-text reason supplied by requester; searchable with GIN."},{"name":"status","type":"string","nullable":false,"description":"Refund request status (pending, approved, denied, processed)."},{"name":"initiated_at","type":"datetime","nullable":false,"description":"Timestamp when refund request was created."},{"name":"processed_at","type":"datetime","nullable":true,"description":"Timestamp when refund was processed/completed."},{"name":"processing_notes","type":"string","nullable":true,"description":"Internal processing notes for support/admins."},{"name":"created_at","type":"datetime","nullable":false,"description":"Record creation timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Record last update timestamp."}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_order_id","status"]},{"fieldNames":["requester_id","initiated_at"]}],"ginIndexes":[{"fieldName":"reason"},{"fieldName":"processing_notes"}]}]},{"filename":"schema-06-fulfillment.prisma","namespace":"Fulfillment","models":[{"name":"shopping_mall_shipments","description":"Per-order shipment records. Represents a fulfillment shipment created for an order or subset of order lines. References the parent order, the seller fulfilling the shipment, optional recipient customer and optional shipping address snapshot. Stores carrier and tracking metadata, current shipment status, and temporal audit fields. Designed as a subsidiary entity managed through order/fulfillment workflows.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Belonged order's {@link shopping_mall_orders.id}. Reference to the parent order header for this shipment.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":false},{"name":"shopping_mall_seller_id","type":"uuid","description":"Owner seller's {@link shopping_mall_seller.id}. The seller responsible for fulfilling this shipment.","relation":{"name":"seller","targetModel":"shopping_mall_seller"},"unique":false,"nullable":false},{"name":"shopping_mall_customer_id","type":"uuid","description":"Recipient customer reference. {@link shopping_mall_customer.id}. Nullable for guest or external shipments.","relation":{"name":"customer","targetModel":"shopping_mall_customer"},"unique":false,"nullable":true},{"name":"shopping_mall_address_id","type":"uuid","description":"Shipping address snapshot reference. {@link shopping_mall_addresses.id}. Stored for traceability to the address used at shipment time.","relation":{"name":"shippingAddress","targetModel":"shopping_mall_addresses"},"unique":false,"nullable":true}],"plainFields":[{"name":"tracking_number","type":"string","nullable":true,"description":"Carrier-provided tracking number for this shipment."},{"name":"carrier_name","type":"string","nullable":true,"description":"Human-readable carrier name (e.g., 'AcmeExpress', 'LocalPost')."},{"name":"status","type":"string","nullable":false,"description":"Current shipment status (created, ready_for_pickup, in_transit, out_for_delivery, delivered, exception, returned)."},{"name":"shipped_at","type":"datetime","nullable":true,"description":"Timestamp when the shipment was marked as shipped by the seller (ISO 8601 KST)."},{"name":"delivered_at","type":"datetime","nullable":true,"description":"Timestamp when carrier reported delivery or system confirmed delivery."},{"name":"weight","type":"double","nullable":true,"description":"Optional shipment weight in platform-standard units. Nullable when unknown."},{"name":"package_count","type":"int","nullable":false,"description":"Number of packages in this shipment. Business expectation: at least 1."},{"name":"notes","type":"string","nullable":true,"description":"Operator-entered notes about the shipment; searchable via GIN index for operational queries."},{"name":"created_at","type":"datetime","nullable":false,"description":"Record creation timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Record last-updated timestamp."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft-delete timestamp. Nullable when not deleted."}],"uniqueIndexes":[{"fieldNames":["shopping_mall_order_id","shopping_mall_seller_id","tracking_number"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_seller_id","created_at"]},{"fieldNames":["status","created_at"]}],"ginIndexes":[{"fieldName":"notes"}]},{"name":"shopping_mall_shipment_events","description":"Append-only, time-ordered shipment event timeline. Each row represents a single event reported by a carrier or created by system/support. Events are immutable snapshots used for tracking feeds and audit trails. References the parent shipment ({@link shopping_mall_shipments.id}) and optionally the support agent who created/triaged the event ({@link shopping_mall_supportagent.id}).","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_shipment_id","type":"uuid","description":"Belonged shipment's {@link shopping_mall_shipments.id}. Parent shipment reference for the timeline event.","relation":{"name":"shipment","targetModel":"shopping_mall_shipments","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_supportagent_id","type":"uuid","description":"Optional supportAgent who created or triaged this event. {@link shopping_mall_supportagent.id}. Nullable for carrier-originated webhooks.","relation":{"name":"supportAgent","targetModel":"shopping_mall_supportagent","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"event_type","type":"string","nullable":false,"description":"Event classification (e.g., label_created, picked_up, in_transit, out_for_delivery, delivered, exception)."},{"name":"event_code","type":"string","nullable":true,"description":"Carrier-specific event code where available."},{"name":"event_time","type":"datetime","nullable":false,"description":"Timestamp reported by carrier or system for the event (ISO 8601, KST for business reporting)."},{"name":"location","type":"string","nullable":true,"description":"Optional location string reported with the event (city, facility)."},{"name":"description","type":"string","nullable":true,"description":"Human-readable event description. Indexed for search/triage."},{"name":"carrier_status","type":"string","nullable":true,"description":"Carrier-provided status text; kept for preservation of original semantics."},{"name":"raw_payload","type":"string","nullable":true,"description":"Raw webhook payload or serialized carrier event JSON for later replay and debugging."},{"name":"created_at","type":"datetime","nullable":false,"description":"Event record creation timestamp."}],"uniqueIndexes":[{"fieldNames":["shopping_mall_shipment_id","event_time","event_type"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_shipment_id","event_time"]},{"fieldNames":["event_type","event_time"]}],"ginIndexes":[{"fieldName":"description"}]}]}]}