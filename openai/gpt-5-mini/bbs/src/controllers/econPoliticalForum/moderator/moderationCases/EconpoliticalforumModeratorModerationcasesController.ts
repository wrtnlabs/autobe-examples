import { Controller } from "@nestjs/common";
import { TypedRoute, TypedBody, TypedParam } from "@nestia/core";
import typia, { tags } from "typia";
import { postEconPoliticalForumModeratorModerationCases } from "../../../../providers/postEconPoliticalForumModeratorModerationCases";
import { ModeratorAuth } from "../../../../decorators/ModeratorAuth";
import { ModeratorPayload } from "../../../../decorators/payload/ModeratorPayload";
import { patchEconPoliticalForumModeratorModerationCases } from "../../../../providers/patchEconPoliticalForumModeratorModerationCases";
import { getEconPoliticalForumModeratorModerationCasesCaseId } from "../../../../providers/getEconPoliticalForumModeratorModerationCasesCaseId";
import { putEconPoliticalForumModeratorModerationCasesCaseId } from "../../../../providers/putEconPoliticalForumModeratorModerationCasesCaseId";

import { IEconPoliticalForumModerationCase } from "../../../../api/structures/IEconPoliticalForumModerationCase";
import { IPageIEconPoliticalForumModerationCase } from "../../../../api/structures/IPageIEconPoliticalForumModerationCase";

@Controller("/econPoliticalForum/moderator/moderationCases")
export class EconpoliticalforumModeratorModerationcasesController {
  /**
   * Create a moderation case (econ_political_forum_moderation_cases).
   *
   * Create a new moderation case to group related reports, coordinate
   * investigations, and track escalation/state.
   *
   * Security and permissions: Only authenticated callers with the moderator
   * role may invoke this endpoint. Implementations must verify caller role and
   * perform referential integrity checks for provided UUID references. The
   * operation returns 201 and the created moderation case on success.
   *
   * Validation and errors:
   *
   * - 400: validation failure (invalid UUID, missing required fields)
   * - 401: unauthenticated
   * - 403: insufficient role
   * - 409: case_number conflict
   * - 500: server error
   *
   * @param connection
   * @param body Moderation case creation payload
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Post()
  public async create(
    @ModeratorAuth()
    moderator: ModeratorPayload,
    @TypedBody()
    body: IEconPoliticalForumModerationCase.ICreate,
  ): Promise<IEconPoliticalForumModerationCase> {
    try {
      return await postEconPoliticalForumModeratorModerationCases({
        moderator,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Search and retrieve a filtered, paginated list of moderation cases
   * (moderator scope).
   *
   * Retrieve a filtered, searchable and paginated list of moderation cases for
   * triage and administrative review.
   *
   * Purpose and overview: Provides moderators with the ability to list and
   * search moderation cases. Results are paginated and returned as concise
   * summaries for list views.
   *
   * Security considerations: Only authenticated users with the moderator role
   * may call this endpoint. The service MUST enforce role-based access and may
   * scope results to cases assigned to the caller unless the caller has
   * administrator privileges. Field-level redaction is required for PII when
   * the caller lacks admin privileges. All access MUST be audited.
   *
   * Business rules:
   *
   * - Default filter excludes records where deleted_at IS NOT NULL.
   * - Pagination: default page size 20, max 100. Either page+limit or opaque
   *   cursor is acceptable; the IRequest DTO should document the chosen
   *   approach.
   * - Filters: status, priority, assigned_moderator_id, owner_admin_id,
   *   legal_hold, created_at/updated_at/closed_at ranges.
   * - Sorting: created_at, priority, case_number.
   *
   * Errors: 400/401/403/429/500.
   *
   * @param connection
   * @param body Search, filter, sort and pagination parameters for moderation
   *   case listing (define cursor or page+limit format in the IRequest DTO)
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Patch()
  public async index(
    @ModeratorAuth()
    moderator: ModeratorPayload,
    @TypedBody()
    body: IEconPoliticalForumModerationCase.IRequest,
  ): Promise<IPageIEconPoliticalForumModerationCase.ISummary> {
    try {
      return await patchEconPoliticalForumModeratorModerationCases({
        moderator,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Retrieve a single moderation case by ID (moderator scope).
   *
   * Get detailed moderation case information for review, escalation, and
   * appeals. The response includes case fields from
   * econ_political_forum_moderation_cases and id references to related reports
   * and moderation logs. Access is restricted to moderators and administrators;
   * administrators may see additional evidence fields per legal_hold rules. All
   * accesses should be recorded in audit logs.
   *
   * Behavior and validation:
   *
   * - Path parameter caseId must be a valid UUID.
   * - If deleted_at is set and caller is not an administrator requesting archived
   *   records, return 404.
   *
   * Errors: 400/401/403/404/500.
   *
   * @param connection
   * @param caseId Unique identifier (UUID) of the moderation case to retrieve
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Get(":caseId")
  public async at(
    @ModeratorAuth()
    moderator: ModeratorPayload,
    @TypedParam("caseId")
    caseId: string & tags.Format<"uuid">,
  ): Promise<IEconPoliticalForumModerationCase> {
    try {
      return await getEconPoliticalForumModeratorModerationCasesCaseId({
        moderator,
        caseId,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }

  /**
   * Update a moderation case (econ_political_forum_moderation_cases).
   *
   * Modify an existing moderation case to reflect investigation progress,
   * assignment changes, escalation decisions, or closure.
   *
   * Security and permissions: Only authenticated callers with the moderator
   * role may update cases. Implementations must verify authorization (e.g.,
   * assigned moderators or administrators) before applying updates. Updates
   * must create audit entries in econ_political_forum_audit_logs and moderation
   * logs where applicable.
   *
   * Validation and errors:
   *
   * - 400: validation failure (invalid UUID, invalid references)
   * - 401: unauthenticated
   * - 403: not authorized
   * - 404: case not found
   * - 409: case_number conflict
   * - 500: server error
   *
   * @param connection
   * @param caseId Target moderation case's ID
   * @param body Moderation case update payload (partial or full)
   * @nestia Generated by Nestia - https://github.com/samchon/nestia
   */
  @TypedRoute.Put(":caseId")
  public async update(
    @ModeratorAuth()
    moderator: ModeratorPayload,
    @TypedParam("caseId")
    caseId: string & tags.Format<"uuid">,
    @TypedBody()
    body: IEconPoliticalForumModerationCase.IUpdate,
  ): Promise<IEconPoliticalForumModerationCase> {
    try {
      return await putEconPoliticalForumModeratorModerationCasesCaseId({
        moderator,
        caseId,
        body,
      });
    } catch (error) {
      console.log(error);
      throw error;
    }
  }
}
