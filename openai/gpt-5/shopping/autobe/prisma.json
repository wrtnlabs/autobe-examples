{"files":[{"filename":"schema-01-systematic.prisma","namespace":"Systematic","models":[{"name":"shopping_mall_configurations","description":"Key-value configuration registry for platform-wide settings. Each record represents a single configuration entry optionally scoped to an environment or region. Consumed by various services for feature behavior, thresholds, and defaults. Managed by administrators with audit through timestamps. No denormalized data; values stored as raw strings with optional description for operator clarity.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"key","type":"string","description":"Business configuration key identifier. Unique within an optional scope to prevent collisions across environments or regions.","nullable":false},{"name":"value","type":"string","description":"Raw configuration value stored as string; interpretation is handled by application (e.g., JSON string, numeric string, boolean string).","nullable":false},{"name":"scope","type":"string","description":"Optional scope label to partition configurations by environment (e.g., prod, staging) or region (e.g., KR, US).","nullable":true},{"name":"description","type":"string","description":"Human-readable explanation of the configuration’s purpose and acceptable values.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for the configuration entry.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for the configuration entry.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for recoverability; null when active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["key","scope"],"unique":true}],"plainIndexes":[{"fieldNames":["created_at"]},{"fieldNames":["scope","key"]}],"ginIndexes":[{"fieldName":"key"}]},{"name":"shopping_mall_feature_flags","description":"Feature flag registry controlling conditional behaviors and progressive rollouts. Flags can be toggled, scheduled with effective windows, and optionally ramped by percentage. Used by application services to gate features and experiments. Managed by operations/admin teams.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"code","type":"string","description":"Unique code identifier for the feature flag (e.g., checkout_risk_hold_v2).","nullable":false},{"name":"name","type":"string","description":"Human-friendly flag name for console display and search.","nullable":false},{"name":"description","type":"string","description":"Operator-facing description of the flag’s purpose and scope.","nullable":true},{"name":"enabled","type":"boolean","description":"Whether the flag is globally enabled (subject to optional schedule and rollout settings).","nullable":false},{"name":"rollout_percentage","type":"int","description":"Optional progressive rollout percentage (0–100). When null, no percentage-based rollout applies.","nullable":true},{"name":"segment","type":"string","description":"Optional audience or segment key used by application to target subsets (e.g., locale=ko-KR, seller_tier=gold). Purely informational here.","nullable":true},{"name":"starts_at","type":"datetime","description":"Optional start datetime for when the flag becomes effective.","nullable":true},{"name":"ends_at","type":"datetime","description":"Optional end datetime after which the flag is no longer effective.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for the feature flag record.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for the feature flag record.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp; null when active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["code"],"unique":true}],"plainIndexes":[{"fieldNames":["enabled","updated_at"]},{"fieldNames":["enabled","starts_at","ends_at"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_policies","description":"Top-level policy definitions governing business behaviors (e.g., returns, cancellations, pricing floors). This table represents the policy container and metadata. Concrete business rules and effective-dated terms are captured in {@link shopping_mall_policy_versions}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"code","type":"string","description":"Unique human-readable policy code (e.g., RETURNS_GENERAL, REFUND_HIGH_VALUE).","nullable":false},{"name":"title","type":"string","description":"Policy title for administrative display and search.","nullable":false},{"name":"category","type":"string","description":"High-level grouping (e.g., returns, refunds, payouts, catalog, moderation).","nullable":false},{"name":"status","type":"string","description":"Lifecycle state of the policy (e.g., draft, active, retired).","nullable":false},{"name":"description","type":"string","description":"Optional summary describing policy intent and scope (detailed terms live in versions).","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for the policy container.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for the policy container.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp; null when active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["code"],"unique":true}],"plainIndexes":[{"fieldNames":["category","status"]}],"ginIndexes":[{"fieldName":"title"}]},{"name":"shopping_mall_policy_versions","description":"Effective-dated, append-only snapshots of policy content for audit and grandfathering. Each version belongs to a {@link shopping_mall_policies} record, carries a semantic version label, effective window, and change notes. Serves as the historical source of truth for policy evaluations at a given time.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_policy_id","type":"uuid","description":"Parent policy reference. Target model's {@link shopping_mall_policies.id}.","relation":{"name":"policy","targetModel":"shopping_mall_policies","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"version","type":"string","description":"Semantic or sequential version label (e.g., 1.0.0, 2025-01).","nullable":false},{"name":"effective_from","type":"datetime","description":"Start datetime when this policy version becomes effective.","nullable":false},{"name":"effective_to","type":"datetime","description":"Optional end datetime after which the version is no longer effective (open-ended when null).","nullable":true},{"name":"change_notes","type":"string","description":"Summary of changes for operators and auditors.","nullable":true},{"name":"approved","type":"boolean","description":"Whether this version is approved through maker-checker or equivalent governance.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp for the policy version record.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for the policy version record.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp; null when active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_policy_id","version"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_policy_id","effective_from"]},{"fieldNames":["shopping_mall_policy_id","approved","effective_from"]}],"ginIndexes":[{"fieldName":"change_notes"}]},{"name":"shopping_mall_locales","description":"Locale registry of supported languages/regions for the platform. Provides BCP 47-style codes with activation flags. Used by frontends and notifications to determine formatting and language fallback logic.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"code","type":"string","description":"Unique locale code (e.g., en-US, ko-KR) used across services for localization.","nullable":false},{"name":"name","type":"string","description":"English display name of the locale (e.g., English (United States), Korean (Korea)).","nullable":false},{"name":"native_name","type":"string","description":"Locale’s self-referential name in its own language/script (e.g., 한국어(대한민국)).","nullable":true},{"name":"rtl","type":"boolean","description":"Whether the locale is right-to-left (true) or left-to-right (false).","nullable":false},{"name":"active","type":"boolean","description":"Whether the locale is currently enabled for use in the platform.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp for the locale record.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for the locale record.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp; null when active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["code"],"unique":true}],"plainIndexes":[{"fieldNames":["active","code"]}],"ginIndexes":[{"fieldName":"name"},{"fieldName":"native_name"}]}]},{"filename":"schema-02-actors.prisma","namespace":"Actors","models":[{"name":"shopping_mall_users","description":"Platform user identities for all roles (guests who registered, customers, sellers, and staff). Holds login credentials, verification state, account status, and basic profile attributes. Other models link here: {@link shopping_mall_user_sessions}, {@link shopping_mall_user_addresses}, {@link shopping_mall_consents}, {@link shopping_mall_user_security_events}, and all role-assignment tables (e.g., {@link shopping_mall_customer}). This version adds secure MFA artifacts and a password change timestamp to support token revocation and 2FA requirements.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"email","type":"string","description":"Unique email address used for login and notifications. Must be verified before checkout or review actions.","nullable":false},{"name":"password_hash","type":"string","description":"BCrypt/Argon2 hash of the user's password. Plaintext passwords are never stored.","nullable":false},{"name":"email_verified","type":"boolean","description":"Whether the email address has been verified.","nullable":false},{"name":"verified_at","type":"datetime","description":"Timestamp when the account's email verification completed.","nullable":true},{"name":"mfa_enabled","type":"boolean","description":"Whether multi-factor authentication is enabled for this user.","nullable":false},{"name":"mfa_method","type":"string","description":"Preferred 2FA method when multi-factor is enabled (e.g., totp, sms, webauthn).","nullable":true},{"name":"mfa_secret_encrypted","type":"string","description":"Encrypted TOTP/credential secret material used for MFA; never stored in plaintext. Encryption/at-rest protection required.","nullable":true},{"name":"mfa_backup_codes_encrypted","type":"string","description":"Encrypted/hashed bundle of backup codes for MFA recovery; rotated on use and never stored in plaintext.","nullable":true},{"name":"password_changed_at","type":"datetime","description":"Timestamp of the last successful password change, used to invalidate refresh tokens and enforce re-authentication per policy.","nullable":true},{"name":"status","type":"string","description":"Administrative/account lifecycle status (e.g., active, suspended, terminated).","nullable":false},{"name":"name","type":"string","description":"Full name as provided by the user for display and fulfillment contexts.","nullable":true},{"name":"nickname","type":"string","description":"Optional nickname/handle used in certain UI contexts.","nullable":true},{"name":"phone","type":"string","description":"Optional phone number for contact and risk checks.","nullable":true},{"name":"last_login_at","type":"datetime","description":"Last successful interactive authentication timestamp.","nullable":true},{"name":"lockout_until","type":"datetime","description":"If set, the account is locked until this time due to policy/risk controls.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp in UTC.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp in UTC.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if the account is deactivated for recovery/compliance.","nullable":true}],"uniqueIndexes":[{"fieldNames":["email"],"unique":true}],"plainIndexes":[{"fieldNames":["email_verified","created_at"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"name"},{"fieldName":"nickname"}]},{"name":"shopping_mall_user_sessions","description":"Authentication sessions/refresh tokens for users. Each record represents a logical session with expiry, device metadata, and revocation state. Belongs to {@link shopping_mall_users}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_user_id","type":"uuid","description":"Owner user's {@link shopping_mall_users.id}.","relation":{"name":"user","targetModel":"shopping_mall_users","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"refresh_token_hash","type":"string","description":"Hash of the refresh token for secure verification and revocation.","nullable":false},{"name":"user_agent","type":"string","description":"Client user agent string captured at session creation.","nullable":true},{"name":"ip","type":"string","description":"IP address (string) observed for this session.","nullable":true},{"name":"expires_at","type":"datetime","description":"When this session/refresh token expires.","nullable":false},{"name":"revoked_at","type":"datetime","description":"When this session was revoked (if applicable).","nullable":true},{"name":"last_accessed_at","type":"datetime","description":"Most recent activity timestamp used for security analysis.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp in UTC.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp in UTC.","nullable":false}],"uniqueIndexes":[{"fieldNames":["refresh_token_hash"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_user_id","created_at"]},{"fieldNames":["expires_at","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_user_addresses","description":"Customer-managed delivery/billing addresses. Validates serviceability and supports default shipping/billing flags per user. Belongs to {@link shopping_mall_users}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_user_id","type":"uuid","description":"Owner user's {@link shopping_mall_users.id}.","relation":{"name":"user","targetModel":"shopping_mall_users","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"type","type":"string","description":"Address type: Shipping or Billing (business-enforced).","nullable":false},{"name":"recipient","type":"string","description":"Recipient full name.","nullable":false},{"name":"phone","type":"string","description":"Contact phone number for delivery coordination.","nullable":false},{"name":"country","type":"string","description":"ISO country name/code string as stored by business rules.","nullable":false},{"name":"region","type":"string","description":"Region/State/Province where applicable.","nullable":true},{"name":"city","type":"string","description":"City/Locality.","nullable":false},{"name":"postal_code","type":"string","description":"Postal/ZIP code as applicable.","nullable":false},{"name":"address_line1","type":"string","description":"Primary street address or road name.","nullable":false},{"name":"address_line2","type":"string","description":"Secondary address info (building, unit).","nullable":true},{"name":"default_shipping","type":"boolean","description":"Whether this is the default shipping address for the user. Only one should be true per user by policy.","nullable":false},{"name":"default_billing","type":"boolean","description":"Whether this is the default billing address for the user. Only one should be true per user by policy.","nullable":false},{"name":"serviceable","type":"boolean","description":"Whether platform/carriers can service this address given policy and region constraints.","nullable":false},{"name":"verified","type":"boolean","description":"Whether this address passed validation checks.","nullable":false},{"name":"validated_at","type":"datetime","description":"Timestamp when the address was last validated.","nullable":true},{"name":"last_used_at","type":"datetime","description":"Timestamp when this address was last used in an order/checkout flow.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp in UTC.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp in UTC.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp when an address is removed from active use.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_user_id","type","created_at"]},{"fieldNames":["shopping_mall_user_id","default_shipping"]},{"fieldNames":["shopping_mall_user_id","default_billing"]}],"ginIndexes":[]},{"name":"shopping_mall_consents","description":"Consent records per user for marketing/personalization and other regulated communications. Enforces single current record per (user, scope). Belongs to {@link shopping_mall_users}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_user_id","type":"uuid","description":"Owner user's {@link shopping_mall_users.id}.","relation":{"name":"user","targetModel":"shopping_mall_users","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"scope","type":"string","description":"Consent scope identifier (e.g., marketing_email, sms, personalization).","nullable":false},{"name":"granted","type":"boolean","description":"Whether consent is currently granted for the scope.","nullable":false},{"name":"granted_at","type":"datetime","description":"When consent was granted.","nullable":true},{"name":"revoked_at","type":"datetime","description":"When consent was revoked.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp in UTC.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp in UTC.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_user_id","scope"],"unique":true}],"plainIndexes":[{"fieldNames":["granted","granted_at"]},{"fieldNames":["shopping_mall_user_id","created_at"]}],"ginIndexes":[{"fieldName":"scope"}]},{"name":"shopping_mall_user_security_events","description":"Append-only security/audit events for identity lifecycle (login success/failure, password reset, 2FA, token revocations). References {@link shopping_mall_users} and optionally {@link shopping_mall_user_sessions}. Used for investigations and compliance audits.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_user_id","type":"uuid","description":"Subject user's {@link shopping_mall_users.id}.","relation":{"name":"user","targetModel":"shopping_mall_users","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_user_session_id","type":"uuid","description":"Related session's {@link shopping_mall_user_sessions.id} when applicable.","relation":{"name":"session","targetModel":"shopping_mall_user_sessions","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"event_type","type":"string","description":"Event kind (e.g., login_success, login_failure, password_changed, mfa_challenge, token_revoked).","nullable":false},{"name":"reason","type":"string","description":"Optional human-readable reason or category code for the event.","nullable":true},{"name":"ip","type":"string","description":"Observed IP address at time of event.","nullable":true},{"name":"user_agent","type":"string","description":"Observed user agent at time of event.","nullable":true},{"name":"occurred_at","type":"datetime","description":"Business time the event occurred.","nullable":false},{"name":"created_at","type":"datetime","description":"Ingestion time the event was recorded.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_user_id","occurred_at"]},{"fieldNames":["shopping_mall_user_session_id","occurred_at"]},{"fieldNames":["event_type","occurred_at"]}],"ginIndexes":[{"fieldName":"reason"},{"fieldName":"user_agent"}]},{"name":"shopping_mall_guest","description":"Role-assignment table marking a {@link shopping_mall_users} identity as guest-kind (limited capabilities). Usually transient and auto-upgraded upon registration. 1:1 with user.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_user_id","type":"uuid","description":"Assigned user's {@link shopping_mall_users.id}.","relation":{"name":"user","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_guest_of_shopping_mall_user_id"},"unique":true,"nullable":false},{"name":"granted_by_user_id","type":"uuid","description":"Optional staff actor's {@link shopping_mall_users.id} who granted the role.","relation":{"name":"grantedBy","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_guest_of_granted_by_user_id"},"unique":false,"nullable":true}],"plainFields":[{"name":"assigned_at","type":"datetime","description":"When this role was granted.","nullable":false},{"name":"revoked_at","type":"datetime","description":"When this role was revoked.","nullable":true},{"name":"reason","type":"string","description":"Reason text or code for assignment/revocation.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp in UTC.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp in UTC.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_user_id"],"unique":true}],"plainIndexes":[{"fieldNames":["assigned_at"]},{"fieldNames":["revoked_at"]}],"ginIndexes":[{"fieldName":"reason"}]},{"name":"shopping_mall_customer","description":"Role-assignment table indicating a {@link shopping_mall_users} identity has customer capabilities. 1:1 with user. Used for query scoping like \"find all customers\" via role presence.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_user_id","type":"uuid","description":"Assigned user's {@link shopping_mall_users.id}.","relation":{"name":"user","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_customer_of_shopping_mall_user_id"},"unique":true,"nullable":false},{"name":"granted_by_user_id","type":"uuid","description":"Optional staff actor's {@link shopping_mall_users.id} who granted the role.","relation":{"name":"grantedBy","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_customer_of_granted_by_user_id"},"unique":false,"nullable":true}],"plainFields":[{"name":"assigned_at","type":"datetime","description":"When this role was granted.","nullable":false},{"name":"revoked_at","type":"datetime","description":"When this role was revoked.","nullable":true},{"name":"reason","type":"string","description":"Reason text or code for assignment/revocation.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp in UTC.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp in UTC.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_user_id"],"unique":true}],"plainIndexes":[{"fieldNames":["assigned_at"]},{"fieldNames":["revoked_at"]}],"ginIndexes":[{"fieldName":"reason"}]},{"name":"shopping_mall_seller","description":"Role-assignment table indicating a {@link shopping_mall_users} identity has seller capabilities. This table does not duplicate seller business entities; it only flags the role assignment and lifecycle. 1:1 with user.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_user_id","type":"uuid","description":"Assigned user's {@link shopping_mall_users.id}.","relation":{"name":"user","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_seller_of_shopping_mall_user_id"},"unique":true,"nullable":false},{"name":"granted_by_user_id","type":"uuid","description":"Optional staff actor's {@link shopping_mall_users.id} who granted the role.","relation":{"name":"grantedBy","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_seller_of_granted_by_user_id"},"unique":false,"nullable":true}],"plainFields":[{"name":"assigned_at","type":"datetime","description":"When this role was granted.","nullable":false},{"name":"revoked_at","type":"datetime","description":"When this role was revoked.","nullable":true},{"name":"reason","type":"string","description":"Reason text or code for assignment/revocation.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp in UTC.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp in UTC.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_user_id"],"unique":true}],"plainIndexes":[{"fieldNames":["assigned_at"]},{"fieldNames":["revoked_at"]}],"ginIndexes":[{"fieldName":"reason"}]},{"name":"shopping_mall_supportagent","description":"Role-assignment table indicating a {@link shopping_mall_users} identity has support agent capabilities within policy thresholds. 1:1 with user and governed by audit controls.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_user_id","type":"uuid","description":"Assigned user's {@link shopping_mall_users.id}.","relation":{"name":"user","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_supportagent_of_shopping_mall_user_id"},"unique":true,"nullable":false},{"name":"granted_by_user_id","type":"uuid","description":"Optional staff actor's {@link shopping_mall_users.id} who granted the role.","relation":{"name":"grantedBy","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_supportagent_of_granted_by_user_id"},"unique":false,"nullable":true}],"plainFields":[{"name":"assigned_at","type":"datetime","description":"When this role was granted.","nullable":false},{"name":"revoked_at","type":"datetime","description":"When this role was revoked.","nullable":true},{"name":"reason","type":"string","description":"Reason text or code for assignment/revocation.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp in UTC.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp in UTC.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_user_id"],"unique":true}],"plainIndexes":[{"fieldNames":["assigned_at"]},{"fieldNames":["revoked_at"]}],"ginIndexes":[{"fieldName":"reason"}]},{"name":"shopping_mall_operationsmanager","description":"Role-assignment table indicating a {@link shopping_mall_users} identity has operations manager capabilities for catalog/policy governance. 1:1 with user and governed by maker-checker policy.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_user_id","type":"uuid","description":"Assigned user's {@link shopping_mall_users.id}.","relation":{"name":"user","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_operationsmanager_of_shopping_mall_user_id"},"unique":true,"nullable":false},{"name":"granted_by_user_id","type":"uuid","description":"Optional staff actor's {@link shopping_mall_users.id} who granted the role.","relation":{"name":"grantedBy","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_operationsmanager_of_granted_by_user_id"},"unique":false,"nullable":true}],"plainFields":[{"name":"assigned_at","type":"datetime","description":"When this role was granted.","nullable":false},{"name":"revoked_at","type":"datetime","description":"When this role was revoked.","nullable":true},{"name":"reason","type":"string","description":"Reason text or code for assignment/revocation.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp in UTC.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp in UTC.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_user_id"],"unique":true}],"plainIndexes":[{"fieldNames":["assigned_at"]},{"fieldNames":["revoked_at"]}],"ginIndexes":[{"fieldName":"reason"}]},{"name":"shopping_mall_financemanager","description":"Role-assignment table indicating a {@link shopping_mall_users} identity has finance manager capabilities for refunds, payouts, and reconciliation governance. 1:1 with user and governed by maker-checker policy.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_user_id","type":"uuid","description":"Assigned user's {@link shopping_mall_users.id}.","relation":{"name":"user","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_financemanager_of_shopping_mall_user_id"},"unique":true,"nullable":false},{"name":"granted_by_user_id","type":"uuid","description":"Optional staff actor's {@link shopping_mall_users.id} who granted the role.","relation":{"name":"grantedBy","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_financemanager_of_granted_by_user_id"},"unique":false,"nullable":true}],"plainFields":[{"name":"assigned_at","type":"datetime","description":"When this role was granted.","nullable":false},{"name":"revoked_at","type":"datetime","description":"When this role was revoked.","nullable":true},{"name":"reason","type":"string","description":"Reason text or code for assignment/revocation.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp in UTC.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp in UTC.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_user_id"],"unique":true}],"plainIndexes":[{"fieldNames":["assigned_at"]},{"fieldNames":["revoked_at"]}],"ginIndexes":[{"fieldName":"reason"}]},{"name":"shopping_mall_contentmoderator","description":"Role-assignment table indicating a {@link shopping_mall_users} identity has content moderation capabilities. 1:1 with user and fully audited.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_user_id","type":"uuid","description":"Assigned user's {@link shopping_mall_users.id}.","relation":{"name":"user","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_contentmoderator_of_shopping_mall_user_id"},"unique":true,"nullable":false},{"name":"granted_by_user_id","type":"uuid","description":"Optional staff actor's {@link shopping_mall_users.id} who granted the role.","relation":{"name":"grantedBy","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_contentmoderator_of_granted_by_user_id"},"unique":false,"nullable":true}],"plainFields":[{"name":"assigned_at","type":"datetime","description":"When this role was granted.","nullable":false},{"name":"revoked_at","type":"datetime","description":"When this role was revoked.","nullable":true},{"name":"reason","type":"string","description":"Reason text or code for assignment/revocation.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp in UTC.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp in UTC.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_user_id"],"unique":true}],"plainIndexes":[{"fieldNames":["assigned_at"]},{"fieldNames":["revoked_at"]}],"ginIndexes":[{"fieldName":"reason"}]},{"name":"shopping_mall_systemadmin","description":"Role-assignment table indicating a {@link shopping_mall_users} identity has system administrator capabilities. 1:1 with user under the platform’s highest audit and maker-checker rules.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_user_id","type":"uuid","description":"Assigned user's {@link shopping_mall_users.id}.","relation":{"name":"user","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_systemadmin_of_shopping_mall_user_id"},"unique":true,"nullable":false},{"name":"granted_by_user_id","type":"uuid","description":"Optional staff actor's {@link shopping_mall_users.id} who granted the role.","relation":{"name":"grantedBy","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_systemadmin_of_granted_by_user_id"},"unique":false,"nullable":true}],"plainFields":[{"name":"assigned_at","type":"datetime","description":"When this role was granted.","nullable":false},{"name":"revoked_at","type":"datetime","description":"When this role was revoked.","nullable":true},{"name":"reason","type":"string","description":"Reason text or code for assignment/revocation.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp in UTC.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp in UTC.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_user_id"],"unique":true}],"plainIndexes":[{"fieldNames":["assigned_at"]},{"fieldNames":["revoked_at"]}],"ginIndexes":[{"fieldName":"reason"}]}]},{"filename":"schema-03-catalog.prisma","namespace":"Catalog","models":[{"name":"shopping_mall_categories","description":"Hierarchical category taxonomy node used for product discovery, navigation, and SEO breadcrumbs. Supports parent-child relationships through self-reference and maintains unique name/slug within the same parent. Primary relationships: parent category via {@link shopping_mall_categories}, products via junction {@link shopping_mall_product_categories}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"parent_id","type":"uuid","description":"Parent category's {@link shopping_mall_categories.id}.","relation":{"name":"parent","targetModel":"shopping_mall_categories","targetField":"id","mappingName":"recursive"},"unique":false,"nullable":true}],"plainFields":[{"name":"name","type":"string","description":"Human-readable category name displayed to users and staff.","nullable":false},{"name":"slug","type":"string","description":"URL-friendly unique identifier within the same parent for canonical paths and SEO.","nullable":false},{"name":"description","type":"string","description":"Optional description used for merchandising or SEO snippets.","nullable":true},{"name":"display_order","type":"int","description":"Ordering weight among siblings for navigation and merchandising (lower first).","nullable":false},{"name":"status","type":"string","description":"Business lifecycle state (e.g., draft, active, hidden, archived).","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp when the category is logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["parent_id","slug"],"unique":true},{"fieldNames":["parent_id","name"],"unique":true}],"plainIndexes":[{"fieldNames":["parent_id","display_order"]},{"fieldNames":["status","created_at"]}],"ginIndexes":[{"fieldName":"name"},{"fieldName":"slug"}]},{"name":"shopping_mall_brands","description":"Brand dimension used across the catalog for filtering, attribution, and SEO. Managed by operations; products may reference a brand. Includes unique name and slug with optional website URI.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"name","type":"string","description":"Brand display name used in listings and filters.","nullable":false},{"name":"slug","type":"string","description":"URL-friendly unique identifier for the brand.","nullable":false},{"name":"description","type":"string","description":"Optional brand description or about text.","nullable":true},{"name":"website","type":"uri","description":"Optional official brand website URL.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp when logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["slug"],"unique":true},{"fieldNames":["name"],"unique":true}],"plainIndexes":[{"fieldNames":["created_at","slug"]}],"ginIndexes":[]},{"name":"shopping_mall_products","description":"Core product entity defining buyer-facing content and canonical placement. Each product belongs to a store ({@link shopping_mall_stores}), has a primary category ({@link shopping_mall_categories}), and may reference a brand ({@link shopping_mall_brands}). Variants/SKUs, options, and inventory are modeled in other components. Supports SEO via unique slug and content fields.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_store_id","type":"uuid","description":"Owning store's {@link shopping_mall_stores.id}.","relation":{"name":"store","targetModel":"shopping_mall_stores","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_category_id","type":"uuid","description":"Primary category's {@link shopping_mall_categories.id} for canonical placement.","relation":{"name":"primaryCategory","targetModel":"shopping_mall_categories","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_brand_id","type":"uuid","description":"Optional brand reference's {@link shopping_mall_brands.id}.","relation":{"name":"brand","targetModel":"shopping_mall_brands","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"title","type":"string","description":"Buyer-facing product title (5–120 chars recommended).","nullable":false},{"name":"slug","type":"string","description":"Canonical URL slug unique across products.","nullable":false},{"name":"short_description","type":"string","description":"Concise merchandising description suitable for lists (20–500 chars).","nullable":true},{"name":"long_description","type":"string","description":"Detailed product description for PDP; may include HTML or rich text (policy-compliant).","nullable":true},{"name":"status","type":"string","description":"Business lifecycle state (e.g., draft, pending, published, suspended, discontinued, archived).","nullable":false},{"name":"published_at","type":"datetime","description":"Timestamp when the product was published (UTC).","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp when logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["slug"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_store_id","created_at"]},{"fieldNames":["shopping_mall_category_id","created_at"]},{"fieldNames":["shopping_mall_brand_id","created_at"]},{"fieldNames":["status","published_at"]},{"fieldNames":["shopping_mall_store_id","status"]}],"ginIndexes":[{"fieldName":"title"},{"fieldName":"short_description"}]},{"name":"shopping_mall_product_categories","description":"Junction table linking {@link shopping_mall_products} to {@link shopping_mall_categories} for cross-listing beyond the primary category. Ensures each product/category pair is unique for clean merchandising and filtering.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Linked product's {@link shopping_mall_products.id}.","relation":{"name":"product","targetModel":"shopping_mall_products","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_category_id","type":"uuid","description":"Linked category's {@link shopping_mall_categories.id}.","relation":{"name":"category","targetModel":"shopping_mall_categories","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp when the link is logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_product_id","shopping_mall_category_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_category_id","shopping_mall_product_id"]}],"ginIndexes":[]},{"name":"shopping_mall_product_attributes","description":"Per-product attribute definitions used for filtering and display on PDP. Each record defines an attribute key for a specific {@link shopping_mall_products} with metadata like data_type, required, and filterable. Values are stored in {@link shopping_mall_product_attribute_values}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Owner product's {@link shopping_mall_products.id}.","relation":{"name":"product","targetModel":"shopping_mall_products","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"name","type":"string","description":"Attribute key/name (e.g., material, gender, season).","nullable":false},{"name":"data_type","type":"string","description":"Declared attribute data type for values (e.g., string, int, double, boolean). Used for validation.","nullable":false},{"name":"required","type":"boolean","description":"Whether this attribute must be present before product publish.","nullable":false},{"name":"filterable","type":"boolean","description":"Whether the attribute is eligible for faceted search filtering.","nullable":false},{"name":"display_order","type":"int","description":"Ordering weight for PDP display (lower first).","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp when the attribute is removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_product_id","name"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_product_id","display_order"]},{"fieldNames":["shopping_mall_product_id","filterable"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_product_attribute_values","description":"Values for a single attribute definition ({@link shopping_mall_product_attributes}). Supports multi-valued attributes while maintaining 3NF by referencing the attribute id only. One of the typed value columns should be populated according to the attribute's data_type.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_attribute_id","type":"uuid","description":"Target attribute's {@link shopping_mall_product_attributes.id}.","relation":{"name":"attribute","targetModel":"shopping_mall_product_attributes","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"value_string","type":"string","description":"String representation when data_type = string (or enumerated textual values).","nullable":true},{"name":"value_int","type":"int","description":"Integer representation when data_type = int.","nullable":true},{"name":"value_double","type":"double","description":"Decimal representation when data_type = double (e.g., weight).","nullable":true},{"name":"value_boolean","type":"boolean","description":"Boolean representation when data_type = boolean.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp when the value is removed.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_product_attribute_id","created_at"]},{"fieldNames":["shopping_mall_product_attribute_id","value_int"]},{"fieldNames":["shopping_mall_product_attribute_id","value_double"]},{"fieldNames":["shopping_mall_product_attribute_id","value_boolean"]}],"ginIndexes":[{"fieldName":"value_string"}]},{"name":"shopping_mall_product_media","description":"Media assets for a product ({@link shopping_mall_products}) including images and videos. Stores canonical URI, type, ordering, and accessibility alt text. Primary images can be derived by is_primary flag; uniqueness per product ensures stable ordering and de-duplication.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Owner product's {@link shopping_mall_products.id}.","relation":{"name":"product","targetModel":"shopping_mall_products","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"kind","type":"string","description":"Media kind/type hint (e.g., image, video).","nullable":false},{"name":"uri","type":"uri","description":"Canonical media URI (CDN or storage link).","nullable":false},{"name":"alt_text","type":"string","description":"Accessibility alt text or caption for the media.","nullable":true},{"name":"display_order","type":"int","description":"Ordering weight for display in product galleries (lower first).","nullable":false},{"name":"is_primary","type":"boolean","description":"Whether this media is the primary visual for the product.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp when logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_product_id","display_order"],"unique":true},{"fieldNames":["shopping_mall_product_id","uri"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_product_id","is_primary"]},{"fieldNames":["shopping_mall_product_id","created_at"]}],"ginIndexes":[{"fieldName":"alt_text"}]}]},{"filename":"schema-04-variants-inventory.prisma","namespace":"Variants","models":[{"name":"shopping_mall_option_types","description":"Master catalog of variant option types (e.g., Color, Size) that define selectable dimensions for products and SKUs. Managed by operations and reused across many products. Related option values live in {@link shopping_mall_option_values}. Products select which types apply via {@link shopping_mall_product_options}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"code","type":"string","description":"Business identifier code for the option type (e.g., \"color\", \"size\"). Must be unique platform-wide.","nullable":false},{"name":"name","type":"string","description":"Human-readable name of the option type (e.g., \"Color\").","nullable":false},{"name":"description","type":"string","description":"Optional description or guidance for this option type.","nullable":true},{"name":"sort_order","type":"int","description":"Display ordering priority for UI presentation; lower numbers appear first.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if the record is logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["code"],"unique":true}],"plainIndexes":[{"fieldNames":["sort_order","created_at"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_option_values","description":"Concrete values under an option type (e.g., for {@link shopping_mall_option_types} Color → Red, Blue). Each value belongs to exactly one type and may include presentation hints (e.g., hex_color). Used to define valid variant combinations for SKUs.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_option_type_id","type":"uuid","description":"Belonged option type's {@link shopping_mall_option_types.id}","relation":{"name":"optionType","targetModel":"shopping_mall_option_types","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"code","type":"string","description":"Business identifier within the parent type (e.g., \"red\", \"xl\"). Unique per option type.","nullable":false},{"name":"value","type":"string","description":"Display value for this option (e.g., \"Red\", \"XL\").","nullable":false},{"name":"hex_color","type":"string","description":"Optional hex color string (e.g., #FF0000) used for color swatches.","nullable":true},{"name":"sort_order","type":"int","description":"Display ordering priority within the type; lower numbers appear first.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_option_type_id","code"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_option_type_id","sort_order"]}],"ginIndexes":[{"fieldName":"value"}]},{"name":"shopping_mall_product_options","description":"Declares which option types apply to a specific product. This enables valid variant dimensions for that product, preserving variant integrity. Supports ordering and whether the type is required for SKU resolution. References {@link shopping_mall_products} and {@link shopping_mall_option_types}. Adds a unique constraint on (product_id, display_order) to prevent duplicate ordering positions per product.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Target product's {@link shopping_mall_products.id}","relation":{"name":"product","targetModel":"shopping_mall_products","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_option_type_id","type":"uuid","description":"Applied option type's {@link shopping_mall_option_types.id}","relation":{"name":"optionType","targetModel":"shopping_mall_option_types","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"required","type":"boolean","description":"Whether this option type is required for the product's SKU resolution.","nullable":false},{"name":"display_order","type":"int","description":"Display ordering priority for the option types on the product page.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if the mapping is removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_product_id","shopping_mall_option_type_id"],"unique":true},{"fieldNames":["shopping_mall_product_id","display_order"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_option_type_id"]}],"ginIndexes":[]},{"name":"shopping_mall_skus","description":"Stock Keeping Units (SKUs) representing specific purchasable variants of a product. Each SKU belongs to a {@link shopping_mall_products} item and is resolved via its associated {@link shopping_mall_sku_option_values}. Contains sellable status and base price information. Uniqueness of the variant combination for a product is enforced via an application-generated combination_key. This version removes the unnecessary trigram GIN index on sku_code to reduce write and storage overhead while keeping the unique constraint.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_product_id","type":"uuid","description":"Parent product's {@link shopping_mall_products.id}","relation":{"name":"product","targetModel":"shopping_mall_products","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"sku_code","type":"string","description":"Platform-wide unique SKU code used internally and in integrations.","nullable":false},{"name":"seller_sku_code","type":"string","description":"Seller-provided SKU code (optional), visible to seller roles and staff.","nullable":true},{"name":"status","type":"string","description":"Business status of the SKU (e.g., active, out_of_stock, backorder, preorder, discontinued).","nullable":false},{"name":"base_price","type":"double","description":"Base unit price for this SKU in the configured currency.","nullable":false},{"name":"currency","type":"string","description":"ISO currency code for pricing (e.g., USD, KRW).","nullable":false},{"name":"barcode","type":"string","description":"Optional barcode/GTIN for this SKU.","nullable":true},{"name":"weight","type":"double","description":"Optional weight for shipping calculations.","nullable":true},{"name":"length","type":"double","description":"Optional package length for shipping calculations.","nullable":true},{"name":"width","type":"double","description":"Optional package width for shipping calculations.","nullable":true},{"name":"height","type":"double","description":"Optional package height for shipping calculations.","nullable":true},{"name":"combination_key","type":"string","description":"Canonical, application-generated key representing the combination of option values for this SKU within its product (e.g., sorted list of option value identifiers). Ensures a single SKU per unique combination.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if the SKU is logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["sku_code"],"unique":true},{"fieldNames":["shopping_mall_product_id","combination_key"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_product_id","status"]},{"fieldNames":["shopping_mall_product_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_sku_option_values","description":"Junction mapping between {@link shopping_mall_skus} and {@link shopping_mall_option_values} that defines the concrete variant combination for a SKU. This version adds {@link shopping_mall_option_types} linkage to enforce one value per option type per SKU at the database level. It keeps the original uniqueness on (sku_id, option_value_id) and adds a new uniqueness on (sku_id, option_type_id) to prevent multiple values of the same type for a single SKU.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_sku_id","type":"uuid","description":"Related SKU's {@link shopping_mall_skus.id}","relation":{"name":"sku","targetModel":"shopping_mall_skus","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_option_value_id","type":"uuid","description":"Assigned option value's {@link shopping_mall_option_values.id}","relation":{"name":"optionValue","targetModel":"shopping_mall_option_values","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_option_type_id","type":"uuid","description":"Option type that the assigned value belongs to. Enforces one value per type per SKU. Target model's {@link shopping_mall_option_types.id}","relation":{"name":"optionType","targetModel":"shopping_mall_option_types","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if mapping is removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_sku_id","shopping_mall_option_value_id"],"unique":true},{"fieldNames":["shopping_mall_sku_id","shopping_mall_option_type_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_sku_id","created_at"]},{"fieldNames":["shopping_mall_option_value_id"]},{"fieldNames":["shopping_mall_option_type_id"]}],"ginIndexes":[]},{"name":"shopping_mall_inventory_locations","description":"Inventory locations (e.g., warehouses, stores, drop-ship nodes) that hold stock for sellers/stores. Each location belongs to a {@link shopping_mall_stores} entity and contains basic identity and activation fields. Inventory is recorded via {@link shopping_mall_inventory_records}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_store_id","type":"uuid","description":"Owning store's {@link shopping_mall_stores.id}","relation":{"name":"store","targetModel":"shopping_mall_stores","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"code","type":"string","description":"Store-scoped unique code identifying the location.","nullable":false},{"name":"name","type":"string","description":"Human-readable name of the location (e.g., \"Seoul WH-A\").","nullable":false},{"name":"address","type":"string","description":"Optional address or free-form location note.","nullable":true},{"name":"region","type":"string","description":"Optional region/country code used for logistics constraints.","nullable":true},{"name":"active","type":"boolean","description":"Whether this location is active and eligible for allocation.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if the location is logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_store_id","code"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_store_id","active"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_inventory_records","description":"Baseline inventory records capturing per-SKU per-location on-hand quantities and policy thresholds. Does not store derived available-to-sell; ATS is computed from records, reservations, and allocations. References {@link shopping_mall_skus} and {@link shopping_mall_inventory_locations}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_sku_id","type":"uuid","description":"Tracked SKU's {@link shopping_mall_skus.id}","relation":{"name":"sku","targetModel":"shopping_mall_skus","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_inventory_location_id","type":"uuid","description":"Inventory location's {@link shopping_mall_inventory_locations.id}","relation":{"name":"location","targetModel":"shopping_mall_inventory_locations","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"on_hand","type":"int","description":"Physical on-hand quantity at the location (non-negative).","nullable":false},{"name":"non_sellable","type":"int","description":"Units currently non-sellable (damaged, QA hold, etc.), excluded from ATS.","nullable":false},{"name":"safety_stock_threshold","type":"int","description":"Threshold at or below which Low Stock warnings are raised.","nullable":false},{"name":"reorder_point","type":"int","description":"Optional point at which replenishment should be triggered.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if the record is logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_sku_id","shopping_mall_inventory_location_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_inventory_location_id","shopping_mall_sku_id"]},{"fieldNames":["shopping_mall_sku_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_inventory_reservations","description":"Temporary inventory holds created during checkout or payment authorization to prevent oversell. Reservations may be linked to a cart, user, and/or order and optionally to a preferred location. Expire automatically per policy. See {@link shopping_mall_inventory_allocations} for committed quantities after order confirmation.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_sku_id","type":"uuid","description":"Reserved SKU's {@link shopping_mall_skus.id}","relation":{"name":"sku","targetModel":"shopping_mall_skus","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_inventory_location_id","type":"uuid","description":"Preferred or tentative location's {@link shopping_mall_inventory_locations.id} (optional).","relation":{"name":"location","targetModel":"shopping_mall_inventory_locations","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_cart_id","type":"uuid","description":"Origin cart's {@link shopping_mall_carts.id} when reservation is created from a cart/checkout session.","relation":{"name":"cart","targetModel":"shopping_mall_carts","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_order_id","type":"uuid","description":"Linked order's {@link shopping_mall_orders.id} if created during payment/confirmation.","relation":{"name":"order","targetModel":"shopping_mall_orders","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_user_id","type":"uuid","description":"Actor user's {@link shopping_mall_users.id} creating the reservation (customer or system-assigned).","relation":{"name":"user","targetModel":"shopping_mall_users","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"reservation_token","type":"string","description":"Idempotency and tracking token for this reservation. Unique platform-wide.","nullable":false},{"name":"quantity","type":"int","description":"Reserved quantity for the SKU (positive integer).","nullable":false},{"name":"status","type":"string","description":"Lifecycle status (e.g., active, extended, consumed, released, expired).","nullable":false},{"name":"reserved_at","type":"datetime","description":"Timestamp when the reservation was created.","nullable":false},{"name":"reservation_expires_at","type":"datetime","description":"Expiry timestamp for the reservation per policy.","nullable":false},{"name":"released_at","type":"datetime","description":"Timestamp when the reservation was released/expired; null while active.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if the reservation record is logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["reservation_token"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_sku_id","reservation_expires_at"]},{"fieldNames":["shopping_mall_order_id","shopping_mall_sku_id"]}],"ginIndexes":[]},{"name":"shopping_mall_inventory_allocations","description":"Committed quantities that deduct from available inventory after order confirmation. Each allocation ties a SKU, a location, and an {@link shopping_mall_order_items} line. Used to reconcile captures and fulfillment. Complements {@link shopping_mall_inventory_reservations}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_sku_id","type":"uuid","description":"Allocated SKU's {@link shopping_mall_skus.id}","relation":{"name":"sku","targetModel":"shopping_mall_skus","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_inventory_location_id","type":"uuid","description":"Inventory location's {@link shopping_mall_inventory_locations.id} from which stock is allocated.","relation":{"name":"location","targetModel":"shopping_mall_inventory_locations","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_order_item_id","type":"uuid","description":"Fulfilled order line's {@link shopping_mall_order_items.id}","relation":{"name":"orderItem","targetModel":"shopping_mall_order_items","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"allocation_reference","type":"string","description":"Unique reference key for idempotent allocation operations.","nullable":false},{"name":"quantity","type":"int","description":"Allocated quantity for the order line.","nullable":false},{"name":"allocated_at","type":"datetime","description":"Timestamp when the allocation was created.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if the record is logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["allocation_reference"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_order_item_id","allocated_at"]},{"fieldNames":["shopping_mall_sku_id","shopping_mall_inventory_location_id"]}],"ginIndexes":[]},{"name":"shopping_mall_inventory_adjustments","description":"Audit and control records capturing manual or system-driven inventory changes (delta-based) for a SKU at a location. Records actor, reason, and timing. Supports reconciliation, cycle counts, and compliance. References {@link shopping_mall_users} where applicable.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_sku_id","type":"uuid","description":"Adjusted SKU's {@link shopping_mall_skus.id}","relation":{"name":"sku","targetModel":"shopping_mall_skus","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_inventory_location_id","type":"uuid","description":"Location's {@link shopping_mall_inventory_locations.id} where the adjustment applies.","relation":{"name":"location","targetModel":"shopping_mall_inventory_locations","targetField":"id"},"unique":false,"nullable":false},{"name":"adjusted_by_user_id","type":"uuid","description":"Actor user's {@link shopping_mall_users.id} who performed/triggered the adjustment.","relation":{"name":"adjustedBy","targetModel":"shopping_mall_users","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"adjustment_reference","type":"string","description":"Optional external/system reference for idempotency and reconciliation.","nullable":true},{"name":"delta","type":"int","description":"Signed quantity change applied to on-hand (positive or negative).","nullable":false},{"name":"reason_category","type":"string","description":"Categorized business reason (e.g., sale, return, correction, damage, receive).","nullable":false},{"name":"reason_note","type":"string","description":"Optional free-text note giving more context for the adjustment.","nullable":true},{"name":"adjusted_at","type":"datetime","description":"Timestamp when the adjustment took effect.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if the record is logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["adjustment_reference"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_sku_id","shopping_mall_inventory_location_id","adjusted_at"]},{"fieldNames":["adjusted_by_user_id","adjusted_at"]}],"ginIndexes":[]}]},{"filename":"schema-05-promotions.prisma","namespace":"Coupons","models":[{"name":"shopping_mall_promotions","description":"Master record for platform promotions/discount programs. Managed by operations/admins and referenced during cart recalculation and checkout. Promotions define discount characteristics (percentage/fixed), lifecycle windows, exclusivity/stacking, and redemption limits. Related eligibility/benefit constraints are modeled in {@link shopping_mall_promotion_rules}. Applications on carts/orders are recorded in {@link shopping_mall_promotion_applications}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"name","type":"string","description":"Human-readable promotion name used in admin tools and reporting.","nullable":false},{"name":"description","type":"string","description":"Optional long-form description and business notes for operators.","nullable":true},{"name":"status","type":"string","description":"Lifecycle status (e.g., draft, active, paused, expired, archived). Used for governance and visibility control.","nullable":false},{"name":"priority","type":"int","description":"Business priority used in conflict resolution when multiple promotions are eligible. Higher number = higher priority.","nullable":false},{"name":"exclusive","type":"boolean","description":"Whether this promotion is exclusive (non-stackable) with other promotions/coupons.","nullable":false},{"name":"auto_apply","type":"boolean","description":"Whether the promotion auto-applies when eligible (no code required).","nullable":false},{"name":"discount_type","type":"string","description":"Promo discount type, such as percentage, fixed_amount, shipping_free, or other configured types.","nullable":false},{"name":"discount_percentage","type":"double","description":"Percentage value when discount_type is percentage. Null when not applicable.","nullable":true},{"name":"discount_amount","type":"double","description":"Fixed discount amount when discount_type is fixed_amount. Null when not applicable.","nullable":true},{"name":"currency","type":"string","description":"ISO 4217 currency code for fixed amount promotions, when applicable.","nullable":true},{"name":"starts_at","type":"datetime","description":"UTC start time when the promotion becomes eligible.","nullable":false},{"name":"ends_at","type":"datetime","description":"UTC end time when the promotion expires. Null for open-ended.","nullable":true},{"name":"max_redemptions_total","type":"int","description":"Optional cap for total redemptions across all customers.","nullable":true},{"name":"max_redemptions_per_customer","type":"int","description":"Optional cap for redemptions per individual customer.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-delete timestamp for recoverability.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["status","starts_at"]},{"fieldNames":["starts_at"]},{"fieldNames":["ends_at"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_promotion_rules","description":"Rule records that define eligibility filters and benefit scoping for a {@link shopping_mall_promotions}. Each row expresses a normalized condition (attribute/operator/value) and optional targeting to catalog entities (category/product/SKU) or seller. Keeps promo core in 3NF and enables granular audit of what made a cart/order eligible.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_promotion_id","type":"uuid","description":"Belonged promotion's {@link shopping_mall_promotions.id}","relation":{"name":"promotion","targetModel":"shopping_mall_promotions","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_category_id","type":"uuid","description":"Optional category scoping. Target model's {@link shopping_mall_categories.id}","relation":{"name":"category","targetModel":"shopping_mall_categories","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_product_id","type":"uuid","description":"Optional product scoping. Target model's {@link shopping_mall_products.id}","relation":{"name":"product","targetModel":"shopping_mall_products","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_sku_id","type":"uuid","description":"Optional SKU scoping. Target model's {@link shopping_mall_skus.id}","relation":{"name":"sku","targetModel":"shopping_mall_skus","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_seller_id","type":"uuid","description":"Optional seller scoping. Target model's {@link shopping_mall_sellers.id}","relation":{"name":"seller","targetModel":"shopping_mall_sellers","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"rule_type","type":"string","description":"Type of rule (e.g., eligibility, benefit_scope).","nullable":false},{"name":"attribute","type":"string","description":"Attribute key this rule evaluates (e.g., order_subtotal, category, product, sku, customer_segment).","nullable":false},{"name":"operator","type":"string","description":"Comparison operator (e.g., eq, neq, gte, lte, in).","nullable":false},{"name":"value_string","type":"string","description":"String value for the comparison when applicable (e.g., customer segment).","nullable":true},{"name":"value_int","type":"int","description":"Integer value for the comparison when applicable (e.g., min quantity).","nullable":true},{"name":"value_double","type":"double","description":"Double value for the comparison when applicable (e.g., min subtotal).","nullable":true},{"name":"min_subtotal","type":"double","description":"Optional minimum order/item subtotal condition used by certain rules.","nullable":true},{"name":"min_quantity","type":"int","description":"Optional minimum quantity condition used by certain rules.","nullable":true},{"name":"customer_segment","type":"string","description":"Optional business segment label for eligibility targeting.","nullable":true},{"name":"new_customer_only","type":"boolean","description":"Whether eligibility requires a new customer.","nullable":true},{"name":"first_order_only","type":"boolean","description":"Whether eligibility requires the customer's first order.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-delete timestamp for rules management.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_promotion_id","attribute"]},{"fieldNames":["shopping_mall_category_id","shopping_mall_promotion_id"]},{"fieldNames":["shopping_mall_product_id","shopping_mall_promotion_id"]},{"fieldNames":["shopping_mall_sku_id","shopping_mall_promotion_id"]}],"ginIndexes":[{"fieldName":"customer_segment"}]},{"name":"shopping_mall_coupons","description":"Coupon definitions, optionally linked to a {@link shopping_mall_promotions}. Each coupon carries a unique code and lifecycle, with optional assignment to a specific customer. Redemptions are logged in {@link shopping_mall_coupon_redemptions} and concrete order/cart applications in {@link shopping_mall_promotion_applications}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_promotion_id","type":"uuid","description":"Optional linked promotion's {@link shopping_mall_promotions.id} (benefits/eligibility).","relation":{"name":"promotion","targetModel":"shopping_mall_promotions","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_customer_id","type":"uuid","description":"Optional assigned customer's {@link shopping_mall_customer.id} for targeted issuance.","relation":{"name":"customer","targetModel":"shopping_mall_customer","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"code","type":"string","description":"Unique coupon code (case-insensitive semantics handled at application layer).","nullable":false},{"name":"status","type":"string","description":"Lifecycle status (e.g., draft, active, paused, expired, archived).","nullable":false},{"name":"issued_at","type":"datetime","description":"UTC time the coupon was issued or created.","nullable":false},{"name":"expires_at","type":"datetime","description":"UTC expiration time if any.","nullable":true},{"name":"max_redemptions_total","type":"int","description":"Optional cap for the total number of redemptions for this coupon.","nullable":true},{"name":"max_redemptions_per_customer","type":"int","description":"Optional cap for redemptions per customer for this coupon.","nullable":true},{"name":"single_use","type":"boolean","description":"Whether this coupon may be redeemed only once in its lifetime.","nullable":false},{"name":"one_per_order","type":"boolean","description":"Whether this coupon can be applied only once per order.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-delete timestamp for recoverability.","nullable":true}],"uniqueIndexes":[{"fieldNames":["code"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_promotion_id","status"]},{"fieldNames":["expires_at"]}],"ginIndexes":[]},{"name":"shopping_mall_coupon_redemptions","description":"Immutable log of coupon redemption attempts/outcomes. Links a coupon to a cart/order context and optionally a customer. Guards against duplicates with composite unique constraints and supports refund reconciliation through applied amounts and timestamps.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_coupon_id","type":"uuid","description":"Redeemed coupon's {@link shopping_mall_coupons.id}","relation":{"name":"coupon","targetModel":"shopping_mall_coupons","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_customer_id","type":"uuid","description":"Optional actor customer's {@link shopping_mall_customer.id}","relation":{"name":"customer","targetModel":"shopping_mall_customer","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_order_id","type":"uuid","description":"Optional associated order's {@link shopping_mall_orders.id} once placed.","relation":{"name":"order","targetModel":"shopping_mall_orders","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_cart_id","type":"uuid","description":"Optional associated cart's {@link shopping_mall_carts.id} for pre-order redemptions.","relation":{"name":"cart","targetModel":"shopping_mall_carts","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"redeemed_at","type":"datetime","description":"UTC timestamp when redemption was processed.","nullable":false},{"name":"amount_applied","type":"double","description":"Amount applied from the coupon at redemption time, if applicable.","nullable":true},{"name":"currency","type":"string","description":"ISO 4217 currency code of the applied amount when applicable.","nullable":true},{"name":"status","type":"string","description":"Outcome of the redemption (e.g., approved, rejected, revoked).","nullable":false},{"name":"revoked_at","type":"datetime","description":"UTC timestamp when redemption was revoked (if revoked).","nullable":true},{"name":"reason","type":"string","description":"Human-readable reason category/details for rejection or revocation when applicable.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-delete timestamp (rarely used; kept for administrative corrections).","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_coupon_id","shopping_mall_order_id"],"unique":true},{"fieldNames":["shopping_mall_coupon_id","shopping_mall_cart_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_coupon_id","redeemed_at"]},{"fieldNames":["shopping_mall_customer_id","redeemed_at"]},{"fieldNames":["status","redeemed_at"]}],"ginIndexes":[]},{"name":"shopping_mall_promotion_applications","description":"Immutable records of concrete promotion application instances on carts, orders, or specific line items. Used for audit, analytics, and refund pro‑rata logic. May reference a {@link shopping_mall_coupons} when the promotion was code-triggered.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_promotion_id","type":"uuid","description":"Applied promotion's {@link shopping_mall_promotions.id}","relation":{"name":"promotion","targetModel":"shopping_mall_promotions","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_coupon_id","type":"uuid","description":"Optional coupon that triggered the promotion. {@link shopping_mall_coupons.id}","relation":{"name":"coupon","targetModel":"shopping_mall_coupons","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_cart_id","type":"uuid","description":"Optional cart context. {@link shopping_mall_carts.id}","relation":{"name":"cart","targetModel":"shopping_mall_carts","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_order_id","type":"uuid","description":"Optional order context. {@link shopping_mall_orders.id}","relation":{"name":"order","targetModel":"shopping_mall_orders","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_order_item_id","type":"uuid","description":"Optional line-level order context. {@link shopping_mall_order_items.id}","relation":{"name":"orderItem","targetModel":"shopping_mall_order_items","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_cart_item_id","type":"uuid","description":"Optional line-level cart context. {@link shopping_mall_cart_items.id}","relation":{"name":"cartItem","targetModel":"shopping_mall_cart_items","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_seller_id","type":"uuid","description":"Optional seller context where benefits are constrained to a seller. {@link shopping_mall_sellers.id}","relation":{"name":"seller","targetModel":"shopping_mall_sellers","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"applied_at","type":"datetime","description":"UTC timestamp when the application occurred.","nullable":false},{"name":"scope","type":"string","description":"Application scope (e.g., order, order_item, shipping).","nullable":false},{"name":"amount_applied","type":"double","description":"Discount amount applied for this instance. For percentage discounts, this is the computed value at time of application.","nullable":true},{"name":"currency","type":"string","description":"ISO 4217 currency code of the applied amount where applicable.","nullable":true},{"name":"reason","type":"string","description":"Optional reason or note describing why/how this promotion was applied.","nullable":true},{"name":"reversed_at","type":"datetime","description":"UTC timestamp if this application was reversed (e.g., upon return/refund).","nullable":true},{"name":"idempotency_key","type":"string","description":"Idempotency key to deduplicate and ensure at-most-once recording of a promotion application event across retries.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-delete timestamp for administrative corrections.","nullable":true}],"uniqueIndexes":[{"fieldNames":["idempotency_key"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_promotion_id","shopping_mall_order_id","applied_at"]},{"fieldNames":["shopping_mall_coupon_id","applied_at"]},{"fieldNames":["shopping_mall_cart_id","applied_at"]}],"ginIndexes":[]}]},{"filename":"schema-06-carts.prisma","namespace":"Carts","models":[{"name":"shopping_mall_carts","description":"Shopping cart aggregate for guest or authenticated customer. Tracks ownership via either a user account or a guest identity, supports device-scoped carts, and enforces single active cart per owner at application level. Items are stored in {@link shopping_mall_cart_items}. Coupons attached through {@link shopping_mall_cart_coupons}. Abandonment and recovery events tracked in {@link shopping_mall_abandoned_cart_events}. Self-reference allows lineage for cart merge operations.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_user_id","type":"uuid","description":"Owning authenticated user. Target model's {@link shopping_mall_users.id}.","relation":{"name":"user","targetModel":"shopping_mall_users","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_guest_id","type":"uuid","description":"Owning guest identity for device-scoped carts. Target model's {@link shopping_mall_guest.id}.","relation":{"name":"guest","targetModel":"shopping_mall_guest","targetField":"id"},"unique":false,"nullable":true},{"name":"source_cart_id","type":"uuid","description":"Upstream cart lineage reference when this cart is created by a merge from another cart. Target model's {@link shopping_mall_carts.id}.","relation":{"name":"sourceCart","targetModel":"shopping_mall_carts","targetField":"id","mappingName":"recursive"},"unique":false,"nullable":true}],"plainFields":[{"name":"device_token","type":"string","description":"Opaque device or browser token used to scope guest carts (e.g., cookie or device fingerprint).","nullable":true},{"name":"is_active","type":"boolean","description":"Whether this cart is the owner’s currently active cart. Application ensures only one active cart per owner.","nullable":false},{"name":"expires_at","type":"datetime","description":"Expiration timestamp for guest carts (e.g., 30 days of inactivity).","nullable":true},{"name":"last_recalculated_at","type":"datetime","description":"Timestamp of the last full price/promotion revalidation for the cart.","nullable":true},{"name":"merged_at","type":"datetime","description":"Timestamp when this cart was produced by merging a previous cart, if applicable.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_user_id","is_active"]},{"fieldNames":["shopping_mall_guest_id","is_active"]},{"fieldNames":["device_token","is_active"]},{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_cart_items","description":"Line items within a shopping cart. Each item references a concrete SKU and quantity. Deduplicated per (cart, sku). Managed only through the parent {@link shopping_mall_carts}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_cart_id","type":"uuid","description":"Parent cart's {@link shopping_mall_carts.id}.","relation":{"name":"cart","targetModel":"shopping_mall_carts","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_sku_id","type":"uuid","description":"Referenced SKU's {@link shopping_mall_skus.id}.","relation":{"name":"sku","targetModel":"shopping_mall_skus","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"quantity","type":"int","description":"Requested quantity for the SKU within this cart line. Validated against purchase limits and ATS.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_cart_id","shopping_mall_sku_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_cart_id","created_at"]},{"fieldNames":["shopping_mall_sku_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_cart_coupons","description":"Junction table recording coupons attached to a cart. Prevents duplicate coupon application per cart and supports audit via timestamps. Connects {@link shopping_mall_carts} to {@link shopping_mall_coupons}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_cart_id","type":"uuid","description":"Parent cart's {@link shopping_mall_carts.id}.","relation":{"name":"cart","targetModel":"shopping_mall_carts","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_coupon_id","type":"uuid","description":"Applied coupon's {@link shopping_mall_coupons.id}.","relation":{"name":"coupon","targetModel":"shopping_mall_coupons","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"applied_at","type":"datetime","description":"Timestamp when the coupon was attached to the cart.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_cart_id","shopping_mall_coupon_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_cart_id","applied_at"]}],"ginIndexes":[]},{"name":"shopping_mall_wishlists","description":"Wishlist container owned by a user or guest. Supports named lists and a per-owner default list, with items recorded in {@link shopping_mall_wishlist_items}. No stock or price lock is implied.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_user_id","type":"uuid","description":"Owning authenticated user. Target model's {@link shopping_mall_users.id}.","relation":{"name":"user","targetModel":"shopping_mall_users","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_guest_id","type":"uuid","description":"Owning guest identity for device-scoped wishlists. Target model's {@link shopping_mall_guest.id}.","relation":{"name":"guest","targetModel":"shopping_mall_guest","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"name","type":"string","description":"Human-readable name of the wishlist (e.g., \"Default\", \"Holiday Gifts\"). Must be unique per owner.","nullable":false},{"name":"is_default","type":"boolean","description":"Whether this is the owner’s default wishlist. Application enforces at most one default per owner.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_user_id","name"],"unique":true},{"fieldNames":["shopping_mall_guest_id","name"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_user_id","is_default"]},{"fieldNames":["shopping_mall_guest_id","is_default"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_wishlist_items","description":"Items saved in a wishlist. Each item references the exact SKU of interest. Deduplicated per (wishlist, sku). Managed via parent {@link shopping_mall_wishlists}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_wishlist_id","type":"uuid","description":"Parent wishlist's {@link shopping_mall_wishlists.id}.","relation":{"name":"wishlist","targetModel":"shopping_mall_wishlists","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_sku_id","type":"uuid","description":"Referenced SKU's {@link shopping_mall_skus.id}.","relation":{"name":"sku","targetModel":"shopping_mall_skus","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_wishlist_id","shopping_mall_sku_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_wishlist_id","created_at"]},{"fieldNames":["shopping_mall_sku_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_abandoned_cart_events","description":"Event log capturing cart abandonment lifecycle for remarketing consent workflows and audit. Records milestones such as eligibility, reminders, recovery, and opt-out respecting policy. Supports queries by cart and event time.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_cart_id","type":"uuid","description":"Related cart's {@link shopping_mall_carts.id}.","relation":{"name":"cart","targetModel":"shopping_mall_carts","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"event_type","type":"string","description":"Business event type label (e.g., \"eligible\", \"reminder_sent\", \"recovered\", \"opt_out\").","nullable":false},{"name":"reason_code","type":"string","description":"Optional reason or category for the event (e.g., frequency_cap, user_unsubscribed).","nullable":true},{"name":"occurred_at","type":"datetime","description":"Timestamp when the event occurred (business time).","nullable":false},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_cart_id","occurred_at"]},{"fieldNames":["event_type","occurred_at"]}],"ginIndexes":[]}]},{"filename":"schema-07-orders.prisma","namespace":"Orders","models":[{"name":"shopping_mall_orders","description":"Parent order entity representing the commercial contract created after successful authorization (or COD acceptance). Captures immutable order snapshot values (currency and monetary breakdown) and immutable shipping/billing address snapshots. Also links to buyer and the original address records for lineage only. Serves as the anchor for per-seller child orders {@link shopping_mall_seller_orders}, order line items {@link shopping_mall_order_items}, and status history {@link shopping_mall_order_status_history}. Supports fraud holds and split shipments through related subsystems.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_user_id","type":"uuid","description":"Optional buyer user's {@link shopping_mall_users.id}.","relation":{"name":"user","targetModel":"shopping_mall_users","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_shipping_address_id","type":"uuid","description":"Original shipping address record for lineage. {@link shopping_mall_user_addresses.id}. Not used for rendering; use snapshot fields.","relation":{"name":"shippingAddress","targetModel":"shopping_mall_user_addresses","targetField":"id","mappingName":"shopping_mall_orders_of_shopping_mall_shipping_address_id"},"unique":false,"nullable":false},{"name":"shopping_mall_billing_address_id","type":"uuid","description":"Original billing address record for lineage. {@link shopping_mall_user_addresses.id}. Not used for rendering; use snapshot fields.","relation":{"name":"billingAddress","targetModel":"shopping_mall_user_addresses","targetField":"id","mappingName":"shopping_mall_orders_of_shopping_mall_billing_address_id"},"unique":false,"nullable":true}],"plainFields":[{"name":"order_number","type":"string","description":"Immutable human-readable order number in format \"ORD-YYYYMMDD-NNNNNN\".","nullable":false},{"name":"status","type":"string","description":"Current canonical order state (e.g., pending_confirmation, confirmed, partially_shipped, shipped, partially_delivered, delivered, completed, on_hold, under_review, canceled, refunded).","nullable":false},{"name":"business_status","type":"string","description":"Optional workflow/business status (e.g., fraud_hold, payment_pending, awaiting_acknowledgment).","nullable":true},{"name":"currency","type":"string","description":"ISO 4217 currency code for monetary snapshot values (e.g., USD, KRW).","nullable":false},{"name":"subtotal","type":"double","description":"Order subtotal at time of sale before discounts, taxes, shipping, and duties (snapshot).","nullable":false},{"name":"discount_total","type":"double","description":"Total discounts applied at order time (snapshot).","nullable":false},{"name":"shipping_total","type":"double","description":"Shipping charges at order time (snapshot).","nullable":false},{"name":"tax_total","type":"double","description":"Total tax amount at order time across lines and shipping (snapshot).","nullable":false},{"name":"duty_total","type":"double","description":"Total duties/import fees when applicable (snapshot).","nullable":true},{"name":"grand_total","type":"double","description":"Final order total at order time (subtotal − discounts + shipping + taxes + duties). Snapshot value.","nullable":false},{"name":"placed_at","type":"datetime","description":"Legal time of sale at order creation (UTC).","nullable":false},{"name":"created_at","type":"datetime","description":"Record creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp (orders are never physically deleted).","nullable":true},{"name":"shipping_recipient","type":"string","description":"Snapshot: Ship-to recipient name captured at order time (immutable).","nullable":false},{"name":"shipping_phone","type":"string","description":"Snapshot: Ship-to phone captured at order time (immutable).","nullable":false},{"name":"shipping_address_line1","type":"string","description":"Snapshot: Ship-to address line 1 captured at order time (immutable).","nullable":false},{"name":"shipping_address_line2","type":"string","description":"Snapshot: Ship-to address line 2 captured at order time (immutable).","nullable":true},{"name":"shipping_city","type":"string","description":"Snapshot: Ship-to city captured at order time (immutable).","nullable":false},{"name":"shipping_region","type":"string","description":"Snapshot: Ship-to region/province/state captured at order time (immutable).","nullable":true},{"name":"shipping_postal_code","type":"string","description":"Snapshot: Ship-to postal/ZIP captured at order time (immutable).","nullable":false},{"name":"shipping_country","type":"string","description":"Snapshot: Ship-to country code captured at order time (immutable).","nullable":false},{"name":"billing_recipient","type":"string","description":"Snapshot: Billing recipient name captured at order time (immutable).","nullable":true},{"name":"billing_phone","type":"string","description":"Snapshot: Billing phone captured at order time (immutable).","nullable":true},{"name":"billing_address_line1","type":"string","description":"Snapshot: Billing address line 1 captured at order time (immutable).","nullable":true},{"name":"billing_address_line2","type":"string","description":"Snapshot: Billing address line 2 captured at order time (immutable).","nullable":true},{"name":"billing_city","type":"string","description":"Snapshot: Billing city captured at order time (immutable).","nullable":true},{"name":"billing_region","type":"string","description":"Snapshot: Billing region/province/state captured at order time (immutable).","nullable":true},{"name":"billing_postal_code","type":"string","description":"Snapshot: Billing postal/ZIP captured at order time (immutable).","nullable":true},{"name":"billing_country","type":"string","description":"Snapshot: Billing country code captured at order time (immutable).","nullable":true}],"uniqueIndexes":[{"fieldNames":["order_number"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_user_id","created_at"]},{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_seller_orders","description":"Child order per seller/store to enable split fulfillment, partial captures, and per-seller KPIs. Uniquely tied to a parent {@link shopping_mall_orders} and owning {@link shopping_mall_stores}. Holds monetary snapshots required for reconciliation to the parent order.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Parent order reference. Target model's {@link shopping_mall_orders.id}","relation":{"name":"parentOrder","targetModel":"shopping_mall_orders","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_store_id","type":"uuid","description":"Owning store reference for this seller order. Target model's {@link shopping_mall_stores.id}","relation":{"name":"store","targetModel":"shopping_mall_stores","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"seller_order_number","type":"string","description":"Unique seller-facing order identifier, often derived from parent order number with a suffix.","nullable":false},{"name":"status","type":"string","description":"Current seller order state aligned with fulfillment (e.g., awaiting_ack, ready_to_ship, in_transit, delivered, exception).","nullable":false},{"name":"currency","type":"string","description":"ISO 4217 currency code for monetary snapshot values (e.g., USD, KRW).","nullable":false},{"name":"subtotal","type":"double","description":"Sum of line item base amounts at creation for this seller order.","nullable":false},{"name":"discount_total","type":"double","description":"Total discounts applied to items in this seller order.","nullable":false},{"name":"shipping_total","type":"double","description":"Shipping charges attributable to this seller order.","nullable":false},{"name":"tax_total","type":"double","description":"Tax amount attributable to this seller order.","nullable":false},{"name":"duty_total","type":"double","description":"Duties/import fees attributable when applicable.","nullable":true},{"name":"grand_total","type":"double","description":"Payable amount for this seller order (subtotal − discounts + shipping + taxes + duties).","nullable":false},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for administrative purposes.","nullable":true}],"uniqueIndexes":[{"fieldNames":["seller_order_number"],"unique":true},{"fieldNames":["shopping_mall_order_id","shopping_mall_store_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_store_id","created_at"]},{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_order_items","description":"Order line items capturing immutable per-SKU snapshots at order time. Each item belongs to the parent {@link shopping_mall_orders} and a specific {@link shopping_mall_seller_orders} for split-seller reconciliation, and references the purchased {@link shopping_mall_skus}. Stores only raw snapshot values required for audit and refunds; no derived/calculated fields beyond the captured amounts themselves.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Parent order reference. Target model's {@link shopping_mall_orders.id}","relation":{"name":"order","targetModel":"shopping_mall_orders","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_seller_order_id","type":"uuid","description":"Owning seller order reference for reconciliation. Target model's {@link shopping_mall_seller_orders.id}","relation":{"name":"sellerOrder","targetModel":"shopping_mall_seller_orders","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_sku_id","type":"uuid","description":"Purchased SKU reference. Target model's {@link shopping_mall_skus.id}","relation":{"name":"sku","targetModel":"shopping_mall_skus","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"line_position","type":"int","description":"Line item position within the parent order; used for deterministic ordering.","nullable":false},{"name":"product_name","type":"string","description":"Snapshot of the product name at the time of purchase (buyer-visible).","nullable":false},{"name":"sku_name","type":"string","description":"Snapshot of the SKU/variant display name if distinct from product name.","nullable":true},{"name":"option_summary","type":"string","description":"Human-readable summary of selected option values (e.g., Color: Red; Size: M).","nullable":true},{"name":"quantity","type":"int","description":"Ordered quantity for the SKU.","nullable":false},{"name":"unit_price","type":"double","description":"Base unit price at order time for the SKU.","nullable":false},{"name":"unit_discount","type":"double","description":"Discount amount per unit applied at order time.","nullable":false},{"name":"unit_tax","type":"double","description":"Tax amount per unit at order time.","nullable":false},{"name":"line_subtotal","type":"double","description":"Line subtotal at order time before discounts and taxes (recorded as snapshot).","nullable":false},{"name":"line_discount_total","type":"double","description":"Total discount amount applied to this line at order time (snapshot).","nullable":false},{"name":"line_tax_total","type":"double","description":"Total tax amount allocated to this line at order time (snapshot).","nullable":false},{"name":"line_grand_total","type":"double","description":"Final line total after discounts and taxes at order time (snapshot).","nullable":false},{"name":"currency","type":"string","description":"ISO 4217 currency code for line-level snapshot values.","nullable":false},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for administrative purposes (line items are rarely deleted).","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_order_id","line_position"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_seller_order_id","created_at"]},{"fieldNames":["shopping_mall_sku_id","shopping_mall_order_id"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"product_name"}]},{"name":"shopping_mall_order_item_allocations","description":"Mapping table linking order line items to inventory allocation records for auditability of stock commitments. Maintains quantity allocated per allocation record. Supports reconciliation between sales and inventory subsystems. Related entities: {@link shopping_mall_order_items}, {@link shopping_mall_inventory_allocations}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_item_id","type":"uuid","description":"Linked order item. Target model's {@link shopping_mall_order_items.id}","relation":{"name":"orderItem","targetModel":"shopping_mall_order_items","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_inventory_allocation_id","type":"uuid","description":"Inventory allocation reference. Target model's {@link shopping_mall_inventory_allocations.id}","relation":{"name":"inventoryAllocation","targetModel":"shopping_mall_inventory_allocations","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"quantity","type":"int","description":"Quantity of the order item covered by this specific inventory allocation link.","nullable":false},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_order_item_id","shopping_mall_inventory_allocation_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_order_item_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_order_status_history","description":"Append-only snapshot of order status transitions for audit trails and customer/staff timelines. Records who/what/when/why for state changes. Related to {@link shopping_mall_orders}.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Associated order. Target model's {@link shopping_mall_orders.id}","relation":{"name":"order","targetModel":"shopping_mall_orders","targetField":"id"},"unique":false,"nullable":false},{"name":"triggered_by_user_id","type":"uuid","description":"Actor responsible for the change (customer, seller, or staff) when known. Target model's {@link shopping_mall_users.id}","relation":{"name":"triggeredBy","targetModel":"shopping_mall_users","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"status","type":"string","description":"Canonical order status after the transition (e.g., confirmed, partially_shipped, delivered, on_hold).","nullable":false},{"name":"business_status","type":"string","description":"Optional business workflow state (e.g., fraud_hold, awaiting_acknowledgment).","nullable":true},{"name":"reason","type":"string","description":"Reason code or human-readable explanation for the transition.","nullable":true},{"name":"note","type":"string","description":"Additional note or comment regarding the transition.","nullable":true},{"name":"recorded_at","type":"datetime","description":"Timestamp when the transition occurred (UTC).","nullable":false},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp when an entry is administratively hidden (rare).","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_order_id","recorded_at"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"reason"}]},{"name":"shopping_mall_order_sequences","description":"System-maintained daily sequence counter to generate deterministic order numbers (e.g., ORD-YYYYMMDD-NNNNNN). Used during order creation to allocate the next sequence for a given business day.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"sequence_yyyymmdd","type":"string","description":"Business date in YYYYMMDD format used for generating daily order sequences.","nullable":false},{"name":"last_value","type":"int","description":"Last consumed integer sequence value for the given date; next order number uses last_value+1.","nullable":false},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false}],"uniqueIndexes":[{"fieldNames":["sequence_yyyymmdd"],"unique":true}],"plainIndexes":[{"fieldNames":["updated_at"]}],"ginIndexes":[]}]},{"filename":"schema-08-payments.prisma","namespace":"Payments","models":[{"name":"shopping_mall_payments","description":"Payment entity representing the financial transaction intent and lifecycle for an order. One payment is generally associated to one {@link shopping_mall_orders} and owned by a {@link shopping_mall_users}. It may reference a saved {@link shopping_mall_payment_methods}. Tracks provider, amount, currency, and status with idempotency and external references for reconciliation.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Related order's {@link shopping_mall_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_orders","targetField":"id"},"unique":true,"nullable":false},{"name":"shopping_mall_user_id","type":"uuid","description":"Owning user's {@link shopping_mall_users.id}.","relation":{"name":"user","targetModel":"shopping_mall_users","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_payment_method_id","type":"uuid","description":"Optional saved method {@link shopping_mall_payment_methods.id} used for this payment.","relation":{"name":"paymentMethod","targetModel":"shopping_mall_payment_methods","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"provider","type":"string","description":"Payment provider/gateway identifier (e.g., stripe, toss, paypal).","nullable":false},{"name":"method_type","type":"string","description":"Business method type selected for this payment (e.g., card, bank_transfer, wallet, cod).","nullable":false},{"name":"amount","type":"double","description":"Payment amount in minor currency units or decimal standardized per platform; exact representation decided by implementation.","nullable":false},{"name":"currency","type":"string","description":"ISO currency code (e.g., KRW, USD).","nullable":false},{"name":"status","type":"string","description":"Current payment status (e.g., pending, authorized, confirmed, captured, canceled, failed, refunded).","nullable":false},{"name":"intent","type":"string","description":"Business flow intent (e.g., authorize_then_capture, sale, cod).","nullable":false},{"name":"idempotency_key","type":"string","description":"Idempotency key to ensure at-most-once creation/transition for checkout confirmations.","nullable":true},{"name":"provider_payment_id","type":"string","description":"External provider payment identifier for reconciliation.","nullable":true},{"name":"client_reference_id","type":"string","description":"Client-supplied reference for duplicate-prevention and tracing (e.g., checkout token).","nullable":true},{"name":"requires_action","type":"boolean","description":"Whether additional step-up authentication or user action is required to proceed.","nullable":false},{"name":"failure_category","type":"string","description":"Categorized failure code/reason when status is failed (e.g., do_not_honor, insufficient_funds).","nullable":true},{"name":"description","type":"string","description":"Optional human-readable description/notes for finance review.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp when applicable (UTC).","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_order_id"],"unique":true},{"fieldNames":["provider_payment_id"],"unique":true},{"fieldNames":["idempotency_key"],"unique":true},{"fieldNames":["client_reference_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_user_id","created_at"]},{"fieldNames":["status","created_at"]},{"fieldNames":["provider","created_at"]}],"ginIndexes":[{"fieldName":"failure_category"},{"fieldName":"status"}]},{"name":"shopping_mall_payment_authorizations","description":"Authorization attempts and outcomes for a {@link shopping_mall_payments}. Each record represents a provider authorization attempt with lifecycle, timing, and idempotency for retries.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_payment_id","type":"uuid","description":"Parent payment {@link shopping_mall_payments.id}.","relation":{"name":"payment","targetModel":"shopping_mall_payments","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"amount","type":"double","description":"Authorized amount.","nullable":false},{"name":"currency","type":"string","description":"ISO currency code of the authorization.","nullable":false},{"name":"status","type":"string","description":"Authorization status (e.g., pending, approved, declined, expired).","nullable":false},{"name":"provider_reference","type":"string","description":"Provider authorization reference/ID.","nullable":true},{"name":"idempotency_key","type":"string","description":"Idempotency key for this authorization attempt.","nullable":true},{"name":"authorized_at","type":"datetime","description":"Authorization approval timestamp (UTC).","nullable":true},{"name":"expires_at","type":"datetime","description":"Authorization expiry timestamp according to provider policy (UTC).","nullable":true},{"name":"failure_category","type":"string","description":"Failure category/reason when declined or error occurred.","nullable":true},{"name":"step_up_required","type":"boolean","description":"Whether step-up authentication (e.g., 3DS) is required.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp (UTC).","nullable":true}],"uniqueIndexes":[{"fieldNames":["provider_reference"],"unique":true},{"fieldNames":["idempotency_key"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_payment_id","created_at"]},{"fieldNames":["status","created_at"]},{"fieldNames":["expires_at"]}],"ginIndexes":[{"fieldName":"failure_category"}]},{"name":"shopping_mall_payment_captures","description":"Capture records for a {@link shopping_mall_payments}. Supports partial captures aligned to shipments. Each record stores provider reference, amount, status, and timing.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_payment_id","type":"uuid","description":"Parent payment {@link shopping_mall_payments.id}.","relation":{"name":"payment","targetModel":"shopping_mall_payments","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_shipment_id","type":"uuid","description":"Optional shipment {@link shopping_mall_shipments.id} associated with this capture portion.","relation":{"name":"shipment","targetModel":"shopping_mall_shipments","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"amount","type":"double","description":"Captured amount for this record.","nullable":false},{"name":"currency","type":"string","description":"ISO currency code of the capture.","nullable":false},{"name":"status","type":"string","description":"Capture status (e.g., pending, succeeded, failed).","nullable":false},{"name":"provider_reference","type":"string","description":"Provider capture reference/ID.","nullable":true},{"name":"idempotency_key","type":"string","description":"Idempotency key for capture execution.","nullable":true},{"name":"captured_at","type":"datetime","description":"Capture completion timestamp (UTC).","nullable":true},{"name":"failure_category","type":"string","description":"Failure category/reason if the capture failed.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp (UTC).","nullable":true}],"uniqueIndexes":[{"fieldNames":["provider_reference"],"unique":true},{"fieldNames":["idempotency_key"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_payment_id","created_at"]},{"fieldNames":["shopping_mall_shipment_id","created_at"]},{"fieldNames":["status","created_at"]}],"ginIndexes":[{"fieldName":"failure_category"}]},{"name":"shopping_mall_payment_refunds","description":"Refund execution records for a {@link shopping_mall_payments}. May refer to a specific {@link shopping_mall_payment_captures} and an external {@link shopping_mall_refund_requests}. Stores amount, status, reasons, and provider references for reconciliation.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_payment_id","type":"uuid","description":"Parent payment {@link shopping_mall_payments.id}.","relation":{"name":"payment","targetModel":"shopping_mall_payments","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_payment_capture_id","type":"uuid","description":"Optional associated capture {@link shopping_mall_payment_captures.id} this refund offsets.","relation":{"name":"capture","targetModel":"shopping_mall_payment_captures","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_refund_request_id","type":"uuid","description":"Optional linked refund request {@link shopping_mall_refund_requests.id}.","relation":{"name":"refundRequest","targetModel":"shopping_mall_refund_requests","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"amount","type":"double","description":"Refunded amount for this record.","nullable":false},{"name":"currency","type":"string","description":"ISO currency code of the refund.","nullable":false},{"name":"status","type":"string","description":"Refund status (e.g., pending, succeeded, failed).","nullable":false},{"name":"reason_category","type":"string","description":"Business reason category for refund (e.g., customer_canceled, damaged_item, not_delivered).","nullable":true},{"name":"provider_reference","type":"string","description":"Provider refund reference/ID.","nullable":true},{"name":"idempotency_key","type":"string","description":"Idempotency key for refund execution.","nullable":true},{"name":"refunded_at","type":"datetime","description":"Refund completion timestamp (UTC).","nullable":true},{"name":"failure_category","type":"string","description":"Failure category/reason if the refund failed.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp (UTC).","nullable":true}],"uniqueIndexes":[{"fieldNames":["provider_reference"],"unique":true},{"fieldNames":["idempotency_key"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_payment_id","created_at"]},{"fieldNames":["shopping_mall_refund_request_id","created_at"]},{"fieldNames":["status","created_at"]}],"ginIndexes":[{"fieldName":"reason_category"},{"fieldName":"failure_category"}]},{"name":"shopping_mall_payment_methods","description":"Saved payment methods (tokenized) owned by users. Methods are used for future payments and may reference a billing address. Enforces uniqueness by provider reference/fingerprint to prevent duplicates. Managed independently by users.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_user_id","type":"uuid","description":"Owner user's {@link shopping_mall_users.id}.","relation":{"name":"user","targetModel":"shopping_mall_users","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_user_address_id","type":"uuid","description":"Optional billing address {@link shopping_mall_user_addresses.id}.","relation":{"name":"billingAddress","targetModel":"shopping_mall_user_addresses","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"method_type","type":"string","description":"Method type (e.g., card, bank_transfer, wallet).","nullable":false},{"name":"display_name","type":"string","description":"User-visible label for the method (e.g., My Visa).","nullable":true},{"name":"last4","type":"string","description":"Last 4 digits for card-like methods for display purposes only.","nullable":true},{"name":"exp_month","type":"int","description":"Expiration month for card methods when applicable.","nullable":true},{"name":"exp_year","type":"int","description":"Expiration year for card methods when applicable.","nullable":true},{"name":"fingerprint","type":"string","description":"Provider/device fingerprint to deduplicate identical instruments.","nullable":true},{"name":"provider_reference","type":"string","description":"External token/reference identifying the payment method at the provider.","nullable":false},{"name":"default_method","type":"boolean","description":"Whether this method is the user's default method.","nullable":false},{"name":"active","type":"boolean","description":"Active state flag; inactive methods cannot be used.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp (UTC).","nullable":true}],"uniqueIndexes":[{"fieldNames":["provider_reference"],"unique":true},{"fieldNames":["shopping_mall_user_id","fingerprint"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_user_id","created_at"]},{"fieldNames":["method_type","created_at"]},{"fieldNames":["shopping_mall_user_id","default_method"]}],"ginIndexes":[{"fieldName":"display_name"}]},{"name":"shopping_mall_payment_events","description":"Normalized provider and internal payment-related events for {@link shopping_mall_payments}. May optionally reference a specific authorization, capture, or refund record for correlation. Used for idempotency, auditing, and reconciliation.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_payment_id","type":"uuid","description":"Parent payment {@link shopping_mall_payments.id}.","relation":{"name":"payment","targetModel":"shopping_mall_payments","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_payment_authorization_id","type":"uuid","description":"Optional related authorization {@link shopping_mall_payment_authorizations.id}.","relation":{"name":"authorization","targetModel":"shopping_mall_payment_authorizations","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_payment_capture_id","type":"uuid","description":"Optional related capture {@link shopping_mall_payment_captures.id}.","relation":{"name":"capture","targetModel":"shopping_mall_payment_captures","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_payment_refund_id","type":"uuid","description":"Optional related refund {@link shopping_mall_payment_refunds.id}.","relation":{"name":"refund","targetModel":"shopping_mall_payment_refunds","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"type","type":"string","description":"Canonical event type (e.g., authorization_approved, capture_succeeded, refund_failed, webhook_received).","nullable":false},{"name":"provider_event_id","type":"string","description":"Provider event identifier for idempotency and correlation.","nullable":true},{"name":"idempotency_key","type":"string","description":"Idempotency key to deduplicate event processing.","nullable":true},{"name":"raw_type","type":"string","description":"Original provider event type/name before canonicalization.","nullable":true},{"name":"status","type":"string","description":"Processing status (e.g., received, processed, failed).","nullable":true},{"name":"payload_uri","type":"uri","description":"URI to persisted raw payload or attachment for large events.","nullable":true},{"name":"occurred_at","type":"datetime","description":"Timestamp of the event occurrence (provider or system time normalized to UTC).","nullable":false},{"name":"processed","type":"boolean","description":"Whether the event has been processed by internal handlers.","nullable":false},{"name":"error_category","type":"string","description":"Categorized error when processing failed (used for analysis and retries).","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp (UTC).","nullable":true}],"uniqueIndexes":[{"fieldNames":["provider_event_id"],"unique":true},{"fieldNames":["idempotency_key"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_payment_id","occurred_at"]},{"fieldNames":["type","occurred_at"]},{"fieldNames":["status","occurred_at"]},{"fieldNames":["processed","occurred_at"]}],"ginIndexes":[{"fieldName":"type"},{"fieldName":"error_category"}]}]},{"filename":"schema-09-shipping.prisma","namespace":"Shipping","models":[{"name":"shopping_mall_carriers","description":"Registry of supported shipping carriers used for fulfillment and tracking. Managed by operations/admin staff and referenced by {@link shopping_mall_shipments}. Includes carrier code, human-readable name, and optional tracking URL template. This table enables validation and governance of carrier usage across the marketplace.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"code","type":"string","description":"Business carrier code unique within the platform (e.g., UPS, FEDEX, DHL). Used for integrations and display configuration.","nullable":false},{"name":"name","type":"string","description":"Carrier display name shown to users and staff. Used for search and selection.","nullable":false},{"name":"tracking_url_template","type":"uri","description":"Optional URL template for tracking links. May include placeholders like {tracking_number}.","nullable":true},{"name":"phone","type":"string","description":"Optional customer service phone number for the carrier.","nullable":true},{"name":"active","type":"boolean","description":"Whether this carrier is enabled for use on the platform.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp. When set, the carrier is inactive and hidden from new operations.","nullable":true}],"uniqueIndexes":[{"fieldNames":["code"],"unique":true}],"plainIndexes":[{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_shipments","description":"Shipment entity representing a package or group of order items moving together under a carrier/tracking number. Belongs to an {@link shopping_mall_orders} record and optionally a {@link shopping_mall_stores} (fulfilling store). Tracks canonical lifecycle state, tracking identifiers, addresses snapshot, and time markers (label, pickup, delivery). Items are linked via {@link shopping_mall_shipment_items}; timeline via {@link shopping_mall_shipment_events}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Owning order's {@link shopping_mall_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_orders","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_store_id","type":"uuid","description":"Optional fulfilling store's {@link shopping_mall_stores.id}.","relation":{"name":"store","targetModel":"shopping_mall_stores","targetField":"id","onDelete":"SetNull"},"unique":false,"nullable":true},{"name":"shopping_mall_carrier_id","type":"uuid","description":"Assigned carrier's {@link shopping_mall_carriers.id}. Nullable before label creation.","relation":{"name":"carrier","targetModel":"shopping_mall_carriers","targetField":"id","onDelete":"SetNull"},"unique":false,"nullable":true}],"plainFields":[{"name":"shipment_number","type":"string","description":"Platform-generated human-readable shipment identifier unique within the system.","nullable":false},{"name":"tracking_number","type":"string","description":"Carrier-provided tracking number. Nullable before label creation.","nullable":true},{"name":"tracking_url","type":"uri","description":"Direct tracking URL if available.","nullable":true},{"name":"status","type":"string","description":"Current canonical shipment status. Expected values include: Ready to Ship, In Transit, Out for Delivery, Delivery Attempted, Delivered, Exception, Return to Sender, Returned.","nullable":false},{"name":"ship_from_name","type":"string","description":"Ship-from contact name snapshot for the shipment label.","nullable":true},{"name":"ship_from_phone","type":"string","description":"Ship-from phone snapshot for the shipment label.","nullable":true},{"name":"ship_from_address_line1","type":"string","description":"Ship-from address line 1 snapshot for the label.","nullable":true},{"name":"ship_from_address_line2","type":"string","description":"Ship-from address line 2 snapshot for the label.","nullable":true},{"name":"ship_from_city","type":"string","description":"Ship-from city snapshot for the label.","nullable":true},{"name":"ship_from_region","type":"string","description":"Ship-from region/province/state snapshot for the label.","nullable":true},{"name":"ship_from_postal_code","type":"string","description":"Ship-from postal code snapshot for the label.","nullable":true},{"name":"ship_from_country","type":"string","description":"Ship-from country code snapshot (e.g., KR, US).","nullable":true},{"name":"ship_to_name","type":"string","description":"Ship-to contact name snapshot for the shipment label.","nullable":true},{"name":"ship_to_phone","type":"string","description":"Ship-to phone snapshot for the shipment label.","nullable":true},{"name":"ship_to_address_line1","type":"string","description":"Ship-to address line 1 snapshot for the label.","nullable":true},{"name":"ship_to_address_line2","type":"string","description":"Ship-to address line 2 snapshot for the label.","nullable":true},{"name":"ship_to_city","type":"string","description":"Ship-to city snapshot for the label.","nullable":true},{"name":"ship_to_region","type":"string","description":"Ship-to region/province/state snapshot for the label.","nullable":true},{"name":"ship_to_postal_code","type":"string","description":"Ship-to postal code snapshot for the label.","nullable":true},{"name":"ship_to_country","type":"string","description":"Ship-to country code snapshot (e.g., KR, US).","nullable":true},{"name":"label_created_at","type":"datetime","description":"Timestamp when the shipping label was created (if applicable).","nullable":true},{"name":"picked_up_at","type":"datetime","description":"Timestamp when the carrier first scanned/picked up the package.","nullable":true},{"name":"delivered_at","type":"datetime","description":"Timestamp when Delivered was recorded.","nullable":true},{"name":"expected_delivery_start","type":"datetime","description":"Estimated delivery window start.","nullable":true},{"name":"expected_delivery_end","type":"datetime","description":"Estimated delivery window end.","nullable":true},{"name":"weight_kg","type":"double","description":"Total weight of the shipment in kilograms, if known.","nullable":true},{"name":"package_count","type":"int","description":"Number of packages for this shipment group.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shipment_number"],"unique":true},{"fieldNames":["shopping_mall_carrier_id","tracking_number"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_order_id","created_at"]},{"fieldNames":["shopping_mall_store_id","created_at"]},{"fieldNames":["status","updated_at"]},{"fieldNames":["label_created_at"]},{"fieldNames":["delivered_at"]}],"ginIndexes":[{"fieldName":"tracking_number"}]},{"name":"shopping_mall_shipment_items","description":"Shipment line items that specify how much of each order line is included in a shipment. This table links {@link shopping_mall_shipments} to {@link shopping_mall_order_items} and captures shipped quantities and optional weight for audit and reconciliation. Managed through shipment operations, not independently.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_shipment_id","type":"uuid","description":"Parent shipment's {@link shopping_mall_shipments.id}.","relation":{"name":"shipment","targetModel":"shopping_mall_shipments","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_order_item_id","type":"uuid","description":"Referenced order item's {@link shopping_mall_order_items.id}.","relation":{"name":"orderItem","targetModel":"shopping_mall_order_items","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"quantity","type":"int","description":"Quantity of the order item included in this shipment line.","nullable":false},{"name":"weight_kg","type":"double","description":"Weight attributed to this shipment line in kilograms, if tracked.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_shipment_id","shopping_mall_order_item_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_shipment_id","created_at"]},{"fieldNames":["shopping_mall_order_item_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_shipment_events","description":"Append-only canonical event timeline for shipments, used for customer updates, SLA tracking, and audit. Each record represents a mapped carrier event to a canonical state with timestamp and optional location. Events belong to {@link shopping_mall_shipments}. This table forms the immutable audit trail for delivery progress.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_shipment_id","type":"uuid","description":"Related shipment's {@link shopping_mall_shipments.id}.","relation":{"name":"shipment","targetModel":"shopping_mall_shipments","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"canonical_event","type":"string","description":"Canonical event name mapped from carrier raw event. Examples: Label Created, Picked Up, In Transit, Arrived at Facility, Departed Facility, Out for Delivery, Delivery Attempted, Delivered, Exception, Return Initiated, Returned to Origin.","nullable":false},{"name":"event_at","type":"datetime","description":"Timestamp when the event occurred at the carrier.","nullable":false},{"name":"location_description","type":"string","description":"Free-text location description from the carrier (city/facility).","nullable":true},{"name":"latitude","type":"double","description":"Latitude for the event location if available.","nullable":true},{"name":"longitude","type":"double","description":"Longitude for the event location if available.","nullable":true},{"name":"raw_event_code","type":"string","description":"Raw carrier event code as received prior to canonicalization.","nullable":true},{"name":"raw_event_description","type":"string","description":"Raw carrier event description/message.","nullable":true},{"name":"raw_event_source","type":"string","description":"Source system identifier (e.g., carrier name or webhook name).","nullable":true},{"name":"customer_visible","type":"boolean","description":"Whether this event should be shown on customer-facing timelines.","nullable":false},{"name":"correlation_id","type":"string","description":"Correlation identifier to deduplicate upstream messages for the same event.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for the event record.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (events are typically immutable after insert).","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_shipment_id","correlation_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_shipment_id","event_at"]},{"fieldNames":["canonical_event","event_at"]},{"fieldNames":["shopping_mall_shipment_id","customer_visible","event_at"]}],"ginIndexes":[]},{"name":"shopping_mall_return_shipments","description":"Return shipping parcels associated with a {@link shopping_mall_return_requests}. Tracks carrier, tracking, and timeline states on the way back to the seller. Complements external shipment/carrier tables {@link shopping_mall_carriers} and is used for customer updates and warehouse receiving.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_return_request_id","type":"uuid","description":"Parent return request's {@link shopping_mall_return_requests.id}","relation":{"name":"returnRequest","targetModel":"shopping_mall_return_requests","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_carrier_id","type":"uuid","description":"Carrier handling this return parcel. {@link shopping_mall_carriers.id}","relation":{"name":"carrier","targetModel":"shopping_mall_carriers","targetField":"id","onDelete":"SetNull"},"unique":false,"nullable":true}],"plainFields":[{"name":"tracking_number","type":"string","description":"Carrier-provided tracking number for the return parcel.","nullable":false},{"name":"status","type":"string","description":"Return parcel shipping state (e.g., label_created, picked_up, in_transit, out_for_delivery, delivery_attempted, delivered, exception, returned_to_origin).","nullable":false},{"name":"shipped_at","type":"datetime","description":"Timestamp when the return parcel was shipped/picked up.","nullable":true},{"name":"delivered_at","type":"datetime","description":"Timestamp when the return parcel was delivered to the seller/warehouse.","nullable":true},{"name":"received_at","type":"datetime","description":"Timestamp when the seller/warehouse confirmed receipt in the system.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_carrier_id","tracking_number"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_return_request_id","created_at"]},{"fieldNames":["status","created_at"]}],"ginIndexes":[]}]},{"filename":"schema-10-reviews.prisma","namespace":"Reviews","models":[{"name":"shopping_mall_reviews","description":"Customer-authored product feedback with rating and optional text at SKU level, strictly tied to an eligible delivered order line (Verified Purchase). Enforces exactly one review per order line for deduplication. Supports moderation lifecycle via {@link shopping_mall_review_moderations} and media via {@link shopping_mall_review_media}. Aggregates feed {@link shopping_mall_rating_aggregates} and product-level MV.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"author_user_id","type":"uuid","description":"Author user's {@link shopping_mall_users.id}","relation":{"name":"authorUser","targetModel":"shopping_mall_users","targetField":"id"},"unique":false,"nullable":false},{"name":"product_id","type":"uuid","description":"Reviewed product's {@link shopping_mall_products.id}","relation":{"name":"product","targetModel":"shopping_mall_products","targetField":"id"},"unique":false,"nullable":false},{"name":"sku_id","type":"uuid","description":"Reviewed SKU's {@link shopping_mall_skus.id}","relation":{"name":"sku","targetModel":"shopping_mall_skus","targetField":"id"},"unique":false,"nullable":false},{"name":"order_item_id","type":"uuid","description":"Linked order item for Verified Purchase. {@link shopping_mall_order_items.id} Required to satisfy eligibility policy.","relation":{"name":"orderItem","targetModel":"shopping_mall_order_items","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"title","type":"string","description":"Optional short title for the review. Used in some UIs for summary display.","nullable":true},{"name":"body","type":"string","description":"Main free-text content of the review. May be empty for rating-only submissions per policy.","nullable":true},{"name":"rating","type":"double","description":"Numeric rating value (supports 0.5 increments from 1.0 to 5.0).","nullable":false},{"name":"verified_purchase","type":"boolean","description":"Whether this review is marked as Verified Purchase; set true when tied to an eligible order item.","nullable":false},{"name":"state","type":"string","description":"Moderation state of the review (e.g., pending, approved, rejected, removed_user, removed_moderator).","nullable":false},{"name":"language","type":"string","description":"BCP 47 language code for the review content (e.g., en-US, ko-KR).","nullable":true},{"name":"edited_at","type":"datetime","description":"Timestamp when the author last edited the review (if any).","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp, if the review is withdrawn or removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["order_item_id"],"unique":true}],"plainIndexes":[{"fieldNames":["product_id","state","created_at"]},{"fieldNames":["sku_id","state","created_at"]},{"fieldNames":["author_user_id","created_at"]}],"ginIndexes":[{"fieldName":"body"},{"fieldName":"title"}]},{"name":"shopping_mall_review_media","description":"Media attachments (images/videos) associated with a specific review {@link shopping_mall_reviews}. Stores ordered media with MIME type for policy validation and deduplicates by URI per review. Managed exclusively via the parent review context.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_review_id","type":"uuid","description":"Parent review's {@link shopping_mall_reviews.id}.","relation":{"name":"review","targetModel":"shopping_mall_reviews","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"uri","type":"uri","description":"Public or signed URL to the stored media asset.","nullable":false},{"name":"mime_type","type":"string","description":"MIME type of the media (e.g., image/jpeg, video/mp4).","nullable":false},{"name":"kind","type":"string","description":"Media kind classification (e.g., image, video) for policy enforcement.","nullable":false},{"name":"position","type":"int","description":"Ordering position within the review's media gallery (0-based or 1-based per application policy).","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if the media is removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_review_id","position"],"unique":true},{"fieldNames":["shopping_mall_review_id","uri"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_review_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_review_moderations","description":"Append-only moderation decision history for reviews. Each record captures the decision, reason, and actor with timestamps for audit trails. The current effective state is reflected on {@link shopping_mall_reviews}.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_review_id","type":"uuid","description":"Target review's {@link shopping_mall_reviews.id}.","relation":{"name":"review","targetModel":"shopping_mall_reviews","targetField":"id"},"unique":false,"nullable":false},{"name":"moderator_user_id","type":"uuid","description":"Moderator actor's {@link shopping_mall_users.id}.","relation":{"name":"moderatorUser","targetModel":"shopping_mall_users","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"decision","type":"string","description":"Decision taken (e.g., approved, rejected, removed).","nullable":false},{"name":"reason_code","type":"string","description":"Policy reason category for the decision (e.g., off_topic, profanity, PII).","nullable":false},{"name":"note","type":"string","description":"Optional moderator note with additional context.","nullable":true},{"name":"effective","type":"boolean","description":"Whether this decision became the effective current state at the time of application.","nullable":false},{"name":"created_at","type":"datetime","description":"Decision timestamp (creation).","nullable":false},{"name":"updated_at","type":"datetime","description":"Administrative update timestamp (rare).","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_review_id","created_at"]},{"fieldNames":["moderator_user_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_review_reports","description":"User- or guest-initiated reports against reviews for policy violations. Supports moderation workflows with resolution tracking, actor attribution, and auditability. Tied to {@link shopping_mall_reviews} and optionally a reporter user and resolving moderator.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_review_id","type":"uuid","description":"Reported review's {@link shopping_mall_reviews.id}.","relation":{"name":"review","targetModel":"shopping_mall_reviews","targetField":"id"},"unique":false,"nullable":false},{"name":"reporter_user_id","type":"uuid","description":"Reporting user's {@link shopping_mall_users.id}. Nullable for guest reports.","relation":{"name":"reporterUser","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_review_reports_of_reporter_user_id"},"unique":false,"nullable":true},{"name":"resolver_user_id","type":"uuid","description":"Moderator/resolver user's {@link shopping_mall_users.id}. Optional until resolution.","relation":{"name":"resolverUser","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_review_reports_of_resolver_user_id"},"unique":false,"nullable":true}],"plainFields":[{"name":"reporter_role","type":"string","description":"Reporter role kind (e.g., guest, customer, seller, staff).","nullable":false},{"name":"reason_category","type":"string","description":"Policy reason category triggering the report (e.g., profanity, harassment, PII).","nullable":false},{"name":"note","type":"string","description":"Optional free-text explanation from the reporter.","nullable":true},{"name":"resolved","type":"boolean","description":"Whether the report has been resolved.","nullable":false},{"name":"resolved_at","type":"datetime","description":"Resolution timestamp if resolved.","nullable":true},{"name":"decision","type":"string","description":"Outcome decision at resolution time (e.g., dismissed, removed, edited).","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if the report is withdrawn or expunged.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_review_id","created_at"]},{"fieldNames":["resolved","created_at"]},{"fieldNames":["reporter_user_id","created_at"]}],"ginIndexes":[{"fieldName":"note"}]},{"name":"shopping_mall_rating_aggregates","description":"SKU-level roll-up rating metrics for faster read paths and sorting. Each row represents a SKU-level aggregate (product_id + sku_id). Product-level aggregates are provided via materialized view {@link mv_shopping_mall_product_rating_aggregates}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"product_id","type":"uuid","description":"Target product's {@link shopping_mall_products.id}.","relation":{"name":"product","targetModel":"shopping_mall_products","targetField":"id"},"unique":false,"nullable":false},{"name":"sku_id","type":"uuid","description":"Target SKU's {@link shopping_mall_skus.id} for SKU-level aggregates.","relation":{"name":"sku","targetModel":"shopping_mall_skus","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"average_rating","type":"double","description":"Average rating from Approved reviews (rounded to one decimal at application).","nullable":false},{"name":"total_reviews","type":"int","description":"Total number of Approved reviews included in this aggregate.","nullable":false},{"name":"ratings_1_count","type":"int","description":"Count of 1-star reviews included.","nullable":false},{"name":"ratings_2_count","type":"int","description":"Count of 2-star reviews included.","nullable":false},{"name":"ratings_3_count","type":"int","description":"Count of 3-star reviews included.","nullable":false},{"name":"ratings_4_count","type":"int","description":"Count of 4-star reviews included.","nullable":false},{"name":"ratings_5_count","type":"int","description":"Count of 5-star reviews included.","nullable":false},{"name":"last_approved_review_at","type":"datetime","description":"Most recent Approved review timestamp reflected in this aggregate.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp when aggregates were refreshed.","nullable":false}],"uniqueIndexes":[{"fieldNames":["product_id","sku_id"],"unique":true}],"plainIndexes":[{"fieldNames":["product_id","updated_at"]},{"fieldNames":["sku_id","updated_at"]}],"ginIndexes":[]},{"name":"shopping_mall_seller_replies","description":"Single public reply from the owning seller to an Approved review. Managed via moderation and visible on the review's page once approved. Supports audit and soft delete. Belongs to {@link shopping_mall_reviews} and the replying {@link shopping_mall_sellers}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_review_id","type":"uuid","description":"Target review's {@link shopping_mall_reviews.id}.","relation":{"name":"review","targetModel":"shopping_mall_reviews","targetField":"id"},"unique":true,"nullable":false},{"name":"shopping_mall_seller_id","type":"uuid","description":"Replying seller's {@link shopping_mall_sellers.id}.","relation":{"name":"seller","targetModel":"shopping_mall_sellers","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"body","type":"string","description":"Seller's public reply text content.","nullable":false},{"name":"state","type":"string","description":"Moderation state for the reply (e.g., pending, approved, rejected).","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if the reply is withdrawn or removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_review_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_seller_id","created_at"]}],"ginIndexes":[{"fieldName":"body"}]},{"name":"mv_shopping_mall_product_rating_aggregates","description":"Materialized view holding product-level rating roll-ups for fast PDP/search display. Maintained by background refresh from SKU-level aggregates {@link shopping_mall_rating_aggregates}. One row per product.\n\nNote: This is a read-only computed table (materialized view).","material":true,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"product_id","type":"uuid","description":"Target product's {@link shopping_mall_products.id}.","relation":{"name":"product","targetModel":"shopping_mall_products","targetField":"id"},"unique":true,"nullable":false}],"plainFields":[{"name":"average_rating","type":"double","description":"Product-level average rating from Approved reviews.","nullable":false},{"name":"total_reviews","type":"int","description":"Total number of Approved reviews at product level.","nullable":false},{"name":"ratings_1_count","type":"int","description":"Count of 1-star reviews at product level.","nullable":false},{"name":"ratings_2_count","type":"int","description":"Count of 2-star reviews at product level.","nullable":false},{"name":"ratings_3_count","type":"int","description":"Count of 3-star reviews at product level.","nullable":false},{"name":"ratings_4_count","type":"int","description":"Count of 4-star reviews at product level.","nullable":false},{"name":"ratings_5_count","type":"int","description":"Count of 5-star reviews at product level.","nullable":false},{"name":"last_approved_review_at","type":"datetime","description":"Most recent Approved review timestamp considered in this product aggregate.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp (MV snapshot).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last refresh timestamp of the MV.","nullable":false}],"uniqueIndexes":[{"fieldNames":["product_id"],"unique":true}],"plainIndexes":[{"fieldNames":["product_id","updated_at"]}],"ginIndexes":[]}]},{"filename":"schema-11-returns.prisma","namespace":"Returns","models":[{"name":"shopping_mall_cancellation_requests","description":"Represents a customer- or staff-initiated request to cancel an order before shipment. Used by support and operations to enforce policy windows and maker-checker approvals. Links to the target {@link shopping_mall_orders} and records both requester and approver users via {@link shopping_mall_users}. Cancellation execution (void/release) is handled by payment entities in other components. This is a primary business entity for audit and workflow management across the marketplace.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Order to be canceled. Target model's {@link shopping_mall_orders.id}","relation":{"name":"order","targetModel":"shopping_mall_orders","targetField":"id"},"unique":false,"nullable":false},{"name":"requested_by_user_id","type":"uuid","description":"User who created the cancellation request. Target model's {@link shopping_mall_users.id}","relation":{"name":"requestedBy","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_cancellation_requests_of_requested_by_user_id"},"unique":false,"nullable":false},{"name":"approved_by_user_id","type":"uuid","description":"Approver user for maker-checker or staff approval where required. Target model's {@link shopping_mall_users.id}","relation":{"name":"approvedBy","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_cancellation_requests_of_approved_by_user_id"},"unique":false,"nullable":true}],"plainFields":[{"name":"cancellation_request_number","type":"string","description":"Unique human-readable identifier for the cancellation request used in operations (e.g., \"CAN-20251007-000123\").","nullable":false},{"name":"status","type":"string","description":"Business status of the cancellation request (e.g., pending, approved, rejected, withdrawn, executed).","nullable":false},{"name":"reason_code","type":"string","description":"Categorized reason code for the cancellation (e.g., buyer_changed_mind, address_issue, pricing_error).","nullable":false},{"name":"reason_note","type":"string","description":"Free-text note elaborating on the cancellation reason, provided by customer or staff.","nullable":true},{"name":"decided_at","type":"datetime","description":"Timestamp when the request was approved/rejected, if applicable.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for recovery and audit purposes.","nullable":true}],"uniqueIndexes":[{"fieldNames":["cancellation_request_number"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_order_id","created_at"]},{"fieldNames":["requested_by_user_id","created_at"]},{"fieldNames":["status","created_at"]}],"ginIndexes":[{"fieldName":"reason_note"}]},{"name":"shopping_mall_return_requests","description":"Represents an RMA request raised after shipment/delivery for items to be returned and potentially refunded. Tied to the buyer and original {@link shopping_mall_orders}, optionally linked to the original {@link shopping_mall_shipments}. Approval outcomes govern downstream refund processing in payment subsystems. Acts as the parent for {@link shopping_mall_return_items} and {@link shopping_mall_return_shipments}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Related order's {@link shopping_mall_orders.id}","relation":{"name":"order","targetModel":"shopping_mall_orders","targetField":"id"},"unique":false,"nullable":false},{"name":"requested_by_user_id","type":"uuid","description":"User who submitted the RMA/return request. {@link shopping_mall_users.id}","relation":{"name":"requestedBy","targetModel":"shopping_mall_users","targetField":"id"},"unique":false,"nullable":false},{"name":"original_shipment_id","type":"uuid","description":"Original shipment associated with the return when applicable. {@link shopping_mall_shipments.id}","relation":{"name":"originalShipment","targetModel":"shopping_mall_shipments","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"rma_code","type":"string","description":"Unique RMA code used to track the return process (e.g., \"RMA-20251007-000045\").","nullable":false},{"name":"status","type":"string","description":"Return workflow state (e.g., pending, approved, rejected, in_transit_back, received, closed).","nullable":false},{"name":"reason_code","type":"string","description":"Categorized reason for return (e.g., defective, damaged_in_transit, wrong_item, not_as_described).","nullable":false},{"name":"reason_note","type":"string","description":"Free-text explanation supporting the reason and evidence context.","nullable":true},{"name":"decided_at","type":"datetime","description":"Timestamp when the return request was approved/rejected.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for audit/recovery.","nullable":true}],"uniqueIndexes":[{"fieldNames":["rma_code"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_order_id","created_at"]},{"fieldNames":["requested_by_user_id","created_at"]},{"fieldNames":["status","created_at"]}],"ginIndexes":[{"fieldName":"reason_note"}]},{"name":"shopping_mall_return_items","description":"Line-level items under a return request capturing exact {@link shopping_mall_order_items} being returned, requested and approved quantities, condition/inspection outcomes, and refundable assessments. Managed through the parent {@link shopping_mall_return_requests}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_return_request_id","type":"uuid","description":"Parent return request's {@link shopping_mall_return_requests.id}","relation":{"name":"returnRequest","targetModel":"shopping_mall_return_requests","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_order_item_id","type":"uuid","description":"Returned order line's {@link shopping_mall_order_items.id}","relation":{"name":"orderItem","targetModel":"shopping_mall_order_items","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"requested_quantity","type":"int","description":"Quantity requested to return for the referenced order item.","nullable":false},{"name":"approved_quantity","type":"int","description":"Quantity approved after review/inspection; may be less than requested.","nullable":true},{"name":"received_condition","type":"string","description":"Condition assessment on receipt (e.g., new, opened, used, damaged).","nullable":true},{"name":"inspection_status","type":"string","description":"Inspection workflow state (e.g., pending, in_review, accepted, rejected).","nullable":true},{"name":"inspection_note","type":"string","description":"Optional inspection notes captured by staff.","nullable":true},{"name":"condition_note","type":"string","description":"Free-text comment on item condition provided by customer or staff.","nullable":true},{"name":"refundable_amount","type":"double","description":"Monetary amount considered refundable for this line based on policy outcomes.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_return_request_id","shopping_mall_order_item_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_return_request_id","created_at"]},{"fieldNames":["shopping_mall_order_item_id","created_at"]},{"fieldNames":["inspection_status","created_at"]}],"ginIndexes":[{"fieldName":"inspection_note"},{"fieldName":"condition_note"}]},{"name":"shopping_mall_refund_requests","description":"Represents a request to refund funds (full or partial) tied to an {@link shopping_mall_orders} snapshot, optionally originating from an approved {@link shopping_mall_return_requests}. This entity precedes actual payment refunds (executed in existing {@link shopping_mall_payment_refunds}) and supports maker-checker approvals and finance thresholds.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_order_id","type":"uuid","description":"Parent order to which the refund applies. {@link shopping_mall_orders.id}","relation":{"name":"order","targetModel":"shopping_mall_orders","targetField":"id"},"unique":false,"nullable":false},{"name":"requested_by_user_id","type":"uuid","description":"User who created the refund request. {@link shopping_mall_users.id}","relation":{"name":"requestedBy","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_refund_requests_of_requested_by_user_id"},"unique":false,"nullable":false},{"name":"approved_by_user_id","type":"uuid","description":"Approver user where thresholds require maker-checker. {@link shopping_mall_users.id}","relation":{"name":"approvedBy","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_refund_requests_of_approved_by_user_id"},"unique":false,"nullable":true},{"name":"shopping_mall_return_request_id","type":"uuid","description":"Linked return request when the refund originates from returns. {@link shopping_mall_return_requests.id}","relation":{"name":"returnRequest","targetModel":"shopping_mall_return_requests","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"refund_request_number","type":"string","description":"Unique reference number for this refund request (e.g., \"RR-20251007-000321\").","nullable":false},{"name":"status","type":"string","description":"Workflow state (e.g., pending, approved, rejected, executed, canceled).","nullable":false},{"name":"reason_code","type":"string","description":"Categorized reason for refund (e.g., not_received, damaged, service_issue, goodwill).","nullable":false},{"name":"reason_note","type":"string","description":"Free-text note supporting the reason and decision context.","nullable":true},{"name":"total_requested_amount","type":"double","description":"Total amount requested for refund across all lines prior to fees/adjustments.","nullable":false},{"name":"approved_amount","type":"double","description":"Amount approved after finance review; may be less than requested.","nullable":true},{"name":"currency","type":"string","description":"ISO currency code (e.g., KRW, USD) used for the requested and approved amounts.","nullable":false},{"name":"decided_at","type":"datetime","description":"Timestamp when the refund request was approved/rejected.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["refund_request_number"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_order_id","created_at"]},{"fieldNames":["requested_by_user_id","created_at"]},{"fieldNames":["status","created_at"]},{"fieldNames":["shopping_mall_return_request_id","created_at"]}],"ginIndexes":[{"fieldName":"reason_note"}]},{"name":"shopping_mall_refund_items","description":"Per-line breakdown for a {@link shopping_mall_refund_requests}, optionally tied to an {@link shopping_mall_order_items} when refunding a specific SKU line. Supports partial quantities and non-item adjustments (shipping, fees) by allowing a null order item reference.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_refund_request_id","type":"uuid","description":"Parent refund request's {@link shopping_mall_refund_requests.id}","relation":{"name":"refundRequest","targetModel":"shopping_mall_refund_requests","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_order_item_id","type":"uuid","description":"Associated order item for itemized refunds. {@link shopping_mall_order_items.id}","relation":{"name":"orderItem","targetModel":"shopping_mall_order_items","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"quantity","type":"int","description":"Quantity affected for the refund line; null for non-item adjustments like shipping/fees.","nullable":true},{"name":"amount","type":"double","description":"Amount requested/approved for this line in the refund currency; sign reflects refund direction (positive refund to buyer).","nullable":false},{"name":"reason_code","type":"string","description":"Categorized reason for this refund line (e.g., damaged, wrong_item, shipping_fee_adjustment).","nullable":false},{"name":"approval_status","type":"string","description":"Line-level approval status when managed separately from the header (e.g., pending, approved, rejected).","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_refund_request_id","shopping_mall_order_item_id","reason_code"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_refund_request_id","created_at"]},{"fieldNames":["shopping_mall_order_item_id","created_at"]},{"fieldNames":["approval_status","created_at"]}],"ginIndexes":[]}]},{"filename":"schema-12-sellers.prisma","namespace":"Sellers","models":[{"name":"shopping_mall_sellers","description":"Merchant entity representing a seller account on the marketplace. Tied to a platform user for authentication/ownership via {@link shopping_mall_users}. Holds business profile, operational state, and localization preferences. Serves as the parent for {@link shopping_mall_stores}, {@link shopping_mall_seller_addresses}, {@link shopping_mall_seller_payout_accounts}, and {@link shopping_mall_seller_verifications}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_user_id","type":"uuid","description":"Owning platform user’s {@link shopping_mall_users.id}.","relation":{"name":"owner","targetModel":"shopping_mall_users","targetField":"id"},"unique":true,"nullable":false}],"plainFields":[{"name":"seller_code","type":"string","description":"Unique business identifier for the seller (human-friendly code or reference).","nullable":false},{"name":"display_name","type":"string","description":"Public-facing seller or business display name.","nullable":false},{"name":"contact_email","type":"string","description":"Primary contact email for the seller’s business operations and notifications.","nullable":true},{"name":"contact_phone","type":"string","description":"Primary contact phone for the seller’s business operations.","nullable":true},{"name":"state","type":"string","description":"Lifecycle state of the seller. Examples: draft, pending_verification, active, suspended, terminated.","nullable":false},{"name":"default_locale","type":"string","description":"Preferred locale code for the seller workspace (e.g., en-US, ko-KR).","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp (UTC). Null when active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["seller_code"],"unique":true},{"fieldNames":["shopping_mall_user_id"],"unique":true}],"plainIndexes":[{"fieldNames":["state","created_at"]},{"fieldNames":["display_name","created_at"]}],"ginIndexes":[{"fieldName":"display_name"}]},{"name":"shopping_mall_stores","description":"Storefronts owned by sellers. Each store contains catalog, branding, and customer service settings. Primary category and product management occur under stores owned by {@link shopping_mall_sellers}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_seller_id","type":"uuid","description":"Owning seller’s {@link shopping_mall_sellers.id}.","relation":{"name":"seller","targetModel":"shopping_mall_sellers","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"store_code","type":"string","description":"Unique business code/reference for the store.","nullable":false},{"name":"name","type":"string","description":"Public store name displayed to buyers.","nullable":false},{"name":"slug","type":"string","description":"Canonical URL slug for the store. Must be unique across platform.","nullable":false},{"name":"description","type":"string","description":"Store description or about text.","nullable":true},{"name":"status","type":"string","description":"Store lifecycle status. Examples: draft, active, hidden, suspended, terminated.","nullable":false},{"name":"support_email","type":"string","description":"Customer support email for the store.","nullable":true},{"name":"support_phone","type":"string","description":"Customer support phone for the store.","nullable":true},{"name":"logo_uri","type":"uri","description":"Public logo URI for the store brand.","nullable":true},{"name":"banner_uri","type":"uri","description":"Public banner/hero image URI for the store.","nullable":true},{"name":"timezone","type":"string","description":"Business operating timezone identifier (e.g., Asia/Seoul).","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp (UTC). Null when active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["slug"],"unique":true},{"fieldNames":["store_code"],"unique":true},{"fieldNames":["shopping_mall_seller_id","name"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_seller_id","created_at"]},{"fieldNames":["status","created_at"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_seller_verifications","description":"KYC/KYB verification cases for sellers. Each record captures a submission and review outcome with timestamps for audit. Owned by {@link shopping_mall_sellers} and optionally reviewed by a staff user via {@link shopping_mall_users}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_seller_id","type":"uuid","description":"Target seller’s {@link shopping_mall_sellers.id}.","relation":{"name":"seller","targetModel":"shopping_mall_sellers","targetField":"id"},"unique":false,"nullable":false},{"name":"approved_by_user_id","type":"uuid","description":"Reviewer staff user’s {@link shopping_mall_users.id}. Optional until decision is made.","relation":{"name":"reviewer","targetModel":"shopping_mall_users","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"case_reference","type":"string","description":"Unique verification case reference for traceability and external correspondence.","nullable":false},{"name":"state","type":"string","description":"Verification state. Examples: draft, pending, action_required, approved, rejected, suspended.","nullable":false},{"name":"submitted_at","type":"datetime","description":"Submission timestamp (UTC) when the case was filed.","nullable":false},{"name":"reviewed_at","type":"datetime","description":"Timestamp (UTC) when a decision was recorded.","nullable":true},{"name":"reason","type":"string","description":"Reason text for action required/approval/rejection. Business-context notes only (no PII).","nullable":true},{"name":"kyc_level","type":"string","description":"Declared verification scope or level (e.g., basic, enhanced).","nullable":true},{"name":"documents_uri","type":"uri","description":"URI referencing uploaded document bundle in storage.","nullable":true},{"name":"expires_at","type":"datetime","description":"Optional expiration or recertification due date (UTC).","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp (UTC). Null when active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["case_reference"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_seller_id","created_at"]},{"fieldNames":["state","created_at"]},{"fieldNames":["approved_by_user_id","reviewed_at"]}],"ginIndexes":[{"fieldName":"reason"}]},{"name":"shopping_mall_seller_addresses","description":"Addresses associated with a seller and optionally a specific store. Used for legal, pickup/return, or warehouse purposes. Supports multiple addresses per type and one or more defaults managed by business logic. Parent: {@link shopping_mall_sellers}. Optional link to {@link shopping_mall_stores} for store-level return addresses.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_seller_id","type":"uuid","description":"Owning seller’s {@link shopping_mall_sellers.id}.","relation":{"name":"seller","targetModel":"shopping_mall_sellers","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_store_id","type":"uuid","description":"Optional associated store’s {@link shopping_mall_stores.id} for return/pickup contexts.","relation":{"name":"store","targetModel":"shopping_mall_stores","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"address_type","type":"string","description":"Type of address. Examples: legal, pickup, return, warehouse.","nullable":false},{"name":"label","type":"string","description":"Human-friendly label for identifying the address (e.g., HQ, Warehouse A).","nullable":true},{"name":"recipient","type":"string","description":"Recipient or business name for delivery and legal correspondence.","nullable":false},{"name":"phone","type":"string","description":"Contact phone number for this address.","nullable":false},{"name":"country_code","type":"string","description":"ISO country code (e.g., KR, US).","nullable":false},{"name":"region","type":"string","description":"Administrative region/state/province where applicable.","nullable":true},{"name":"city","type":"string","description":"City/locality name.","nullable":false},{"name":"postal_code","type":"string","description":"Postal/ZIP code when applicable for the country.","nullable":true},{"name":"address_line1","type":"string","description":"Primary street address line.","nullable":false},{"name":"address_line2","type":"string","description":"Secondary address line (apartment, suite, etc.).","nullable":true},{"name":"is_default","type":"boolean","description":"Whether this address is marked as the default for its type and scope. Enforced by business logic.","nullable":false},{"name":"created_at","type":"datetime","description":"Record creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp (UTC). Null when active.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_store_id","address_type"]},{"fieldNames":["country_code","region"]},{"fieldNames":["shopping_mall_seller_id","address_type","is_default"]}],"ginIndexes":[{"fieldName":"label"}]},{"name":"shopping_mall_seller_payout_accounts","description":"Financial payout configurations for sellers. Contains masked account identifiers, status, and verification timestamps. Owned by {@link shopping_mall_sellers}. Used by finance operations and payouts reconciliation.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_seller_id","type":"uuid","description":"Owning seller’s {@link shopping_mall_sellers.id}.","relation":{"name":"seller","targetModel":"shopping_mall_sellers","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"external_reference","type":"string","description":"Unique external reference or token for this payout account (e.g., PSP reference).","nullable":false},{"name":"status","type":"string","description":"Payout account status. Examples: draft, pending_verification, verified, rejected, suspended.","nullable":false},{"name":"account_holder_name","type":"string","description":"Legal account holder name as provided to the payout provider.","nullable":false},{"name":"bank_name","type":"string","description":"Bank or provider name where applicable.","nullable":true},{"name":"account_number_masked","type":"string","description":"Masked account number (no raw PAN or full account numbers stored).","nullable":false},{"name":"routing_number_masked","type":"string","description":"Masked routing/branch number where applicable.","nullable":true},{"name":"country_code","type":"string","description":"Country code for the payout account (e.g., KR, US).","nullable":false},{"name":"currency","type":"string","description":"ISO currency code for disbursements (e.g., KRW, USD).","nullable":false},{"name":"primary","type":"boolean","description":"Whether this is the seller’s primary payout account. Uniqueness per seller is governed by business logic.","nullable":false},{"name":"verified_at","type":"datetime","description":"Timestamp (UTC) when the payout account was verified.","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp (UTC). Null when active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["external_reference"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_seller_id","created_at"]},{"fieldNames":["status","created_at"]},{"fieldNames":["country_code","currency","status"]},{"fieldNames":["shopping_mall_seller_id","primary"]}],"ginIndexes":[{"fieldName":"account_holder_name"}]}]},{"filename":"schema-13-finance.prisma","namespace":"Finance","models":[{"name":"shopping_mall_seller_ledgers","description":"Seller ledger entries recording financial debits and credits per seller. Entries are used for reconciliation, payouts composition, reserves/fees/refunds mapping, and audit. May reference orders, payment captures/refunds, and chargebacks. {@link shopping_mall_payout_items} links these entries to {@link shopping_mall_payouts} when settled.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_seller_id","type":"uuid","description":"Belonged seller's {@link shopping_mall_sellers.id}.","relation":{"name":"seller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":false},{"name":"shopping_mall_order_id","type":"uuid","description":"Related order's {@link shopping_mall_orders.id}. Optional for generic adjustments.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":true},{"name":"shopping_mall_payment_capture_id","type":"uuid","description":"Related payment capture's {@link shopping_mall_payment_captures.id}.","relation":{"name":"paymentCapture","targetModel":"shopping_mall_payment_captures"},"unique":false,"nullable":true},{"name":"shopping_mall_payment_refund_id","type":"uuid","description":"Related payment refund's {@link shopping_mall_payment_refunds.id}.","relation":{"name":"paymentRefund","targetModel":"shopping_mall_payment_refunds"},"unique":false,"nullable":true},{"name":"shopping_mall_chargeback_id","type":"uuid","description":"Related chargeback's {@link shopping_mall_chargebacks.id}.","relation":{"name":"chargeback","targetModel":"shopping_mall_chargebacks"},"unique":false,"nullable":true}],"plainFields":[{"name":"entry_type","type":"string","description":"Financial direction of the entry. Expected values like \"credit\" or \"debit\" based on business rules.","nullable":false},{"name":"source_type","type":"string","description":"Business source of the entry (e.g., order_capture, refund, fee, reserve_hold, reserve_release, adjustment, chargeback_debit).","nullable":false},{"name":"source_reference","type":"string","description":"External or business reference identifier for the source (e.g., capture reference, refund reference).","nullable":true},{"name":"currency","type":"string","description":"ISO 4217 currency code of the entry amount.","nullable":false},{"name":"amount","type":"double","description":"Signed amount of the ledger entry in currency minor units where applicable (business rounding rules apply).","nullable":false},{"name":"balance_after","type":"double","description":"Seller running balance immediately after this entry is applied (snapshot).","nullable":true},{"name":"occurred_at","type":"datetime","description":"Timestamp when the business event occurred (e.g., capture time), used for reconciliation windows.","nullable":false},{"name":"note","type":"string","description":"Optional descriptive note for the ledger entry.","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for recoverability.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_seller_id","source_type","source_reference"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_seller_id","occurred_at"]},{"fieldNames":["shopping_mall_order_id","occurred_at"]}],"ginIndexes":[{"fieldName":"note"}]},{"name":"shopping_mall_payouts","description":"Payout batches to sellers summarizing captured funds less refunds, fees, and reserves. Managed by finance for scheduling, processing, and reconciliation. Each payout is linked to a seller and destination payout account. Line-level composition is captured by {@link shopping_mall_payout_items}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_seller_id","type":"uuid","description":"Target seller's {@link shopping_mall_sellers.id}.","relation":{"name":"seller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":false},{"name":"shopping_mall_seller_payout_account_id","type":"uuid","description":"Destination account's {@link shopping_mall_seller_payout_accounts.id}.","relation":{"name":"payoutAccount","targetModel":"shopping_mall_seller_payout_accounts"},"unique":false,"nullable":false}],"plainFields":[{"name":"payout_number","type":"string","description":"Immutable business identifier for payout (e.g., \"PO-YYYYMMDD-NNNNNN\").","nullable":false},{"name":"status","type":"string","description":"Current payout status (e.g., scheduled, processing, paid, failed, canceled).","nullable":false},{"name":"currency","type":"string","description":"ISO 4217 currency used for all amounts in the payout.","nullable":false},{"name":"period_start","type":"datetime","description":"Start of earnings window included in this payout (inclusive).","nullable":true},{"name":"period_end","type":"datetime","description":"End of earnings window included in this payout (inclusive).","nullable":true},{"name":"scheduled_for","type":"datetime","description":"Datetime when payout is planned to be executed.","nullable":true},{"name":"processed_at","type":"datetime","description":"Datetime when payout was processed by the provider/platform.","nullable":true},{"name":"gross_amount","type":"double","description":"Total gross amount of included positive entries before deductions.","nullable":false},{"name":"fees_amount","type":"double","description":"Total fees deducted in this payout.","nullable":false},{"name":"reserve_withheld","type":"double","description":"Amount withheld due to reserves in this payout.","nullable":false},{"name":"net_amount","type":"double","description":"Net amount disbursed to the seller (gross − fees − reserves).","nullable":false},{"name":"note","type":"string","description":"Optional finance note for the payout.","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for recoverability.","nullable":true}],"uniqueIndexes":[{"fieldNames":["payout_number"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_seller_id","period_start","period_end"]},{"fieldNames":["status","scheduled_for"]}],"ginIndexes":[{"fieldName":"note"}]},{"name":"shopping_mall_payout_items","description":"Line-level composition for payouts mapping seller ledger entries to a payout with the settled amount. Enforces that each ledger entry can be settled at most once across all payouts for financial integrity.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_payout_id","type":"uuid","description":"Parent payout's {@link shopping_mall_payouts.id}.","relation":{"name":"payout","targetModel":"shopping_mall_payouts","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_seller_ledger_id","type":"uuid","description":"Included ledger entry's {@link shopping_mall_seller_ledgers.id}.","relation":{"name":"sellerLedger","targetModel":"shopping_mall_seller_ledgers","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"amount","type":"double","description":"Amount of this ledger entry settled in the payout currency.","nullable":false},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for recoverability.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_payout_id","shopping_mall_seller_ledger_id"],"unique":true},{"fieldNames":["shopping_mall_seller_ledger_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_payout_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_reserves","description":"Reserve holds applied to seller balances per policy (e.g., rolling reserves, case-specific holds). Tracks hold basis, amounts/percent, lifecycle status, and releases. May be linked to orders and releases via payouts. Association to chargebacks is maintained only via the chargebacks table referencing this reserve to avoid dual/cyclic linkage.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_seller_id","type":"uuid","description":"Affected seller's {@link shopping_mall_sellers.id}","relation":{"name":"seller","targetModel":"shopping_mall_sellers","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_order_id","type":"uuid","description":"Related order's {@link shopping_mall_orders.id} when reserve is case-based.","relation":{"name":"order","targetModel":"shopping_mall_orders","targetField":"id"},"unique":false,"nullable":true},{"name":"released_shopping_mall_payout_id","type":"uuid","description":"Payout's {@link shopping_mall_payouts.id} through which the reserve was released, if applicable.","relation":{"name":"releasedPayout","targetModel":"shopping_mall_payouts","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"reserve_type","type":"string","description":"Type of reserve (e.g., rolling, case_hold).","nullable":false},{"name":"policy_reference","type":"string","description":"Policy/configuration reference justifying this reserve.","nullable":true},{"name":"reason","type":"string","description":"Human-readable reason for applying the reserve.","nullable":true},{"name":"hold_percent","type":"double","description":"Percent of sales to hold (0–100). Used for rolling reserves.","nullable":true},{"name":"hold_amount","type":"double","description":"Fixed amount held for the case or initial hold.","nullable":true},{"name":"currency","type":"string","description":"ISO 4217 currency for amounts tracked by this reserve.","nullable":false},{"name":"status","type":"string","description":"Lifecycle status (e.g., active, released, canceled).","nullable":false},{"name":"start_at","type":"datetime","description":"When the reserve starts being applied.","nullable":false},{"name":"release_at","type":"datetime","description":"Planned or actual release time of the reserve.","nullable":true},{"name":"released_amount","type":"double","description":"Amount released from reserve (snapshot at release time).","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for recoverability.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_seller_id","status","release_at"]},{"fieldNames":["released_shopping_mall_payout_id"]}],"ginIndexes":[{"fieldName":"reason"}]},{"name":"shopping_mall_fees","description":"Fee assessments charged to sellers (e.g., platform fees, dispute fees, payout fees). Can relate to orders, captures/refunds, or be settlement-time fees. Used by finance for governance and audit, and reflected in {@link shopping_mall_seller_ledgers} entries.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_seller_id","type":"uuid","description":"Charged seller's {@link shopping_mall_sellers.id}.","relation":{"name":"seller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":false},{"name":"shopping_mall_order_id","type":"uuid","description":"Related order's {@link shopping_mall_orders.id} when applicable.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":true},{"name":"shopping_mall_payment_capture_id","type":"uuid","description":"Related payment capture's {@link shopping_mall_payment_captures.id} when fee is capture-related.","relation":{"name":"paymentCapture","targetModel":"shopping_mall_payment_captures"},"unique":false,"nullable":true},{"name":"shopping_mall_payment_refund_id","type":"uuid","description":"Related payment refund's {@link shopping_mall_payment_refunds.id} when fee is refund-related.","relation":{"name":"paymentRefund","targetModel":"shopping_mall_payment_refunds"},"unique":false,"nullable":true},{"name":"shopping_mall_payout_id","type":"uuid","description":"Related payout's {@link shopping_mall_payouts.id} when fee is assessed at settlement.","relation":{"name":"payout","targetModel":"shopping_mall_payouts"},"unique":false,"nullable":true}],"plainFields":[{"name":"fee_type","type":"string","description":"Business category of fee (e.g., platform, payment_processing, dispute, payout).","nullable":false},{"name":"basis","type":"string","description":"Basis for fee calculation (e.g., fixed, percentage_of_capture, per_order).","nullable":true},{"name":"rate_percent","type":"double","description":"Percentage rate applied when basis is percent-based.","nullable":true},{"name":"amount","type":"double","description":"Assessed fee amount in currency units.","nullable":false},{"name":"currency","type":"string","description":"ISO 4217 currency code of the fee.","nullable":false},{"name":"description","type":"string","description":"Human-readable explanation of the fee assessment.","nullable":true},{"name":"assessed_at","type":"datetime","description":"Timestamp when the fee was assessed.","nullable":false},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for recoverability.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_seller_id","assessed_at"]},{"fieldNames":["shopping_mall_payout_id","assessed_at"]}],"ginIndexes":[{"fieldName":"description"}]},{"name":"shopping_mall_chargebacks","description":"Chargeback cases raised by payment providers against a captured payment. Tracks lifecycle, reasons, and amounts for reconciliation. May be associated with reserves and payouts and impacts seller ledger entries.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_seller_id","type":"uuid","description":"Affected seller's {@link shopping_mall_sellers.id}.","relation":{"name":"seller","targetModel":"shopping_mall_sellers"},"unique":false,"nullable":false},{"name":"shopping_mall_order_id","type":"uuid","description":"Related order's {@link shopping_mall_orders.id}. Optional if only capture reference is known.","relation":{"name":"order","targetModel":"shopping_mall_orders"},"unique":false,"nullable":true},{"name":"shopping_mall_payment_capture_id","type":"uuid","description":"Disputed payment capture's {@link shopping_mall_payment_captures.id}.","relation":{"name":"paymentCapture","targetModel":"shopping_mall_payment_captures"},"unique":false,"nullable":false},{"name":"shopping_mall_reserve_id","type":"uuid","description":"Related reserve's {@link shopping_mall_reserves.id} when a case hold is applied.","relation":{"name":"reserve","targetModel":"shopping_mall_reserves"},"unique":false,"nullable":true},{"name":"shopping_mall_payout_id","type":"uuid","description":"Related payout's {@link shopping_mall_payouts.id} when financial impact is settled in a payout.","relation":{"name":"payout","targetModel":"shopping_mall_payouts"},"unique":false,"nullable":true}],"plainFields":[{"name":"provider_reference","type":"string","description":"Payment provider's dispute/chargeback reference identifier.","nullable":false},{"name":"status","type":"string","description":"Chargeback status (e.g., open, under_review, won, lost, reversed, canceled).","nullable":false},{"name":"reason_category","type":"string","description":"Provider reason category (e.g., fraud, not_received, not_as_described).","nullable":true},{"name":"amount","type":"double","description":"Disputed amount.","nullable":false},{"name":"currency","type":"string","description":"ISO 4217 currency code of the disputed amount.","nullable":false},{"name":"opened_at","type":"datetime","description":"Datetime when the chargeback was opened.","nullable":false},{"name":"responded_at","type":"datetime","description":"Datetime when the platform responded to the dispute.","nullable":true},{"name":"closed_at","type":"datetime","description":"Datetime when the chargeback was closed/resolved.","nullable":true},{"name":"notes","type":"string","description":"Internal notes for the case and evidence context.","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for recoverability.","nullable":true}],"uniqueIndexes":[{"fieldNames":["provider_reference"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_seller_id","status","opened_at"]},{"fieldNames":["shopping_mall_payment_capture_id","opened_at"]}],"ginIndexes":[{"fieldName":"notes"}]}]},{"filename":"schema-14-inquiries.prisma","namespace":"Inquiries","models":[{"name":"shopping_mall_support_cases","description":"Support case master record for customer/seller inquiries and operational issues. Provides routing (status, priority, category), SLA (sla_due_at), assignment, and relationships to customer/seller identities, related orders and shipments. Designed for independent search, filtering, and recent-activity sorting via last_event_at. Timeline events, notes, and attachments reference this parent.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"customer_user_id","type":"uuid","description":"Customer subject's {@link shopping_mall_users.id} when applicable.","relation":{"name":"customer","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_support_cases_of_customer_user_id"},"unique":false,"nullable":true},{"name":"seller_user_id","type":"uuid","description":"Seller subject's {@link shopping_mall_users.id} when the case concerns a seller.","relation":{"name":"seller","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_support_cases_of_seller_user_id"},"unique":false,"nullable":true},{"name":"order_id","type":"uuid","description":"Related order's {@link shopping_mall_orders.id} if the case concerns a specific order.","relation":{"name":"order","targetModel":"shopping_mall_orders","targetField":"id"},"unique":false,"nullable":true},{"name":"shipment_id","type":"uuid","description":"Related shipment's {@link shopping_mall_shipments.id} if fulfillment is in scope.","relation":{"name":"shipment","targetModel":"shopping_mall_shipments","targetField":"id"},"unique":false,"nullable":true},{"name":"assigned_to_user_id","type":"uuid","description":"Assignee staff's {@link shopping_mall_users.id} responsible for handling the case.","relation":{"name":"assignee","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_support_cases_of_assigned_to_user_id"},"unique":false,"nullable":true}],"plainFields":[{"name":"case_number","type":"string","description":"Immutable human-friendly case number (e.g., \"CAS-YYYYMMDD-NNNNNN\"). Unique across the platform.","nullable":false},{"name":"subject","type":"string","description":"Short subject/title summarizing the issue for search and list displays.","nullable":false},{"name":"description","type":"string","description":"Detailed issue description provided at intake. May contain PII; masking is enforced at application layer.","nullable":true},{"name":"status","type":"string","description":"Workflow state (e.g., open, pending, on_hold, resolved, closed).","nullable":false},{"name":"priority","type":"string","description":"Business priority (e.g., low, medium, high, urgent) used for SLA routing.","nullable":false},{"name":"category","type":"string","description":"Business category/reason code (e.g., billing, fulfillment, product, policy).","nullable":true},{"name":"origin_channel","type":"string","description":"Channel where the case originated: web, email, chat, phone, or system.","nullable":true},{"name":"sla_due_at","type":"datetime","description":"Deadline for first response/next action per SLA policy.","nullable":true},{"name":"closed_at","type":"datetime","description":"Timestamp when case was resolved/closed.","nullable":true},{"name":"last_event_at","type":"datetime","description":"Timestamp of the most recent timeline event to support recency sorting.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp when the case is logically removed from active views.","nullable":true}],"uniqueIndexes":[{"fieldNames":["case_number"],"unique":true}],"plainIndexes":[{"fieldNames":["customer_user_id","created_at"]},{"fieldNames":["seller_user_id","created_at"]},{"fieldNames":["order_id","created_at"]},{"fieldNames":["shipment_id","created_at"]},{"fieldNames":["assigned_to_user_id","status","priority"]},{"fieldNames":["status","priority","created_at"]},{"fieldNames":["sla_due_at","priority"]},{"fieldNames":["last_event_at"]}],"ginIndexes":[{"fieldName":"subject"},{"fieldName":"description"}]},{"name":"shopping_mall_support_case_events","description":"Timeline entries for a {@link shopping_mall_support_cases} capturing state changes, communications, and system actions. Each event records an actor (when applicable), type, visibility, and body. Used for audit trails and customer/staff-facing timelines.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_support_case_id","type":"uuid","description":"Belonged case's {@link shopping_mall_support_cases.id}.","relation":{"name":"supportCase","targetModel":"shopping_mall_support_cases","targetField":"id"},"unique":false,"nullable":false},{"name":"actor_user_id","type":"uuid","description":"Actor's {@link shopping_mall_users.id} who performed the event. Null when system-generated.","relation":{"name":"actor","targetModel":"shopping_mall_users","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"event_type","type":"string","description":"Business event type key (e.g., customer_message, staff_reply, status_change, assignment_change, sla_breach).","nullable":false},{"name":"visibility","type":"string","description":"Visibility scope string such as public, internal, or staff_only controlling who can see the event.","nullable":false},{"name":"body","type":"string","description":"Event content/body in plain text (masked/redacted where required).","nullable":true},{"name":"occurred_at","type":"datetime","description":"Timestamp representing when the event actually occurred (may differ from persistence time).","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for redaction/removal from active views.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_support_case_id","created_at"]},{"fieldNames":["actor_user_id","created_at"]},{"fieldNames":["event_type","created_at"]}],"ginIndexes":[{"fieldName":"body"}]},{"name":"shopping_mall_support_attachments","description":"File attachments associated with support cases. Attachments are always tied to a parent {@link shopping_mall_support_cases} and may optionally reference a specific {@link shopping_mall_support_case_events} or {@link shopping_mall_support_notes}. Used for evidence, screenshots, invoices, or proofs.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_support_case_id","type":"uuid","description":"Parent case's {@link shopping_mall_support_cases.id}.","relation":{"name":"supportCase","targetModel":"shopping_mall_support_cases","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_support_case_event_id","type":"uuid","description":"Optional related event's {@link shopping_mall_support_case_events.id} when the file belongs to a specific timeline entry.","relation":{"name":"supportCaseEvent","targetModel":"shopping_mall_support_case_events","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_support_note_id","type":"uuid","description":"Optional related note's {@link shopping_mall_support_notes.id} when the file belongs to a case note.","relation":{"name":"supportNote","targetModel":"shopping_mall_support_notes","targetField":"id"},"unique":false,"nullable":true},{"name":"uploaded_by_user_id","type":"uuid","description":"Uploader's {@link shopping_mall_users.id} (customer, seller, or staff).","relation":{"name":"uploadedBy","targetModel":"shopping_mall_users","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"file_name","type":"string","description":"Original file name as provided by the uploader.","nullable":false},{"name":"file_uri","type":"uri","description":"URI to the stored file location.","nullable":false},{"name":"content_type","type":"string","description":"MIME content type of the uploaded file.","nullable":false},{"name":"file_size","type":"int","description":"File size in bytes for validation and storage accounting.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp when attachment is removed from active views.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_support_case_id","created_at"]},{"fieldNames":["shopping_mall_support_case_event_id","created_at"]},{"fieldNames":["shopping_mall_support_note_id","created_at"]},{"fieldNames":["uploaded_by_user_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_support_notes","description":"Free-form notes associated with a {@link shopping_mall_support_cases}. Typically internal or restricted-visibility staff notes; may also store limited audience messages per policy. Notes can carry attachments via {@link shopping_mall_support_attachments}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_support_case_id","type":"uuid","description":"Parent case's {@link shopping_mall_support_cases.id}.","relation":{"name":"supportCase","targetModel":"shopping_mall_support_cases","targetField":"id"},"unique":false,"nullable":false},{"name":"author_user_id","type":"uuid","description":"Author's {@link shopping_mall_users.id} who wrote the note.","relation":{"name":"author","targetModel":"shopping_mall_users","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"visibility","type":"string","description":"Visibility scope string such as internal, staff_only, or limited_audience per policy.","nullable":false},{"name":"body","type":"string","description":"Note content in plain text (PII should be masked/redacted for staff views by default).","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for logical removal.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_support_case_id","created_at"]},{"fieldNames":["author_user_id","created_at"]}],"ginIndexes":[{"fieldName":"body"}]}]},{"filename":"schema-15-admin.prisma","namespace":"Admin","models":[{"name":"shopping_mall_audit_events","description":"Immutable audit trail entries recording who did what, when, and why across the platform. Primarily used for compliance, forensics, and operational observability. Each event may optionally reference the actor user and an associated {@link shopping_mall_admin_actions} record. Target business object is referenced generically by table name and entity_id to avoid polymorphic FK constraints.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"actor_user_id","type":"uuid","description":"Actor user's {@link shopping_mall_users.id}. Optional for system-generated events.","relation":{"name":"actorUser","targetModel":"shopping_mall_users","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_admin_action_id","type":"uuid","description":"Related admin action's {@link shopping_mall_admin_actions.id} when the event is tied to an admin workflow.","relation":{"name":"adminAction","targetModel":"shopping_mall_admin_actions","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"entity_table","type":"string","description":"Table name of the business entity this event pertains to (e.g., shopping_mall_orders).","nullable":false},{"name":"entity_id","type":"uuid","description":"Target entity identifier. Nullable for global/system events not tied to a single record.","nullable":true},{"name":"action","type":"string","description":"Normalized action keyword (e.g., created, updated, published, suspended, refunded).","nullable":false},{"name":"summary","type":"string","description":"Human-readable summary of the event suitable for staff consoles.","nullable":true},{"name":"reason","type":"string","description":"Optional reason code or narrative for state-changing events (policy reference, justification).","nullable":true},{"name":"correlation_id","type":"string","description":"Correlation identifier to link related events across services and retries.","nullable":true},{"name":"source_ip","type":"string","description":"Originating IP address (string form).","nullable":true},{"name":"user_agent","type":"string","description":"User-Agent string when applicable.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC). Typically equals created_at for immutable entries.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for retention workflows (null for active).","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["actor_user_id","created_at"]},{"fieldNames":["shopping_mall_admin_action_id","created_at"]},{"fieldNames":["created_at"]},{"fieldNames":["entity_table","entity_id","created_at"]},{"fieldNames":["correlation_id"]}],"ginIndexes":[{"fieldName":"action"},{"fieldName":"reason"}]},{"name":"shopping_mall_admin_actions","description":"Staff-initiated administrative actions that may require approval and execution (maker-checker). Tracks the requestor, target entity, status transitions, and idempotency. Related approvals are stored in {@link shopping_mall_maker_checker_approvals}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"requested_by_user_id","type":"uuid","description":"Requesting staff user's {@link shopping_mall_users.id}.","relation":{"name":"requestedBy","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_admin_actions_of_requested_by_user_id"},"unique":false,"nullable":false},{"name":"performed_by_user_id","type":"uuid","description":"Executing staff user's {@link shopping_mall_users.id} when carried out.","relation":{"name":"performedBy","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_admin_actions_of_performed_by_user_id"},"unique":false,"nullable":true}],"plainFields":[{"name":"idempotency_key","type":"string","description":"Client-supplied idempotency key to prevent duplicate execution of the same admin action.","nullable":false},{"name":"action_name","type":"string","description":"Business name of the administrative action (e.g., suspend_product, approve_refund, publish_category).","nullable":false},{"name":"target_entity_table","type":"string","description":"Target table name for the action (e.g., shopping_mall_products).","nullable":false},{"name":"target_entity_id","type":"uuid","description":"Identifier of the target entity when applicable.","nullable":true},{"name":"status","type":"string","description":"Current workflow status (e.g., pending, under_review, approved, rejected, executed, canceled).","nullable":false},{"name":"justification","type":"string","description":"Requestor-provided justification text referencing policy or operational reasons.","nullable":true},{"name":"rejection_reason","type":"string","description":"Reason specified when the action is rejected.","nullable":true},{"name":"scheduled_at","type":"datetime","description":"Optional scheduled execution time for time-bound or deferred actions.","nullable":true},{"name":"executed_at","type":"datetime","description":"Timestamp when the action was executed.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for retention workflows (null for active).","nullable":true}],"uniqueIndexes":[{"fieldNames":["idempotency_key"],"unique":true}],"plainIndexes":[{"fieldNames":["requested_by_user_id","created_at"]},{"fieldNames":["status","created_at"]},{"fieldNames":["performed_by_user_id","executed_at"]},{"fieldNames":["target_entity_table","target_entity_id","status"]},{"fieldNames":["scheduled_at"]}],"ginIndexes":[{"fieldName":"action_name"},{"fieldName":"justification"},{"fieldName":"rejection_reason"}]},{"name":"shopping_mall_risk_rules","description":"Configurable fraud/risk rules managed by operations/finance/security. Each rule defines a condition expression and decision outcome (e.g., allow, review, block) with priority and activation status. Actions are audited via {@link shopping_mall_audit_events}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"created_by_user_id","type":"uuid","description":"Creator staff user's {@link shopping_mall_users.id}.","relation":{"name":"createdBy","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_risk_rules_of_created_by_user_id"},"unique":false,"nullable":false},{"name":"updated_by_user_id","type":"uuid","description":"Last editor staff user's {@link shopping_mall_users.id}.","relation":{"name":"updatedBy","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_risk_rules_of_updated_by_user_id"},"unique":false,"nullable":true}],"plainFields":[{"name":"code","type":"string","description":"Stable business identifier for the rule (unique).","nullable":false},{"name":"name","type":"string","description":"Human-readable rule name for consoles and search.","nullable":false},{"name":"description","type":"string","description":"Detailed description and policy references.","nullable":true},{"name":"active","type":"boolean","description":"Whether the rule is currently active and evaluated.","nullable":false},{"name":"priority","type":"int","description":"Evaluation priority; lower numbers evaluated earlier or with higher precedence depending on engine configuration.","nullable":false},{"name":"condition","type":"string","description":"Expression string describing the rule condition (domain-specific syntax).","nullable":false},{"name":"decision","type":"string","description":"Outcome decision when condition matches (e.g., allow, review, block, hold).","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for retention workflows (null for active).","nullable":true}],"uniqueIndexes":[{"fieldNames":["code"],"unique":true}],"plainIndexes":[{"fieldNames":["active","priority"]},{"fieldNames":["created_by_user_id","created_at"]},{"fieldNames":["decision","active"]},{"fieldNames":["updated_by_user_id","updated_at"]}],"ginIndexes":[{"fieldName":"name"},{"fieldName":"description"}]},{"name":"shopping_mall_data_exports","description":"Governed data export requests for audit, compliance, and operations. Captures requester identity, purpose, scope, approvals, delivery details, and lifecycle status. Approvals are optional and may be recorded in {@link shopping_mall_maker_checker_approvals}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"requested_by_user_id","type":"uuid","description":"Requesting staff user's {@link shopping_mall_users.id}.","relation":{"name":"requestedBy","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_data_exports_of_requested_by_user_id"},"unique":false,"nullable":false},{"name":"approved_by_user_id","type":"uuid","description":"Approver staff user's {@link shopping_mall_users.id} when maker-checker applies.","relation":{"name":"approvedBy","targetModel":"shopping_mall_users","targetField":"id","mappingName":"shopping_mall_data_exports_of_approved_by_user_id"},"unique":false,"nullable":true}],"plainFields":[{"name":"request_number","type":"string","description":"Human-readable request number unique across all exports (e.g., EXP-YYYYMMDD-NNNNNN).","nullable":false},{"name":"purpose","type":"string","description":"Declared business purpose for the export (e.g., DSAR, audit, reconciliation) used for policy checks.","nullable":false},{"name":"scope_description","type":"string","description":"Textual description of included entities/fields/filters (no raw data).","nullable":false},{"name":"status","type":"string","description":"Lifecycle status (e.g., requested, approved, processing, completed, failed, canceled).","nullable":false},{"name":"justification","type":"string","description":"Optional justification or case reference for policy review.","nullable":true},{"name":"delivery_channel","type":"string","description":"Delivery channel or mechanism (e.g., secure_link, sftp, in_app).","nullable":true},{"name":"file_uri","type":"uri","description":"Where the generated artifact is available when completed (if applicable).","nullable":true},{"name":"expires_at","type":"datetime","description":"Optional expiration timestamp after which the artifact is no longer accessible.","nullable":true},{"name":"completed_at","type":"datetime","description":"Completion timestamp for successful exports.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for retention workflows (null for active).","nullable":true}],"uniqueIndexes":[{"fieldNames":["request_number"],"unique":true}],"plainIndexes":[{"fieldNames":["requested_by_user_id","created_at"]},{"fieldNames":["status","created_at"]},{"fieldNames":["approved_by_user_id","updated_at"]},{"fieldNames":["expires_at"]},{"fieldNames":["completed_at"]}],"ginIndexes":[{"fieldName":"purpose"},{"fieldName":"scope_description"},{"fieldName":"justification"}]},{"name":"shopping_mall_maker_checker_approvals","description":"Approval decisions supporting the maker-checker pattern for sensitive administrative actions. Each record captures one approver’s decision tied to a specific {@link shopping_mall_admin_actions} entry for auditability.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_admin_action_id","type":"uuid","description":"Target admin action's {@link shopping_mall_admin_actions.id}.","relation":{"name":"adminAction","targetModel":"shopping_mall_admin_actions","targetField":"id"},"unique":false,"nullable":false},{"name":"approver_user_id","type":"uuid","description":"Approver staff user's {@link shopping_mall_users.id}.","relation":{"name":"approver","targetModel":"shopping_mall_users","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"decision","type":"string","description":"Decision outcome (e.g., approved, rejected).","nullable":false},{"name":"reason","type":"string","description":"Optional rationale or policy reference for the decision.","nullable":true},{"name":"decided_at","type":"datetime","description":"Timestamp when the decision was made.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp (UTC).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (UTC).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for retention workflows (null for active).","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_admin_action_id","approver_user_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_admin_action_id","created_at"]},{"fieldNames":["approver_user_id","created_at"]},{"fieldNames":["decision","decided_at"]}],"ginIndexes":[{"fieldName":"reason"}]}]}]}